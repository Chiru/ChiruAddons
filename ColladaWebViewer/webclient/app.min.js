(function(b){if(/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|meego.+mobile|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|pad|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))){window.mobile=true}})(navigator.userAgent||navigator.vendor||window.opera);var THREE=THREE||{REVISION:"52dev"};if(self.console===undefined){self.console={info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}}}if(self.Int32Array===undefined){self.Int32Array=Array;self.Float32Array=Array}if(String.prototype.startsWith===undefined){String.prototype.startsWith=function(a){return this.slice(0,a.length)===a}}if(String.prototype.endsWith===undefined){String.prototype.endsWith=function(c){var b=String(c);var a=this.lastIndexOf(b);return a>=0&&a===this.length-b.length}}if(!String.prototype.trim===undefined){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(window.requestAnimationFrame===undefined){window.requestAnimationFrame=function(h,e){var d=Date.now(),f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(window.cancelAnimationFrame===undefined){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=1000;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.Clock=function(a){this.autoStart=(a!==undefined)?a:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype.start=function(){this.startTime=Date.now();this.oldTime=this.startTime;this.running=true};THREE.Clock.prototype.stop=function(){this.getElapsedTime();this.running=false};THREE.Clock.prototype.getElapsedTime=function(){this.elapsedTime+=this.getDelta();return this.elapsedTime};THREE.Clock.prototype.getDelta=function(){var b=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var a=Date.now();b=0.001*(a-this.oldTime);this.oldTime=a;this.elapsedTime+=b}return b};THREE.Color=function(a){if(a!==undefined){this.setHex(a)}return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},convertGammaToLinear:function(){var d=this.r,c=this.g,a=this.b;this.r=d*d;this.g=c*c;this.b=a*a;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},setRGB:function(d,c,a){this.r=d;this.g=c;this.b=a;return this},setHSV:function(e,d,a){var c,j,k,g,b;if(a===0){this.r=this.g=this.b=0}else{c=Math.floor(e*6);j=(e*6)-c;k=a*(1-d);g=a*(1-(d*j));b=a*(1-(d*(1-j)));if(c===0){this.r=a;this.g=b;this.b=k}else{if(c===1){this.r=g;this.g=a;this.b=k}else{if(c===2){this.r=k;this.g=a;this.b=b}else{if(c===3){this.r=k;this.g=g;this.b=a}else{if(c===4){this.r=b;this.g=k;this.b=a}else{if(c===5){this.r=a;this.g=k;this.b=g}}}}}}}return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},lerpSelf:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},getHex:function(){return(this.r*255)<<16^(this.g*255)<<8^(this.b*255)<<0},getContextStyle:function(){return"rgb("+((this.r*255)|0)+","+((this.g*255)|0)+","+((this.b*255)|0)+")"},clone:function(){return new THREE.Color().setRGB(this.r,this.g,this.b)}};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},sub:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(a){if(a){this.x/=a;this.y/=a}else{this.set(0,0)}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(c){var b=this.x-c.x,a=this.y-c.y;return b*b+a*a},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},equals:function(a){return((a.x===this.x)&&(a.y===this.y))},isZero:function(){return(this.lengthSq()<0.0001)},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,c,b){this.x=a;this.y=c;this.z=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(d,c){this.x=d.x*c.x;this.y=d.y*c.y;this.z=d.z*c.z;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideSelf:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){if(a){this.x/=a;this.y/=a;this.z/=a}else{this.x=0;this.y=0;this.z=0}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},cross:function(d,c){this.x=d.y*c.z-d.z*c.y;this.y=d.z*c.x-d.x*c.z;this.z=d.x*c.y-d.y*c.x;return this},crossSelf:function(b){var a=this.x,d=this.y,c=this.z;this.x=d*b.z-c*b.y;this.y=c*b.x-a*b.z;this.z=a*b.y-d*b.x;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return new THREE.Vector3().sub(this,a).lengthSq()},getPositionFromMatrix:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},setEulerFromRotationMatrix:function(e,f){function i(m){return Math.min(Math.max(m,-1),1)}var d=e.elements;var j=d[0],h=d[4],g=d[8];var c=d[1],b=d[5],a=d[9];var n=d[2],l=d[6],k=d[10];if(f===undefined||f==="XYZ"){this.y=Math.asin(i(g));if(Math.abs(g)<0.99999){this.x=Math.atan2(-a,k);this.z=Math.atan2(-h,j)}else{this.x=Math.atan2(l,b);this.z=0}}else{if(f==="YXZ"){this.x=Math.asin(-i(a));if(Math.abs(a)<0.99999){this.y=Math.atan2(g,k);this.z=Math.atan2(c,b)}else{this.y=Math.atan2(-n,j);this.z=0}}else{if(f==="ZXY"){this.x=Math.asin(i(l));if(Math.abs(l)<0.99999){this.y=Math.atan2(-n,k);this.z=Math.atan2(-h,b)}else{this.y=0;this.z=Math.atan2(c,j)}}else{if(f==="ZYX"){this.y=Math.asin(-i(n));if(Math.abs(n)<0.99999){this.x=Math.atan2(l,k);this.z=Math.atan2(c,j)}else{this.x=0;this.z=Math.atan2(-h,b)}}else{if(f==="YZX"){this.z=Math.asin(i(c));if(Math.abs(c)<0.99999){this.x=Math.atan2(-a,b);this.y=Math.atan2(-n,j)}else{this.x=0;this.y=Math.atan2(g,k)}}else{if(f==="XZY"){this.z=Math.asin(-i(h));if(Math.abs(h)<0.99999){this.x=Math.atan2(l,b);this.y=Math.atan2(g,j)}else{this.x=Math.atan2(-a,k);this.y=0}}}}}}}return this},setEulerFromQuaternion:function(d,a){function g(h){return Math.min(Math.max(h,-1),1)}var e=d.x*d.x;var c=d.y*d.y;var b=d.z*d.z;var f=d.w*d.w;if(a===undefined||a==="XYZ"){this.x=Math.atan2(2*(d.x*d.w-d.y*d.z),(f-e-c+b));this.y=Math.asin(g(2*(d.x*d.z+d.y*d.w)));this.z=Math.atan2(2*(d.z*d.w-d.x*d.y),(f+e-c-b))}else{if(a==="YXZ"){this.x=Math.asin(g(2*(d.x*d.w-d.y*d.z)));this.y=Math.atan2(2*(d.x*d.z+d.y*d.w),(f-e-c+b));this.z=Math.atan2(2*(d.x*d.y+d.z*d.w),(f-e+c-b))}else{if(a==="ZXY"){this.x=Math.asin(g(2*(d.x*d.w+d.y*d.z)));this.y=Math.atan2(2*(d.y*d.w-d.z*d.x),(f-e-c+b));this.z=Math.atan2(2*(d.z*d.w-d.x*d.y),(f-e+c-b))}else{if(a==="ZYX"){this.x=Math.atan2(2*(d.x*d.w+d.z*d.y),(f-e-c+b));this.y=Math.asin(g(2*(d.y*d.w-d.x*d.z)));this.z=Math.atan2(2*(d.x*d.y+d.z*d.w),(f+e-c-b))}else{if(a==="YZX"){this.x=Math.atan2(2*(d.x*d.w-d.z*d.y),(f-e+c-b));this.y=Math.atan2(2*(d.y*d.w-d.x*d.z),(f+e-c-b));this.z=Math.asin(g(2*(d.x*d.y+d.z*d.w)))}else{if(a==="XZY"){this.x=Math.atan2(2*(d.x*d.w+d.y*d.z),(f-e+c-b));this.y=Math.atan2(2*(d.x*d.z+d.y*d.w),(f+e-c-b));this.z=Math.asin(g(2*(d.z*d.w-d.x*d.y)))}}}}}}return this},getScaleFromMatrix:function(a){var d=this.set(a.elements[0],a.elements[1],a.elements[2]).length();var c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();var b=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=d;this.y=c;this.z=b;return this},equals:function(a){return((a.x===this.x)&&(a.y===this.y)&&(a.z===this.z))},isZero:function(){return(this.lengthSq()<0.0001)},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(a,d,c,b){this.x=a||0;this.y=d||0;this.z=c||0;this.w=(b!==undefined)?b:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=(a.w!==undefined)?a.w:1;return this},add:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;this.w=d.w+c.w;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;this.w=d.w-c.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScalar:function(a){if(a){this.x/=a;this.y/=a;this.z/=a;this.w/=a}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.normalize().multiplyScalar(a)},lerpSelf:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},setAxisAngleFromQuaternion:function(b){this.w=2*Math.acos(b.w);var a=Math.sqrt(1-b.w*b.w);if(a<0.0001){this.x=1;this.y=0;this.z=0}else{this.x=b.x/a;this.y=b.y/a;this.z=b.z/a}return this},setAxisAngleFromRotationMatrix:function(t){var u,j,i,h,C=0.01,k=0.1,g=t.elements,B=g[0],w=g[4],v=g[8],e=g[1],c=g[5],a=g[9],r=g[2],p=g[6],n=g[10];if((Math.abs(w-e)<C)&&(Math.abs(v-r)<C)&&(Math.abs(a-p)<C)){if((Math.abs(w+e)<k)&&(Math.abs(v+r)<k)&&(Math.abs(a+p)<k)&&(Math.abs(B+c+n-3)<k)){this.set(1,0,0,0);return this}u=Math.PI;var f=(B+1)/2;var q=(c+1)/2;var A=(n+1)/2;var d=(w+e)/4;var b=(v+r)/4;var o=(a+p)/4;if((f>q)&&(f>A)){if(f<C){j=0;i=0.707106781;h=0.707106781}else{j=Math.sqrt(f);i=d/j;h=b/j}}else{if(q>A){if(q<C){j=0.707106781;i=0;h=0.707106781}else{i=Math.sqrt(q);j=d/i;h=o/i}}else{if(A<C){j=0.707106781;i=0.707106781;h=0}else{h=Math.sqrt(A);j=b/h;i=o/h}}}this.set(j,i,h,u);return this}var l=Math.sqrt((p-a)*(p-a)+(v-r)*(v-r)+(e-w)*(e-w));if(Math.abs(l)<0.001){l=1}this.x=(p-a)/l;this.y=(v-r)/l;this.z=(e-w)/l;this.w=Math.acos((B+c+n-1)/2);return this}};THREE.Matrix3=function(){this.elements=new Float32Array(9)};THREE.Matrix3.prototype={constructor:THREE.Matrix3,getInverse:function(k){var j=k.elements;var o=j[10]*j[5]-j[6]*j[9];var i=-j[10]*j[1]+j[2]*j[9];var d=j[6]*j[1]-j[2]*j[5];var n=-j[10]*j[4]+j[6]*j[8];var g=j[10]*j[0]-j[2]*j[8];var c=-j[6]*j[0]+j[2]*j[4];var l=j[9]*j[4]-j[5]*j[8];var f=-j[9]*j[0]+j[1]*j[8];var a=j[5]*j[0]-j[1]*j[4];var h=j[0]*o+j[1]*n+j[2]*l;if(h===0){console.warn("Matrix3.getInverse(): determinant == 0")}var b=1/h;var e=this.elements;e[0]=b*o;e[1]=b*i;e[2]=b*d;e[3]=b*n;e[4]=b*g;e[5]=b*c;e[6]=b*l;e[7]=b*f;e[8]=b*a;return this},transpose:function(){var b,a=this.elements;b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},transposeIntoArray:function(b){var a=this.m;b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return this}};THREE.Matrix4=function(m,l,j,h,e,d,c,b,a,p,o,n,k,i,g,f){this.elements=new Float32Array(16);this.set((m!==undefined)?m:1,l||0,j||0,h||0,e||0,(d!==undefined)?d:1,c||0,b||0,a||0,p||0,(o!==undefined)?o:1,n||0,k||0,i||0,g||0,(f!==undefined)?f:1)};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(n,m,k,i,f,e,d,c,a,q,p,o,l,j,h,g){var b=this.elements;b[0]=n;b[4]=m;b[8]=k;b[12]=i;b[1]=f;b[5]=e;b[9]=d;b[13]=c;b[2]=a;b[6]=q;b[10]=p;b[14]=o;b[3]=l;b[7]=j;b[11]=h;b[15]=g;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){var b=a.elements;this.set(b[0],b[4],b[8],b[12],b[1],b[5],b[9],b[13],b[2],b[6],b[10],b[14],b[3],b[7],b[11],b[15]);return this},lookAt:function(c,d,b){var f=this.elements;var a=THREE.Matrix4.__v1;var g=THREE.Matrix4.__v2;var e=THREE.Matrix4.__v3;e.sub(c,d).normalize();if(e.length()===0){e.z=1}a.cross(b,e).normalize();if(a.length()===0){e.x+=0.0001;a.cross(b,e).normalize()}g.cross(e,a);f[0]=a.x;f[4]=g.x;f[8]=e.x;f[1]=a.y;f[5]=g.y;f[9]=e.y;f[2]=a.z;f[6]=g.z;f[10]=e.z;return this},multiply:function(M,L){var s=M.elements;var K=L.elements;var c=this.elements;var p=s[0],n=s[4],m=s[8],l=s[12];var J=s[1],I=s[5],H=s[9],G=s[13];var B=s[2],A=s[6],z=s[10],y=s[14];var t=s[3],r=s[7],q=s[11],o=s[15];var i=K[0],g=K[4],e=K[8],d=K[12];var F=K[1],E=K[5],D=K[9],C=K[13];var x=K[2],w=K[6],v=K[10],u=K[14];var k=K[3],j=K[7],h=K[11],f=K[15];c[0]=p*i+n*F+m*x+l*k;c[4]=p*g+n*E+m*w+l*j;c[8]=p*e+n*D+m*v+l*h;c[12]=p*d+n*C+m*u+l*f;c[1]=J*i+I*F+H*x+G*k;c[5]=J*g+I*E+H*w+G*j;c[9]=J*e+I*D+H*v+G*h;c[13]=J*d+I*C+H*u+G*f;c[2]=B*i+A*F+z*x+y*k;c[6]=B*g+A*E+z*w+y*j;c[10]=B*e+A*D+z*v+y*h;c[14]=B*d+A*C+z*u+y*f;c[3]=t*i+r*F+q*x+o*k;c[7]=t*g+r*E+q*w+o*j;c[11]=t*e+r*D+q*v+o*h;c[15]=t*d+r*C+q*u+o*f;return this},multiplySelf:function(a){return this.multiply(this,a)},multiplyToArray:function(d,c,e){var f=this.elements;this.multiply(d,c);e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=f[3];e[4]=f[4];e[5]=f[5];e[6]=f[6];e[7]=f[7];e[8]=f[8];e[9]=f[9];e[10]=f[10];e[11]=f[11];e[12]=f[12];e[13]=f[13];e[14]=f[14];e[15]=f[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){var g=this.elements;var e=a.x,c=a.y,b=a.z;var f=1/(g[3]*e+g[7]*c+g[11]*b+g[15]);a.x=(g[0]*e+g[4]*c+g[8]*b+g[12])*f;a.y=(g[1]*e+g[5]*c+g[9]*b+g[13])*f;a.z=(g[2]*e+g[6]*c+g[10]*b+g[14])*f;return a},multiplyVector4:function(a){var f=this.elements;var d=a.x,c=a.y,b=a.z,e=a.w;a.x=f[0]*d+f[4]*c+f[8]*b+f[12]*e;a.y=f[1]*d+f[5]*c+f[9]*b+f[13]*e;a.z=f[2]*d+f[6]*c+f[10]*b+f[14]*e;a.w=f[3]*d+f[7]*c+f[11]*b+f[15]*e;return a},multiplyVector3Array:function(b){var e=THREE.Matrix4.__v1;for(var d=0,c=b.length;d<c;d+=3){e.x=b[d];e.y=b[d+1];e.z=b[d+2];this.multiplyVector3(e);b[d]=e.x;b[d+1]=e.y;b[d+2]=e.z}return b},rotateAxis:function(a){var e=this.elements;var d=a.x,c=a.y,b=a.z;a.x=d*e[0]+c*e[4]+b*e[8];a.y=d*e[1]+c*e[5]+b*e[9];a.z=d*e[2]+c*e[6]+b*e[10];a.normalize();return a},crossVector:function(b){var d=this.elements;var c=new THREE.Vector4();c.x=d[0]*b.x+d[4]*b.y+d[8]*b.z+d[12]*b.w;c.y=d[1]*b.x+d[5]*b.y+d[9]*b.z+d[13]*b.w;c.z=d[2]*b.x+d[6]*b.y+d[10]*b.z+d[14]*b.w;c.w=(b.w)?d[3]*b.x+d[7]*b.y+d[11]*b.z+d[15]*b.w:1;return c},determinant:function(){var c=this.elements;var n=c[0],m=c[4],k=c[8],i=c[12];var f=c[1],e=c[5],d=c[9],b=c[13];var a=c[2],q=c[6],p=c[10],o=c[14];var l=c[3],j=c[7],h=c[11],g=c[15];return(i*d*q*l-k*b*q*l-i*e*p*l+m*b*p*l+k*e*o*l-m*d*o*l-i*d*a*j+k*b*a*j+i*f*p*j-n*b*p*j-k*f*o*j+n*d*o*j+i*e*a*h-m*b*a*h-i*f*q*h+n*b*q*h+m*f*o*h-n*e*o*h-k*e*a*g+m*d*a*g+k*f*q*g-n*d*q*g-m*f*p*g+n*e*p*g)},transpose:function(){var b=this.elements;var a;a=b[1];b[1]=b[4];b[4]=a;a=b[2];b[2]=b[8];b[8]=a;a=b[6];b[6]=b[9];b[9]=a;a=b[3];b[3]=b[12];b[12]=a;a=b[7];b[7]=b[13];b[13]=a;a=b[11];b[11]=b[14];b[14]=a;return this},flattenToArray:function(b){var a=this.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},flattenToArrayOffset:function(c,b){var a=this.elements;c[b]=a[0];c[b+1]=a[1];c[b+2]=a[2];c[b+3]=a[3];c[b+4]=a[4];c[b+5]=a[5];c[b+6]=a[6];c[b+7]=a[7];c[b+8]=a[8];c[b+9]=a[9];c[b+10]=a[10];c[b+11]=a[11];c[b+12]=a[12];c[b+13]=a[13];c[b+14]=a[14];c[b+15]=a[15];return c},getPosition:function(){var a=this.elements;return THREE.Matrix4.__v1.set(a[12],a[13],a[14])},setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getColumnX:function(){var a=this.elements;return THREE.Matrix4.__v1.set(a[0],a[1],a[2])},getColumnY:function(){var a=this.elements;return THREE.Matrix4.__v1.set(a[4],a[5],a[6])},getColumnZ:function(){var a=this.elements;return THREE.Matrix4.__v1.set(a[8],a[9],a[10])},getInverse:function(o){var e=this.elements;var t=o.elements;var k=t[0],j=t[4],h=t[8],f=t[12];var s=t[1],r=t[5],q=t[9],p=t[13];var d=t[2],c=t[6],b=t[10],a=t[14];var n=t[3],l=t[7],i=t[11],g=t[15];e[0]=q*a*l-p*b*l+p*c*i-r*a*i-q*c*g+r*b*g;e[4]=f*b*l-h*a*l-f*c*i+j*a*i+h*c*g-j*b*g;e[8]=h*p*l-f*q*l+f*r*i-j*p*i-h*r*g+j*q*g;e[12]=f*q*c-h*p*c-f*r*b+j*p*b+h*r*a-j*q*a;e[1]=p*b*n-q*a*n-p*d*i+s*a*i+q*d*g-s*b*g;e[5]=h*a*n-f*b*n+f*d*i-k*a*i-h*d*g+k*b*g;e[9]=f*q*n-h*p*n-f*s*i+k*p*i+h*s*g-k*q*g;e[13]=h*p*d-f*q*d+f*s*b-k*p*b-h*s*a+k*q*a;e[2]=r*a*n-p*c*n+p*d*l-s*a*l-r*d*g+s*c*g;e[6]=f*c*n-j*a*n-f*d*l+k*a*l+j*d*g-k*c*g;e[10]=j*p*n-f*r*n+f*s*l-k*p*l-j*s*g+k*r*g;e[14]=f*r*d-j*p*d-f*s*c+k*p*c+j*s*a-k*r*a;e[3]=q*c*n-r*b*n-q*d*l+s*b*l+r*d*i-s*c*i;e[7]=j*b*n-h*c*n+h*d*l-k*b*l-j*d*i+k*c*i;e[11]=h*r*n-j*q*n-h*s*l+k*q*l+j*s*i-k*r*i;e[15]=j*q*d-h*r*d+h*s*c-k*q*c-j*s*b+k*r*b;this.multiplyScalar(1/o.determinant());return this},setRotationFromEuler:function(o,r){var k=this.elements;var n=o.x,m=o.y,l=o.z;var H=Math.cos(n),G=Math.sin(n);var E=Math.cos(m),B=Math.sin(m);var u=Math.cos(l),s=Math.sin(l);if(r===undefined||r==="XYZ"){var A=H*u,t=H*s,h=G*u,g=G*s;k[0]=E*u;k[4]=-E*s;k[8]=B;k[1]=t+h*B;k[5]=A-g*B;k[9]=-G*E;k[2]=g-A*B;k[6]=h+t*B;k[10]=H*E}else{if(r==="YXZ"){var q=E*u,p=E*s,D=B*u,w=B*s;k[0]=q+w*G;k[4]=D*G-p;k[8]=H*B;k[1]=H*s;k[5]=H*u;k[9]=-G;k[2]=p*G-D;k[6]=w+q*G;k[10]=H*E}else{if(r==="ZXY"){var q=E*u,p=E*s,D=B*u,w=B*s;k[0]=q-w*G;k[4]=-H*s;k[8]=D+p*G;k[1]=p+D*G;k[5]=H*u;k[9]=w-q*G;k[2]=-H*B;k[6]=G;k[10]=H*E}else{if(r==="ZYX"){var A=H*u,t=H*s,h=G*u,g=G*s;k[0]=E*u;k[4]=h*B-t;k[8]=A*B+g;k[1]=E*s;k[5]=g*B+A;k[9]=t*B-h;k[2]=-B;k[6]=G*E;k[10]=H*E}else{if(r==="YZX"){var F=H*E,C=H*B,j=G*E,i=G*B;k[0]=E*u;k[4]=i-F*s;k[8]=j*s+C;k[1]=s;k[5]=H*u;k[9]=-G*u;k[2]=-B*u;k[6]=C*s+j;k[10]=F-i*s}else{if(r==="XZY"){var F=H*E,C=H*B,j=G*E,i=G*B;k[0]=E*u;k[4]=-s;k[8]=B*u;k[1]=F*s+i;k[5]=H*u;k[9]=C*s-j;k[2]=j*s-C;k[6]=G*u;k[10]=i*s+F}}}}}}return this},setRotationFromQuaternion:function(l){var e=this.elements;var h=l.x,g=l.y,f=l.z,i=l.w;var n=h+h,a=g+g,j=f+f;var d=h*n,c=h*a,b=h*j;var m=g*a,k=g*j,r=f*j;var s=i*n,p=i*a,o=i*j;e[0]=1-(m+r);e[4]=c-o;e[8]=b+p;e[1]=c+o;e[5]=1-(d+r);e[9]=k-s;e[2]=b-p;e[6]=k+s;e[10]=1-(d+m);return this},compose:function(f,a,e){var d=this.elements;var c=THREE.Matrix4.__m1;var b=THREE.Matrix4.__m2;c.identity();c.setRotationFromQuaternion(a);b.makeScale(e.x,e.y,e.z);this.multiply(c,b);d[12]=f.x;d[13]=f.y;d[14]=f.z;return this},decompose:function(h,c,f){var e=this.elements;var a=THREE.Matrix4.__v1;var g=THREE.Matrix4.__v2;var d=THREE.Matrix4.__v3;a.set(e[0],e[1],e[2]);g.set(e[4],e[5],e[6]);d.set(e[8],e[9],e[10]);h=(h instanceof THREE.Vector3)?h:new THREE.Vector3();c=(c instanceof THREE.Quaternion)?c:new THREE.Quaternion();f=(f instanceof THREE.Vector3)?f:new THREE.Vector3();f.x=a.length();f.y=g.length();f.z=d.length();h.x=e[12];h.y=e[13];h.z=e[14];var b=THREE.Matrix4.__m1;b.copy(this);b.elements[0]/=f.x;b.elements[1]/=f.x;b.elements[2]/=f.x;b.elements[4]/=f.y;b.elements[5]/=f.y;b.elements[6]/=f.y;b.elements[8]/=f.z;b.elements[9]/=f.z;b.elements[10]/=f.z;c.setFromRotationMatrix(b);return[h,c,f]},extractPosition:function(a){var c=this.elements;var b=a.elements;c[12]=b[12];c[13]=b[13];c[14]=b[14];return this},extractRotation:function(a){var g=this.elements;var f=a.elements;var c=THREE.Matrix4.__v1;var e=1/c.set(f[0],f[1],f[2]).length();var d=1/c.set(f[4],f[5],f[6]).length();var b=1/c.set(f[8],f[9],f[10]).length();g[0]=f[0]*e;g[1]=f[1]*e;g[2]=f[2]*e;g[4]=f[4]*d;g[5]=f[5]*d;g[6]=f[6]*d;g[8]=f[8]*b;g[9]=f[9]*b;g[10]=f[10]*b;return this},translate:function(b){var d=this.elements;var a=b.x,e=b.y,c=b.z;d[12]=d[0]*a+d[4]*e+d[8]*c+d[12];d[13]=d[1]*a+d[5]*e+d[9]*c+d[13];d[14]=d[2]*a+d[6]*e+d[10]*c+d[14];d[15]=d[3]*a+d[7]*e+d[11]*c+d[15];return this},rotateX:function(e){var d=this.elements;var i=d[4];var b=d[5];var l=d[6];var h=d[7];var g=d[8];var a=d[9];var k=d[10];var f=d[11];var j=Math.cos(e);var m=Math.sin(e);d[4]=j*i+m*g;d[5]=j*b+m*a;d[6]=j*l+m*k;d[7]=j*h+m*f;d[8]=j*g-m*i;d[9]=j*a-m*b;d[10]=j*k-m*l;d[11]=j*f-m*h;return this},rotateY:function(e){var d=this.elements;var i=d[0];var b=d[1];var l=d[2];var h=d[3];var g=d[8];var a=d[9];var k=d[10];var f=d[11];var j=Math.cos(e);var m=Math.sin(e);d[0]=j*i-m*g;d[1]=j*b-m*a;d[2]=j*l-m*k;d[3]=j*h-m*f;d[8]=j*g+m*i;d[9]=j*a+m*b;d[10]=j*k+m*l;d[11]=j*f+m*h;return this},rotateZ:function(e){var d=this.elements;var i=d[0];var b=d[1];var l=d[2];var h=d[3];var g=d[4];var a=d[5];var k=d[6];var f=d[7];var j=Math.cos(e);var m=Math.sin(e);d[0]=j*i+m*g;d[1]=j*b+m*a;d[2]=j*l+m*k;d[3]=j*h+m*f;d[4]=j*g-m*i;d[5]=j*a-m*b;d[6]=j*k-m*l;d[7]=j*f-m*h;return this},rotateByAxis:function(o,m){var a=this.elements;if(o.x===1&&o.y===0&&o.z===0){return this.rotateX(m)}else{if(o.x===0&&o.y===1&&o.z===0){return this.rotateY(m)}else{if(o.x===0&&o.y===0&&o.z===1){return this.rotateZ(m)}}}var H=o.x,G=o.y,F=o.z;var K=Math.sqrt(H*H+G*G+F*F);H/=K;G/=K;F/=K;var A=H*H,h=G*G,S=F*F;var U=Math.cos(m);var I=Math.sin(m);var p=1-U;var w=H*G*p;var v=H*F*p;var g=G*F*p;var C=H*I;var l=G*I;var X=F*I;var k=A+(1-A)*U;var W=w+X;var E=v-l;var j=w-X;var V=h+(1-h)*U;var D=g+C;var i=v+l;var T=g-C;var B=S+(1-S)*U;var P=a[0],u=a[1],f=a[2],R=a[3];var N=a[4],t=a[5],e=a[6],Q=a[7];var L=a[8],r=a[9],d=a[10],O=a[11];var J=a[12],q=a[13],b=a[14],M=a[15];a[0]=k*P+W*N+E*L;a[1]=k*u+W*t+E*r;a[2]=k*f+W*e+E*d;a[3]=k*R+W*Q+E*O;a[4]=j*P+V*N+D*L;a[5]=j*u+V*t+D*r;a[6]=j*f+V*e+D*d;a[7]=j*R+V*Q+D*O;a[8]=i*P+T*N+B*L;a[9]=i*u+T*t+B*r;a[10]=i*f+T*e+B*d;a[11]=i*R+T*Q+B*O;return this},scale:function(b){var d=this.elements;var a=b.x,e=b.y,c=b.z;d[0]*=a;d[4]*=e;d[8]*=c;d[1]*=a;d[5]*=e;d[9]*=c;d[2]*=a;d[6]*=e;d[10]*=c;d[3]*=a;d[7]*=e;d[11]*=c;return this},getMaxScaleOnAxis:function(){var c=this.elements;var d=c[0]*c[0]+c[1]*c[1]+c[2]*c[2];var b=c[4]*c[4]+c[5]*c[5]+c[6]*c[6];var a=c[8]*c[8]+c[9]*c[9]+c[10]*c[10];return Math.sqrt(Math.max(d,Math.max(b,a)))},makeTranslation:function(a,c,b){this.set(1,0,0,a,0,1,0,c,0,0,1,b,0,0,0,1);return this},makeRotationX:function(a){var d=Math.cos(a),b=Math.sin(a);this.set(1,0,0,0,0,d,-b,0,0,b,d,0,0,0,0,1);return this},makeRotationY:function(a){var d=Math.cos(a),b=Math.sin(a);this.set(d,0,b,0,0,1,0,0,-b,0,d,0,0,0,0,1);return this},makeRotationZ:function(a){var d=Math.cos(a),b=Math.sin(a);this.set(d,-b,0,0,b,d,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var f=Math.cos(b);var k=Math.sin(b);var j=1-f;var i=a.x,h=a.y,g=a.z;var e=j*i,d=j*h;this.set(e*i+f,e*h-k*g,e*g+k*h,0,e*h+k*g,d*h+f,d*g-k*i,0,e*g-k*h,d*g+k*i,j*g*g+f,0,0,0,0,1);return this},makeScale:function(a,c,b){this.set(a,0,0,0,0,c,0,0,0,0,b,0,0,0,0,1);return this},makeFrustum:function(g,q,e,n,i,h){var f=this.elements;var p=2*i/(q-g);var m=2*i/(n-e);var o=(q+g)/(q-g);var l=(n+e)/(n-e);var k=-(h+i)/(h-i);var j=-2*h*i/(h-i);f[0]=p;f[4]=0;f[8]=o;f[12]=0;f[1]=0;f[5]=m;f[9]=l;f[13]=0;f[2]=0;f[6]=0;f[10]=k;f[14]=j;f[3]=0;f[7]=0;f[11]=-1;f[15]=0;return this},makePerspective:function(e,c,g,b){var a=g*Math.tan(e*Math.PI/360);var f=-a;var h=f*c;var d=a*c;return this.makeFrustum(h,d,f,a,g,b)},makeOrthographic:function(d,n,k,a,g,f){var c=this.elements;var m=n-d;var e=k-a;var b=f-g;var l=(n+d)/m;var j=(k+a)/e;var i=(f+g)/b;c[0]=2/m;c[4]=0;c[8]=0;c[12]=-l;c[1]=0;c[5]=2/e;c[9]=0;c[13]=-j;c[2]=0;c[6]=0;c[10]=-2/b;c[14]=-i;c[3]=0;c[7]=0;c[11]=0;c[15]=1;return this},clone:function(){var a=this.elements;return new THREE.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}};THREE.Matrix4.__v1=new THREE.Vector3();THREE.Matrix4.__v2=new THREE.Vector3();THREE.Matrix4.__v3=new THREE.Vector3();THREE.Matrix4.__m1=new THREE.Matrix4();THREE.Matrix4.__m2=new THREE.Matrix4();THREE.EventTarget=function(){var a={};this.addEventListener=function(b,c){if(a[b]===undefined){a[b]=[]}if(a[b].indexOf(c)===-1){a[b].push(c)}};this.dispatchEvent=function(b){for(var c in a[b.type]){a[b.type][c](b)}};this.removeEventListener=function(c,d){var b=a[c].indexOf(d);if(b!==-1){a[c].splice(b,1)}}};THREE.Frustum=function(){this.planes=[new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4(),new THREE.Vector4()]};THREE.Frustum.prototype.setFromMatrix=function(q){var a;var j=this.planes;var w=q.elements;var o=w[0],l=w[1],k=w[2],h=w[3];var g=w[4],f=w[5],e=w[6],d=w[7];var c=w[8],b=w[9],v=w[10],t=w[11];var s=w[12],r=w[13],p=w[14],n=w[15];j[0].set(h-o,d-g,t-c,n-s);j[1].set(h+o,d+g,t+c,n+s);j[2].set(h+l,d+f,t+b,n+r);j[3].set(h-l,d-f,t-b,n-r);j[4].set(h-k,d-e,t-v,n-p);j[5].set(h+k,d+e,t+v,n+p);for(var u=0;u<6;u++){a=j[u];a.divideScalar(Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z))}};THREE.Frustum.prototype.contains=function(d){var g=0;var c=this.planes;var b=d.matrixWorld;var f=b.elements;var a=-d.geometry.boundingSphere.radius*b.getMaxScaleOnAxis();for(var e=0;e<6;e++){g=c[e].x*f[12]+c[e].y*f[13]+c[e].z*f[14]+c[e].w;if(g<=a){return false}}return true};THREE.Frustum.__v1=new THREE.Vector3();(function(i){i.Ray=function(r,t,s,q){this.origin=r||new i.Vector3();this.direction=t||new i.Vector3();this.near=s||0;this.far=q||Infinity};var c=new i.Vector3();var n=new i.Vector3();var e=new i.Vector3();var d=new i.Vector3();var h=new i.Vector3();var o=new i.Vector3();var m=new i.Matrix4();var f=function(r,q){return r.distance-q.distance};var l=new i.Vector3(),k=new i.Vector3(),j=new i.Vector3();var a=function(t,u,r){l.sub(r,t);var s=l.dot(u);var q=k.add(t,j.copy(u).multiplyScalar(s));var v=r.distanceTo(q);return v};var b=function(q,B,z,w){l.sub(w,B);k.sub(z,B);j.sub(q,B);var A=l.dot(l);var y=l.dot(k);var x=l.dot(j);var t=k.dot(k);var r=k.dot(j);var s=1/(A*t-y*y);var D=(t*x-y*r)*s;var C=(A*r-y*x)*s;return(D>=0)&&(C>=0)&&(D+C<1)};var g=function(M,A,q){var u,H;if(M instanceof i.Particle){u=a(A.origin,A.direction,M.matrixWorld.getPosition());if(u>M.scale.x){return q}H={distance:u,point:M.position,face:null,object:M};q.push(H)}else{if(M instanceof i.Mesh){var C=M.geometry.boundingSphere.radius*M.matrixWorld.getMaxScaleOnAxis();u=a(A.origin,A.direction,M.matrixWorld.getPosition());if(u>C){return q}var G,y,x,D,N,v=M.geometry,w=v.vertices,t,z,s,B,r,E;z=M.geometry.materials;s=M.material instanceof i.MeshFaceMaterial;r=M.material.side;var L,K,J,I;var F=A.precision;M.matrixRotationWorld.extractRotation(M.matrixWorld);c.copy(A.origin);t=M.matrixWorld;m.getInverse(t);n.copy(c);m.multiplyVector3(n);e.copy(A.direction);m.rotateAxis(e).normalize();for(G=0,y=v.faces.length;G<y;G++){x=v.faces[G];B=s===true?z[x.materialIndex]:M.material;if(B===undefined){continue}r=B.side;d.sub(x.centroid,n);h=x.normal;D=e.dot(h);if(Math.abs(D)<F){continue}N=h.dot(d)/D;if(N<0){continue}if(r===i.DoubleSide||(r===i.FrontSide?D<0:D>0)){o.add(n,e.multiplyScalar(N));if(x instanceof i.Face3){L=w[x.a];K=w[x.b];J=w[x.c];if(b(o,L,K,J)){E=M.matrixWorld.multiplyVector3(o.clone());u=c.distanceTo(E);if(u<A.near||u>A.far){continue}H={distance:u,point:E,face:x,faceIndex:G,object:M};q.push(H)}}else{if(x instanceof i.Face4){L=w[x.a];K=w[x.b];J=w[x.c];I=w[x.d];if(b(o,L,K,I)||b(o,K,J,I)){E=M.matrixWorld.multiplyVector3(o.clone());u=c.distanceTo(E);if(u<A.near||u>A.far){continue}H={distance:u,point:E,face:x,faceIndex:G,object:M};q.push(H)}}}}}}}};var p=function(s,r,u){var v=s.getDescendants();for(var t=0,q=v.length;t<q;t++){g(v[t],r,u)}};i.Ray.prototype.precision=0.0001;i.Ray.prototype.set=function(q,r){this.origin=q;this.direction=r};i.Ray.prototype.intersectObject=function(r,q){var s=[];if(q===true){p(r,this,s)}g(r,this,s);s.sort(f);return s};i.Ray.prototype.intersectObjects=function(u,r){var t=[];for(var s=0,q=u.length;s<q;s++){g(u[s],this,t);if(r===true){p(u[s],this,t)}}t.sort(f);return t}}(THREE));THREE.Rectangle=function(){var e=0;var g=0;var h=0;var d=0;var a=0;var c=0;var f=true;function b(){a=h-e;c=d-g}this.getX=function(){return e};this.getY=function(){return g};this.getWidth=function(){return a};this.getHeight=function(){return c};this.getLeft=function(){return e};this.getTop=function(){return g};this.getRight=function(){return h};this.getBottom=function(){return d};this.set=function(l,k,j,i){f=false;e=l;g=k;h=j;d=i;b()};this.addPoint=function(i,j){if(f===true){f=false;e=i;g=j;h=i;d=j;b()}else{e=e<i?e:i;g=g<j?g:j;h=h>i?h:i;d=d>j?d:j;b()}};this.add3Points=function(l,n,j,m,i,k){if(f===true){f=false;e=l<j?(l<i?l:i):(j<i?j:i);g=n<m?(n<k?n:k):(m<k?m:k);h=l>j?(l>i?l:i):(j>i?j:i);d=n>m?(n>k?n:k):(m>k?m:k);b()}else{e=l<j?(l<i?(l<e?l:e):(i<e?i:e)):(j<i?(j<e?j:e):(i<e?i:e));g=n<m?(n<k?(n<g?n:g):(k<g?k:g)):(m<k?(m<g?m:g):(k<g?k:g));h=l>j?(l>i?(l>h?l:h):(i>h?i:h)):(j>i?(j>h?j:h):(i>h?i:h));d=n>m?(n>k?(n>d?n:d):(k>d?k:d)):(m>k?(m>d?m:d):(k>d?k:d));b()}};this.addRectangle=function(i){if(f===true){f=false;e=i.getLeft();g=i.getTop();h=i.getRight();d=i.getBottom();b()}else{e=e<i.getLeft()?e:i.getLeft();g=g<i.getTop()?g:i.getTop();h=h>i.getRight()?h:i.getRight();d=d>i.getBottom()?d:i.getBottom();b()}};this.inflate=function(i){e-=i;g-=i;h+=i;d+=i;b()};this.minSelf=function(i){e=e>i.getLeft()?e:i.getLeft();g=g>i.getTop()?g:i.getTop();h=h<i.getRight()?h:i.getRight();d=d<i.getBottom()?d:i.getBottom();b()};this.intersects=function(i){if(h<i.getLeft()){return false}if(e>i.getRight()){return false}if(d<i.getTop()){return false}if(g>i.getBottom()){return false}return true};this.empty=function(){f=true;e=0;g=0;h=0;d=0;b()};this.isEmpty=function(){return f}};THREE.Math={clamp:function(d,e,c){return(d<e)?e:((d>c)?c:d)},clampBottom:function(b,c){return b<c?c:b},mapLinear:function(b,c,a,e,d){return e+(b-c)*(d-e)/(a-c)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(0.5-Math.random())},sign:function(a){return(a<0)?-1:((a>0)?1:0)}};THREE.Object3D=function(){this.id=THREE.Object3DCount++;this.name="";this.properties={};this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3();this.rotation=new THREE.Vector3();this.eulerOrder="XYZ";this.scale=new THREE.Vector3(1,1,1);this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4();this.matrixWorld=new THREE.Matrix4();this.matrixRotationWorld=new THREE.Matrix4();this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=true;this.quaternion=new THREE.Quaternion();this.useQuaternion=false;this.boundRadius=0;this.boundRadiusScale=1;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this._vector=new THREE.Vector3()};THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(a){this.matrix.multiply(a,this.matrix);this.scale.getScaleFromMatrix(this.matrix);var b=new THREE.Matrix4().extractRotation(this.matrix);this.rotation.setEulerFromRotationMatrix(b,this.eulerOrder);this.position.getPositionFromMatrix(this.matrix)},translate:function(b,a){this.matrix.rotateAxis(a);this.position.addSelf(a.multiplyScalar(b))},translateX:function(a){this.translate(a,this._vector.set(1,0,0))},translateY:function(a){this.translate(a,this._vector.set(0,1,0))},translateZ:function(a){this.translate(a,this._vector.set(0,0,1))},localToWorld:function(a){return this.matrixWorld.multiplyVector3(a)},worldToLocal:function(a){return THREE.Object3D.__m1.getInverse(this.matrixWorld).multiplyVector3(a)},lookAt:function(a){this.matrix.lookAt(a,this.position,this.up);if(this.rotationAutoUpdate){this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)}},add:function(a){if(a===this){console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");return}if(a instanceof THREE.Object3D){if(a.parent!==undefined){a.parent.remove(a)}a.parent=this;this.children.push(a);var b=this;while(b.parent!==undefined){b=b.parent}if(b!==undefined&&b instanceof THREE.Scene){b.__addObject(a)}}},remove:function(b){var a=this.children.indexOf(b);if(a!==-1){b.parent=undefined;this.children.splice(a,1);var c=this;while(c.parent!==undefined){c=c.parent}if(c!==undefined&&c instanceof THREE.Scene){c.__removeObject(b)}}},getChildByName:function(d,b){var f,a,e;for(f=0,a=this.children.length;f<a;f++){e=this.children[f];if(e.name===d){return e}if(b){e=e.getChildByName(d,b);if(e!==undefined){return e}}}return undefined},getDescendants:function(c){if(c===undefined){c=[]}Array.prototype.push.apply(c,this.children);for(var b=0,a=this.children.length;b<a;b++){this.children[b].getDescendants(c)}return c},updateMatrix:function(){this.matrix.setPosition(this.position);if(this.useQuaternion===false){this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder)}else{this.matrix.setRotationFromQuaternion(this.quaternion)}if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(c){if(this.matrixAutoUpdate===true){this.updateMatrix()}if(this.matrixWorldNeedsUpdate===true||c===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;c=true}for(var b=0,a=this.children.length;b<a;b++){this.children[b].updateMatrixWorld(c)}},clone:function(){}};THREE.Object3D.__m1=new THREE.Matrix4();THREE.Object3DCount=0;THREE.Projector=function(){var O,A,H=[],l=0,v,b,c=[],a=0,h,J,G=[],g=0,n,q=[],x=0,f,L,N=[],t=0,K,m,s=[],F=0,D={objects:[],sprites:[],lights:[],elements:[]},E=new THREE.Vector3(),C=new THREE.Vector4(),d=new THREE.Matrix4(),z=new THREE.Matrix4(),M=new THREE.Frustum(),r=new THREE.Vector4(),e=new THREE.Vector4(),p;this.projectVector=function(P,Q){Q.matrixWorldInverse.getInverse(Q.matrixWorld);d.multiply(Q.projectionMatrix,Q.matrixWorldInverse);d.multiplyVector3(P);return P};this.unprojectVector=function(P,Q){Q.projectionMatrixInverse.getInverse(Q.projectionMatrix);d.multiply(Q.matrixWorld,Q.projectionMatrixInverse);d.multiplyVector3(P);return P};this.pickingRay=function(R,T){var Q,P,S;R.z=-1;Q=new THREE.Vector3(R.x,R.y,1);this.unprojectVector(R,T);this.unprojectVector(Q,T);Q.subSelf(R).normalize();return new THREE.Ray(R,Q)};var I=function(P,Q){A=0;D.objects.length=0;D.sprites.length=0;D.lights.length=0;var R=function(U){for(var V=0,S=U.children.length;V<S;V++){var T=U.children[V];if(T.visible===false){continue}if(T instanceof THREE.Light){D.lights.push(T)}else{if(T instanceof THREE.Mesh||T instanceof THREE.Line){if(T.frustumCulled===false||M.contains(T)===true){O=k();O.object=T;if(T.renderDepth!==null){O.z=T.renderDepth}else{E.copy(T.matrixWorld.getPosition());d.multiplyVector3(E);O.z=E.z}D.objects.push(O)}}else{if(T instanceof THREE.Sprite||T instanceof THREE.Particle){O=k();O.object=T;if(T.renderDepth!==null){O.z=T.renderDepth}else{E.copy(T.matrixWorld.getPosition());d.multiplyVector3(E);O.z=E.z}D.sprites.push(O)}else{O=k();O.object=T;if(T.renderDepth!==null){O.z=T.renderDepth}else{E.copy(T.matrixWorld.getPosition());d.multiplyVector3(E);O.z=E.z}D.objects.push(O)}}}R(T)}};R(P);if(Q===true){D.objects.sort(o)}return D};this.projectScene=function(ad,Z,ai,Q){var ah=Z.near,W=Z.far,ac=false,au,ak,aq,Y,ay,ag,av,aC,aB,af,ar,al,ap,ae,am,V,ax,P,aa,ab,U,T,R,at,an,ao,aE,aD,aA,az,S,aw,X;J=0;n=0;L=0;m=0;D.elements.length=0;ad.updateMatrixWorld();if(Z.parent===undefined){Z.updateMatrixWorld()}Z.matrixWorldInverse.getInverse(Z.matrixWorld);d.multiply(Z.projectionMatrix,Z.matrixWorldInverse);M.setFromMatrix(d);D=I(ad,ai);for(au=0,ak=D.objects.length;au<ak;au++){ap=D.objects[au].object;ae=ap.matrixWorld;b=0;if(ap instanceof THREE.Mesh){V=ap.geometry;ax=ap.geometry.materials;P=V.vertices;U=V.faces;an=V.faceVertexUvs;am=ap.matrixRotationWorld.extractRotation(ae);S=ap.material instanceof THREE.MeshFaceMaterial;X=ap.material.side;for(aq=0,Y=P.length;aq<Y;aq++){v=u();v.positionWorld.copy(P[aq]);ae.multiplyVector3(v.positionWorld);v.positionScreen.copy(v.positionWorld);d.multiplyVector4(v.positionScreen);v.positionScreen.x/=v.positionScreen.w;v.positionScreen.y/=v.positionScreen.w;v.visible=v.positionScreen.z>ah&&v.positionScreen.z<W}for(ay=0,ag=U.length;ay<ag;ay++){T=U[ay];aw=S===true?ax[T.materialIndex]:ap.material;if(aw===undefined){continue}X=aw.side;if(T instanceof THREE.Face3){aE=c[T.a];aD=c[T.b];aA=c[T.c];if(aE.visible===true&&aD.visible===true&&aA.visible===true){ac=((aA.positionScreen.x-aE.positionScreen.x)*(aD.positionScreen.y-aE.positionScreen.y)-(aA.positionScreen.y-aE.positionScreen.y)*(aD.positionScreen.x-aE.positionScreen.x))<0;if(X===THREE.DoubleSide||ac===(X===THREE.FrontSide)){h=j();h.v1.copy(aE);h.v2.copy(aD);h.v3.copy(aA)}else{continue}}else{continue}}else{if(T instanceof THREE.Face4){aE=c[T.a];aD=c[T.b];aA=c[T.c];az=c[T.d];if(aE.visible===true&&aD.visible===true&&aA.visible===true&&az.visible===true){ac=(az.positionScreen.x-aE.positionScreen.x)*(aD.positionScreen.y-aE.positionScreen.y)-(az.positionScreen.y-aE.positionScreen.y)*(aD.positionScreen.x-aE.positionScreen.x)<0||(aD.positionScreen.x-aA.positionScreen.x)*(az.positionScreen.y-aA.positionScreen.y)-(aD.positionScreen.y-aA.positionScreen.y)*(az.positionScreen.x-aA.positionScreen.x)<0;if(X===THREE.DoubleSide||ac===(X===THREE.FrontSide)){h=i();h.v1.copy(aE);h.v2.copy(aD);h.v3.copy(aA);h.v4.copy(az)}else{continue}}else{continue}}}h.normalWorld.copy(T.normal);if(ac===false&&(X===THREE.BackSide||X===THREE.DoubleSide)){h.normalWorld.negate()}am.multiplyVector3(h.normalWorld);h.centroidWorld.copy(T.centroid);ae.multiplyVector3(h.centroidWorld);h.centroidScreen.copy(h.centroidWorld);d.multiplyVector3(h.centroidScreen);R=T.vertexNormals;for(av=0,aC=R.length;av<aC;av++){at=h.vertexNormalsWorld[av];at.copy(R[av]);if(ac===false&&(X===THREE.BackSide||X===THREE.DoubleSide)){at.negate()}am.multiplyVector3(at)}h.vertexNormalsLength=R.length;for(aB=0,af=an.length;aB<af;aB++){ao=an[aB][ay];if(ao===undefined){continue}for(ar=0,al=ao.length;ar<al;ar++){h.uvs[aB][ar]=ao[ar]}}h.material=aw;h.z=h.centroidScreen.z;D.elements.push(h)}}else{if(ap instanceof THREE.Line){z.multiply(d,ae);P=ap.geometry.vertices;aE=u();aE.positionScreen.copy(P[0]);z.multiplyVector4(aE.positionScreen);var aj=ap.type===THREE.LinePieces?2:1;for(aq=1,Y=P.length;aq<Y;aq++){aE=u();aE.positionScreen.copy(P[aq]);z.multiplyVector4(aE.positionScreen);if((aq+1)%aj>0){continue}aD=c[b-2];r.copy(aE.positionScreen);e.copy(aD.positionScreen);if(w(r,e)===true){r.multiplyScalar(1/r.w);e.multiplyScalar(1/e.w);f=B();f.v1.positionScreen.copy(r);f.v2.positionScreen.copy(e);f.z=Math.max(r.z,e.z);f.material=ap.material;D.elements.push(f)}}}}}for(au=0,ak=D.sprites.length;au<ak;au++){ap=D.sprites[au].object;ae=ap.matrixWorld;if(ap instanceof THREE.Particle){C.set(ae.elements[12],ae.elements[13],ae.elements[14],1);d.multiplyVector4(C);C.z/=C.w;if(C.z>0&&C.z<1){K=y();K.object=ap;K.x=C.x/C.w;K.y=C.y/C.w;K.z=C.z;K.rotation=ap.rotation.z;K.scale.x=ap.scale.x*Math.abs(K.x-(C.x+Z.projectionMatrix.elements[0])/(C.w+Z.projectionMatrix.elements[12]));K.scale.y=ap.scale.y*Math.abs(K.y-(C.y+Z.projectionMatrix.elements[5])/(C.w+Z.projectionMatrix.elements[13]));K.material=ap.material;D.elements.push(K)}}}if(Q===true){D.elements.sort(o)}return D};function k(){if(A===l){var P=new THREE.RenderableObject();H.push(P);l++;A++;return P}return H[A++]}function u(){if(b===a){var P=new THREE.RenderableVertex();c.push(P);a++;b++;return P}return c[b++]}function j(){if(J===g){var P=new THREE.RenderableFace3();G.push(P);g++;J++;return P}return G[J++]}function i(){if(n===x){var P=new THREE.RenderableFace4();q.push(P);x++;n++;return P}return q[n++]}function B(){if(L===t){var P=new THREE.RenderableLine();N.push(P);t++;L++;return P}return N[L++]}function y(){if(m===F){var P=new THREE.RenderableParticle();s.push(P);F++;m++;return P}return s[m++]}function o(Q,P){return P.z-Q.z}function w(T,S){var R=0,W=1,U=T.z+T.w,Q=S.z+S.w,P=-T.z+T.w,V=-S.z+S.w;if(U>=0&&Q>=0&&P>=0&&V>=0){return true}else{if((U<0&&Q<0)||(P<0&&V<0)){return false}else{if(U<0){R=Math.max(R,U/(U-Q))}else{if(Q<0){W=Math.min(W,U/(U-Q))}}if(P<0){R=Math.max(R,P/(P-V))}else{if(V<0){W=Math.min(W,P/(P-V))}}if(W<R){return false}else{T.lerpSelf(S,R);S.lerpSelf(T,1-W);return true}}}}};THREE.Quaternion=function(a,d,c,b){this.x=a||0;this.y=d||0;this.z=c||0;this.w=(b!==undefined)?b:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this},setFromEuler:function(c,a){var h=Math.cos(c.x/2);var g=Math.cos(c.y/2);var e=Math.cos(c.z/2);var f=Math.sin(c.x/2);var d=Math.sin(c.y/2);var b=Math.sin(c.z/2);if(a===undefined||a==="XYZ"){this.x=f*g*e+h*d*b;this.y=h*d*e-f*g*b;this.z=h*g*b+f*d*e;this.w=h*g*e-f*d*b}else{if(a==="YXZ"){this.x=f*g*e+h*d*b;this.y=h*d*e-f*g*b;this.z=h*g*b-f*d*e;this.w=h*g*e+f*d*b}else{if(a==="ZXY"){this.x=f*g*e-h*d*b;this.y=h*d*e+f*g*b;this.z=h*g*b+f*d*e;this.w=h*g*e-f*d*b}else{if(a==="ZYX"){this.x=f*g*e-h*d*b;this.y=h*d*e+f*g*b;this.z=h*g*b-f*d*e;this.w=h*g*e+f*d*b}else{if(a==="YZX"){this.x=f*g*e+h*d*b;this.y=h*d*e+f*g*b;this.z=h*g*b-f*d*e;this.w=h*g*e-f*d*b}else{if(a==="XZY"){this.x=f*g*e-h*d*b;this.y=h*d*e-f*g*b;this.z=h*g*b+f*d*e;this.w=h*g*e+f*d*b}}}}}}return this},setFromAxisAngle:function(c,d){var a=d/2,b=Math.sin(a);this.x=c.x*b;this.y=c.y*b;this.z=c.z*b;this.w=Math.cos(a);return this},setFromRotationMatrix:function(e){var d=e.elements,i=d[0],h=d[4],g=d[8],c=d[1],b=d[5],a=d[9],l=d[2],k=d[6],j=d[10],f=i+b+j,n;if(f>0){n=0.5/Math.sqrt(f+1);this.w=0.25/n;this.x=(k-a)*n;this.y=(g-l)*n;this.z=(c-h)*n}else{if(i>b&&i>j){n=2*Math.sqrt(1+i-b-j);this.w=(k-a)/n;this.x=0.25*n;this.y=(h+c)/n;this.z=(g+l)/n}else{if(b>j){n=2*Math.sqrt(1+b-i-j);this.w=(g-l)/n;this.x=(h+c)/n;this.y=0.25*n;this.z=(a+k)/n}else{n=2*Math.sqrt(1+j-i-b);this.w=(c-h)/n;this.x=(g+l)/n;this.y=(a+k)/n;this.z=0.25*n}}}return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(a===0){this.x=0;this.y=0;this.z=0;this.w=0}else{a=1/a;this.x=this.x*a;this.y=this.y*a;this.z=this.z*a;this.w=this.w*a}return this},multiply:function(l,k){var i=l.x,h=l.y,g=l.z,j=l.w,e=k.x,d=k.y,c=k.z,f=k.w;this.x=i*f+h*c-g*d+j*e;this.y=-i*c+h*f+g*e+j*d;this.z=i*d-h*e+g*f+j*c;this.w=-i*e-h*d-g*c+j*f;return this},multiplySelf:function(j){var h=this.x,g=this.y,f=this.z,i=this.w,d=j.x,c=j.y,a=j.z,e=j.w;this.x=h*e+i*d+g*a-f*c;this.y=g*e+i*c+f*d-h*a;this.z=f*e+i*a+h*c-g*d;this.w=i*e-h*d-g*c-f*a;return this},multiplyVector3:function(c,m){if(!m){m=c}var l=c.x,k=c.y,j=c.z,h=this.x,g=this.y,f=this.z,i=this.w;var d=i*l+g*j-f*k,b=i*k+f*l-h*j,a=i*j+h*k-g*l,e=-h*l-g*k-f*j;m.x=d*i+e*-h+b*-f-a*-g;m.y=b*i+e*-g+a*-h-d*-f;m.z=a*i+e*-f+d*-g-b*-h;return m},slerpSelf:function(c,k){var i=this.x,h=this.y,g=this.z,j=this.w;var b=j*c.w+i*c.x+h*c.y+g*c.z;if(b<0){this.w=-c.w;this.x=-c.x;this.y=-c.y;this.z=-c.z;b=-b}else{this.copy(c)}if(b>=1){this.w=j;this.x=i;this.y=h;this.z=g;return this}var d=Math.acos(b);var a=Math.sqrt(1-b*b);if(Math.abs(a)<0.001){this.w=0.5*(j+this.w);this.x=0.5*(i+this.x);this.y=0.5*(h+this.y);this.z=0.5*(g+this.z);return this}var f=Math.sin((1-k)*d)/a,e=Math.sin(k*d)/a;this.w=(j*f+this.w*e);this.x=(i*f+this.x*e);this.y=(h*f+this.y*e);this.z=(g*f+this.z*e);return this},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}};THREE.Quaternion.slerp=function(e,c,h,i){var b=e.w*c.w+e.x*c.x+e.y*c.y+e.z*c.z;if(b<0){h.w=-c.w;h.x=-c.x;h.y=-c.y;h.z=-c.z;b=-b}else{h.copy(c)}if(Math.abs(b)>=1){h.w=e.w;h.x=e.x;h.y=e.y;h.z=e.z;return h}var d=Math.acos(b);var a=Math.sqrt(1-b*b);if(Math.abs(a)<0.001){h.w=0.5*(e.w+h.w);h.x=0.5*(e.x+h.x);h.y=0.5*(e.y+h.y);h.z=0.5*(e.z+h.z);return h}var g=Math.sin((1-i)*d)/a;var f=Math.sin(i*d)/a;h.w=(e.w*g+h.w*f);h.x=(e.x*g+h.x*f);h.y=(e.y*g+h.y*f);h.z=(e.z*g+h.z*f);return h};THREE.Vertex=function(a){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.");return a};THREE.Face3=function(f,e,i,h,g,d){this.a=f;this.b=e;this.c=i;this.normal=h instanceof THREE.Vector3?h:new THREE.Vector3();this.vertexNormals=h instanceof Array?h:[];this.color=g instanceof THREE.Color?g:new THREE.Color();this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materialIndex=d;this.centroid=new THREE.Vector3()};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var c=new THREE.Face3(this.a,this.b,this.c);c.normal.copy(this.normal);c.color.copy(this.color);c.centroid.copy(this.centroid);c.materialIndex=this.materialIndex;var b,a;for(b=0,a=this.vertexNormals.length;b<a;b++){c.vertexNormals[b]=this.vertexNormals[b].clone()}for(b=0,a=this.vertexColors.length;b<a;b++){c.vertexColors[b]=this.vertexColors[b].clone()}for(b=0,a=this.vertexTangents.length;b<a;b++){c.vertexTangents[b]=this.vertexTangents[b].clone()}return c}};THREE.Face4=function(g,f,k,j,i,h,e){this.a=g;this.b=f;this.c=k;this.d=j;this.normal=i instanceof THREE.Vector3?i:new THREE.Vector3();this.vertexNormals=i instanceof Array?i:[];this.color=h instanceof THREE.Color?h:new THREE.Color();this.vertexColors=h instanceof Array?h:[];this.vertexTangents=[];this.materialIndex=e;this.centroid=new THREE.Vector3()};THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var c=new THREE.Face4(this.a,this.b,this.c,this.d);c.normal.copy(this.normal);c.color.copy(this.color);c.centroid.copy(this.centroid);c.materialIndex=this.materialIndex;var b,a;for(b=0,a=this.vertexNormals.length;b<a;b++){c.vertexNormals[b]=this.vertexNormals[b].clone()}for(b=0,a=this.vertexColors.length;b<a;b++){c.vertexColors[b]=this.vertexColors[b].clone()}for(b=0,a=this.vertexTangents.length;b<a;b++){c.vertexTangents[b]=this.vertexTangents[b].clone()}return c}};THREE.UV=function(b,a){this.u=b||0;this.v=a||0};THREE.UV.prototype={constructor:THREE.UV,set:function(b,a){this.u=b;this.v=a;return this},copy:function(a){this.u=a.u;this.v=a.v;return this},lerpSelf:function(a,b){this.u+=(a.u-this.u)*b;this.v+=(a.v-this.v)*b;return this},clone:function(){return new THREE.UV(this.u,this.v)}};THREE.Geometry=function(){this.id=THREE.GeometryCount++;this.name="";this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(b){var f=new THREE.Matrix4();f.extractRotation(b);for(var e=0,a=this.vertices.length;e<a;e++){var h=this.vertices[e];b.multiplyVector3(h)}for(var e=0,a=this.faces.length;e<a;e++){var g=this.faces[e];f.multiplyVector3(g.normal);for(var c=0,d=g.vertexNormals.length;c<d;c++){f.multiplyVector3(g.vertexNormals[c])}b.multiplyVector3(g.centroid)}},computeCentroids:function(){var c,b,a;for(c=0,b=this.faces.length;c<b;c++){a=this.faces[c];a.centroid.set(0,0,0);if(a instanceof THREE.Face3){a.centroid.addSelf(this.vertices[a.a]);a.centroid.addSelf(this.vertices[a.b]);a.centroid.addSelf(this.vertices[a.c]);a.centroid.divideScalar(3)}else{if(a instanceof THREE.Face4){a.centroid.addSelf(this.vertices[a.a]);a.centroid.addSelf(this.vertices[a.b]);a.centroid.addSelf(this.vertices[a.c]);a.centroid.addSelf(this.vertices[a.d]);a.centroid.divideScalar(4)}}}},computeFaceNormals:function(){var e,b,m,g,i,j,l,k,d,c,a,h=new THREE.Vector3(),o=new THREE.Vector3();for(j=0,l=this.faces.length;j<l;j++){k=this.faces[j];d=this.vertices[k.a];c=this.vertices[k.b];a=this.vertices[k.c];h.sub(a,c);o.sub(d,c);h.crossSelf(o);if(!h.isZero()){h.normalize()}k.normal.copy(h)}},computeVertexNormals:function(){var a,c,g,e,d,b;if(this.__tmpVertices===undefined){this.__tmpVertices=new Array(this.vertices.length);b=this.__tmpVertices;for(a=0,c=this.vertices.length;a<c;a++){b[a]=new THREE.Vector3()}for(g=0,e=this.faces.length;g<e;g++){d=this.faces[g];if(d instanceof THREE.Face3){d.vertexNormals=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()]}else{if(d instanceof THREE.Face4){d.vertexNormals=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()]}}}}else{b=this.__tmpVertices;for(a=0,c=this.vertices.length;a<c;a++){b[a].set(0,0,0)}}for(g=0,e=this.faces.length;g<e;g++){d=this.faces[g];if(d instanceof THREE.Face3){b[d.a].addSelf(d.normal);b[d.b].addSelf(d.normal);b[d.c].addSelf(d.normal)}else{if(d instanceof THREE.Face4){b[d.a].addSelf(d.normal);b[d.b].addSelf(d.normal);b[d.c].addSelf(d.normal);b[d.d].addSelf(d.normal)}}}for(a=0,c=this.vertices.length;a<c;a++){b[a].normalize()}for(g=0,e=this.faces.length;g<e;g++){d=this.faces[g];if(d instanceof THREE.Face3){d.vertexNormals[0].copy(b[d.a]);d.vertexNormals[1].copy(b[d.b]);d.vertexNormals[2].copy(b[d.c])}else{if(d instanceof THREE.Face4){d.vertexNormals[0].copy(b[d.a]);d.vertexNormals[1].copy(b[d.b]);d.vertexNormals[2].copy(b[d.c]);d.vertexNormals[3].copy(b[d.d])}}}},computeMorphNormals:function(){var e,l,g,m,h;for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];if(!h.__originalFaceNormal){h.__originalFaceNormal=h.normal.clone()}else{h.__originalFaceNormal.copy(h.normal)}if(!h.__originalVertexNormals){h.__originalVertexNormals=[]}for(e=0,l=h.vertexNormals.length;e<l;e++){if(!h.__originalVertexNormals[e]){h.__originalVertexNormals[e]=h.vertexNormals[e].clone()}else{h.__originalVertexNormals[e].copy(h.vertexNormals[e])}}}var c=new THREE.Geometry();c.faces=this.faces;for(e=0,l=this.morphTargets.length;e<l;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var d=this.morphNormals[e].faceNormals;var a=this.morphNormals[e].vertexNormals;var k,b;for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];k=new THREE.Vector3();if(h instanceof THREE.Face3){b={a:new THREE.Vector3(),b:new THREE.Vector3(),c:new THREE.Vector3()}}else{b={a:new THREE.Vector3(),b:new THREE.Vector3(),c:new THREE.Vector3(),d:new THREE.Vector3()}}d.push(k);a.push(b)}}var j=this.morphNormals[e];c.vertices=this.morphTargets[e].vertices;c.computeFaceNormals();c.computeVertexNormals();var k,b;for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];k=j.faceNormals[g];b=j.vertexNormals[g];k.copy(h.normal);if(h instanceof THREE.Face3){b.a.copy(h.vertexNormals[0]);b.b.copy(h.vertexNormals[1]);b.c.copy(h.vertexNormals[2])}else{b.a.copy(h.vertexNormals[0]);b.b.copy(h.vertexNormals[1]);b.c.copy(h.vertexNormals[2]);b.d.copy(h.vertexNormals[3])}}}for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];h.normal=h.__originalFaceNormal;h.vertexNormals=h.__originalVertexNormals}},computeTangents:function(){var L,m,B,k,K,p,z,g,o,H,E,D,e,d,c,j,h,S,R,x,u,O,N,s,q,F,C,b,Q=[],P=[],a=new THREE.Vector3(),l=new THREE.Vector3(),I=new THREE.Vector3(),M=new THREE.Vector3(),J=new THREE.Vector3(),A;for(B=0,k=this.vertices.length;B<k;B++){Q[B]=new THREE.Vector3();P[B]=new THREE.Vector3()}function y(v,i,f,w,t,r,n){H=v.vertices[i];E=v.vertices[f];D=v.vertices[w];e=o[t];d=o[r];c=o[n];j=E.x-H.x;h=D.x-H.x;S=E.y-H.y;R=D.y-H.y;x=E.z-H.z;u=D.z-H.z;O=d.u-e.u;N=c.u-e.u;s=d.v-e.v;q=c.v-e.v;F=1/(O*q-N*s);a.set((q*j-s*h)*F,(q*S-s*R)*F,(q*x-s*u)*F);l.set((O*h-N*j)*F,(O*R-N*S)*F,(O*u-N*x)*F);Q[i].addSelf(a);Q[f].addSelf(a);Q[w].addSelf(a);P[i].addSelf(l);P[f].addSelf(l);P[w].addSelf(l)}for(L=0,m=this.faces.length;L<m;L++){g=this.faces[L];o=this.faceVertexUvs[0][L];if(g instanceof THREE.Face3){y(this,g.a,g.b,g.c,0,1,2)}else{if(g instanceof THREE.Face4){y(this,g.a,g.b,g.d,0,1,3);y(this,g.b,g.c,g.d,1,2,3)}}}var G=["a","b","c","d"];for(L=0,m=this.faces.length;L<m;L++){g=this.faces[L];for(K=0;K<g.vertexNormals.length;K++){J.copy(g.vertexNormals[K]);z=g[G[K]];C=Q[z];I.copy(C);I.subSelf(J.multiplyScalar(J.dot(C))).normalize();M.cross(g.vertexNormals[K],C);b=M.dot(P[z]);A=(b<0)?-1:1;g.vertexTangents[K]=new THREE.Vector4(I.x,I.y,I.z,A)}}this.hasTangents=true},computeBoundingBox:function(){if(!this.boundingBox){this.boundingBox={min:new THREE.Vector3(),max:new THREE.Vector3()}}if(this.vertices.length>0){var b,f=this.vertices[0];this.boundingBox.min.copy(f);this.boundingBox.max.copy(f);var d=this.boundingBox.min,a=this.boundingBox.max;for(var c=1,e=this.vertices.length;c<e;c++){b=this.vertices[c];if(b.x<d.x){d.x=b.x}else{if(b.x>a.x){a.x=b.x}}if(b.y<d.y){d.y=b.y}else{if(b.y>a.y){a.y=b.y}}if(b.z<d.z){d.z=b.z}else{if(b.z>a.z){a.z=b.z}}}}else{this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}},computeBoundingSphere:function(){var b=0;if(this.boundingSphere===null){this.boundingSphere={radius:0}}for(var d=0,a=this.vertices.length;d<a;d++){var c=this.vertices[d].lengthSq();if(c>b){b=c}}this.boundingSphere.radius=Math.sqrt(b)},mergeVertices:function(){var n={};var e=[],q=[];var t,s;var g=4;var l=Math.pow(10,g);var h,p,m;var b="abcd",a,c,d,f,w;for(h=0,p=this.vertices.length;h<p;h++){t=this.vertices[h];s=[Math.round(t.x*l),Math.round(t.y*l),Math.round(t.z*l)].join("_");if(n[s]===undefined){n[s]=h;e.push(this.vertices[h]);q[h]=e.length-1}else{q[h]=q[n[s]]}}for(h=0,p=this.faces.length;h<p;h++){m=this.faces[h];if(m instanceof THREE.Face3){m.a=q[m.a];m.b=q[m.b];m.c=q[m.c]}else{if(m instanceof THREE.Face4){m.a=q[m.a];m.b=q[m.b];m.c=q[m.c];m.d=q[m.d];a=[m.a,m.b,m.c,m.d];for(c=3;c>0;c--){if(a.indexOf(m[b[c]])!==c){a.splice(c,1);this.faces[h]=new THREE.Face3(a[0],a[1],a[2],m.normal,m.color,m.materialIndex);for(d=0,f=this.faceVertexUvs.length;d<f;d++){w=this.faceVertexUvs[d][h];if(w){w.splice(c,1)}}this.faces[h].vertexColors=m.vertexColors;break}}}}}var r=this.vertices.length-e.length;this.vertices=e;return r},clone:function(){}};THREE.GeometryCount=0;THREE.BufferGeometry=function(){this.id=THREE.GeometryCount++;this.attributes={};this.dynamic=false;this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.morphTargets=[]};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,applyMatrix:function(b){var a;var c;if(this.attributes.position){a=this.attributes.position.array}if(this.attributes.normal){c=this.attributes.normal.array}if(a!==undefined){b.multiplyVector3Array(a);this.verticesNeedUpdate=true}if(c!==undefined){var d=new THREE.Matrix4();d.extractRotation(b);d.multiplyVector3Array(c);this.normalsNeedUpdate=true}},computeBoundingBox:function(){if(!this.boundingBox){this.boundingBox={min:new THREE.Vector3(Infinity,Infinity,Infinity),max:new THREE.Vector3(-Infinity,-Infinity,-Infinity)}}var b=this.attributes.position.array;if(b){var f=this.boundingBox;var a,g,e;for(var d=0,c=b.length;d<c;d+=3){a=b[d];g=b[d+1];e=b[d+2];if(a<f.min.x){f.min.x=a}else{if(a>f.max.x){f.max.x=a}}if(g<f.min.y){f.min.y=g}else{if(g>f.max.y){f.max.y=g}}if(e<f.min.z){f.min.z=e}else{if(e>f.max.z){f.max.z=e}}}}if(b===undefined||b.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}},computeBoundingSphere:function(){if(!this.boundingSphere){this.boundingSphere={radius:0}}var c=this.attributes.position.array;if(c){var e,b=0;var a,h,g;for(var f=0,d=c.length;f<d;f+=3){a=c[f];h=c[f+1];g=c[f+2];e=a*a+h*h+g*g;if(e>b){b=e}}this.boundingSphere.radius=Math.sqrt(b)}},computeVertexNormals:function(){if(this.attributes.position&&this.attributes.index){var v,k;var s,A;var C=this.attributes.position.array.length;if(this.attributes.normal===undefined){this.attributes.normal={itemSize:3,array:new Float32Array(C),numItems:C}}else{for(v=0,k=this.attributes.normal.array.length;v<k;v++){this.attributes.normal.array[v]=0}}var c=this.offsets;var b=this.attributes.index.array;var f=this.attributes.position.array;var m=this.attributes.normal.array;var B,w,u,l,h,g,t=new THREE.Vector3(),r=new THREE.Vector3(),q=new THREE.Vector3(),o=new THREE.Vector3(),D=new THREE.Vector3();for(s=0,A=c.length;s<A;++s){var a=c[s].start;var e=c[s].count;var d=c[s].index;for(v=a,k=a+e;v<k;v+=3){B=d+b[v];w=d+b[v+1];u=d+b[v+2];l=f[B*3];h=f[B*3+1];g=f[B*3+2];t.set(l,h,g);l=f[w*3];h=f[w*3+1];g=f[w*3+2];r.set(l,h,g);l=f[u*3];h=f[u*3+1];g=f[u*3+2];q.set(l,h,g);o.sub(q,r);D.sub(t,r);o.crossSelf(D);m[B*3]+=o.x;m[B*3+1]+=o.y;m[B*3+2]+=o.z;m[w*3]+=o.x;m[w*3+1]+=o.y;m[w*3+2]+=o.z;m[u*3]+=o.x;m[u*3+1]+=o.y;m[u*3+2]+=o.z}}for(v=0,k=m.length;v<k;v+=3){l=m[v];h=m[v+1];g=m[v+2];var p=1/Math.sqrt(l*l+h*h+g*g);m[v]*=p;m[v+1]*=p;m[v+2]*=p}this.normalsNeedUpdate=true}},computeTangents:function(){if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var f=this.attributes.index.array;var s=this.attributes.position.array;var y=this.attributes.normal.array;var Q=this.attributes.uv.array;var x=s.length/3;if(this.attributes.tangent===undefined){var z=4*x;this.attributes.tangent={itemSize:4,array:new Float32Array(z),numItems:z}}var G=this.attributes.tangent.array;var an=[],am=[];for(var ag=0;ag<x;ag++){an[ag]=new THREE.Vector3();am[ag]=new THREE.Vector3()}var m,ad,F,l,ab,E,h,Y,C,g,X,e,V,d,T,v,u,ap,ao,O,N,al,ak,M,L,U;var o=new THREE.Vector3(),I=new THREE.Vector3();function P(j,i,k){m=s[j*3];ad=s[j*3+1];F=s[j*3+2];l=s[i*3];ab=s[i*3+1];E=s[i*3+2];h=s[k*3];Y=s[k*3+1];C=s[k*3+2];g=Q[j*2];X=Q[j*2+1];e=Q[i*2];V=Q[i*2+1];d=Q[k*2];T=Q[k*2+1];v=l-m;u=h-m;ap=ab-ad;ao=Y-ad;O=E-F;N=C-F;al=e-g;ak=d-g;M=V-X;L=T-X;U=1/(al*L-ak*M);o.set((L*v-M*u)*U,(L*ap-M*ao)*U,(L*O-M*N)*U);I.set((al*u-ak*v)*U,(al*ao-ak*ap)*U,(al*N-ak*O)*U);an[j].addSelf(o);an[i].addSelf(o);an[k].addSelf(o);am[j].addSelf(I);am[i].addSelf(I);am[k].addSelf(I)}var ai,J;var ah,q;var c,b,a;var B=this.offsets;for(ah=0,q=B.length;ah<q;++ah){var D=B[ah].start;var W=B[ah].count;var K=B[ah].index;for(ai=D,J=D+W;ai<J;ai+=3){c=K+f[ai];b=K+f[ai+1];a=K+f[ai+2];P(c,b,a)}}var aa=new THREE.Vector3(),aj=new THREE.Vector3();var af=new THREE.Vector3(),H=new THREE.Vector3();var R,S,p;var ae,ac,Z;function A(i){af.x=y[i*3];af.y=y[i*3+1];af.z=y[i*3+2];H.copy(af);S=an[i];aa.copy(S);aa.subSelf(af.multiplyScalar(af.dot(S))).normalize();aj.cross(H,S);p=aj.dot(am[i]);R=(p<0)?-1:1;G[i*4]=aa.x;G[i*4+1]=aa.y;G[i*4+2]=aa.z;G[i*4+3]=R}for(ah=0,q=B.length;ah<q;++ah){var D=B[ah].start;var W=B[ah].count;var K=B[ah].index;for(ai=D,J=D+W;ai<J;ai+=3){c=K+f[ai];b=K+f[ai+1];a=K+f[ai+2];A(c);A(b);A(a)}}this.hasTangents=true;this.tangentsNeedUpdate=true}};THREE.Spline=function(n){this.points=n;var h=[],j={x:0,y:0,z:0},m,a,e,d,b,l,k,i,g;this.initFromArray=function(c){this.points=[];for(var o=0;o<c.length;o++){this.points[o]={x:c[o][0],y:c[o][1],z:c[o][2]}}};this.getPoint=function(c){m=(this.points.length-1)*c;a=Math.floor(m);e=m-a;h[0]=a===0?a:a-1;h[1]=a;h[2]=a>this.points.length-2?this.points.length-1:a+1;h[3]=a>this.points.length-3?this.points.length-1:a+2;l=this.points[h[0]];k=this.points[h[1]];i=this.points[h[2]];g=this.points[h[3]];d=e*e;b=e*d;j.x=f(l.x,k.x,i.x,g.x,e,d,b);j.y=f(l.y,k.y,i.y,g.y,e,d,b);j.z=f(l.z,k.z,i.z,g.z,e,d,b);return j};this.getControlPointsArray=function(){var o,r,c=this.points.length,q=[];for(o=0;o<c;o++){r=this.points[o];q[o]=[r.x,r.y,r.z]}return q};this.getLength=function(p){var r,t,u,s,x=0,c=0,q=0,w=new THREE.Vector3(),o=new THREE.Vector3(),v=[],y=0;v[0]=0;if(!p){p=100}u=this.points.length*p;w.copy(this.points[0]);for(r=1;r<u;r++){t=r/u;s=this.getPoint(t);o.copy(s);y+=o.distanceTo(w);w.copy(s);x=(this.points.length-1)*t;c=Math.floor(x);if(c!=q){v[c]=y;q=c}}v[v.length]=y;return{chunks:v,total:y}};this.reparametrizeByArcLength=function(p){var t,s,w,x,q,o,y,v,u,z=[],c=new THREE.Vector3(),r=this.getLength();z.push(c.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){y=r.chunks[t]-r.chunks[t-1];v=Math.ceil(p*y/r.total);x=(t-1)/(this.points.length-1);q=t/(this.points.length-1);for(s=1;s<v-1;s++){w=x+s*(1/v)*(q-x);u=this.getPoint(w);z.push(c.copy(u).clone())}z.push(c.copy(this.points[t]).clone())}this.points=z};function f(v,u,r,q,w,o,c){var s=(r-v)*0.5,p=(q-u)*0.5;return(2*(u-r)+s+p)*c+(-3*(u-r)-2*s-p)*o+s*w+u}};THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4();this.projectionMatrix=new THREE.Matrix4();this.projectionMatrixInverse=new THREE.Matrix4()};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up);if(this.rotationAutoUpdate===true){this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)}};THREE.OrthographicCamera=function(f,c,e,b,d,a){THREE.Camera.call(this);this.left=f;this.right=c;this.top=e;this.bottom=b;this.near=(d!==undefined)?d:0.1;this.far=(a!==undefined)?a:2000;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)};THREE.PerspectiveCamera=function(c,b,d,a){THREE.Camera.call(this);this.fov=c!==undefined?c:50;this.aspect=b!==undefined?b:1;this.near=d!==undefined?d:0.1;this.far=a!==undefined?a:2000;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.setLens=function(b,a){if(a===undefined){a=24}this.fov=2*Math.atan(a/(b*2))*(180/Math.PI);this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(e,c,b,f,d,a){this.fullWidth=e;this.fullHeight=c;this.x=b;this.y=f;this.width=d;this.height=a;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var c=this.fullWidth/this.fullHeight;var g=Math.tan(this.fov*Math.PI/360)*this.near;var b=-g;var f=c*b;var d=c*g;var e=Math.abs(d-f);var a=Math.abs(g-b);this.projectionMatrix.makeFrustum(f+this.x*e/this.fullWidth,f+(this.x+this.width)*e/this.fullWidth,g-(this.y+this.height)*a/this.fullHeight,g-this.y*a/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)}};THREE.Light=function(a){THREE.Object3D.call(this);this.color=new THREE.Color(a)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.AmbientLight=function(a){THREE.Light.call(this,a)};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight=function(b,a,c){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.target=new THREE.Object3D();this.intensity=(a!==undefined)?a:1;this.distance=(c!==undefined)?c:0;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5000;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1000);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,0.99,0.998];this.shadowCascadeFarZ=[0.99,0.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight=function(b,c,a){THREE.Light.call(this,b);this.groundColor=new THREE.Color(c);this.position=new THREE.Vector3(0,100,0);this.intensity=(a!==undefined)?a:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight=function(b,a,c){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,0,0);this.intensity=(a!==undefined)?a:1;this.distance=(c!==undefined)?c:0};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight=function(b,a,e,d,c){THREE.Light.call(this,b);this.position=new THREE.Vector3(0,1,0);this.target=new THREE.Object3D();this.intensity=(a!==undefined)?a:1;this.distance=(e!==undefined)?e:0;this.angle=(d!==undefined)?d:Math.PI/2;this.exponent=(c!==undefined)?c:10;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.Loader=function(a){this.showStatus=a;this.statusDomElement=a?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1000;a.innerHTML="Loading ...";return a},updateProgress:function(a){var b="Loaded ";if(a.total){b+=(100*a.loaded/a.total).toFixed(0)+"%"}else{b+=(a.loaded/1000).toFixed(2)+" KB"}this.statusDomElement.innerHTML=b},extractUrlBase:function(a){var b=a.split("/");b.pop();return(b.length<1?".":b.join("/"))+"/"},initMaterials:function(c,a,d){c.materials=[];for(var b=0;b<a.length;++b){c.materials[b]=THREE.Loader.prototype.createMaterial(a[b],d)}},hasNormals:function(d){var a,c,b=d.materials.length;for(c=0;c<b;c++){a=d.materials[c];if(a instanceof THREE.ShaderMaterial){return true}}return false},createMaterial:function(f,c){var h=this;function e(q){var m=Math.log(q)/Math.LN2;return Math.floor(m)==m}function a(q){var m=Math.log(q)/Math.LN2;return Math.pow(2,Math.round(m))}function n(q,m){var r=new Image();r.onload=function(){if(!e(this.width)||!e(this.height)){var t=a(this.width);var s=a(this.height);q.image.width=t;q.image.height=s;q.image.getContext("2d").drawImage(this,0,0,t,s)}else{q.image=this}q.needsUpdate=true};r.crossOrigin=h.crossOrigin;r.src=m}function j(x,q,v,r,w,s,m){var u=v.toLowerCase().endsWith(".dds");var t=c+"/"+v;if(u){var y=THREE.ImageUtils.loadCompressedTexture(t);x[q]=y}else{var y=document.createElement("canvas");x[q]=new THREE.Texture(y)}x[q].sourceFile=v;if(r){x[q].repeat.set(r[0],r[1]);if(r[0]!==1){x[q].wrapS=THREE.RepeatWrapping}if(r[1]!==1){x[q].wrapT=THREE.RepeatWrapping}}if(w){x[q].offset.set(w[0],w[1])}if(s){var z={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(z[s[0]]!==undefined){x[q].wrapS=z[s[0]]}if(z[s[1]]!==undefined){x[q].wrapT=z[s[1]]}}if(m){x[q].anisotropy=m}if(!u){n(x[q],t)}}function b(m){return(m[0]*255<<16)+(m[1]*255<<8)+m[2]*255}var d="MeshLambertMaterial";var l={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(f.shading){var k=f.shading.toLowerCase();if(k==="phong"){d="MeshPhongMaterial"}else{if(k==="basic"){d="MeshBasicMaterial"}}}if(f.blending!==undefined&&THREE[f.blending]!==undefined){l.blending=THREE[f.blending]}if(f.transparent!==undefined||f.opacity<1){l.transparent=f.transparent}if(f.depthTest!==undefined){l.depthTest=f.depthTest}if(f.depthWrite!==undefined){l.depthWrite=f.depthWrite}if(f.visible!==undefined){l.visible=f.visible}if(f.flipSided!==undefined){l.side=THREE.BackSide}if(f.doubleSided!==undefined){l.side=THREE.DoubleSide}if(f.wireframe!==undefined){l.wireframe=f.wireframe}if(f.vertexColors!==undefined){if(f.vertexColors==="face"){l.vertexColors=THREE.FaceColors}else{if(f.vertexColors){l.vertexColors=THREE.VertexColors}}}if(f.colorDiffuse){l.color=b(f.colorDiffuse)}else{if(f.DbgColor){l.color=f.DbgColor}}if(f.colorSpecular){l.specular=b(f.colorSpecular)}if(f.colorAmbient){l.ambient=b(f.colorAmbient)}if(f.transparency){l.opacity=f.transparency}if(f.specularCoef){l.shininess=f.specularCoef}if(f.mapDiffuse&&c){j(l,"map",f.mapDiffuse,f.mapDiffuseRepeat,f.mapDiffuseOffset,f.mapDiffuseWrap,f.mapDiffuseAnisotropy)}if(f.mapLight&&c){j(l,"lightMap",f.mapLight,f.mapLightRepeat,f.mapLightOffset,f.mapLightWrap,f.mapLightAnisotropy)}if(f.mapBump&&c){j(l,"bumpMap",f.mapBump,f.mapBumpRepeat,f.mapBumpOffset,f.mapBumpWrap,f.mapBumpAnisotropy)}if(f.mapNormal&&c){j(l,"normalMap",f.mapNormal,f.mapNormalRepeat,f.mapNormalOffset,f.mapNormalWrap,f.mapNormalAnisotropy)}if(f.mapSpecular&&c){j(l,"specularMap",f.mapSpecular,f.mapSpecularRepeat,f.mapSpecularOffset,f.mapSpecularWrap,f.mapSpecularAnisotropy)}if(f.mapBumpScale){l.bumpScale=f.mapBumpScale}if(f.mapNormal){var g=THREE.ShaderUtils.lib.normal;var o=THREE.UniformsUtils.clone(g.uniforms);o.tNormal.value=l.normalMap;if(f.mapNormalFactor){o.uNormalScale.value.set(f.mapNormalFactor,f.mapNormalFactor)}if(l.map){o.tDiffuse.value=l.map;o.enableDiffuse.value=true}if(l.specularMap){o.tSpecular.value=l.specularMap;o.enableSpecular.value=true}if(l.lightMap){o.tAO.value=l.lightMap;o.enableAO.value=true}o.uDiffuseColor.value.setHex(l.color);o.uSpecularColor.value.setHex(l.specular);o.uAmbientColor.value.setHex(l.ambient);o.uShininess.value=l.shininess;if(l.opacity!==undefined){o.uOpacity.value=l.opacity}var p={fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:o,lights:true,fog:true};var i=new THREE.ShaderMaterial(p)}else{var i=new THREE[d](l)}if(f.DbgName!==undefined){i.name=f.DbgName}return i}};THREE.BinaryLoader=function(a){THREE.Loader.call(this,a)};THREE.BinaryLoader.prototype=Object.create(THREE.Loader.prototype);THREE.BinaryLoader.prototype.load=function(b,e,d,a){d=d?d:this.extractUrlBase(b);a=a?a:this.extractUrlBase(b);var c=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart();this.loadAjaxJSON(this,b,e,d,a,c)};THREE.BinaryLoader.prototype.loadAjaxJSON=function(c,b,g,e,a,d){var f=new XMLHttpRequest();f.onreadystatechange=function(){if(f.readyState==4){if(f.status==200||f.status==0){var h=JSON.parse(f.responseText);c.loadAjaxBuffers(h,g,a,e,d)}else{console.error("THREE.BinaryLoader: Couldn't load ["+b+"] ["+f.status+"]")}}};f.open("GET",b,true);f.send(null)};THREE.BinaryLoader.prototype.loadAjaxBuffers=function(c,h,a,f,e){var g=new XMLHttpRequest(),b=a+"/"+c.buffers;var d=0;g.onreadystatechange=function(){if(g.readyState==4){if(g.status==200||g.status==0){var i=g.response;if(i===undefined){i=(new Uint8Array(g.responseBody)).buffer}THREE.BinaryLoader.prototype.createBinModel(i,h,f,c.materials)}else{console.error("THREE.BinaryLoader: Couldn't load ["+b+"] ["+g.status+"]")}}else{if(g.readyState==3){if(e){if(d==0){d=g.getResponseHeader("Content-Length")}e({total:d,loaded:g.responseText.length})}}else{if(g.readyState==2){d=g.getResponseHeader("Content-Length")}}}};g.open("GET",b,true);g.responseType="arraybuffer";g.send(null)};THREE.BinaryLoader.prototype.createBinModel=function(h,k,c,l){var d=function(af){var S=this,n=0,C,G=[],V=[],ab,J,u,B,E,I,W,Z,T,A,N,U,r,Q,K,z,s,H;THREE.Geometry.call(this);THREE.Loader.prototype.initMaterials(S,l,af);C=ad(h,n);n+=C.header_bytes;T=C.vertex_index_bytes*3+C.material_index_bytes;A=C.vertex_index_bytes*4+C.material_index_bytes;N=C.ntri_flat*(T);U=C.ntri_smooth*(T+C.normal_index_bytes*3);r=C.ntri_flat_uv*(T+C.uv_index_bytes*3);Q=C.ntri_smooth_uv*(T+C.normal_index_bytes*3+C.uv_index_bytes*3);K=C.nquad_flat*(A);z=C.nquad_smooth*(A+C.normal_index_bytes*4);s=C.nquad_flat_uv*(A+C.uv_index_bytes*4);H=C.nquad_smooth_uv*(A+C.normal_index_bytes*4+C.uv_index_bytes*4);n+=y(n);n+=R(n);n+=O(C.nnormals*3);n+=P(n);ab=n;J=ab+N+O(C.ntri_flat*2);u=J+U+O(C.ntri_smooth*2);B=u+r+O(C.ntri_flat_uv*2);E=B+Q+O(C.ntri_smooth_uv*2);I=E+K+O(C.nquad_flat*2);W=I+z+O(C.nquad_smooth*2);Z=W+s+O(C.nquad_flat_uv*2);ae(u);t(B);v(W);F(Z);aa(ab);ac(J);m(E);q(I);this.computeCentroids();this.computeFaceNormals();if(THREE.Loader.prototype.hasNormals(this)){this.computeTangents()}function O(ag){return(ag%4)?(4-ag%4):0}function ad(ah,ai){var ag={signature:L(ah,ai,12),header_bytes:o(ah,ai+12),vertex_coordinate_bytes:o(ah,ai+13),normal_coordinate_bytes:o(ah,ai+14),uv_coordinate_bytes:o(ah,ai+15),vertex_index_bytes:o(ah,ai+16),normal_index_bytes:o(ah,ai+17),uv_index_bytes:o(ah,ai+18),material_index_bytes:o(ah,ai+19),nvertices:x(ah,ai+20),nnormals:x(ah,ai+20+4*1),nuvs:x(ah,ai+20+4*2),ntri_flat:x(ah,ai+20+4*3),ntri_smooth:x(ah,ai+20+4*4),ntri_flat_uv:x(ah,ai+20+4*5),ntri_smooth_uv:x(ah,ai+20+4*6),nquad_flat:x(ah,ai+20+4*7),nquad_smooth:x(ah,ai+20+4*8),nquad_flat_uv:x(ah,ai+20+4*9),nquad_smooth_uv:x(ah,ai+20+4*10)};return ag}function L(aj,al,ai){var ah=new Uint8Array(aj,al,ai);var ak="";for(var ag=0;ag<ai;ag++){ak+=String.fromCharCode(ah[al+ag])}return ak}function o(ah,ai){var ag=new Uint8Array(ah,ai,1);return ag[0]}function x(ag,ai){var ah=new Uint32Array(ag,ai,1);return ah[0]}function y(am){var ah=C.nvertices;var aj=new Float32Array(h,am,ah*3);var ai,ag,al,ak;for(ai=0;ai<ah;ai++){ag=aj[ai*3];al=aj[ai*3+1];ak=aj[ai*3+2];i(S,ag,al,ak)}return ah*3*Float32Array.BYTES_PER_ELEMENT}function R(am){var ah=C.nnormals;if(ah){var aj=new Int8Array(h,am,ah*3);var ai,ag,al,ak;for(ai=0;ai<ah;ai++){ag=aj[ai*3];al=aj[ai*3+1];ak=aj[ai*3+2];G.push(ag/127,al/127,ak/127)}}return ah*3*Int8Array.BYTES_PER_ELEMENT}function P(al){var ag=C.nuvs;if(ag){var ak=new Float32Array(h,al,ag*2);var aj,ai,ah;for(aj=0;aj<ag;aj++){ai=ak[aj*2];ah=ak[aj*2+1];V.push(ai,ah)}}return ag*2*Float32Array.BYTES_PER_ELEMENT}function Y(ap,an){var ao,am,aj,ah,al,ak,ag,at,ar,aq;var ai=new Uint32Array(h,an,3*ap);for(ao=0;ao<ap;ao++){am=ai[ao*3];aj=ai[ao*3+1];ah=ai[ao*3+2];al=V[am*2];at=V[am*2+1];ak=V[aj*2];ar=V[aj*2+1];ag=V[ah*2];aq=V[ah*2+1];b(S.faceVertexUvs[0],al,at,ak,ar,ag,aq)}}function X(ar,ap){var aq,ao,am,aj,ah,an,al,ai,ag,aw,av,au,at;var ak=new Uint32Array(h,ap,4*ar);for(aq=0;aq<ar;aq++){ao=ak[aq*4];am=ak[aq*4+1];aj=ak[aq*4+2];ah=ak[aq*4+3];an=V[ao*2];aw=V[ao*2+1];al=V[am*2];av=V[am*2+1];ai=V[aj*2];au=V[aj*2+1];ag=V[ah*2];at=V[ah*2+1];a(S.faceVertexUvs[0],an,aw,al,av,ai,au,ag,at)}}function p(am,ak,al){var aj,ap,ao,an,ai;var ah=new Uint32Array(h,ak,3*am);var ag=new Uint16Array(h,al,am);for(aj=0;aj<am;aj++){ap=ah[aj*3];ao=ah[aj*3+1];an=ah[aj*3+2];ai=ag[aj];g(S,ap,ao,an,ai)}}function M(am,ak,al){var aj,aq,ap,ao,an,ai;var ah=new Uint32Array(h,ak,4*am);var ag=new Uint16Array(h,al,am);for(aj=0;aj<am;aj++){aq=ah[aj*4];ap=ah[aj*4+1];ao=ah[aj*4+2];an=ah[aj*4+3];ai=ag[aj];e(S,aq,ap,ao,an,ai)}}function w(ar,am,aj,aq){var al,av,au,at,ai;var ap,an,ak;var ah=new Uint32Array(h,am,3*ar);var ao=new Uint32Array(h,aj,3*ar);var ag=new Uint16Array(h,aq,ar);for(al=0;al<ar;al++){av=ah[al*3];au=ah[al*3+1];at=ah[al*3+2];ap=ao[al*3];an=ao[al*3+1];ak=ao[al*3+2];ai=ag[al];j(S,G,av,au,at,ai,ap,an,ak)}}function D(at,an,aj,ar){var am,ax,aw,av,au,ai;var aq,ao,al,ak;var ah=new Uint32Array(h,an,4*at);var ap=new Uint32Array(h,aj,4*at);var ag=new Uint16Array(h,ar,at);for(am=0;am<at;am++){ax=ah[am*4];aw=ah[am*4+1];av=ah[am*4+2];au=ah[am*4+3];aq=ap[am*4];ao=ap[am*4+1];al=ap[am*4+2];ak=ap[am*4+3];ai=ag[am];f(S,G,ax,aw,av,au,ai,aq,ao,al,ak)}}function aa(ai){var ag=C.ntri_flat;if(ag){var ah=ai+ag*Uint32Array.BYTES_PER_ELEMENT*3;p(ag,ai,ah)}}function ae(aj){var ag=C.ntri_flat_uv;if(ag){var ai=aj+ag*Uint32Array.BYTES_PER_ELEMENT*3;var ah=ai+ag*Uint32Array.BYTES_PER_ELEMENT*3;p(ag,aj,ah);Y(ag,ai)}}function ac(aj){var ag=C.ntri_smooth;if(ag){var ai=aj+ag*Uint32Array.BYTES_PER_ELEMENT*3;var ah=ai+ag*Uint32Array.BYTES_PER_ELEMENT*3;w(ag,aj,ai,ah)}}function t(ak){var ag=C.ntri_smooth_uv;if(ag){var aj=ak+ag*Uint32Array.BYTES_PER_ELEMENT*3;var ai=aj+ag*Uint32Array.BYTES_PER_ELEMENT*3;var ah=ai+ag*Uint32Array.BYTES_PER_ELEMENT*3;w(ag,ak,aj,ah);Y(ag,ai)}}function m(ai){var ag=C.nquad_flat;if(ag){var ah=ai+ag*Uint32Array.BYTES_PER_ELEMENT*4;M(ag,ai,ah)}}function v(aj){var ag=C.nquad_flat_uv;if(ag){var ai=aj+ag*Uint32Array.BYTES_PER_ELEMENT*4;var ah=ai+ag*Uint32Array.BYTES_PER_ELEMENT*4;M(ag,aj,ah);X(ag,ai)}}function q(aj){var ag=C.nquad_smooth;if(ag){var ai=aj+ag*Uint32Array.BYTES_PER_ELEMENT*4;var ah=ai+ag*Uint32Array.BYTES_PER_ELEMENT*4;D(ag,aj,ai,ah)}}function F(ak){var ag=C.nquad_smooth_uv;if(ag){var aj=ak+ag*Uint32Array.BYTES_PER_ELEMENT*4;var ai=aj+ag*Uint32Array.BYTES_PER_ELEMENT*4;var ah=ai+ag*Uint32Array.BYTES_PER_ELEMENT*4;D(ag,ak,aj,ah);X(ag,ai)}}};function i(n,m,p,o){n.vertices.push(new THREE.Vector3(m,p,o))}function g(p,n,m,q,o){p.faces.push(new THREE.Face3(n,m,q,null,null,o))}function e(p,n,m,r,q,o){p.faces.push(new THREE.Face4(n,m,r,q,null,null,o))}function j(m,t,A,z,y,x,s,r,q){var p=t[s*3],o=t[s*3+1],n=t[s*3+2],w=t[r*3],v=t[r*3+1],u=t[r*3+2],D=t[q*3],C=t[q*3+1],B=t[q*3+2];m.faces.push(new THREE.Face3(A,z,y,[new THREE.Vector3(p,o,n),new THREE.Vector3(w,v,u),new THREE.Vector3(D,C,B)],null,x))}function f(m,x,F,E,D,B,C,w,v,u,s){var r=x[w*3],p=x[w*3+1],n=x[w*3+2],A=x[v*3],z=x[v*3+1],y=x[v*3+2],I=x[u*3],H=x[u*3+1],G=x[u*3+2],t=x[s*3],q=x[s*3+1],o=x[s*3+2];m.faces.push(new THREE.Face4(F,E,D,B,[new THREE.Vector3(r,p,n),new THREE.Vector3(A,z,y),new THREE.Vector3(I,H,G),new THREE.Vector3(t,q,o)],null,C))}function b(m,r,t,p,s,o,q){var n=[];n.push(new THREE.UV(r,t));n.push(new THREE.UV(p,s));n.push(new THREE.UV(o,q));m.push(n)}function a(r,q,v,o,u,n,t,m,s){var p=[];p.push(new THREE.UV(q,v));p.push(new THREE.UV(o,u));p.push(new THREE.UV(n,t));p.push(new THREE.UV(m,s));r.push(p)}d.prototype=Object.create(THREE.Geometry.prototype);k(new d(c))};THREE.ImageLoader=function(){THREE.EventTarget.call(this);this.crossOrigin=null};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(a,c){var b=this;if(c===undefined){c=new Image()}c.addEventListener("load",function(){b.dispatchEvent({type:"load",content:c})},false);c.addEventListener("error",function(){b.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);if(b.crossOrigin){c.crossOrigin=b.crossOrigin}c.src=a}};THREE.JSONLoader=function(a){THREE.Loader.call(this,a)};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.load=function(a,d,c){var b=this;c=c?c:this.extractUrlBase(a);this.onLoadStart();this.loadAjaxJSON(this,a,d,c)};THREE.JSONLoader.prototype.loadAjaxJSON=function(b,a,g,e,d){var f=new XMLHttpRequest();var c=0;f.onreadystatechange=function(){if(f.readyState===f.DONE){if(f.status===200||f.status===0){if(f.responseText){var h=JSON.parse(f.responseText);b.createModel(h,g,e)}else{console.warn("THREE.JSONLoader: ["+a+"] seems to be unreachable or file there is empty")}b.onLoadComplete()}else{console.error("THREE.JSONLoader: Couldn't load ["+a+"] ["+f.status+"]")}}else{if(f.readyState===f.LOADING){if(d){if(c===0){c=f.getResponseHeader("Content-Length")}d({total:c,loaded:f.responseText.length})}}else{if(f.readyState===f.HEADERS_RECEIVED){c=f.getResponseHeader("Content-Length")}}}};f.open("GET",a,true);f.send(null)};THREE.JSONLoader.prototype.createModel=function(i,g,c){var h=this,e=new THREE.Geometry(),d=(i.scale!==undefined)?1/i.scale:1;this.initMaterials(e,i.materials,c);b(d);f();a(d);e.computeCentroids();e.computeFaceNormals();if(this.hasNormals(e)){e.computeTangents()}function b(S){function s(u,j){return u&(1<<j)}var M,L,A,q,p,K,o,P,D,t,m,B,E,Q,k,O,J,H,F,N,w,I,R,n,y,C,z,l=i.faces,r=i.vertices,G=i.normals,x=i.colors,T=0;for(M=0;M<i.uvs.length;M++){if(i.uvs[M].length){T++}}for(M=0;M<T;M++){e.faceUvs[M]=[];e.faceVertexUvs[M]=[]}q=0;p=r.length;while(q<p){N=new THREE.Vector3();N.x=r[q++]*S;N.y=r[q++]*S;N.z=r[q++]*S;e.vertices.push(N)}q=0;p=l.length;while(q<p){m=l[q++];B=s(m,0);E=s(m,1);Q=s(m,2);k=s(m,3);O=s(m,4);J=s(m,5);H=s(m,6);F=s(m,7);if(B){w=new THREE.Face4();w.a=l[q++];w.b=l[q++];w.c=l[q++];w.d=l[q++];K=4}else{w=new THREE.Face3();w.a=l[q++];w.b=l[q++];w.c=l[q++];K=3}if(E){t=l[q++];w.materialIndex=t}A=e.faces.length;if(Q){for(M=0;M<T;M++){n=i.uvs[M];D=l[q++];C=n[D*2];z=n[D*2+1];e.faceUvs[M][A]=new THREE.UV(C,z)}}if(k){for(M=0;M<T;M++){n=i.uvs[M];y=[];for(L=0;L<K;L++){D=l[q++];C=n[D*2];z=n[D*2+1];y[L]=new THREE.UV(C,z)}e.faceVertexUvs[M][A]=y}}if(O){P=l[q++]*3;R=new THREE.Vector3();R.x=G[P++];R.y=G[P++];R.z=G[P];w.normal=R}if(J){for(M=0;M<K;M++){P=l[q++]*3;R=new THREE.Vector3();R.x=G[P++];R.y=G[P++];R.z=G[P];w.vertexNormals.push(R)}}if(H){o=l[q++];I=new THREE.Color(x[o]);w.color=I}if(F){for(M=0;M<K;M++){o=l[q++];I=new THREE.Color(x[o]);w.vertexColors.push(I)}}e.faces.push(w)}}function f(){var k,j,s,p,o,t,r,q,n,m;if(i.skinWeights){for(k=0,j=i.skinWeights.length;k<j;k+=2){s=i.skinWeights[k];p=i.skinWeights[k+1];o=0;t=0;e.skinWeights.push(new THREE.Vector4(s,p,o,t))}}if(i.skinIndices){for(k=0,j=i.skinIndices.length;k<j;k+=2){r=i.skinIndices[k];q=i.skinIndices[k+1];n=0;m=0;e.skinIndices.push(new THREE.Vector4(r,q,n,m))}}e.bones=i.bones;e.animation=i.animation}function a(m){if(i.morphTargets!==undefined){var p,n,w,k,r,x;for(p=0,n=i.morphTargets.length;p<n;p++){e.morphTargets[p]={};e.morphTargets[p].name=i.morphTargets[p].name;e.morphTargets[p].vertices=[];r=e.morphTargets[p].vertices;x=i.morphTargets[p].vertices;for(w=0,k=x.length;w<k;w+=3){var q=new THREE.Vector3();q.x=x[w]*m;q.y=x[w+1]*m;q.z=x[w+2]*m;r.push(q)}}}if(i.morphColors!==undefined){var p,n,s,u,t,j,o;for(p=0,n=i.morphColors.length;p<n;p++){e.morphColors[p]={};e.morphColors[p].name=i.morphColors[p].name;e.morphColors[p].colors=[];t=e.morphColors[p].colors;j=i.morphColors[p].colors;for(s=0,u=j.length;s<u;s+=3){o=new THREE.Color(16755200);o.setRGB(j[s],j[s+1],j[s+2]);t.push(o)}}}}g(e)};THREE.GeometryLoader=function(){THREE.EventTarget.call(this);this.crossOrigin=null;this.path=null};THREE.GeometryLoader.prototype={constructor:THREE.GeometryLoader,load:function(b){var c=this;var f=null;if(c.path===null){var d=b.split("/");d.pop();c.path=(d.length<1?".":d.join("/"))}var e=new XMLHttpRequest();e.addEventListener("load",function(g){if(g.target.responseText){f=c.parse(JSON.parse(g.target.responseText),a)}else{c.dispatchEvent({type:"error",message:"Invalid file ["+b+"]"})}},false);e.addEventListener("error",function(){c.dispatchEvent({type:"error",message:"Couldn't load URL ["+b+"]"})},false);e.open("GET",b,true);e.send(null);var a=new THREE.LoadingMonitor();a.addEventListener("load",function(g){c.dispatchEvent({type:"load",content:f})});a.add(e)},parse:function(aw,V){var W=this;var t=new THREE.Geometry();var S=(aw.scale!==undefined)?1/aw.scale:1;if(aw.materials){t.materials=[];for(var at=0;at<aw.materials.length;++at){var am=aw.materials[at];function A(b){var a=Math.log(b)/Math.LN2;return Math.floor(a)==a}function ad(b){var a=Math.log(b)/Math.LN2;return Math.pow(2,Math.round(a))}function U(j,a,d,b,i,c){j[a]=new THREE.Texture();j[a].sourceFile=d;if(b){j[a].repeat.set(b[0],b[1]);if(b[0]!==1){j[a].wrapS=THREE.RepeatWrapping}if(b[1]!==1){j[a].wrapT=THREE.RepeatWrapping}}if(i){j[a].offset.set(i[0],i[1])}if(c){var u={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(u[c[0]]!==undefined){j[a].wrapS=u[c[0]]}if(u[c[1]]!==undefined){j[a].wrapT=u[c[1]]}}var l=j[a];var m=new THREE.ImageLoader();m.addEventListener("load",function(x){var y=x.content;if(!A(y.width)||!A(y.height)){var w=ad(y.width);var v=ad(y.height);l.image=document.createElement("canvas");l.image.width=w;l.image.height=v;l.image.getContext("2d").drawImage(y,0,0,w,v)}else{l.image=y}l.needsUpdate=true});m.crossOrigin=W.crossOrigin;m.load(W.path+"/"+d);if(V){V.add(m)}}function ar(a){return(a[0]*255<<16)+(a[1]*255<<8)+a[2]*255}var h="MeshLambertMaterial";var I={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(am.shading){var s=am.shading.toLowerCase();if(s==="phong"){h="MeshPhongMaterial"}else{if(s==="basic"){h="MeshBasicMaterial"}}}if(am.blending!==undefined&&THREE[am.blending]!==undefined){I.blending=THREE[am.blending]}if(am.transparent!==undefined||am.opacity<1){I.transparent=am.transparent}if(am.depthTest!==undefined){I.depthTest=am.depthTest}if(am.depthWrite!==undefined){I.depthWrite=am.depthWrite}if(am.vertexColors!==undefined){if(am.vertexColors=="face"){I.vertexColors=THREE.FaceColors}else{if(am.vertexColors){I.vertexColors=THREE.VertexColors}}}if(am.colorDiffuse){I.color=ar(am.colorDiffuse)}else{if(am.DbgColor){I.color=am.DbgColor}}if(am.colorSpecular){I.specular=ar(am.colorSpecular)}if(am.colorAmbient){I.ambient=ar(am.colorAmbient)}if(am.transparency){I.opacity=am.transparency}if(am.specularCoef){I.shininess=am.specularCoef}if(am.visible!==undefined){I.visible=am.visible}if(am.flipSided!==undefined){I.side=THREE.BackSide}if(am.doubleSided!==undefined){I.side=THREE.DoubleSide}if(am.wireframe!==undefined){I.wireframe=am.wireframe}if(am.mapDiffuse){U(I,"map",am.mapDiffuse,am.mapDiffuseRepeat,am.mapDiffuseOffset,am.mapDiffuseWrap)}if(am.mapLight){U(I,"lightMap",am.mapLight,am.mapLightRepeat,am.mapLightOffset,am.mapLightWrap)}if(am.mapBump){U(I,"bumpMap",am.mapBump,am.mapBumpRepeat,am.mapBumpOffset,am.mapBumpWrap)}if(am.mapNormal){U(I,"normalMap",am.mapNormal,am.mapNormalRepeat,am.mapNormalOffset,am.mapNormalWrap)}if(am.mapSpecular){U(I,"specularMap",am.mapSpecular,am.mapSpecularRepeat,am.mapSpecularOffset,am.mapSpecularWrap)}if(am.mapNormal){var az=THREE.ShaderUtils.lib.normal;var q=THREE.UniformsUtils.clone(az.uniforms);q.tNormal.value=I.normalMap;if(am.mapNormalFactor){q.uNormalScale.value.set(am.mapNormalFactor,am.mapNormalFactor)}if(I.map){q.tDiffuse.value=I.map;q.enableDiffuse.value=true}if(I.specularMap){q.tSpecular.value=I.specularMap;q.enableSpecular.value=true}if(I.lightMap){q.tAO.value=I.lightMap;q.enableAO.value=true}q.uDiffuseColor.value.setHex(I.color);q.uSpecularColor.value.setHex(I.specular);q.uAmbientColor.value.setHex(I.ambient);q.uShininess.value=I.shininess;if(I.opacity!==undefined){q.uOpacity.value=I.opacity}var aq={fragmentShader:az.fragmentShader,vertexShader:az.vertexShader,uniforms:q,lights:true,fog:true};var ao=new THREE.ShaderMaterial(aq)}else{var ao=new THREE[h](I)}if(am.DbgName!==undefined){ao.name=am.DbgName}t.materials[at]=ao}}function T(b,a){return b&(1<<a)}var p=aw.faces;var g=aw.vertices;var F=aw.normals;var al=aw.colors;var f=0;if(aw.uvs){for(var at=0;at<aw.uvs.length;at++){if(aw.uvs[at].length){f++}}}for(var at=0;at<f;at++){t.faceUvs[at]=[];t.faceVertexUvs[at]=[]}var af=0;var k=g.length;while(af<k){var D=new THREE.Vector3();D.x=g[af++]*S;D.y=g[af++]*S;D.z=g[af++]*S;t.vertices.push(D)}af=0;k=p.length;while(af<k){var aB=p[af++];var Y=T(aB,0);var au=T(aB,1);var aa=T(aB,2);var r=T(aB,3);var J=T(aB,4);var ai=T(aB,5);var C=T(aB,6);var P=T(aB,7);if(Y){var o=new THREE.Face4();o.a=p[af++];o.b=p[af++];o.c=p[af++];o.d=p[af++];var E=4}else{var o=new THREE.Face3();o.a=p[af++];o.b=p[af++];o.c=p[af++];var E=3}if(au){var H=p[af++];o.materialIndex=H}var Q=t.faces.length;if(aa){for(var at=0;at<f;at++){var e=aw.uvs[at];var O=p[af++];var ah=e[O*2];var ag=e[O*2+1];t.faceUvs[at][Q]=new THREE.UV(ah,ag)}}if(r){for(var at=0;at<f;at++){var e=aw.uvs[at];var ac=[];for(var ap=0;ap<E;ap++){var O=p[af++];var ah=e[O*2];var ag=e[O*2+1];ac[ap]=new THREE.UV(ah,ag)}t.faceVertexUvs[at][Q]=ac}}if(J){var L=p[af++]*3;var aj=new THREE.Vector3();aj.x=F[L++];aj.y=F[L++];aj.z=F[L];o.normal=aj}if(ai){for(at=0;at<E;at++){var L=p[af++]*3;var aj=new THREE.Vector3();aj.x=F[L++];aj.y=F[L++];aj.z=F[L];o.vertexNormals.push(aj)}}if(C){var ak=p[af++];o.color=new THREE.Color(al[ak])}if(P){for(var at=0;at<E;at++){var ak=p[af++];o.vertexColors.push(new THREE.Color(al[ak]))}}t.faces.push(o)}if(aw.skinWeights){for(var at=0,an=aw.skinWeights.length;at<an;at+=2){var ab=aw.skinWeights[at];var Z=aw.skinWeights[at+1];var X=0;var ae=0;t.skinWeights.push(new THREE.Vector4(ab,Z,X,ae))}}if(aw.skinIndices){for(var at=0,an=aw.skinIndices.length;at<an;at+=2){var aA=aw.skinIndices[at];var ay=aw.skinIndices[at+1];var ax=0;var av=0;t.skinIndices.push(new THREE.Vector4(aA,ay,ax,av))}}t.bones=aw.bones;t.animation=aw.animation;if(aw.morphTargets){for(var at=0,an=aw.morphTargets.length;at<an;at++){t.morphTargets[at]={};t.morphTargets[at].name=aw.morphTargets[at].name;t.morphTargets[at].vertices=[];var K=t.morphTargets[at].vertices;var R=aw.morphTargets[at].vertices;for(var ag=0,B=R.length;ag<B;ag+=3){var D=new THREE.Vector3();D.x=R[ag]*S;D.y=R[ag+1]*S;D.z=R[ag+2]*S;K.push(D)}}}if(aw.morphColors){for(var at=0,an=aw.morphColors.length;at<an;at++){t.morphColors[at]={};t.morphColors[at].name=aw.morphColors[at].name;t.morphColors[at].colors=[];var n=t.morphColors[at].colors;var G=aw.morphColors[at].colors;for(var ax=0,N=G.length;ax<N;ax+=3){var M=new THREE.Color(16755200);M.setRGB(G[ax],G[ax+1],G[ax+2]);n.push(M)}}}t.computeCentroids();t.computeFaceNormals();return t}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){};this.geometryHandlerMap={};this.addGeometryHandler("ascii",THREE.JSONLoader);this.addGeometryHandler("binary",THREE.BinaryLoader)};THREE.SceneLoader.prototype.constructor=THREE.SceneLoader;THREE.SceneLoader.prototype.load=function(b,a){var c=this;var d=new XMLHttpRequest();d.onreadystatechange=function(){if(d.readyState===4){if(d.status===200||d.status===0){var e=JSON.parse(d.responseText);c.parse(e,a,b)}else{console.error("THREE.SceneLoader: Couldn't load ["+b+"] ["+d.status+"]")}}};d.open("GET",b,true);d.send(null)};THREE.SceneLoader.prototype.addGeometryHandler=function(a,b){this.geometryHandlerMap[a]={loaderClass:b}};THREE.SceneLoader.prototype.parse=function(ar,a,M){var az=this;var h=THREE.Loader.prototype.extractUrlBase(M);var G,D,F,L,I,B,ai,ad,ae,al,ab,Y,Z,X,am,V,aj,aq,J,U,aA,aL,aG,K,aC,z,ax,j,aI,C,ah,aM;var H=ar;for(var aH in this.geometryHandlerMap){var o=this.geometryHandlerMap[aH]["loaderClass"];this.geometryHandlerMap[aH]["loaderObject"]=new o()}j=0;aI=0;aM={scene:new THREE.Scene(),geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}};if(H.transform){var aB=H.transform.position,aa=H.transform.rotation,aF=H.transform.scale;if(aB){aM.scene.position.set(aB[0],aB[1],aB[2])}if(aa){aM.scene.rotation.set(aa[0],aa[1],aa[2])}if(aF){aM.scene.scale.set(aF[0],aF[1],aF[2])}if(aB||aa||aF){aM.scene.updateMatrix();aM.scene.updateMatrixWorld()}}function P(c,d){if(d=="relativeToHTML"){return c}else{return h+"/"+c}}function aJ(){av(aM.scene,H.objects)}function av(l,i){for(var c in i){if(aM.objects[c]===undefined){var n=i[c];var f=null;if(n.geometry!==undefined){aA=aM.geometries[n.geometry];if(aA){var d=false;aL=aM.materials[n.materials[0]];d=aL instanceof THREE.ShaderMaterial;if(d){aA.computeTangents()}ab=n.position;Y=n.rotation;Z=n.quaternion;X=n.scale;ad=n.matrix;Z=0;if(n.materials.length===0){aL=new THREE.MeshFaceMaterial()}if(n.materials.length>1){aL=new THREE.MeshFaceMaterial()}if(n.morph){f=new THREE.MorphAnimMesh(aA,aL);if(n.duration!==undefined){f.duration=n.duration}if(n.time!==undefined){f.time=n.time}if(n.mirroredLoop!==undefined){f.mirroredLoop=n.mirroredLoop}if(aL.morphNormals){aA.computeMorphNormals()}}else{f=new THREE.Mesh(aA,aL)}f.name=c;if(ad){f.matrixAutoUpdate=false;f.matrix.set(ad[0],ad[1],ad[2],ad[3],ad[4],ad[5],ad[6],ad[7],ad[8],ad[9],ad[10],ad[11],ad[12],ad[13],ad[14],ad[15])}else{f.position.set(ab[0],ab[1],ab[2]);if(Z){f.quaternion.set(Z[0],Z[1],Z[2],Z[3]);f.useQuaternion=true}else{f.rotation.set(Y[0],Y[1],Y[2])}f.scale.set(X[0],X[1],X[2])}f.visible=n.visible;f.castShadow=n.castShadow;f.receiveShadow=n.receiveShadow;l.add(f);aM.objects[c]=f}}else{ab=n.position;Y=n.rotation;Z=n.quaternion;X=n.scale;Z=0;f=new THREE.Object3D();f.name=c;f.position.set(ab[0],ab[1],ab[2]);if(Z){f.quaternion.set(Z[0],Z[1],Z[2],Z[3]);f.useQuaternion=true}else{f.rotation.set(Y[0],Y[1],Y[2])}f.scale.set(X[0],X[1],X[2]);f.visible=(n.visible!==undefined)?n.visible:false;l.add(f);aM.objects[c]=f;aM.empties[c]=f}if(f){if(n.properties!==undefined){for(var g in n.properties){var m=n.properties[g];f.properties[g]=m}}if(n.children!==undefined){av(f,n.children)}}}}}function aw(c,d){aM.geometries[d]=c;aJ()}function S(c){return function(d){aw(d,c);j-=1;az.onLoadComplete();ap()}}function O(c){return function(d){aM.geometries[c]=d}}function ap(){var c={totalModels:C,totalTextures:ah,loadedModels:C-j,loadedTextures:ah-aI};az.callbackProgress(c,aM);az.onLoadProgress();if(j===0&&aI===0){a(aM)}}var au=function(c){aI-=c;ap();az.onLoadComplete()};var A=function(c){return function(){au(c)}};for(L in H.cameras){am=H.cameras[L];if(am.type==="perspective"){aG=new THREE.PerspectiveCamera(am.fov,am.aspect,am.near,am.far)}else{if(am.type==="ortho"){aG=new THREE.OrthographicCamera(am.left,am.right,am.top,am.bottom,am.near,am.far)}}ab=am.position;V=am.target;U=am.up;aG.position.set(ab[0],ab[1],ab[2]);aG.target=new THREE.Vector3(V[0],V[1],V[2]);if(U){aG.up.set(U[0],U[1],U[2])}aM.cameras[L]=aG}var ay,k;for(F in H.lights){ae=H.lights[F];ay=(ae.color!==undefined)?ae.color:16777215;k=(ae.intensity!==undefined)?ae.intensity:1;if(ae.type==="directional"){ab=ae.direction;ax=new THREE.DirectionalLight(ay,k);ax.position.set(ab[0],ab[1],ab[2]);ax.position.normalize()}else{if(ae.type==="point"){ab=ae.position;al=ae.distance;ax=new THREE.PointLight(ay,k,al);ax.position.set(ab[0],ab[1],ab[2])}else{if(ae.type==="ambient"){ax=new THREE.AmbientLight(ay)}}}aM.scene.add(ax);aM.lights[F]=ax}for(I in H.fogs){aj=H.fogs[I];if(aj.type==="linear"){K=new THREE.Fog(0,aj.near,aj.far)}else{if(aj.type==="exp2"){K=new THREE.FogExp2(0,aj.density)}}am=aj.color;K.color.setRGB(am[0],am[1],am[2]);aM.fogs[I]=K}if(aM.cameras&&H.defaults.camera){aM.currentCamera=aM.cameras[H.defaults.camera]}if(aM.fogs&&H.defaults.fog){aM.scene.fog=aM.fogs[H.defaults.fog]}am=H.defaults.bgcolor;aM.bgColor=new THREE.Color();aM.bgColor.setRGB(am[0],am[1],am[2]);aM.bgColorAlpha=H.defaults.bgalpha;for(G in H.geometries){ai=H.geometries[G];if(ai.type in this.geometryHandlerMap){j+=1;az.onLoadStart()}}C=j;for(G in H.geometries){ai=H.geometries[G];if(ai.type==="cube"){aA=new THREE.CubeGeometry(ai.width,ai.height,ai.depth,ai.segmentsWidth,ai.segmentsHeight,ai.segmentsDepth,null,ai.flipped,ai.sides);aM.geometries[G]=aA}else{if(ai.type==="plane"){aA=new THREE.PlaneGeometry(ai.width,ai.height,ai.segmentsWidth,ai.segmentsHeight);aM.geometries[G]=aA}else{if(ai.type==="sphere"){aA=new THREE.SphereGeometry(ai.radius,ai.segmentsWidth,ai.segmentsHeight);aM.geometries[G]=aA}else{if(ai.type==="cylinder"){aA=new THREE.CylinderGeometry(ai.topRad,ai.botRad,ai.height,ai.radSegs,ai.heightSegs);aM.geometries[G]=aA}else{if(ai.type==="torus"){aA=new THREE.TorusGeometry(ai.radius,ai.tube,ai.segmentsR,ai.segmentsT);aM.geometries[G]=aA}else{if(ai.type==="icosahedron"){aA=new THREE.IcosahedronGeometry(ai.radius,ai.subdivisions);aM.geometries[G]=aA}else{if(ai.type in this.geometryHandlerMap){var an={};for(var T in ai){if(T!=="type"&&T!=="url"){an[T]=ai[T]}}var Q=this.geometryHandlerMap[ai.type]["loaderObject"];Q.load(P(ai.url,H.urlBaseType),S(G),an)}else{if(ai.type==="embedded"){var x=H.embeds[ai.id],b="";x.metadata=H.metadata;if(x){var af=this.geometryHandlerMap.ascii["loaderObject"];af.createModel(x,O(G),b)}}}}}}}}}}for(B in H.textures){aq=H.textures[B];if(aq.url instanceof Array){aI+=aq.url.length;for(var ac=0;ac<aq.url.length;ac++){az.onLoadStart()}}else{aI+=1;az.onLoadStart()}}ah=aI;for(B in H.textures){aq=H.textures[B];if(aq.mapping!==undefined&&THREE[aq.mapping]!==undefined){aq.mapping=new THREE[aq.mapping]()}if(aq.url instanceof Array){var v=aq.url.length;var W=[];for(var ag=0;ag<v;ag++){W[ag]=P(aq.url[ag],H.urlBaseType)}var w=W[0].endsWith(".dds");if(w){aC=THREE.ImageUtils.loadCompressedTextureCube(W,aq.mapping,A(v))}else{aC=THREE.ImageUtils.loadTextureCube(W,aq.mapping,A(v))}}else{var w=aq.url.toLowerCase().endsWith(".dds");var aE=P(aq.url,H.urlBaseType);var aK=A(1);if(w){aC=THREE.ImageUtils.loadCompressedTexture(aE,aq.mapping,aK)}else{aC=THREE.ImageUtils.loadTexture(aE,aq.mapping,aK)}if(THREE[aq.minFilter]!==undefined){aC.minFilter=THREE[aq.minFilter]}if(THREE[aq.magFilter]!==undefined){aC.magFilter=THREE[aq.magFilter]}if(aq.anisotropy){aC.anisotropy=aq.anisotropy}if(aq.repeat){aC.repeat.set(aq.repeat[0],aq.repeat[1]);if(aq.repeat[0]!==1){aC.wrapS=THREE.RepeatWrapping}if(aq.repeat[1]!==1){aC.wrapT=THREE.RepeatWrapping}}if(aq.offset){aC.offset.set(aq.offset[0],aq.offset[1])}if(aq.wrap){var ak={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(ak[aq.wrap[0]]!==undefined){aC.wrapS=ak[aq.wrap[0]]}if(ak[aq.wrap[1]]!==undefined){aC.wrapT=ak[aq.wrap[1]]}}}aM.textures[B]=aC}for(D in H.materials){ad=H.materials[D];for(J in ad.parameters){if(J==="envMap"||J==="map"||J==="lightMap"||J==="bumpMap"){ad.parameters[J]=aM.textures[ad.parameters[J]]}else{if(J==="shading"){ad.parameters[J]=(ad.parameters[J]==="flat")?THREE.FlatShading:THREE.SmoothShading}else{if(J==="side"){if(ad.parameters[J]=="double"){ad.parameters[J]=THREE.DoubleSide}else{if(ad.parameters[J]=="back"){ad.parameters[J]=THREE.BackSide}else{ad.parameters[J]=THREE.FrontSide}}}else{if(J==="blending"){ad.parameters[J]=ad.parameters[J] in THREE?THREE[ad.parameters[J]]:THREE.NormalBlending}else{if(J==="combine"){ad.parameters[J]=(ad.parameters[J]=="MixOperation")?THREE.MixOperation:THREE.MultiplyOperation}else{if(J==="vertexColors"){if(ad.parameters[J]=="face"){ad.parameters[J]=THREE.FaceColors}else{if(ad.parameters[J]){ad.parameters[J]=THREE.VertexColors}}}else{if(J==="wrapRGB"){var at=ad.parameters[J];ad.parameters[J]=new THREE.Vector3(at[0],at[1],at[2])}}}}}}}}if(ad.parameters.opacity!==undefined&&ad.parameters.opacity<1){ad.parameters.transparent=true}if(ad.parameters.normalMap){var aD=THREE.ShaderUtils.lib.normal;var E=THREE.UniformsUtils.clone(aD.uniforms);var y=ad.parameters.color;var e=ad.parameters.specular;var R=ad.parameters.ambient;var ao=ad.parameters.shininess;E.tNormal.value=aM.textures[ad.parameters.normalMap];if(ad.parameters.normalScale){E.uNormalScale.value.set(ad.parameters.normalScale[0],ad.parameters.normalScale[1])}if(ad.parameters.map){E.tDiffuse.value=ad.parameters.map;E.enableDiffuse.value=true}if(ad.parameters.envMap){E.tCube.value=ad.parameters.envMap;E.enableReflection.value=true;E.uReflectivity.value=ad.parameters.reflectivity}if(ad.parameters.lightMap){E.tAO.value=ad.parameters.lightMap;E.enableAO.value=true}if(ad.parameters.specularMap){E.tSpecular.value=aM.textures[ad.parameters.specularMap];E.enableSpecular.value=true}if(ad.parameters.displacementMap){E.tDisplacement.value=aM.textures[ad.parameters.displacementMap];E.enableDisplacement.value=true;E.uDisplacementBias.value=ad.parameters.displacementBias;E.uDisplacementScale.value=ad.parameters.displacementScale}E.uDiffuseColor.value.setHex(y);E.uSpecularColor.value.setHex(e);E.uAmbientColor.value.setHex(R);E.uShininess.value=ao;if(ad.parameters.opacity){E.uOpacity.value=ad.parameters.opacity}var N={fragmentShader:aD.fragmentShader,vertexShader:aD.vertexShader,uniforms:E,lights:true,fog:true};aL=new THREE.ShaderMaterial(N)}else{aL=new THREE[ad.type](ad.parameters)}aM.materials[D]=aL}aJ();az.callbackSync(aM);ap()};THREE.TextureLoader=function(){THREE.EventTarget.call(this);this.crossOrigin=null};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(a){var b=this;var c=new Image();c.addEventListener("load",function(){var d=new THREE.Texture(c);d.needsUpdate=true;b.dispatchEvent({type:"load",content:d})},false);c.addEventListener("error",function(){b.dispatchEvent({type:"error",message:"Couldn't load URL ["+a+"]"})},false);if(b.crossOrigin){c.crossOrigin=b.crossOrigin}c.src=a}};THREE.Material=function(){this.id=THREE.MaterialCount++;this.name="";this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthTest=true;this.depthWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=false;this.visible=true;this.needsUpdate=true};THREE.Material.prototype.setValues=function(a){if(a===undefined){return}for(var b in a){var d=a[b];if(d===undefined){console.warn("THREE.Material: '"+b+"' parameter is undefined.");continue}if(b in this){var c=this[b];if(c instanceof THREE.Color&&d instanceof THREE.Color){c.copy(d)}else{if(c instanceof THREE.Color&&typeof(d)==="number"){c.setHex(d)}else{if(c instanceof THREE.Vector3&&d instanceof THREE.Vector3){c.copy(d)}else{this[b]=d}}}}}};THREE.Material.prototype.clone=function(a){if(a===undefined){a=new THREE.Material()}a.name=this.name;a.side=this.side;a.opacity=this.opacity;a.transparent=this.transparent;a.blending=this.blending;a.blendSrc=this.blendSrc;a.blendDst=this.blendDst;a.blendEquation=this.blendEquation;a.depthTest=this.depthTest;a.depthWrite=this.depthWrite;a.polygonOffset=this.polygonOffset;a.polygonOffsetFactor=this.polygonOffsetFactor;a.polygonOffsetUnits=this.polygonOffsetUnits;a.alphaTest=this.alphaTest;a.overdraw=this.overdraw;a.visible=this.visible;return a};THREE.MaterialCount=0;THREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=false;this.fog=true;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.clone=function(){var a=new THREE.LineBasicMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.linecap=this.linecap;a.linejoin=this.linejoin;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(a)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.clone=function(){var a=new THREE.MeshBasicMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;return a};THREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.clone=function(){var a=new THREE.MeshLambertMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.perPixel=false;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.clone=function(){var a=new THREE.MeshPhongMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.specular.copy(this.specular);a.shininess=this.shininess;a.metal=this.metal;a.perPixel=this.perPixel;a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.bumpMap=this.bumpMap;a.bumpScale=this.bumpScale;a.normalMap=this.normalMap;a.normalScale.copy(this.normalScale);a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.wireframe=false;this.wireframeLinewidth=1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.clone=function(){var a=new THREE.LineBasicMaterial();THREE.Material.prototype.clone.call(this,a);a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a};THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.shading=THREE.FlatShading;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(a)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.clone=function(){var a=new THREE.MeshNormalMaterial();THREE.Material.prototype.clone.call(this,a);a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a};THREE.MeshFaceMaterial=function(){};THREE.MeshFaceMaterial.prototype.clone=function(){return new THREE.MeshFaceMaterial()};THREE.ParticleBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=false;this.fog=true;this.setValues(a)};THREE.ParticleBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ParticleBasicMaterial.prototype.clone=function(){var a=new THREE.ParticleBasicMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.size=this.size;a.sizeAttenuation=this.sizeAttenuation;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.ParticleCanvasMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.program=function(c,b){};this.setValues(a)};THREE.ParticleCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ParticleCanvasMaterial.prototype.clone=function(){var a=new THREE.ParticleCanvasMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.program=this.program;return a};THREE.ParticleDOMMaterial=function(a){this.element=a};THREE.ParticleDOMMaterial.prototype.clone=function(){return new THREE.ParticleDOMMaterial(this.element)};THREE.ShaderMaterial=function(a){THREE.Material.call(this);this.fragmentShader="void main() {}";this.vertexShader="void main() {}";this.uniforms={};this.attributes=null;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(a)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.clone=function(){var a=new THREE.ShaderMaterial();THREE.Material.prototype.clone.call(this,a);a.fragmentShader=this.fragmentShader;a.vertexShader=this.vertexShader;a.uniforms=this.uniforms;a.attributes=this.attributes;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.fog=this.fog;a.lights=this.lights;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.Texture=function(d,b,f,e,i,c,h,g,a){this.id=THREE.TextureCount++;this.image=d;this.mapping=b!==undefined?b:new THREE.UVMapping();this.wrapS=f!==undefined?f:THREE.ClampToEdgeWrapping;this.wrapT=e!==undefined?e:THREE.ClampToEdgeWrapping;this.magFilter=i!==undefined?i:THREE.LinearFilter;this.minFilter=c!==undefined?c:THREE.LinearMipMapLinearFilter;this.anisotropy=a!==undefined?a:1;this.format=h!==undefined?h:THREE.RGBAFormat;this.type=g!==undefined?g:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.needsUpdate=false;this.onUpdate=null};THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var a=new THREE.Texture();a.image=this.image;a.mapping=this.mapping;a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.format=this.format;a.type=this.type;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.generateMipmaps=this.generateMipmaps;a.premultiplyAlpha=this.premultiplyAlpha;a.flipY=this.flipY;return a}};THREE.TextureCount=0;THREE.CompressedTexture=function(d,c,j,h,g,a,f,e,i,b){THREE.Texture.call(this,null,a,f,e,i,b,h,g);this.image={width:c,height:j};this.mipmaps=d};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.clone=function(){var a=new THREE.CompressedTexture();a.image=this.image;a.mipmaps=this.mipmaps;a.format=this.format;a.type=this.type;a.mapping=this.mapping;a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a};THREE.DataTexture=function(e,c,j,h,g,a,f,d,i,b){THREE.Texture.call(this,null,a,f,d,i,b,h,g);this.image={data:e,width:c,height:j}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.clone=function(){var a=new THREE.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a};THREE.Particle=function(a){THREE.Object3D.call(this);this.material=a};THREE.Particle.prototype=Object.create(THREE.Object3D.prototype);THREE.ParticleSystem=function(b,a){THREE.Object3D.call(this);this.geometry=b;this.material=(a!==undefined)?a:new THREE.ParticleBasicMaterial({color:Math.random()*16777215});this.sortParticles=false;if(this.geometry){if(!this.geometry.boundingSphere){this.geometry.computeBoundingSphere()}this.boundRadius=b.boundingSphere.radius}this.frustumCulled=false};THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype);THREE.Line=function(c,b,a){THREE.Object3D.call(this);this.geometry=c;this.material=(b!==undefined)?b:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.type=(a!==undefined)?a:THREE.LineStrip;if(this.geometry){if(!this.geometry.boundingSphere){this.geometry.computeBoundingSphere()}}};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh=function(c,b){THREE.Object3D.call(this);this.geometry=c;this.material=(b!==undefined)?b:new THREE.MeshBasicMaterial({color:Math.random()*16777215,wireframe:true});if(this.geometry){if(!this.geometry.boundingSphere){this.geometry.computeBoundingSphere()}this.boundRadius=c.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0;a<this.geometry.morphTargets.length;a++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}}}};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(this.morphTargetDictionary[a]!==undefined){return this.morphTargetDictionary[a]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};THREE.Bone=function(a){THREE.Object3D.call(this);this.skin=a;this.skinMatrix=new THREE.Matrix4()};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.update=function(d,b){if(this.matrixAutoUpdate){b|=this.updateMatrix()}if(b||this.matrixWorldNeedsUpdate){if(d){this.skinMatrix.multiply(d,this.matrix)}else{this.skinMatrix.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;b=true}var e,c,a=this.children.length;for(c=0;c<a;c++){this.children[c].update(this.skinMatrix,b)}};THREE.SkinnedMesh=function(f,e,d){THREE.Mesh.call(this,f,e);this.useVertexTexture=d!==undefined?d:true;this.identityMatrix=new THREE.Matrix4();this.bones=[];this.boneMatrices=[];var g,i,j,c,a,l;if(this.geometry.bones!==undefined){for(g=0;g<this.geometry.bones.length;g++){j=this.geometry.bones[g];c=j.pos;a=j.rotq;l=j.scl;i=this.addBone();i.name=j.name;i.position.set(c[0],c[1],c[2]);i.quaternion.set(a[0],a[1],a[2],a[3]);i.useQuaternion=true;if(l!==undefined){i.scale.set(l[0],l[1],l[2])}else{i.scale.set(1,1,1)}}for(g=0;g<this.bones.length;g++){j=this.geometry.bones[g];i=this.bones[g];if(j.parent===-1){this.add(i)}else{this.bones[j.parent].add(i)}}var h=this.bones.length;if(this.useVertexTexture){var k;if(h>256){k=64}else{if(h>64){k=32}else{if(h>16){k=16}else{k=8}}}this.boneTextureWidth=k;this.boneTextureHeight=k;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*h)}this.pose()}};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.addBone=function(a){if(a===undefined){a=new THREE.Bone(this)}this.bones.push(a);return a};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(f){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||f){if(this.parent){this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;f=true}for(var e=0,d=this.children.length;e<d;e++){var h=this.children[e];if(h instanceof THREE.Bone){h.update(this.identityMatrix,false)}else{h.updateMatrixWorld(true)}}if(this.boneInverses==undefined){this.boneInverses=[];for(var a=0,g=this.bones.length;a<g;a++){var c=new THREE.Matrix4();c.getInverse(this.bones[a].skinMatrix);this.boneInverses.push(c)}}for(var a=0,g=this.bones.length;a<g;a++){THREE.SkinnedMesh.offsetMatrix.multiply(this.bones[a].skinMatrix,this.boneInverses[a]);THREE.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,a*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}};THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(true);for(var b=0;b<this.geometry.skinIndices.length;b++){var a=this.geometry.skinWeights[b];var c=1/a.lengthManhattan();if(c!==Infinity){a.multiplyScalar(c)}else{a.set(1)}}};THREE.SkinnedMesh.offsetMatrix=new THREE.Matrix4();THREE.MorphAnimMesh=function(b,a){THREE.Mesh.call(this,b,a);this.duration=1000;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.setFrameRange=function(b,a){this.startKeyframe=b;this.endKeyframe=a;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var g=this.geometry;if(!g.animations){g.animations={}}var a,l=g.animations;var f=/([a-z]+)(\d+)/;for(var d=0,j=g.morphTargets.length;d<j;d++){var k=g.morphTargets[d];var c=k.name.match(f);if(c&&c.length>1){var h=c[1];var e=c[2];if(!l[h]){l[h]={start:Infinity,end:-Infinity}}var b=l[h];if(d<b.start){b.start=d}if(d>b.end){b.end=d}if(!a){a=h}}}g.firstAnimation=a};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(b,c,a){if(!this.geometry.animations){this.geometry.animations={}}this.geometry.animations[b]={start:c,end:a}};THREE.MorphAnimMesh.prototype.playAnimation=function(a,c){var b=this.geometry.animations[a];if(b){this.setFrameRange(b.start,b.end);this.duration=1000*((b.end-b.start)/c);this.time=0}else{console.warn("animation["+a+"] undefined")}};THREE.MorphAnimMesh.prototype.updateAnimation=function(d){var c=this.duration/this.length;this.time+=this.direction*d;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0){this.time+=this.duration}}var a=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/c),0,this.length-1);if(a!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[a]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=a}var b=(this.time%c)/c;if(this.directionBackwards){b=1-b}this.morphTargetInfluences[this.currentKeyframe]=b;this.morphTargetInfluences[this.lastKeyframe]=1-b};THREE.Ribbon=function(b,a){THREE.Object3D.call(this);this.geometry=b;this.material=a};THREE.Ribbon.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.addLevel=function(c,b){if(b===undefined){b=0}b=Math.abs(b);for(var a=0;a<this.LODs.length;a++){if(b<this.LODs[a].visibleAtDistance){break}}this.LODs.splice(a,0,{visibleAtDistance:b,object3D:c});this.add(c)};THREE.LOD.prototype.update=function(c){if(this.LODs.length>1){c.matrixWorldInverse.getInverse(c.matrixWorld);var b=c.matrixWorldInverse;var d=-(b.elements[2]*this.matrixWorld.elements[12]+b.elements[6]*this.matrixWorld.elements[13]+b.elements[10]*this.matrixWorld.elements[14]+b.elements[14]);this.LODs[0].object3D.visible=true;for(var a=1;a<this.LODs.length;a++){if(d>=this.LODs[a].visibleAtDistance){this.LODs[a-1].object3D.visible=false;this.LODs[a].object3D.visible=true}else{break}}for(;a<this.LODs.length;a++){this.LODs[a].object3D.visible=false}}};THREE.Sprite=function(a){THREE.Object3D.call(this);this.color=(a.color!==undefined)?new THREE.Color(a.color):new THREE.Color(16777215);this.map=(a.map!==undefined)?a.map:new THREE.Texture();this.blending=(a.blending!==undefined)?a.blending:THREE.NormalBlending;this.blendSrc=a.blendSrc!==undefined?a.blendSrc:THREE.SrcAlphaFactor;this.blendDst=a.blendDst!==undefined?a.blendDst:THREE.OneMinusSrcAlphaFactor;this.blendEquation=a.blendEquation!==undefined?a.blendEquation:THREE.AddEquation;this.useScreenCoordinates=(a.useScreenCoordinates!==undefined)?a.useScreenCoordinates:true;this.mergeWith3D=(a.mergeWith3D!==undefined)?a.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=(a.affectedByDistance!==undefined)?a.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=(a.scaleByViewport!==undefined)?a.scaleByViewport:!this.affectedByDistance;this.alignment=(a.alignment instanceof THREE.Vector2)?a.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=true};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);THREE.Scene=function(){THREE.Object3D.call(this);this.fog=null;this.overrideMaterial=null;this.matrixAutoUpdate=false;this.__objects=[];this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.__addObject=function(a){if(a instanceof THREE.Light){if(this.__lights.indexOf(a)===-1){this.__lights.push(a)}if(a.target&&a.target.parent===undefined){this.add(a.target)}}else{if(!(a instanceof THREE.Camera||a instanceof THREE.Bone)){if(this.__objects.indexOf(a)===-1){this.__objects.push(a);this.__objectsAdded.push(a);var b=this.__objectsRemoved.indexOf(a);if(b!==-1){this.__objectsRemoved.splice(b,1)}}}}for(var d=0;d<a.children.length;d++){this.__addObject(a.children[d])}};THREE.Scene.prototype.__removeObject=function(b){if(b instanceof THREE.Light){var d=this.__lights.indexOf(b);if(d!==-1){this.__lights.splice(d,1)}}else{if(!(b instanceof THREE.Camera)){var d=this.__objects.indexOf(b);if(d!==-1){this.__objects.splice(d,1);this.__objectsRemoved.push(b);var a=this.__objectsAdded.indexOf(b);if(a!==-1){this.__objectsAdded.splice(a,1)}}}}for(var e=0;e<b.children.length;e++){this.__removeObject(b.children[e])}};THREE.Fog=function(c,b,a){this.color=new THREE.Color(c);this.near=(b!==undefined)?b:1;this.far=(a!==undefined)?a:1000};THREE.FogExp2=function(b,a){this.color=new THREE.Color(b);this.density=(a!==undefined)?a:0.00025};THREE.CanvasRenderer=function(z){console.log("THREE.CanvasRenderer",THREE.REVISION);z=z||{};var t=this,w,A,m,b=new THREE.Projector(),h=z.canvas!==undefined?z.canvas:document.createElement("canvas"),v,ao,ab,D,f=h.getContext("2d"),B=new THREE.Color(0),ac=0,ap=1,am=0,u=null,al=null,F=null,k=null,ai=null,aa,Y,W,V,U=new THREE.RenderableVertex(),S=new THREE.RenderableVertex(),s,r,e,d,ay,av,ak,aj,Q,O,I,H,g=new THREE.Color(),q=new THREE.Color(),p=new THREE.Color(),o=new THREE.Color(),n=new THREE.Color(),C={},M={},L,aA,R,j,ax,at,ah,ag,P,N,c=new THREE.Rectangle(),aB=new THREE.Rectangle(),aq=new THREE.Rectangle(),a=false,ar=new THREE.Color(),y=new THREE.Color(),X=new THREE.Color(),af=Math.PI*2,l=new THREE.Vector3(),aw,i,az,J,G,K,Z=16;aw=document.createElement("canvas");aw.width=aw.height=2;i=aw.getContext("2d");i.fillStyle="rgba(0,0,0,1)";i.fillRect(0,0,2,2);az=i.getImageData(0,0,2,2);J=az.data;G=document.createElement("canvas");G.width=G.height=Z;K=G.getContext("2d");K.translate(-Z/2,-Z/2);K.scale(Z,Z);Z--;this.domElement=h;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.setSize=function(aD,aC){v=aD;ao=aC;ab=Math.floor(v/2);D=Math.floor(ao/2);h.width=v;h.height=ao;c.set(-ab,-D,ab,D);aB.set(-ab,-D,ab,D);ap=1;am=0;u=null;al=null;F=null;k=null;ai=null};this.setClearColor=function(aC,aD){B.copy(aC);ac=aD!==undefined?aD:1;aB.set(-ab,-D,ab,D)};this.setClearColorHex=function(aD,aC){B.setHex(aD);ac=aC!==undefined?aC:1;aB.set(-ab,-D,ab,D)};this.getMaxAnisotropy=function(){return 0};this.clear=function(){f.setTransform(1,0,0,-1,ab,D);if(aB.isEmpty()===false){aB.minSelf(c);aB.inflate(2);if(ac<1){f.clearRect(Math.floor(aB.getX()),Math.floor(aB.getY()),Math.floor(aB.getWidth()),Math.floor(aB.getHeight()))}if(ac>0){ae(THREE.NormalBlending);x(1);ad("rgba("+Math.floor(B.r*255)+","+Math.floor(B.g*255)+","+Math.floor(B.b*255)+","+ac+")");f.fillRect(Math.floor(aB.getX()),Math.floor(aB.getY()),Math.floor(aB.getWidth()),Math.floor(aB.getHeight()))}aB.empty()}};this.render=function(aU,aR){if(aR instanceof THREE.Camera===false){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}var aT,aF,aG,aN;this.autoClear===true?this.clear():f.setTransform(1,0,0,-1,ab,D);t.info.render.vertices=0;t.info.render.faces=0;w=b.projectScene(aU,aR,this.sortObjects,this.sortElements);A=w.elements;m=w.lights;a=m.length>0;if(a===true){aI()}for(aT=0,aF=A.length;aT<aF;aT++){aG=A[aT];aN=aG.material;if(aN===undefined||aN.visible===false){continue}aq.empty();if(aG instanceof THREE.RenderableParticle){aa=aG;aa.x*=ab;aa.y*=D;aK(aa,aG,aN,aU)}else{if(aG instanceof THREE.RenderableLine){aa=aG.v1;Y=aG.v2;aa.positionScreen.x*=ab;aa.positionScreen.y*=D;Y.positionScreen.x*=ab;Y.positionScreen.y*=D;aq.addPoint(aa.positionScreen.x,aa.positionScreen.y);aq.addPoint(Y.positionScreen.x,Y.positionScreen.y);if(c.intersects(aq)===true){aE(aa,Y,aG,aN,aU)}}else{if(aG instanceof THREE.RenderableFace3){aa=aG.v1;Y=aG.v2;W=aG.v3;aa.positionScreen.x*=ab;aa.positionScreen.y*=D;Y.positionScreen.x*=ab;Y.positionScreen.y*=D;W.positionScreen.x*=ab;W.positionScreen.y*=D;if(aN.overdraw===true){aC(aa.positionScreen,Y.positionScreen);aC(Y.positionScreen,W.positionScreen);aC(W.positionScreen,aa.positionScreen)}aq.add3Points(aa.positionScreen.x,aa.positionScreen.y,Y.positionScreen.x,Y.positionScreen.y,W.positionScreen.x,W.positionScreen.y);if(c.intersects(aq)===true){aJ(aa,Y,W,0,1,2,aG,aN,aU)}}else{if(aG instanceof THREE.RenderableFace4){aa=aG.v1;Y=aG.v2;W=aG.v3;V=aG.v4;aa.positionScreen.x*=ab;aa.positionScreen.y*=D;Y.positionScreen.x*=ab;Y.positionScreen.y*=D;W.positionScreen.x*=ab;W.positionScreen.y*=D;V.positionScreen.x*=ab;V.positionScreen.y*=D;U.positionScreen.copy(Y.positionScreen);S.positionScreen.copy(V.positionScreen);if(aN.overdraw===true){aC(aa.positionScreen,Y.positionScreen);aC(Y.positionScreen,V.positionScreen);aC(V.positionScreen,aa.positionScreen);aC(W.positionScreen,U.positionScreen);aC(W.positionScreen,S.positionScreen)}aq.addPoint(aa.positionScreen.x,aa.positionScreen.y);aq.addPoint(Y.positionScreen.x,Y.positionScreen.y);aq.addPoint(W.positionScreen.x,W.positionScreen.y);aq.addPoint(V.positionScreen.x,V.positionScreen.y);if(c.intersects(aq)===true){aH(aa,Y,W,V,U,S,aG,aN,aU)}}}}}aB.addRectangle(aq)}f.setTransform(1,0,0,1,0,0);function aI(){ar.setRGB(0,0,0);y.setRGB(0,0,0);X.setRGB(0,0,0);for(var a0=0,a1=m.length;a0<a1;a0++){var aZ=m[a0];var aY=aZ.color;if(aZ instanceof THREE.AmbientLight){ar.r+=aY.r;ar.g+=aY.g;ar.b+=aY.b}else{if(aZ instanceof THREE.DirectionalLight){y.r+=aY.r;y.g+=aY.g;y.b+=aY.b}else{if(aZ instanceof THREE.PointLight){X.r+=aY.r;X.g+=aY.g;X.b+=aY.b}}}}}function aP(a3,a4,aZ){for(var aY=0,a5=m.length;aY<a5;aY++){var a1=m[aY];var a0=a1.color;if(a1 instanceof THREE.DirectionalLight){var a6=a1.matrixWorld.getPosition().normalize();var a2=a4.dot(a6);if(a2<=0){continue}a2*=a1.intensity;aZ.r+=a0.r*a2;aZ.g+=a0.g*a2;aZ.b+=a0.b*a2}else{if(a1 instanceof THREE.PointLight){var a6=a1.matrixWorld.getPosition();var a2=a4.dot(l.sub(a6,a3).normalize());if(a2<=0){continue}a2*=a1.distance==0?1:1-Math.min(a3.distanceTo(a6)/a1.distance,1);if(a2==0){continue}a2*=a1.intensity;aZ.r+=a0.r*a2;aZ.g+=a0.g*a2;aZ.b+=a0.b*a2}}}}function aK(a4,a0,a2,a1){x(a2.opacity);ae(a2.blending);var aY,a8,a6,a5,a3,a7,aZ;if(a2 instanceof THREE.ParticleBasicMaterial){if(a2.map===null){a6=a0.object.scale.x;a5=a0.object.scale.y;a6*=a0.scale.x*ab;a5*=a0.scale.y*D;aq.set(a4.x-a6,a4.y-a5,a4.x+a6,a4.y+a5);if(c.intersects(aq)===false){return}ad(a2.color.getContextStyle());f.save();f.translate(a4.x,a4.y);f.rotate(-a0.rotation);f.scale(a6,a5);f.fillRect(-1,-1,2,2);f.restore()}else{a3=a2.map.image;a7=a3.width>>1;aZ=a3.height>>1;a6=a0.scale.x*ab;a5=a0.scale.y*D;aY=a6*a7;a8=a5*aZ;aq.set(a4.x-aY,a4.y-a8,a4.x+aY,a4.y+a8);if(c.intersects(aq)===false){return}f.save();f.translate(a4.x,a4.y);f.rotate(-a0.rotation);f.scale(a6,-a5);f.translate(-a7,-aZ);f.drawImage(a3,0,0);f.restore()}}else{if(a2 instanceof THREE.ParticleCanvasMaterial){aY=a0.scale.x*ab;a8=a0.scale.y*D;aq.set(a4.x-aY,a4.y-a8,a4.x+aY,a4.y+a8);if(c.intersects(aq)===false){return}an(a2.color.getContextStyle());ad(a2.color.getContextStyle());f.save();f.translate(a4.x,a4.y);f.rotate(-a0.rotation);f.scale(aY,a8);a2.program(f);f.restore()}}}function aE(a2,a1,aY,aZ,a0){x(aZ.opacity);ae(aZ.blending);f.beginPath();f.moveTo(a2.positionScreen.x,a2.positionScreen.y);f.lineTo(a1.positionScreen.x,a1.positionScreen.y);if(aZ instanceof THREE.LineBasicMaterial){E(aZ.linewidth);T(aZ.linecap);au(aZ.linejoin);an(aZ.color.getContextStyle());f.stroke();aq.inflate(aZ.linewidth*2)}}function aJ(a8,a6,a5,a0,aZ,aY,a1,a4,a2){t.info.render.vertices+=3;t.info.render.faces++;x(a4.opacity);ae(a4.blending);s=a8.positionScreen.x;r=a8.positionScreen.y;e=a6.positionScreen.x;d=a6.positionScreen.y;ay=a5.positionScreen.x;av=a5.positionScreen.y;aQ(s,r,e,d,ay,av);if((a4 instanceof THREE.MeshLambertMaterial||a4 instanceof THREE.MeshPhongMaterial)&&a4.map===null&&a4.map===null){if(a===true){var a9=a4.color;var a3=a4.emissive;if(a4.wireframe===false&&a4.shading==THREE.SmoothShading&&a1.vertexNormalsLength==3){q.r=p.r=o.r=ar.r;q.g=p.g=o.g=ar.g;q.b=p.b=o.b=ar.b;aP(a1.v1.positionWorld,a1.vertexNormalsWorld[0],q);aP(a1.v2.positionWorld,a1.vertexNormalsWorld[1],p);aP(a1.v3.positionWorld,a1.vertexNormalsWorld[2],o);q.r=a9.r*q.r+a3.r;q.g=a9.g*q.g+a3.g;q.b=a9.b*q.b+a3.b;p.r=a9.r*p.r+a3.r;p.g=a9.g*p.g+a3.g;p.b=a9.b*p.b+a3.b;o.r=a9.r*o.r+a3.r;o.g=a9.g*o.g+a3.g;o.b=a9.b*o.b+a3.b;n.r=(p.r+o.r)*0.5;n.g=(p.g+o.g)*0.5;n.b=(p.b+o.b)*0.5;R=aX(q,p,o,n);aS(s,r,e,d,ay,av,0,0,1,0,0,1,R)}else{g.r=ar.r;g.g=ar.g;g.b=ar.b;aP(a1.centroidWorld,a1.normalWorld,g);g.r=a9.r*g.r+a3.r;g.g=a9.g*g.g+a3.g;g.b=a9.b*g.b+a3.b;a4.wireframe===true?aW(g,a4.wireframeLinewidth,a4.wireframeLinecap,a4.wireframeLinejoin):aV(g)}}else{a4.wireframe===true?aW(a4.color,a4.wireframeLinewidth,a4.wireframeLinecap,a4.wireframeLinejoin):aV(a4.color)}}else{if(a4 instanceof THREE.MeshBasicMaterial||a4 instanceof THREE.MeshLambertMaterial||a4 instanceof THREE.MeshPhongMaterial){if(a4.map!==null){if(a4.map.mapping instanceof THREE.UVMapping){j=a1.uvs[0];aD(s,r,e,d,ay,av,j[a0].u,j[a0].v,j[aZ].u,j[aZ].v,j[aY].u,j[aY].v,a4.map)}}else{if(a4.envMap!==null){if(a4.envMap.mapping instanceof THREE.SphericalReflectionMapping){var a7=aR.matrixWorldInverse;l.copy(a1.vertexNormalsWorld[a0]);ax=(l.x*a7.elements[0]+l.y*a7.elements[4]+l.z*a7.elements[8])*0.5+0.5;at=(l.x*a7.elements[1]+l.y*a7.elements[5]+l.z*a7.elements[9])*0.5+0.5;l.copy(a1.vertexNormalsWorld[aZ]);ah=(l.x*a7.elements[0]+l.y*a7.elements[4]+l.z*a7.elements[8])*0.5+0.5;ag=(l.x*a7.elements[1]+l.y*a7.elements[5]+l.z*a7.elements[9])*0.5+0.5;l.copy(a1.vertexNormalsWorld[aY]);P=(l.x*a7.elements[0]+l.y*a7.elements[4]+l.z*a7.elements[8])*0.5+0.5;N=(l.x*a7.elements[1]+l.y*a7.elements[5]+l.z*a7.elements[9])*0.5+0.5;aD(s,r,e,d,ay,av,ax,at,ah,ag,P,N,a4.envMap)}}else{a4.wireframe===true?aW(a4.color,a4.wireframeLinewidth,a4.wireframeLinecap,a4.wireframeLinejoin):aV(a4.color)}}}else{if(a4 instanceof THREE.MeshDepthMaterial){L=aR.near;aA=aR.far;q.r=q.g=q.b=1-aM(a8.positionScreen.z,L,aA);p.r=p.g=p.b=1-aM(a6.positionScreen.z,L,aA);o.r=o.g=o.b=1-aM(a5.positionScreen.z,L,aA);n.r=(p.r+o.r)*0.5;n.g=(p.g+o.g)*0.5;n.b=(p.b+o.b)*0.5;R=aX(q,p,o,n);aS(s,r,e,d,ay,av,0,0,1,0,0,1,R)}else{if(a4 instanceof THREE.MeshNormalMaterial){g.r=aL(a1.normalWorld.x);g.g=aL(a1.normalWorld.y);g.b=aL(a1.normalWorld.z);a4.wireframe===true?aW(g,a4.wireframeLinewidth,a4.wireframeLinecap,a4.wireframeLinejoin):aV(g)}}}}}function aH(a7,a6,a5,a4,a3,a1,aY,a2,aZ){t.info.render.vertices+=4;t.info.render.faces++;x(a2.opacity);ae(a2.blending);if((a2.map!==undefined&&a2.map!==null)||(a2.envMap!==undefined&&a2.envMap!==null)){aJ(a7,a6,a4,0,1,3,aY,a2,aZ);aJ(a3,a5,a1,1,2,3,aY,a2,aZ);return}s=a7.positionScreen.x;r=a7.positionScreen.y;e=a6.positionScreen.x;d=a6.positionScreen.y;ay=a5.positionScreen.x;av=a5.positionScreen.y;ak=a4.positionScreen.x;aj=a4.positionScreen.y;Q=a3.positionScreen.x;O=a3.positionScreen.y;I=a1.positionScreen.x;H=a1.positionScreen.y;if(a2 instanceof THREE.MeshLambertMaterial||a2 instanceof THREE.MeshPhongMaterial){if(a===true){var a8=a2.color;var a0=a2.emissive;if(a2.wireframe===false&&a2.shading==THREE.SmoothShading&&aY.vertexNormalsLength==4){q.r=p.r=o.r=n.r=ar.r;q.g=p.g=o.g=n.g=ar.g;q.b=p.b=o.b=n.b=ar.b;aP(aY.v1.positionWorld,aY.vertexNormalsWorld[0],q);aP(aY.v2.positionWorld,aY.vertexNormalsWorld[1],p);aP(aY.v4.positionWorld,aY.vertexNormalsWorld[3],o);aP(aY.v3.positionWorld,aY.vertexNormalsWorld[2],n);q.r=a8.r*q.r+a0.r;q.g=a8.g*q.g+a0.g;q.b=a8.b*q.b+a0.b;p.r=a8.r*p.r+a0.r;p.g=a8.g*p.g+a0.g;p.b=a8.b*p.b+a0.b;o.r=a8.r*o.r+a0.r;o.g=a8.g*o.g+a0.g;o.b=a8.b*o.b+a0.b;n.r=a8.r*n.r+a0.r;n.g=a8.g*n.g+a0.g;n.b=a8.b*n.b+a0.b;R=aX(q,p,o,n);aQ(s,r,e,d,ak,aj);aS(s,r,e,d,ak,aj,0,0,1,0,0,1,R);aQ(Q,O,ay,av,I,H);aS(Q,O,ay,av,I,H,1,0,1,1,0,1,R)}else{g.r=ar.r;g.g=ar.g;g.b=ar.b;aP(aY.centroidWorld,aY.normalWorld,g);g.r=a8.r*g.r+a0.r;g.g=a8.g*g.g+a0.g;g.b=a8.b*g.b+a0.b;aO(s,r,e,d,ay,av,ak,aj);a2.wireframe===true?aW(g,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aV(g)}}else{aO(s,r,e,d,ay,av,ak,aj);a2.wireframe===true?aW(a2.color,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aV(a2.color)}}else{if(a2 instanceof THREE.MeshBasicMaterial){aO(s,r,e,d,ay,av,ak,aj);a2.wireframe===true?aW(a2.color,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aV(a2.color)}else{if(a2 instanceof THREE.MeshNormalMaterial){g.r=aL(aY.normalWorld.x);g.g=aL(aY.normalWorld.y);g.b=aL(aY.normalWorld.z);aO(s,r,e,d,ay,av,ak,aj);a2.wireframe===true?aW(g,a2.wireframeLinewidth,a2.wireframeLinecap,a2.wireframeLinejoin):aV(g)}else{if(a2 instanceof THREE.MeshDepthMaterial){L=aR.near;aA=aR.far;q.r=q.g=q.b=1-aM(a7.positionScreen.z,L,aA);p.r=p.g=p.b=1-aM(a6.positionScreen.z,L,aA);o.r=o.g=o.b=1-aM(a4.positionScreen.z,L,aA);n.r=n.g=n.b=1-aM(a5.positionScreen.z,L,aA);R=aX(q,p,o,n);aQ(s,r,e,d,ak,aj);aS(s,r,e,d,ak,aj,0,0,1,0,0,1,R);aQ(Q,O,ay,av,I,H);aS(Q,O,ay,av,I,H,1,0,1,1,0,1,R)}}}}}function aQ(a1,a3,aZ,a2,aY,a0){f.beginPath();f.moveTo(a1,a3);f.lineTo(aZ,a2);f.lineTo(aY,a0);f.closePath()}function aO(a3,a5,a1,a4,aZ,a2,aY,a0){f.beginPath();f.moveTo(a3,a5);f.lineTo(a1,a4);f.lineTo(aZ,a2);f.lineTo(aY,a0);f.closePath()}function aW(aY,a1,a0,aZ){E(a1);T(a0);au(aZ);an(aY.getContextStyle());f.stroke();aq.inflate(a1*2)}function aV(aY){ad(aY.getContextStyle());f.fill()}function aD(bi,a5,bf,a3,bd,a1,be,a2,bc,a0,bb,aY,a8){if(a8 instanceof THREE.DataTexture||a8.image===undefined||a8.image.width==0){return}if(a8.needsUpdate===true){var bq=a8.wrapS==THREE.RepeatWrapping;var bo=a8.wrapT==THREE.RepeatWrapping;C[a8.id]=f.createPattern(a8.image,bq===true&&bo===true?"repeat":bq===true&&bo===false?"repeat-x":bq===false&&bo===true?"repeat-y":"no-repeat");a8.needsUpdate=false}C[a8.id]===undefined?ad("rgba(0,0,0,1)"):ad(C[a8.id]);var br,bp,bn,bm,bk,bh,a6,bl,bj=a8.offset.x/a8.repeat.x,bg=a8.offset.y/a8.repeat.y,ba=a8.image.width*a8.repeat.x,a9=a8.image.height*a8.repeat.y;be=(be+bj)*ba;a2=(1-a2+bg)*a9;bc=(bc+bj)*ba;a0=(1-a0+bg)*a9;bb=(bb+bj)*ba;aY=(1-aY+bg)*a9;bf-=bi;a3-=a5;bd-=bi;a1-=a5;bc-=be;a0-=a2;bb-=be;aY-=a2;a6=bc*aY-bb*a0;if(a6===0){if(M[a8.id]===undefined){var a4=document.createElement("canvas");a4.width=a8.image.width;a4.height=a8.image.height;var aZ=a4.getContext("2d");aZ.drawImage(a8.image,0,0);M[a8.id]=aZ.getImageData(0,0,a8.image.width,a8.image.height).data}var bs=M[a8.id];var a7=(Math.floor(be)+Math.floor(a2)*a8.image.width)*4;g.setRGB(bs[a7]/255,bs[a7+1]/255,bs[a7+2]/255);aV(g);return}bl=1/a6;br=(aY*bf-a0*bd)*bl;bp=(aY*a3-a0*a1)*bl;bn=(bc*bd-bb*bf)*bl;bm=(bc*a1-bb*a3)*bl;bk=bi-br*be-bn*a2;bh=a5-bp*be-bm*a2;f.save();f.transform(br,bp,bn,bm,bk,bh);f.fill();f.restore()}function aS(be,a3,bc,a2,ba,a0,bb,a1,a9,aZ,a8,aY,a6){var bk,bj,bi,bh,bf,bd,a4,bg,a7=a6.width-1,a5=a6.height-1;bb*=a7;a1*=a5;a9*=a7;aZ*=a5;a8*=a7;aY*=a5;bc-=be;a2-=a3;ba-=be;a0-=a3;a9-=bb;aZ-=a1;a8-=bb;aY-=a1;a4=a9*aY-a8*aZ;bg=1/a4;bk=(aY*bc-aZ*ba)*bg;bj=(aY*a2-aZ*a0)*bg;bi=(a9*ba-a8*bc)*bg;bh=(a9*a0-a8*a2)*bg;bf=be-bk*bb-bi*a1;bd=a3-bj*bb-bh*a1;f.save();f.transform(bk,bj,bi,bh,bf,bd);f.clip();f.drawImage(a6,0,0);f.restore()}function aX(aZ,aY,a1,a0){J[0]=(aZ.r*255)|0;J[1]=(aZ.g*255)|0;J[2]=(aZ.b*255)|0;J[4]=(aY.r*255)|0;J[5]=(aY.g*255)|0;J[6]=(aY.b*255)|0;J[8]=(a1.r*255)|0;J[9]=(a1.g*255)|0;J[10]=(a1.b*255)|0;J[12]=(a0.r*255)|0;J[13]=(a0.g*255)|0;J[14]=(a0.b*255)|0;i.putImageData(az,0,0);K.drawImage(aw,0,0);return G}function aM(a1,a0,aZ){var aY=(a1-a0)/(aZ-a0);return aY*aY*(3-2*aY)}function aL(aZ){var aY=(aZ+1)*0.5;return aY<0?0:(aY>1?1:aY)}function aC(a3,a1){var aY=a1.x-a3.x,a2=a1.y-a3.y,aZ=aY*aY+a2*a2,a0;if(aZ===0){return}a0=1/Math.sqrt(aZ);aY*=a0;a2*=a0;a1.x+=aY;a1.y+=a2;a3.x-=aY;a3.y-=a2}};function x(aC){if(ap!==aC){f.globalAlpha=aC;ap=aC}}function ae(aC){if(am!==aC){if(aC===THREE.NormalBlending){f.globalCompositeOperation="source-over"}else{if(aC===THREE.AdditiveBlending){f.globalCompositeOperation="lighter"}else{if(aC===THREE.SubtractiveBlending){f.globalCompositeOperation="darker"}}}am=aC}}function E(aC){if(F!==aC){f.lineWidth=aC;F=aC}}function T(aC){if(k!==aC){f.lineCap=aC;k=aC}}function au(aC){if(ai!==aC){f.lineJoin=aC;ai=aC}}function an(aC){if(u!==aC){f.strokeStyle=aC;u=aC}}function ad(aC){if(al!==aC){f.fillStyle=aC;al=aC}}};THREE.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 mPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 mPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 mPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 nWorld = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","if ( useRefract ) {","vReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );","} else {","vReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif",].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( map, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( map, vUv );","#endif","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngle[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );","if ( spotEffect > spotLightAngle[ i ] ) {","spotEffect = pow( spotEffect, spotLightExponent[ i ] );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = mPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngle[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngle[ i ] ) {","spotEffect = pow( spotEffect, spotLightExponent[ i ] );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );","vec3 lVector = normalize( lPosition.xyz + vViewPosition.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = normalize( -lPosition.xyz + vViewPosition.xyz );","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;",].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;",].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#ifdef SHADOWMAP_SOFT","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * mPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n"),};THREE.UniformsUtils={merge:function(b){var c,e,d,a={};for(c=0;c<b.length;c++){d=this.clone(b[c]);for(e in d){a[e]=d[e]}}return a},clone:function(a){var d,e,f,c,b={};for(d in a){b[d]={};for(e in a[d]){c=a[d][e];if(c instanceof THREE.Color||c instanceof THREE.Vector2||c instanceof THREE.Vector3||c instanceof THREE.Vector4||c instanceof THREE.Matrix4||c instanceof THREE.Texture){b[d][e]=c.clone()}else{if(c instanceof Array){b[d][e]=c.slice()}else{b[d][e]=c}}}}return b}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightPosition:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]},}};THREE.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2000},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalMatrix * normal;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = transformedNormal;",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}};THREE.WebGLRenderer=function(O){console.log("THREE.WebGLRenderer",THREE.REVISION);O=O||{};var i=O.canvas!==undefined?O.canvas:document.createElement("canvas"),aR=O.precision!==undefined?O.precision:"highp",ak=O.alpha!==undefined?O.alpha:true,bq=O.premultipliedAlpha!==undefined?O.premultipliedAlpha:true,aA=O.antialias!==undefined?O.antialias:false,bA=O.stencil!==undefined?O.stencil:true,aG=O.preserveDrawingBuffer!==undefined?O.preserveDrawingBuffer:false,Q=O.clearColor!==undefined?new THREE.Color(O.clearColor):new THREE.Color(0),aS=O.clearAlpha!==undefined?O.clearAlpha:0,P=O.maxLights!==undefined?O.maxLights:4;this.domElement=i;this.context=null;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.autoUpdateObjects=true;this.autoUpdateScene=true;this.gammaInput=false;this.gammaOutput=false;this.physicallyBasedShading=false;this.shadowMapEnabled=false;this.shadowMapAutoUpdate=true;this.shadowMapSoft=true;this.shadowMapCullFrontFaces=true;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var G=this,b=[],bs=0,A=null,bg=null,at=-1,aB=null,J=null,aC=0,bh=0,y=-1,aa=-1,by=-1,Y=-1,l=-1,M=-1,aN=-1,ac=-1,br=null,az=null,c=null,bo=null,e=0,d=0,be=0,K=0,T=0,aE=0,aP=new THREE.Frustum(),ax=new THREE.Matrix4(),av=new THREE.Matrix4(),s=new THREE.Vector4(),k=new THREE.Vector3(),bx=true,t={ambient:[0,0,0],directional:{length:0,colors:new Array(),positions:new Array()},point:{length:0,colors:new Array(),positions:new Array(),distances:new Array()},spot:{length:0,colors:new Array(),positions:new Array(),distances:new Array(),directions:new Array(),angles:new Array(),exponents:new Array()},hemi:{length:0,skyColors:new Array(),groundColors:new Array(),positions:new Array()}};var aU;var bz;var h;var a5;var aV;ba();a0();this.context=aU;var a1=aU.getParameter(aU.MAX_TEXTURE_IMAGE_UNITS);var an=aU.getParameter(aU.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var ad=aU.getParameter(aU.MAX_TEXTURE_SIZE);var aq=aU.getParameter(aU.MAX_CUBE_MAP_TEXTURE_SIZE);var ah=a5?aU.getParameter(a5.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;var ay=(an>0);var aY=ay&&bz;var aT=aV?aU.getParameter(aU.COMPRESSED_TEXTURE_FORMATS):[];this.getContext=function(){return aU};this.supportsVertexTextures=function(){return ay};this.getMaxAnisotropy=function(){return ah};this.setSize=function(bC,bB){i.width=bC;i.height=bB;this.setViewport(0,0,i.width,i.height)};this.setViewport=function(bC,bE,bD,bB){e=bC!==undefined?bC:0;d=bE!==undefined?bE:0;be=bD!==undefined?bD:i.width;K=bB!==undefined?bB:i.height;aU.viewport(e,d,be,K)};this.setScissor=function(bC,bE,bD,bB){aU.scissor(bC,bE,bD,bB)};this.enableScissorTest=function(bB){bB?aU.enable(aU.SCISSOR_TEST):aU.disable(aU.SCISSOR_TEST)};this.setClearColorHex=function(bB,bC){Q.setHex(bB);aS=bC;aU.clearColor(Q.r,Q.g,Q.b,aS)};this.setClearColor=function(bB,bC){Q.copy(bB);aS=bC;aU.clearColor(Q.r,Q.g,Q.b,aS)};this.getClearColor=function(){return Q};this.getClearAlpha=function(){return aS};this.clear=function(bB,bE,bC){var bD=0;if(bB===undefined||bB){bD|=aU.COLOR_BUFFER_BIT}if(bE===undefined||bE){bD|=aU.DEPTH_BUFFER_BIT}if(bC===undefined||bC){bD|=aU.STENCIL_BUFFER_BIT}aU.clear(bD)};this.clearTarget=function(bD,bB,bE,bC){this.setRenderTarget(bD);this.clear(bB,bE,bC)};this.addPostPlugin=function(bB){bB.init(this);this.renderPluginsPost.push(bB)};this.addPrePlugin=function(bB){bB.init(this);this.renderPluginsPre.push(bB)};this.deallocateObject=function(bB){if(!bB.__webglInit){return}bB.__webglInit=false;delete bB._modelViewMatrix;delete bB._normalMatrix;delete bB._normalMatrixArray;delete bB._modelViewMatrixArray;delete bB._modelMatrixArray;if(bB instanceof THREE.Mesh){for(var bC in bB.geometry.geometryGroups){a8(bB.geometry.geometryGroups[bC])}}else{if(bB instanceof THREE.Ribbon){a9(bB.geometry)}else{if(bB instanceof THREE.Line){bc(bB.geometry)}else{if(bB instanceof THREE.ParticleSystem){bv(bB.geometry)}}}}};this.deallocateTexture=function(bB){if(!bB.__webglInit){return}bB.__webglInit=false;aU.deleteTexture(bB.__webglTexture);G.info.memory.textures--};this.deallocateRenderTarget=function(bC){if(!bC||!bC.__webglTexture){return}aU.deleteTexture(bC.__webglTexture);if(bC instanceof THREE.WebGLRenderTargetCube){for(var bB=0;bB<6;bB++){aU.deleteFramebuffer(bC.__webglFramebuffer[bB]);aU.deleteRenderbuffer(bC.__webglRenderbuffer[bB])}}else{aU.deleteFramebuffer(bC.__webglFramebuffer);aU.deleteRenderbuffer(bC.__webglRenderbuffer)}};this.deallocateMaterial=function(bH){var bD=bH.program;if(!bD){return}bH.program=undefined;var bE,bC,bG;var bF=false;for(bE=0,bC=b.length;bE<bC;bE++){bG=b[bE];if(bG.program===bD){bG.usedTimes--;if(bG.usedTimes===0){bF=true}break}}if(bF){var bB=[];for(bE=0,bC=b.length;bE<bC;bE++){bG=b[bE];if(bG.program!==bD){bB.push(bG)}}b=bB;aU.deleteProgram(bD);G.info.memory.programs--}};this.updateShadowMap=function(bC,bB){A=null;by=-1;aN=-1;ac=-1;aB=-1;at=-1;bx=true;y=-1;aa=-1;this.shadowMapPlugin.update(bC,bB)};function W(bB){bB.__webglVertexBuffer=aU.createBuffer();bB.__webglColorBuffer=aU.createBuffer();G.info.memory.geometries++}function bw(bB){bB.__webglVertexBuffer=aU.createBuffer();bB.__webglColorBuffer=aU.createBuffer();G.info.memory.geometries++}function a7(bB){bB.__webglVertexBuffer=aU.createBuffer();bB.__webglColorBuffer=aU.createBuffer();G.info.memory.geometries++}function bu(bC){bC.__webglVertexBuffer=aU.createBuffer();bC.__webglNormalBuffer=aU.createBuffer();bC.__webglTangentBuffer=aU.createBuffer();bC.__webglColorBuffer=aU.createBuffer();bC.__webglUVBuffer=aU.createBuffer();bC.__webglUV2Buffer=aU.createBuffer();bC.__webglSkinIndicesBuffer=aU.createBuffer();bC.__webglSkinWeightsBuffer=aU.createBuffer();bC.__webglFaceBuffer=aU.createBuffer();bC.__webglLineBuffer=aU.createBuffer();var bB,bD;if(bC.numMorphTargets){bC.__webglMorphTargetsBuffers=[];for(bB=0,bD=bC.numMorphTargets;bB<bD;bB++){bC.__webglMorphTargetsBuffers.push(aU.createBuffer())}}if(bC.numMorphNormals){bC.__webglMorphNormalsBuffers=[];for(bB=0,bD=bC.numMorphNormals;bB<bD;bB++){bC.__webglMorphNormalsBuffers.push(aU.createBuffer())}}G.info.memory.geometries++}function bv(bB){aU.deleteBuffer(bB.__webglVertexBuffer);aU.deleteBuffer(bB.__webglColorBuffer);G.info.memory.geometries--}function bc(bB){aU.deleteBuffer(bB.__webglVertexBuffer);aU.deleteBuffer(bB.__webglColorBuffer);G.info.memory.geometries--}function a9(bB){aU.deleteBuffer(bB.__webglVertexBuffer);aU.deleteBuffer(bB.__webglColorBuffer);G.info.memory.geometries--}function a8(bC){aU.deleteBuffer(bC.__webglVertexBuffer);aU.deleteBuffer(bC.__webglNormalBuffer);aU.deleteBuffer(bC.__webglTangentBuffer);aU.deleteBuffer(bC.__webglColorBuffer);aU.deleteBuffer(bC.__webglUVBuffer);aU.deleteBuffer(bC.__webglUV2Buffer);aU.deleteBuffer(bC.__webglSkinIndicesBuffer);aU.deleteBuffer(bC.__webglSkinWeightsBuffer);aU.deleteBuffer(bC.__webglFaceBuffer);aU.deleteBuffer(bC.__webglLineBuffer);var bB,bE;if(bC.numMorphTargets){for(bB=0,bE=bC.numMorphTargets;bB<bE;bB++){aU.deleteBuffer(bC.__webglMorphTargetsBuffers[bB])}}if(bC.numMorphNormals){for(bB=0,bE=bC.numMorphNormals;bB<bE;bB++){aU.deleteBuffer(bC.__webglMorphNormalsBuffers[bB])}}if(bC.__webglCustomAttributesList){for(var bD in bC.__webglCustomAttributesList){aU.deleteBuffer(bC.__webglCustomAttributesList[bD].buffer)}}G.info.memory.geometries--}function L(bH,bC){var bE=bH.vertices.length;var bF=bC.material;if(bF.attributes){if(bH.__webglCustomAttributesList===undefined){bH.__webglCustomAttributesList=[]}for(var bB in bF.attributes){var bG=bF.attributes[bB];if(!bG.__webglInitialized||bG.createUniqueBuffers){bG.__webglInitialized=true;var bD=1;if(bG.type==="v2"){bD=2}else{if(bG.type==="v3"){bD=3}else{if(bG.type==="v4"){bD=4}else{if(bG.type==="c"){bD=3}}}}bG.size=bD;bG.array=new Float32Array(bE*bD);bG.buffer=aU.createBuffer();bG.buffer.belongsToAttribute=bB;bG.needsUpdate=true}bH.__webglCustomAttributesList.push(bG)}}}function bb(bD,bB){var bC=bD.vertices.length;bD.__vertexArray=new Float32Array(bC*3);bD.__colorArray=new Float32Array(bC*3);bD.__sortArray=[];bD.__webglParticleCount=bC;L(bD,bB)}function B(bD,bB){var bC=bD.vertices.length;bD.__vertexArray=new Float32Array(bC*3);bD.__colorArray=new Float32Array(bC*3);bD.__webglLineCount=bC;L(bD,bB)}function bl(bC){var bB=bC.vertices.length;bC.__vertexArray=new Float32Array(bB*3);bC.__colorArray=new Float32Array(bB*3);bC.__webglVertexCount=bB}function z(bJ,bS){var bB=bS.geometry,bT=bJ.faces3,bR=bJ.faces4,bM=bT.length*3+bR.length*4,bE=bT.length*1+bR.length*2,bG=bT.length*3+bR.length*4,bD=aF(bS,bJ),bI=ai(bD),bK=U(bD),bP=aO(bD);bJ.__vertexArray=new Float32Array(bM*3);if(bK){bJ.__normalArray=new Float32Array(bM*3)}if(bB.hasTangents){bJ.__tangentArray=new Float32Array(bM*4)}if(bP){bJ.__colorArray=new Float32Array(bM*3)}if(bI){if(bB.faceUvs.length>0||bB.faceVertexUvs.length>0){bJ.__uvArray=new Float32Array(bM*2)}if(bB.faceUvs.length>1||bB.faceVertexUvs.length>1){bJ.__uv2Array=new Float32Array(bM*2)}}if(bS.geometry.skinWeights.length&&bS.geometry.skinIndices.length){bJ.__skinIndexArray=new Float32Array(bM*4);bJ.__skinWeightArray=new Float32Array(bM*4)}bJ.__faceArray=new Uint16Array(bE*3);bJ.__lineArray=new Uint16Array(bG*2);var bL,bO;if(bJ.numMorphTargets){bJ.__morphTargetsArrays=[];for(bL=0,bO=bJ.numMorphTargets;bL<bO;bL++){bJ.__morphTargetsArrays.push(new Float32Array(bM*3))}}if(bJ.numMorphNormals){bJ.__morphNormalsArrays=[];for(bL=0,bO=bJ.numMorphNormals;bL<bO;bL++){bJ.__morphNormalsArrays.push(new Float32Array(bM*3))}}bJ.__webglFaceCount=bE*3;bJ.__webglLineCount=bG*2;if(bD.attributes){if(bJ.__webglCustomAttributesList===undefined){bJ.__webglCustomAttributesList=[]}for(var bQ in bD.attributes){var bN=bD.attributes[bQ];var bF={};for(var bC in bN){bF[bC]=bN[bC]}if(!bF.__webglInitialized||bF.createUniqueBuffers){bF.__webglInitialized=true;var bH=1;if(bF.type==="v2"){bH=2}else{if(bF.type==="v3"){bH=3}else{if(bF.type==="v4"){bH=4}else{if(bF.type==="c"){bH=3}}}}bF.size=bH;bF.array=new Float32Array(bM*bH);bF.buffer=aU.createBuffer();bF.buffer.belongsToAttribute=bQ;bN.needsUpdate=true;bF.__original=bN}bJ.__webglCustomAttributesList.push(bF)}}bJ.__inittedArrays=true}function aF(bC,bB){if(bC.material&&!(bC.material instanceof THREE.MeshFaceMaterial)){return bC.material}else{if(bB.materialIndex>=0){return bC.geometry.materials[bB.materialIndex]}}}function aK(bB){return bB&&bB.shading!==undefined&&bB.shading===THREE.SmoothShading}function U(bB){if((bB instanceof THREE.MeshBasicMaterial&&!bB.envMap)||bB instanceof THREE.MeshDepthMaterial){return false}if(aK(bB)){return THREE.SmoothShading}else{return THREE.FlatShading}}function aO(bB){if(bB.vertexColors){return bB.vertexColors}return false}function ai(bB){if(bB.map||bB.lightMap||bB.bumpMap||bB.normalMap||bB.specularMap||bB instanceof THREE.ShaderMaterial){return true}return false}function E(bE){var bB,bD,bC;for(bB in bE.attributes){if(bB==="index"){bC=aU.ELEMENT_ARRAY_BUFFER}else{bC=aU.ARRAY_BUFFER}bD=bE.attributes[bB];bD.buffer=aU.createBuffer();aU.bindBuffer(bC,bD.buffer);aU.bufferData(bC,bD.array,aU.STATIC_DRAW)}}function N(bC,bO,b1){var bM,bZ,bX,bE,bH,bU,bF=bC.vertices,bY=bF.length,bJ=bC.colors,bI=bJ.length,bN=bC.__vertexArray,bB=bC.__colorArray,bD=bC.__sortArray,bS=bC.verticesNeedUpdate,bG=bC.elementsNeedUpdate,bP=bC.colorsNeedUpdate,bR=bC.__webglCustomAttributesList,bV,bK,b0,bQ,bL,bT,bW;if(b1.sortParticles){av.copy(ax);av.multiplySelf(b1.matrixWorld);for(bM=0;bM<bY;bM++){bX=bF[bM];s.copy(bX);av.multiplyVector3(s);bD[bM]=[s.z,bM]}bD.sort(function(b3,b2){return b2[0]-b3[0]});for(bM=0;bM<bY;bM++){bX=bF[bD[bM][1]];bE=bM*3;bN[bE]=bX.x;bN[bE+1]=bX.y;bN[bE+2]=bX.z}for(bZ=0;bZ<bI;bZ++){bE=bZ*3;bU=bJ[bD[bZ][1]];bB[bE]=bU.r;bB[bE+1]=bU.g;bB[bE+2]=bU.b}if(bR){for(bV=0,bK=bR.length;bV<bK;bV++){bW=bR[bV];if(!(bW.boundTo===undefined||bW.boundTo==="vertices")){continue}bE=0;bL=bW.value.length;if(bW.size===1){for(bQ=0;bQ<bL;bQ++){bH=bD[bQ][1];bW.array[bQ]=bW.value[bH]}}else{if(bW.size===2){for(bQ=0;bQ<bL;bQ++){bH=bD[bQ][1];bT=bW.value[bH];bW.array[bE]=bT.x;bW.array[bE+1]=bT.y;bE+=2}}else{if(bW.size===3){if(bW.type==="c"){for(bQ=0;bQ<bL;bQ++){bH=bD[bQ][1];bT=bW.value[bH];bW.array[bE]=bT.r;bW.array[bE+1]=bT.g;bW.array[bE+2]=bT.b;bE+=3}}else{for(bQ=0;bQ<bL;bQ++){bH=bD[bQ][1];bT=bW.value[bH];bW.array[bE]=bT.x;bW.array[bE+1]=bT.y;bW.array[bE+2]=bT.z;bE+=3}}}else{if(bW.size===4){for(bQ=0;bQ<bL;bQ++){bH=bD[bQ][1];bT=bW.value[bH];bW.array[bE]=bT.x;bW.array[bE+1]=bT.y;bW.array[bE+2]=bT.z;bW.array[bE+3]=bT.w;bE+=4}}}}}}}}else{if(bS){for(bM=0;bM<bY;bM++){bX=bF[bM];bE=bM*3;bN[bE]=bX.x;bN[bE+1]=bX.y;bN[bE+2]=bX.z}}if(bP){for(bZ=0;bZ<bI;bZ++){bU=bJ[bZ];bE=bZ*3;bB[bE]=bU.r;bB[bE+1]=bU.g;bB[bE+2]=bU.b}}if(bR){for(bV=0,bK=bR.length;bV<bK;bV++){bW=bR[bV];if(bW.needsUpdate&&(bW.boundTo===undefined||bW.boundTo==="vertices")){bL=bW.value.length;bE=0;if(bW.size===1){for(bQ=0;bQ<bL;bQ++){bW.array[bQ]=bW.value[bQ]}}else{if(bW.size===2){for(bQ=0;bQ<bL;bQ++){bT=bW.value[bQ];bW.array[bE]=bT.x;bW.array[bE+1]=bT.y;bE+=2}}else{if(bW.size===3){if(bW.type==="c"){for(bQ=0;bQ<bL;bQ++){bT=bW.value[bQ];bW.array[bE]=bT.r;bW.array[bE+1]=bT.g;bW.array[bE+2]=bT.b;bE+=3}}else{for(bQ=0;bQ<bL;bQ++){bT=bW.value[bQ];bW.array[bE]=bT.x;bW.array[bE+1]=bT.y;bW.array[bE+2]=bT.z;bE+=3}}}else{if(bW.size===4){for(bQ=0;bQ<bL;bQ++){bT=bW.value[bQ];bW.array[bE]=bT.x;bW.array[bE+1]=bT.y;bW.array[bE+2]=bT.z;bW.array[bE+3]=bT.w;bE+=4}}}}}}}}}if(bS||b1.sortParticles){aU.bindBuffer(aU.ARRAY_BUFFER,bC.__webglVertexBuffer);aU.bufferData(aU.ARRAY_BUFFER,bN,bO)}if(bP||b1.sortParticles){aU.bindBuffer(aU.ARRAY_BUFFER,bC.__webglColorBuffer);aU.bufferData(aU.ARRAY_BUFFER,bB,bO)}if(bR){for(bV=0,bK=bR.length;bV<bK;bV++){bW=bR[bV];if(bW.needsUpdate||b1.sortParticles){aU.bindBuffer(aU.ARRAY_BUFFER,bW.buffer);aU.bufferData(aU.ARRAY_BUFFER,bW.array,bO)}}}}function bt(bC,bL){var bJ,bW,bU,bD,bR,bE=bC.vertices,bG=bC.colors,bV=bE.length,bF=bG.length,bK=bC.__vertexArray,bB=bC.__colorArray,bP=bC.verticesNeedUpdate,bM=bC.colorsNeedUpdate,bO=bC.__webglCustomAttributesList,bS,bH,bX,bN,bI,bQ,bT;if(bP){for(bJ=0;bJ<bV;bJ++){bU=bE[bJ];bD=bJ*3;bK[bD]=bU.x;bK[bD+1]=bU.y;bK[bD+2]=bU.z}aU.bindBuffer(aU.ARRAY_BUFFER,bC.__webglVertexBuffer);aU.bufferData(aU.ARRAY_BUFFER,bK,bL)}if(bM){for(bW=0;bW<bF;bW++){bR=bG[bW];bD=bW*3;bB[bD]=bR.r;bB[bD+1]=bR.g;bB[bD+2]=bR.b}aU.bindBuffer(aU.ARRAY_BUFFER,bC.__webglColorBuffer);aU.bufferData(aU.ARRAY_BUFFER,bB,bL)}if(bO){for(bS=0,bH=bO.length;bS<bH;bS++){bT=bO[bS];if(bT.needsUpdate&&(bT.boundTo===undefined||bT.boundTo==="vertices")){bD=0;bI=bT.value.length;if(bT.size===1){for(bN=0;bN<bI;bN++){bT.array[bN]=bT.value[bN]}}else{if(bT.size===2){for(bN=0;bN<bI;bN++){bQ=bT.value[bN];bT.array[bD]=bQ.x;bT.array[bD+1]=bQ.y;bD+=2}}else{if(bT.size===3){if(bT.type==="c"){for(bN=0;bN<bI;bN++){bQ=bT.value[bN];bT.array[bD]=bQ.r;bT.array[bD+1]=bQ.g;bT.array[bD+2]=bQ.b;bD+=3}}else{for(bN=0;bN<bI;bN++){bQ=bT.value[bN];bT.array[bD]=bQ.x;bT.array[bD+1]=bQ.y;bT.array[bD+2]=bQ.z;bD+=3}}}else{if(bT.size===4){for(bN=0;bN<bI;bN++){bQ=bT.value[bN];bT.array[bD]=bQ.x;bT.array[bD+1]=bQ.y;bT.array[bD+2]=bQ.z;bT.array[bD+3]=bQ.w;bD+=4}}}}}aU.bindBuffer(aU.ARRAY_BUFFER,bT.buffer);aU.bufferData(aU.ARRAY_BUFFER,bT.array,bL)}}}}function ag(bM,bG){var bP,bL,bJ,bH,bF,bK=bM.vertices,bB=bM.colors,bE=bK.length,bO=bB.length,bC=bM.__vertexArray,bN=bM.__colorArray,bI=bM.verticesNeedUpdate,bD=bM.colorsNeedUpdate;if(bI){for(bP=0;bP<bE;bP++){bJ=bK[bP];bH=bP*3;bC[bH]=bJ.x;bC[bH+1]=bJ.y;bC[bH+2]=bJ.z}aU.bindBuffer(aU.ARRAY_BUFFER,bM.__webglVertexBuffer);aU.bufferData(aU.ARRAY_BUFFER,bC,bG)}if(bD){for(bL=0;bL<bO;bL++){bF=bB[bL];bH=bL*3;bN[bH]=bF.r;bN[bH+1]=bF.g;bN[bH+2]=bF.b}aU.bindBuffer(aU.ARRAY_BUFFER,bM.__webglColorBuffer);aU.bufferData(aU.ARRAY_BUFFER,bN,bG)}}function p(cR,cX,dv,bP,dt){if(!cR.__inittedArrays){return}var cn=U(dt),bM=aO(dt),cQ=ai(dt),cc=(cn===THREE.SmoothShading);var ct,dd,dj,bC,bT,bH,cy,bU,cm,bD,cl,dq,cH,cG,cF,cE,dr,dp,dm,dk,di,df,de,dc,cO,cN,cL,cK,c8,c7,c0,cZ,bL,bK,bJ,bI,ci,cg,cf,ce,b0,bY,bW,bV,cp,cU,cs,ck,b5,cJ,cP,b6,cd,co,cM,cu,cI,cx,b2=0,bR=0,cT=0,dn=0,cq=0,cb=0,bS=0,cD=0,bQ=0,cr=0,bB=0,bN=0,bX=0,ch,bG=cR.__vertexArray,ca=cR.__uvArray,bO=cR.__uv2Array,cY=cR.__normalArray,c6=cR.__tangentArray,cA=cR.__colorArray,cW=cR.__skinIndexArray,dh=cR.__skinWeightArray,dg=cR.__morphTargetsArrays,b7=cR.__morphNormalsArrays,b9=cR.__webglCustomAttributesList,bF,dl=cR.__faceArray,cw=cR.__lineArray,cS=cX.geometry,b4=cS.verticesNeedUpdate,cv=cS.elementsNeedUpdate,cB=cS.uvsNeedUpdate,bE=cS.normalsNeedUpdate,ds=cS.tangentsNeedUpdate,c5=cS.colorsNeedUpdate,dw=cS.morphTargetsNeedUpdate,cC=cS.vertices,b1=cR.faces3,bZ=cR.faces4,c9=cS.faces,cz=cS.faceVertexUvs[0],b8=cS.faceVertexUvs[1],da=cS.colors,cj=cS.skinIndices,db=cS.skinWeights,du=cS.morphTargets,cV=cS.morphNormals;if(b4){for(ct=0,dd=b1.length;ct<dd;ct++){bC=c9[b1[ct]];cH=cC[bC.a];cG=cC[bC.b];cF=cC[bC.c];bG[bR]=cH.x;bG[bR+1]=cH.y;bG[bR+2]=cH.z;bG[bR+3]=cG.x;bG[bR+4]=cG.y;bG[bR+5]=cG.z;bG[bR+6]=cF.x;bG[bR+7]=cF.y;bG[bR+8]=cF.z;bR+=9}for(ct=0,dd=bZ.length;ct<dd;ct++){bC=c9[bZ[ct]];cH=cC[bC.a];cG=cC[bC.b];cF=cC[bC.c];cE=cC[bC.d];bG[bR]=cH.x;bG[bR+1]=cH.y;bG[bR+2]=cH.z;bG[bR+3]=cG.x;bG[bR+4]=cG.y;bG[bR+5]=cG.z;bG[bR+6]=cF.x;bG[bR+7]=cF.y;bG[bR+8]=cF.z;bG[bR+9]=cE.x;bG[bR+10]=cE.y;bG[bR+11]=cE.z;bR+=12}aU.bindBuffer(aU.ARRAY_BUFFER,cR.__webglVertexBuffer);aU.bufferData(aU.ARRAY_BUFFER,bG,dv)}if(dw){for(b6=0,cd=du.length;b6<cd;b6++){bB=0;for(ct=0,dd=b1.length;ct<dd;ct++){cu=b1[ct];bC=c9[cu];cH=du[b6].vertices[bC.a];cG=du[b6].vertices[bC.b];cF=du[b6].vertices[bC.c];co=dg[b6];co[bB]=cH.x;co[bB+1]=cH.y;co[bB+2]=cH.z;co[bB+3]=cG.x;co[bB+4]=cG.y;co[bB+5]=cG.z;co[bB+6]=cF.x;co[bB+7]=cF.y;co[bB+8]=cF.z;if(dt.morphNormals){if(cc){cI=cV[b6].vertexNormals[cu];di=cI.a;df=cI.b;de=cI.c}else{di=cV[b6].faceNormals[cu];df=di;de=di}cM=b7[b6];cM[bB]=di.x;cM[bB+1]=di.y;cM[bB+2]=di.z;cM[bB+3]=df.x;cM[bB+4]=df.y;cM[bB+5]=df.z;cM[bB+6]=de.x;cM[bB+7]=de.y;cM[bB+8]=de.z}bB+=9}for(ct=0,dd=bZ.length;ct<dd;ct++){cu=bZ[ct];bC=c9[cu];cH=du[b6].vertices[bC.a];cG=du[b6].vertices[bC.b];cF=du[b6].vertices[bC.c];cE=du[b6].vertices[bC.d];co=dg[b6];co[bB]=cH.x;co[bB+1]=cH.y;co[bB+2]=cH.z;co[bB+3]=cG.x;co[bB+4]=cG.y;co[bB+5]=cG.z;co[bB+6]=cF.x;co[bB+7]=cF.y;co[bB+8]=cF.z;co[bB+9]=cE.x;co[bB+10]=cE.y;co[bB+11]=cE.z;if(dt.morphNormals){if(cc){cI=cV[b6].vertexNormals[cu];di=cI.a;df=cI.b;de=cI.c;dc=cI.d}else{di=cV[b6].faceNormals[cu];df=di;de=di;dc=di}cM=b7[b6];cM[bB]=di.x;cM[bB+1]=di.y;cM[bB+2]=di.z;cM[bB+3]=df.x;cM[bB+4]=df.y;cM[bB+5]=df.z;cM[bB+6]=de.x;cM[bB+7]=de.y;cM[bB+8]=de.z;cM[bB+9]=dc.x;cM[bB+10]=dc.y;cM[bB+11]=dc.z}bB+=12}aU.bindBuffer(aU.ARRAY_BUFFER,cR.__webglMorphTargetsBuffers[b6]);aU.bufferData(aU.ARRAY_BUFFER,dg[b6],dv);if(dt.morphNormals){aU.bindBuffer(aU.ARRAY_BUFFER,cR.__webglMorphNormalsBuffers[b6]);aU.bufferData(aU.ARRAY_BUFFER,b7[b6],dv)}}}if(db.length){for(ct=0,dd=b1.length;ct<dd;ct++){bC=c9[b1[ct]];c8=db[bC.a];c7=db[bC.b];c0=db[bC.c];dh[cr]=c8.x;dh[cr+1]=c8.y;dh[cr+2]=c8.z;dh[cr+3]=c8.w;dh[cr+4]=c7.x;dh[cr+5]=c7.y;dh[cr+6]=c7.z;dh[cr+7]=c7.w;dh[cr+8]=c0.x;dh[cr+9]=c0.y;dh[cr+10]=c0.z;dh[cr+11]=c0.w;bL=cj[bC.a];bK=cj[bC.b];bJ=cj[bC.c];cW[cr]=bL.x;cW[cr+1]=bL.y;cW[cr+2]=bL.z;cW[cr+3]=bL.w;cW[cr+4]=bK.x;cW[cr+5]=bK.y;cW[cr+6]=bK.z;cW[cr+7]=bK.w;cW[cr+8]=bJ.x;cW[cr+9]=bJ.y;cW[cr+10]=bJ.z;cW[cr+11]=bJ.w;cr+=12}for(ct=0,dd=bZ.length;ct<dd;ct++){bC=c9[bZ[ct]];c8=db[bC.a];c7=db[bC.b];c0=db[bC.c];cZ=db[bC.d];dh[cr]=c8.x;dh[cr+1]=c8.y;dh[cr+2]=c8.z;dh[cr+3]=c8.w;dh[cr+4]=c7.x;dh[cr+5]=c7.y;dh[cr+6]=c7.z;dh[cr+7]=c7.w;dh[cr+8]=c0.x;dh[cr+9]=c0.y;dh[cr+10]=c0.z;dh[cr+11]=c0.w;dh[cr+12]=cZ.x;dh[cr+13]=cZ.y;dh[cr+14]=cZ.z;dh[cr+15]=cZ.w;bL=cj[bC.a];bK=cj[bC.b];bJ=cj[bC.c];bI=cj[bC.d];cW[cr]=bL.x;cW[cr+1]=bL.y;cW[cr+2]=bL.z;cW[cr+3]=bL.w;cW[cr+4]=bK.x;cW[cr+5]=bK.y;cW[cr+6]=bK.z;cW[cr+7]=bK.w;cW[cr+8]=bJ.x;cW[cr+9]=bJ.y;cW[cr+10]=bJ.z;cW[cr+11]=bJ.w;cW[cr+12]=bI.x;cW[cr+13]=bI.y;cW[cr+14]=bI.z;cW[cr+15]=bI.w;cr+=16}if(cr>0){aU.bindBuffer(aU.ARRAY_BUFFER,cR.__webglSkinIndicesBuffer);aU.bufferData(aU.ARRAY_BUFFER,cW,dv);aU.bindBuffer(aU.ARRAY_BUFFER,cR.__webglSkinWeightsBuffer);aU.bufferData(aU.ARRAY_BUFFER,dh,dv)}}if(c5&&bM){for(ct=0,dd=b1.length;ct<dd;ct++){bC=c9[b1[ct]];bU=bC.vertexColors;cm=bC.color;if(bU.length===3&&bM===THREE.VertexColors){cO=bU[0];cN=bU[1];cL=bU[2]}else{cO=cm;cN=cm;cL=cm}cA[bQ]=cO.r;cA[bQ+1]=cO.g;cA[bQ+2]=cO.b;cA[bQ+3]=cN.r;cA[bQ+4]=cN.g;cA[bQ+5]=cN.b;cA[bQ+6]=cL.r;cA[bQ+7]=cL.g;cA[bQ+8]=cL.b;bQ+=9}for(ct=0,dd=bZ.length;ct<dd;ct++){bC=c9[bZ[ct]];bU=bC.vertexColors;cm=bC.color;if(bU.length===4&&bM===THREE.VertexColors){cO=bU[0];cN=bU[1];cL=bU[2];cK=bU[3]}else{cO=cm;cN=cm;cL=cm;cK=cm}cA[bQ]=cO.r;cA[bQ+1]=cO.g;cA[bQ+2]=cO.b;cA[bQ+3]=cN.r;cA[bQ+4]=cN.g;cA[bQ+5]=cN.b;cA[bQ+6]=cL.r;cA[bQ+7]=cL.g;cA[bQ+8]=cL.b;cA[bQ+9]=cK.r;cA[bQ+10]=cK.g;cA[bQ+11]=cK.b;bQ+=12}if(bQ>0){aU.bindBuffer(aU.ARRAY_BUFFER,cR.__webglColorBuffer);aU.bufferData(aU.ARRAY_BUFFER,cA,dv)}}if(ds&&cS.hasTangents){for(ct=0,dd=b1.length;ct<dd;ct++){bC=c9[b1[ct]];bD=bC.vertexTangents;dr=bD[0];dp=bD[1];dm=bD[2];c6[bS]=dr.x;c6[bS+1]=dr.y;c6[bS+2]=dr.z;c6[bS+3]=dr.w;c6[bS+4]=dp.x;c6[bS+5]=dp.y;c6[bS+6]=dp.z;c6[bS+7]=dp.w;c6[bS+8]=dm.x;c6[bS+9]=dm.y;c6[bS+10]=dm.z;c6[bS+11]=dm.w;bS+=12}for(ct=0,dd=bZ.length;ct<dd;ct++){bC=c9[bZ[ct]];bD=bC.vertexTangents;dr=bD[0];dp=bD[1];dm=bD[2];dk=bD[3];c6[bS]=dr.x;c6[bS+1]=dr.y;c6[bS+2]=dr.z;c6[bS+3]=dr.w;c6[bS+4]=dp.x;c6[bS+5]=dp.y;c6[bS+6]=dp.z;c6[bS+7]=dp.w;c6[bS+8]=dm.x;c6[bS+9]=dm.y;c6[bS+10]=dm.z;c6[bS+11]=dm.w;c6[bS+12]=dk.x;c6[bS+13]=dk.y;c6[bS+14]=dk.z;c6[bS+15]=dk.w;bS+=16}aU.bindBuffer(aU.ARRAY_BUFFER,cR.__webglTangentBuffer);aU.bufferData(aU.ARRAY_BUFFER,c6,dv)}if(bE&&cn){for(ct=0,dd=b1.length;ct<dd;ct++){bC=c9[b1[ct]];bT=bC.vertexNormals;bH=bC.normal;if(bT.length===3&&cc){for(cs=0;cs<3;cs++){b5=bT[cs];cY[cb]=b5.x;cY[cb+1]=b5.y;cY[cb+2]=b5.z;cb+=3}}else{for(cs=0;cs<3;cs++){cY[cb]=bH.x;cY[cb+1]=bH.y;cY[cb+2]=bH.z;cb+=3}}}for(ct=0,dd=bZ.length;ct<dd;ct++){bC=c9[bZ[ct]];bT=bC.vertexNormals;bH=bC.normal;if(bT.length===4&&cc){for(cs=0;cs<4;cs++){b5=bT[cs];cY[cb]=b5.x;cY[cb+1]=b5.y;cY[cb+2]=b5.z;cb+=3}}else{for(cs=0;cs<4;cs++){cY[cb]=bH.x;cY[cb+1]=bH.y;cY[cb+2]=bH.z;cb+=3}}}aU.bindBuffer(aU.ARRAY_BUFFER,cR.__webglNormalBuffer);aU.bufferData(aU.ARRAY_BUFFER,cY,dv)}if(cB&&cz&&cQ){for(ct=0,dd=b1.length;ct<dd;ct++){dj=b1[ct];bC=c9[dj];cl=cz[dj];if(cl===undefined){continue}for(cs=0;cs<3;cs++){cJ=cl[cs];ca[cT]=cJ.u;ca[cT+1]=cJ.v;cT+=2}}for(ct=0,dd=bZ.length;ct<dd;ct++){dj=bZ[ct];bC=c9[dj];cl=cz[dj];if(cl===undefined){continue}for(cs=0;cs<4;cs++){cJ=cl[cs];ca[cT]=cJ.u;ca[cT+1]=cJ.v;cT+=2}}if(cT>0){aU.bindBuffer(aU.ARRAY_BUFFER,cR.__webglUVBuffer);aU.bufferData(aU.ARRAY_BUFFER,ca,dv)}}if(cB&&b8&&cQ){for(ct=0,dd=b1.length;ct<dd;ct++){dj=b1[ct];bC=c9[dj];dq=b8[dj];if(dq===undefined){continue}for(cs=0;cs<3;cs++){cP=dq[cs];bO[dn]=cP.u;bO[dn+1]=cP.v;dn+=2}}for(ct=0,dd=bZ.length;ct<dd;ct++){dj=bZ[ct];bC=c9[dj];dq=b8[dj];if(dq===undefined){continue}for(cs=0;cs<4;cs++){cP=dq[cs];bO[dn]=cP.u;bO[dn+1]=cP.v;dn+=2}}if(dn>0){aU.bindBuffer(aU.ARRAY_BUFFER,cR.__webglUV2Buffer);aU.bufferData(aU.ARRAY_BUFFER,bO,dv)}}if(cv){for(ct=0,dd=b1.length;ct<dd;ct++){bC=c9[b1[ct]];dl[cq]=b2;dl[cq+1]=b2+1;dl[cq+2]=b2+2;cq+=3;cw[cD]=b2;cw[cD+1]=b2+1;cw[cD+2]=b2;cw[cD+3]=b2+2;cw[cD+4]=b2+1;cw[cD+5]=b2+2;cD+=6;b2+=3}for(ct=0,dd=bZ.length;ct<dd;ct++){bC=c9[bZ[ct]];dl[cq]=b2;dl[cq+1]=b2+1;dl[cq+2]=b2+3;dl[cq+3]=b2+1;dl[cq+4]=b2+2;dl[cq+5]=b2+3;cq+=6;cw[cD]=b2;cw[cD+1]=b2+1;cw[cD+2]=b2;cw[cD+3]=b2+3;cw[cD+4]=b2+1;cw[cD+5]=b2+2;cw[cD+6]=b2+2;cw[cD+7]=b2+3;cD+=8;b2+=4}aU.bindBuffer(aU.ELEMENT_ARRAY_BUFFER,cR.__webglFaceBuffer);aU.bufferData(aU.ELEMENT_ARRAY_BUFFER,dl,dv);aU.bindBuffer(aU.ELEMENT_ARRAY_BUFFER,cR.__webglLineBuffer);aU.bufferData(aU.ELEMENT_ARRAY_BUFFER,cw,dv)}if(b9){for(cs=0,ck=b9.length;cs<ck;cs++){bF=b9[cs];if(!bF.__original.needsUpdate){continue}bN=0;bX=0;if(bF.size===1){if(bF.boundTo===undefined||bF.boundTo==="vertices"){for(ct=0,dd=b1.length;ct<dd;ct++){bC=c9[b1[ct]];bF.array[bN]=bF.value[bC.a];bF.array[bN+1]=bF.value[bC.b];bF.array[bN+2]=bF.value[bC.c];bN+=3}for(ct=0,dd=bZ.length;ct<dd;ct++){bC=c9[bZ[ct]];bF.array[bN]=bF.value[bC.a];bF.array[bN+1]=bF.value[bC.b];bF.array[bN+2]=bF.value[bC.c];bF.array[bN+3]=bF.value[bC.d];bN+=4}}else{if(bF.boundTo==="faces"){for(ct=0,dd=b1.length;ct<dd;ct++){ch=bF.value[b1[ct]];bF.array[bN]=ch;bF.array[bN+1]=ch;bF.array[bN+2]=ch;bN+=3}for(ct=0,dd=bZ.length;ct<dd;ct++){ch=bF.value[bZ[ct]];bF.array[bN]=ch;bF.array[bN+1]=ch;bF.array[bN+2]=ch;bF.array[bN+3]=ch;bN+=4}}}}else{if(bF.size===2){if(bF.boundTo===undefined||bF.boundTo==="vertices"){for(ct=0,dd=b1.length;ct<dd;ct++){bC=c9[b1[ct]];cH=bF.value[bC.a];cG=bF.value[bC.b];cF=bF.value[bC.c];bF.array[bN]=cH.x;bF.array[bN+1]=cH.y;bF.array[bN+2]=cG.x;bF.array[bN+3]=cG.y;bF.array[bN+4]=cF.x;bF.array[bN+5]=cF.y;bN+=6}for(ct=0,dd=bZ.length;ct<dd;ct++){bC=c9[bZ[ct]];cH=bF.value[bC.a];cG=bF.value[bC.b];cF=bF.value[bC.c];cE=bF.value[bC.d];bF.array[bN]=cH.x;bF.array[bN+1]=cH.y;bF.array[bN+2]=cG.x;bF.array[bN+3]=cG.y;bF.array[bN+4]=cF.x;bF.array[bN+5]=cF.y;bF.array[bN+6]=cE.x;bF.array[bN+7]=cE.y;bN+=8}}else{if(bF.boundTo==="faces"){for(ct=0,dd=b1.length;ct<dd;ct++){ch=bF.value[b1[ct]];cH=ch;cG=ch;cF=ch;bF.array[bN]=cH.x;bF.array[bN+1]=cH.y;bF.array[bN+2]=cG.x;bF.array[bN+3]=cG.y;bF.array[bN+4]=cF.x;bF.array[bN+5]=cF.y;bN+=6}for(ct=0,dd=bZ.length;ct<dd;ct++){ch=bF.value[bZ[ct]];cH=ch;cG=ch;cF=ch;cE=ch;bF.array[bN]=cH.x;bF.array[bN+1]=cH.y;bF.array[bN+2]=cG.x;bF.array[bN+3]=cG.y;bF.array[bN+4]=cF.x;bF.array[bN+5]=cF.y;bF.array[bN+6]=cE.x;bF.array[bN+7]=cE.y;bN+=8}}}}else{if(bF.size===3){var b3;if(bF.type==="c"){b3=["r","g","b"]}else{b3=["x","y","z"]}if(bF.boundTo===undefined||bF.boundTo==="vertices"){for(ct=0,dd=b1.length;ct<dd;ct++){bC=c9[b1[ct]];cH=bF.value[bC.a];cG=bF.value[bC.b];cF=bF.value[bC.c];bF.array[bN]=cH[b3[0]];bF.array[bN+1]=cH[b3[1]];bF.array[bN+2]=cH[b3[2]];bF.array[bN+3]=cG[b3[0]];bF.array[bN+4]=cG[b3[1]];bF.array[bN+5]=cG[b3[2]];bF.array[bN+6]=cF[b3[0]];bF.array[bN+7]=cF[b3[1]];bF.array[bN+8]=cF[b3[2]];bN+=9}for(ct=0,dd=bZ.length;ct<dd;ct++){bC=c9[bZ[ct]];cH=bF.value[bC.a];cG=bF.value[bC.b];cF=bF.value[bC.c];cE=bF.value[bC.d];bF.array[bN]=cH[b3[0]];bF.array[bN+1]=cH[b3[1]];bF.array[bN+2]=cH[b3[2]];bF.array[bN+3]=cG[b3[0]];bF.array[bN+4]=cG[b3[1]];bF.array[bN+5]=cG[b3[2]];bF.array[bN+6]=cF[b3[0]];bF.array[bN+7]=cF[b3[1]];bF.array[bN+8]=cF[b3[2]];bF.array[bN+9]=cE[b3[0]];bF.array[bN+10]=cE[b3[1]];bF.array[bN+11]=cE[b3[2]];bN+=12}}else{if(bF.boundTo==="faces"){for(ct=0,dd=b1.length;ct<dd;ct++){ch=bF.value[b1[ct]];cH=ch;cG=ch;cF=ch;bF.array[bN]=cH[b3[0]];bF.array[bN+1]=cH[b3[1]];bF.array[bN+2]=cH[b3[2]];bF.array[bN+3]=cG[b3[0]];bF.array[bN+4]=cG[b3[1]];bF.array[bN+5]=cG[b3[2]];bF.array[bN+6]=cF[b3[0]];bF.array[bN+7]=cF[b3[1]];bF.array[bN+8]=cF[b3[2]];bN+=9}for(ct=0,dd=bZ.length;ct<dd;ct++){ch=bF.value[bZ[ct]];cH=ch;cG=ch;cF=ch;cE=ch;bF.array[bN]=cH[b3[0]];bF.array[bN+1]=cH[b3[1]];bF.array[bN+2]=cH[b3[2]];bF.array[bN+3]=cG[b3[0]];bF.array[bN+4]=cG[b3[1]];bF.array[bN+5]=cG[b3[2]];bF.array[bN+6]=cF[b3[0]];bF.array[bN+7]=cF[b3[1]];bF.array[bN+8]=cF[b3[2]];bF.array[bN+9]=cE[b3[0]];bF.array[bN+10]=cE[b3[1]];bF.array[bN+11]=cE[b3[2]];bN+=12}}else{if(bF.boundTo==="faceVertices"){for(ct=0,dd=b1.length;ct<dd;ct++){ch=bF.value[b1[ct]];cH=ch[0];cG=ch[1];cF=ch[2];bF.array[bN]=cH[b3[0]];bF.array[bN+1]=cH[b3[1]];bF.array[bN+2]=cH[b3[2]];bF.array[bN+3]=cG[b3[0]];bF.array[bN+4]=cG[b3[1]];bF.array[bN+5]=cG[b3[2]];bF.array[bN+6]=cF[b3[0]];bF.array[bN+7]=cF[b3[1]];bF.array[bN+8]=cF[b3[2]];bN+=9}for(ct=0,dd=bZ.length;ct<dd;ct++){ch=bF.value[bZ[ct]];cH=ch[0];cG=ch[1];cF=ch[2];cE=ch[3];bF.array[bN]=cH[b3[0]];bF.array[bN+1]=cH[b3[1]];bF.array[bN+2]=cH[b3[2]];bF.array[bN+3]=cG[b3[0]];bF.array[bN+4]=cG[b3[1]];bF.array[bN+5]=cG[b3[2]];bF.array[bN+6]=cF[b3[0]];bF.array[bN+7]=cF[b3[1]];bF.array[bN+8]=cF[b3[2]];bF.array[bN+9]=cE[b3[0]];bF.array[bN+10]=cE[b3[1]];bF.array[bN+11]=cE[b3[2]];bN+=12}}}}}else{if(bF.size===4){if(bF.boundTo===undefined||bF.boundTo==="vertices"){for(ct=0,dd=b1.length;ct<dd;ct++){bC=c9[b1[ct]];cH=bF.value[bC.a];cG=bF.value[bC.b];cF=bF.value[bC.c];bF.array[bN]=cH.x;bF.array[bN+1]=cH.y;bF.array[bN+2]=cH.z;bF.array[bN+3]=cH.w;bF.array[bN+4]=cG.x;bF.array[bN+5]=cG.y;bF.array[bN+6]=cG.z;bF.array[bN+7]=cG.w;bF.array[bN+8]=cF.x;bF.array[bN+9]=cF.y;bF.array[bN+10]=cF.z;bF.array[bN+11]=cF.w;bN+=12}for(ct=0,dd=bZ.length;ct<dd;ct++){bC=c9[bZ[ct]];cH=bF.value[bC.a];cG=bF.value[bC.b];cF=bF.value[bC.c];cE=bF.value[bC.d];bF.array[bN]=cH.x;bF.array[bN+1]=cH.y;bF.array[bN+2]=cH.z;bF.array[bN+3]=cH.w;bF.array[bN+4]=cG.x;bF.array[bN+5]=cG.y;bF.array[bN+6]=cG.z;bF.array[bN+7]=cG.w;bF.array[bN+8]=cF.x;bF.array[bN+9]=cF.y;bF.array[bN+10]=cF.z;bF.array[bN+11]=cF.w;bF.array[bN+12]=cE.x;bF.array[bN+13]=cE.y;bF.array[bN+14]=cE.z;bF.array[bN+15]=cE.w;bN+=16}}else{if(bF.boundTo==="faces"){for(ct=0,dd=b1.length;ct<dd;ct++){ch=bF.value[b1[ct]];cH=ch;cG=ch;cF=ch;bF.array[bN]=cH.x;bF.array[bN+1]=cH.y;bF.array[bN+2]=cH.z;bF.array[bN+3]=cH.w;bF.array[bN+4]=cG.x;bF.array[bN+5]=cG.y;bF.array[bN+6]=cG.z;bF.array[bN+7]=cG.w;bF.array[bN+8]=cF.x;bF.array[bN+9]=cF.y;bF.array[bN+10]=cF.z;bF.array[bN+11]=cF.w;bN+=12}for(ct=0,dd=bZ.length;ct<dd;ct++){ch=bF.value[bZ[ct]];cH=ch;cG=ch;cF=ch;cE=ch;bF.array[bN]=cH.x;bF.array[bN+1]=cH.y;bF.array[bN+2]=cH.z;bF.array[bN+3]=cH.w;bF.array[bN+4]=cG.x;bF.array[bN+5]=cG.y;bF.array[bN+6]=cG.z;bF.array[bN+7]=cG.w;bF.array[bN+8]=cF.x;bF.array[bN+9]=cF.y;bF.array[bN+10]=cF.z;bF.array[bN+11]=cF.w;bF.array[bN+12]=cE.x;bF.array[bN+13]=cE.y;bF.array[bN+14]=cE.z;bF.array[bN+15]=cE.w;bN+=16}}else{if(bF.boundTo==="faceVertices"){for(ct=0,dd=b1.length;ct<dd;ct++){ch=bF.value[b1[ct]];cH=ch[0];cG=ch[1];cF=ch[2];bF.array[bN]=cH.x;bF.array[bN+1]=cH.y;bF.array[bN+2]=cH.z;bF.array[bN+3]=cH.w;bF.array[bN+4]=cG.x;bF.array[bN+5]=cG.y;bF.array[bN+6]=cG.z;bF.array[bN+7]=cG.w;bF.array[bN+8]=cF.x;bF.array[bN+9]=cF.y;bF.array[bN+10]=cF.z;bF.array[bN+11]=cF.w;bN+=12}for(ct=0,dd=bZ.length;ct<dd;ct++){ch=bF.value[bZ[ct]];cH=ch[0];cG=ch[1];cF=ch[2];cE=ch[3];bF.array[bN]=cH.x;bF.array[bN+1]=cH.y;bF.array[bN+2]=cH.z;bF.array[bN+3]=cH.w;bF.array[bN+4]=cG.x;bF.array[bN+5]=cG.y;bF.array[bN+6]=cG.z;bF.array[bN+7]=cG.w;bF.array[bN+8]=cF.x;bF.array[bN+9]=cF.y;bF.array[bN+10]=cF.z;bF.array[bN+11]=cF.w;bF.array[bN+12]=cE.x;bF.array[bN+13]=cE.y;bF.array[bN+14]=cE.z;bF.array[bN+15]=cE.w;bN+=16}}}}}}}}aU.bindBuffer(aU.ARRAY_BUFFER,bF.buffer);aU.bufferData(aU.ARRAY_BUFFER,bF.array,dv)}}if(bP){delete cR.__inittedArrays;delete cR.__colorArray;delete cR.__normalArray;delete cR.__tangentArray;delete cR.__uvArray;delete cR.__uv2Array;delete cR.__faceArray;delete cR.__vertexArray;delete cR.__lineArray;delete cR.__skinIndexArray;delete cR.__skinWeightArray}}function aW(bJ,bD,bK){var bE=bJ.attributes;var bH=bE.index;var bG=bE.position;var bI=bE.normal;var bB=bE.uv;var bC=bE.color;var bL=bE.tangent;if(bJ.elementsNeedUpdate&&bH!==undefined){aU.bindBuffer(aU.ELEMENT_ARRAY_BUFFER,bH.buffer);aU.bufferData(aU.ELEMENT_ARRAY_BUFFER,bH.array,bD)}if(bJ.verticesNeedUpdate&&bG!==undefined){aU.bindBuffer(aU.ARRAY_BUFFER,bG.buffer);aU.bufferData(aU.ARRAY_BUFFER,bG.array,bD)}if(bJ.normalsNeedUpdate&&bI!==undefined){aU.bindBuffer(aU.ARRAY_BUFFER,bI.buffer);aU.bufferData(aU.ARRAY_BUFFER,bI.array,bD)}if(bJ.uvsNeedUpdate&&bB!==undefined){aU.bindBuffer(aU.ARRAY_BUFFER,bB.buffer);aU.bufferData(aU.ARRAY_BUFFER,bB.array,bD)}if(bJ.colorsNeedUpdate&&bC!==undefined){aU.bindBuffer(aU.ARRAY_BUFFER,bC.buffer);aU.bufferData(aU.ARRAY_BUFFER,bC.array,bD)}if(bJ.tangentsNeedUpdate&&bL!==undefined){aU.bindBuffer(aU.ARRAY_BUFFER,bL.buffer);aU.bufferData(aU.ARRAY_BUFFER,bL.array,bD)}if(bK){for(var bF in bJ.attributes){delete bJ.attributes[bF].array}}}this.renderBufferImmediate=function(bQ,bE,bG){if(bQ.hasPositions&&!bQ.__webglVertexBuffer){bQ.__webglVertexBuffer=aU.createBuffer()}if(bQ.hasNormals&&!bQ.__webglNormalBuffer){bQ.__webglNormalBuffer=aU.createBuffer()}if(bQ.hasUvs&&!bQ.__webglUvBuffer){bQ.__webglUvBuffer=aU.createBuffer()}if(bQ.hasColors&&!bQ.__webglColorBuffer){bQ.__webglColorBuffer=aU.createBuffer()}if(bQ.hasPositions){aU.bindBuffer(aU.ARRAY_BUFFER,bQ.__webglVertexBuffer);aU.bufferData(aU.ARRAY_BUFFER,bQ.positionArray,aU.DYNAMIC_DRAW);aU.enableVertexAttribArray(bE.attributes.position);aU.vertexAttribPointer(bE.attributes.position,3,aU.FLOAT,false,0,0)}if(bQ.hasNormals){aU.bindBuffer(aU.ARRAY_BUFFER,bQ.__webglNormalBuffer);if(bG.shading===THREE.FlatShading){var bO,bN,bL,bD,bJ,bS,bC,bI,bR,bB,bH,bP,bM,bK,bF=bQ.count*3;for(bK=0;bK<bF;bK+=9){bM=bQ.normalArray;bD=bM[bK];bC=bM[bK+1];bB=bM[bK+2];bJ=bM[bK+3];bI=bM[bK+4];bH=bM[bK+5];bS=bM[bK+6];bR=bM[bK+7];bP=bM[bK+8];bO=(bD+bJ+bS)/3;bN=(bC+bI+bR)/3;bL=(bB+bH+bP)/3;bM[bK]=bO;bM[bK+1]=bN;bM[bK+2]=bL;bM[bK+3]=bO;bM[bK+4]=bN;bM[bK+5]=bL;bM[bK+6]=bO;bM[bK+7]=bN;bM[bK+8]=bL}}aU.bufferData(aU.ARRAY_BUFFER,bQ.normalArray,aU.DYNAMIC_DRAW);aU.enableVertexAttribArray(bE.attributes.normal);aU.vertexAttribPointer(bE.attributes.normal,3,aU.FLOAT,false,0,0)}if(bQ.hasUvs&&bG.map){aU.bindBuffer(aU.ARRAY_BUFFER,bQ.__webglUvBuffer);aU.bufferData(aU.ARRAY_BUFFER,bQ.uvArray,aU.DYNAMIC_DRAW);aU.enableVertexAttribArray(bE.attributes.uv);aU.vertexAttribPointer(bE.attributes.uv,2,aU.FLOAT,false,0,0)}if(bQ.hasColors&&bG.vertexColors!==THREE.NoColors){aU.bindBuffer(aU.ARRAY_BUFFER,bQ.__webglColorBuffer);aU.bufferData(aU.ARRAY_BUFFER,bQ.colorArray,aU.DYNAMIC_DRAW);aU.enableVertexAttribArray(bE.attributes.color);aU.vertexAttribPointer(bE.attributes.color,3,aU.FLOAT,false,0,0)}aU.drawArrays(aU.TRIANGLES,0,bQ.count);bQ.count=0};this.renderBufferDirect=function(bX,b1,bC,bP,bF,b4){if(bP.visible===false){return}var bK,bL,bU,bY,b0,bQ;bK=aH(bX,b1,bC,bP,b4);bL=bK.attributes;var bS=false,bV=bP.wireframe?1:0,bZ=(bF.id*16777215)+(bK.id*2)+bV;if(bZ!==aB){aB=bZ;bS=true}if(b4 instanceof THREE.Mesh){var bG=bF.offsets;if(bG.length>1){bS=true}for(var bW=0,bN=bG.length;bW<bN;++bW){var bE=bG[bW].index;if(bS){var b3=bF.attributes.position;var bO=b3.itemSize;aU.bindBuffer(aU.ARRAY_BUFFER,b3.buffer);aU.vertexAttribPointer(bL.position,bO,aU.FLOAT,false,0,bE*bO*4);var b2=bF.attributes.normal;if(bL.normal>=0&&b2){var bD=b2.itemSize;aU.bindBuffer(aU.ARRAY_BUFFER,b2.buffer);aU.vertexAttribPointer(bL.normal,bD,aU.FLOAT,false,0,bE*bD*4)}var bI=bF.attributes.uv;if(bL.uv>=0&&bI){if(bI.buffer){var bB=bI.itemSize;aU.bindBuffer(aU.ARRAY_BUFFER,bI.buffer);aU.vertexAttribPointer(bL.uv,bB,aU.FLOAT,false,0,bE*bB*4);aU.enableVertexAttribArray(bL.uv)}else{aU.disableVertexAttribArray(bL.uv)}}var bT=bF.attributes.color;if(bL.color>=0&&bT){var bJ=bT.itemSize;aU.bindBuffer(aU.ARRAY_BUFFER,bT.buffer);aU.vertexAttribPointer(bL.color,bJ,aU.FLOAT,false,0,bE*bJ*4)}var bM=bF.attributes.tangent;if(bL.tangent>=0&&bM){var bR=bM.itemSize;aU.bindBuffer(aU.ARRAY_BUFFER,bM.buffer);aU.vertexAttribPointer(bL.tangent,bR,aU.FLOAT,false,0,bE*bR*4)}var bH=bF.attributes.index;aU.bindBuffer(aU.ELEMENT_ARRAY_BUFFER,bH.buffer)}aU.drawElements(aU.TRIANGLES,bG[bW].count,aU.UNSIGNED_SHORT,bG[bW].start*2);G.info.render.calls++;G.info.render.vertices+=bG[bW].count;G.info.render.faces+=bG[bW].count/3}}else{if(b4 instanceof THREE.ParticleSystem){if(bS){var b3=bF.attributes.position;var bO=b3.itemSize;aU.bindBuffer(aU.ARRAY_BUFFER,b3.buffer);aU.vertexAttribPointer(bL.position,bO,aU.FLOAT,false,0,0);var bT=bF.attributes.color;if(bL.color>=0&&bT){var bJ=bT.itemSize;aU.bindBuffer(aU.ARRAY_BUFFER,bT.buffer);aU.vertexAttribPointer(bL.color,bJ,aU.FLOAT,false,0,0)}aU.drawArrays(aU.POINTS,0,b3.numItems/3);G.info.render.calls++;G.info.render.points+=b3.numItems/3}}}};this.renderBuffer=function(bL,bH,bB,bM,bF,bE){if(bM.visible===false){return}var bK,bI,bO,bR,bQ,bC,bJ,bP;bK=aH(bL,bH,bB,bM,bE);bI=bK.attributes;var bD=false,bN=bM.wireframe?1:0,bG=(bF.id*16777215)+(bK.id*2)+bN;if(bG!==aB){aB=bG;bD=true}if(!bM.morphTargets&&bI.position>=0){if(bD){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglVertexBuffer);aU.vertexAttribPointer(bI.position,3,aU.FLOAT,false,0,0)}}else{if(bE.morphTargetBase){Z(bM,bF,bE)}}if(bD){if(bF.__webglCustomAttributesList){for(bJ=0,bP=bF.__webglCustomAttributesList.length;bJ<bP;bJ++){bC=bF.__webglCustomAttributesList[bJ];if(bI[bC.buffer.belongsToAttribute]>=0){aU.bindBuffer(aU.ARRAY_BUFFER,bC.buffer);aU.vertexAttribPointer(bI[bC.buffer.belongsToAttribute],bC.size,aU.FLOAT,false,0,0)}}}if(bI.color>=0){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglColorBuffer);aU.vertexAttribPointer(bI.color,3,aU.FLOAT,false,0,0)}if(bI.normal>=0){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglNormalBuffer);aU.vertexAttribPointer(bI.normal,3,aU.FLOAT,false,0,0)}if(bI.tangent>=0){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglTangentBuffer);aU.vertexAttribPointer(bI.tangent,4,aU.FLOAT,false,0,0)}if(bI.uv>=0){if(bF.__webglUVBuffer){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglUVBuffer);aU.vertexAttribPointer(bI.uv,2,aU.FLOAT,false,0,0);aU.enableVertexAttribArray(bI.uv)}else{aU.disableVertexAttribArray(bI.uv)}}if(bI.uv2>=0){if(bF.__webglUV2Buffer){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglUV2Buffer);aU.vertexAttribPointer(bI.uv2,2,aU.FLOAT,false,0,0);aU.enableVertexAttribArray(bI.uv2)}else{aU.disableVertexAttribArray(bI.uv2)}}if(bM.skinning&&bI.skinIndex>=0&&bI.skinWeight>=0){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglSkinIndicesBuffer);aU.vertexAttribPointer(bI.skinIndex,4,aU.FLOAT,false,0,0);aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglSkinWeightsBuffer);aU.vertexAttribPointer(bI.skinWeight,4,aU.FLOAT,false,0,0)}}if(bE instanceof THREE.Mesh){if(bM.wireframe){X(bM.wireframeLinewidth);if(bD){aU.bindBuffer(aU.ELEMENT_ARRAY_BUFFER,bF.__webglLineBuffer)}aU.drawElements(aU.LINES,bF.__webglLineCount,aU.UNSIGNED_SHORT,0)}else{if(bD){aU.bindBuffer(aU.ELEMENT_ARRAY_BUFFER,bF.__webglFaceBuffer)}aU.drawElements(aU.TRIANGLES,bF.__webglFaceCount,aU.UNSIGNED_SHORT,0)}G.info.render.calls++;G.info.render.vertices+=bF.__webglFaceCount;G.info.render.faces+=bF.__webglFaceCount/3}else{if(bE instanceof THREE.Line){bR=(bE.type===THREE.LineStrip)?aU.LINE_STRIP:aU.LINES;X(bM.linewidth);aU.drawArrays(bR,0,bF.__webglLineCount);G.info.render.calls++}else{if(bE instanceof THREE.ParticleSystem){aU.drawArrays(aU.POINTS,0,bF.__webglParticleCount);G.info.render.calls++;G.info.render.points+=bF.__webglParticleCount}else{if(bE instanceof THREE.Ribbon){aU.drawArrays(aU.TRIANGLE_STRIP,0,bF.__webglVertexCount);G.info.render.calls++}}}}};function Z(bJ,bF,bE){var bH=bJ.program.attributes;if(bE.morphTargetBase!==-1){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglMorphTargetsBuffers[bE.morphTargetBase]);aU.vertexAttribPointer(bH.position,3,aU.FLOAT,false,0,0)}else{if(bH.position>=0){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglVertexBuffer);aU.vertexAttribPointer(bH.position,3,aU.FLOAT,false,0,0)}}if(bE.morphTargetForcedOrder.length){var bB=0;var bC=bE.morphTargetForcedOrder;var bL=bE.morphTargetInfluences;while(bB<bJ.numSupportedMorphTargets&&bB<bC.length){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglMorphTargetsBuffers[bC[bB]]);aU.vertexAttribPointer(bH["morphTarget"+bB],3,aU.FLOAT,false,0,0);if(bJ.morphNormals){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglMorphNormalsBuffers[bC[bB]]);aU.vertexAttribPointer(bH["morphNormal"+bB],3,aU.FLOAT,false,0,0)}bE.__webglMorphTargetInfluences[bB]=bL[bC[bB]];bB++}}else{var bK,bD=[];var bL=bE.morphTargetInfluences;var bI,bM=bL.length;for(bI=0;bI<bM;bI++){bK=bL[bI];if(bK>0){bD.push([bI,bK])}}if(bD.length>bJ.numSupportedMorphTargets){bD.sort(a);bD.length=bJ.numSupportedMorphTargets}else{if(bD.length>bJ.numSupportedMorphNormals){bD.sort(a)}else{if(bD.length===0){bD.push([0,0])}}}var bG,bB=0;while(bB<bJ.numSupportedMorphTargets){if(bD[bB]){bG=bD[bB][0];aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglMorphTargetsBuffers[bG]);aU.vertexAttribPointer(bH["morphTarget"+bB],3,aU.FLOAT,false,0,0);if(bJ.morphNormals){aU.bindBuffer(aU.ARRAY_BUFFER,bF.__webglMorphNormalsBuffers[bG]);aU.vertexAttribPointer(bH["morphNormal"+bB],3,aU.FLOAT,false,0,0)}bE.__webglMorphTargetInfluences[bB]=bL[bG]}else{aU.vertexAttribPointer(bH["morphTarget"+bB],3,aU.FLOAT,false,0,0);if(bJ.morphNormals){aU.vertexAttribPointer(bH["morphNormal"+bB],3,aU.FLOAT,false,0,0)}bE.__webglMorphTargetInfluences[bB]=0}bB++}}if(bJ.program.uniforms.morphTargetInfluences!==null){aU.uniform1fv(bJ.program.uniforms.morphTargetInfluences,bE.__webglMorphTargetInfluences)}}function I(bC,bB){return bB.z-bC.z}function a(bC,bB){return bB[1]-bC[1]}this.render=function(bH,bL,bI,bJ){if(bL instanceof THREE.Camera===false){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var bF,bM,bG,bD,bB,bE=bH.__lights,bC=bH.fog;at=-1;bx=true;if(this.autoUpdateScene){bH.updateMatrixWorld()}if(bL.parent===undefined){bL.updateMatrixWorld()}if(!bL._viewMatrixArray){bL._viewMatrixArray=new Float32Array(16)}if(!bL._projectionMatrixArray){bL._projectionMatrixArray=new Float32Array(16)}bL.matrixWorldInverse.getInverse(bL.matrixWorld);bL.matrixWorldInverse.flattenToArray(bL._viewMatrixArray);bL.projectionMatrix.flattenToArray(bL._projectionMatrixArray);ax.multiply(bL.projectionMatrix,bL.matrixWorldInverse);aP.setFromMatrix(ax);if(this.autoUpdateObjects){this.initWebGLObjects(bH)}aD(this.renderPluginsPre,bH,bL);G.info.render.calls=0;G.info.render.vertices=0;G.info.render.faces=0;G.info.render.points=0;this.setRenderTarget(bI);if(this.autoClear||bJ){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}bB=bH.__webglObjects;for(bF=0,bM=bB.length;bF<bM;bF++){bG=bB[bF];bD=bG.object;bG.render=false;if(bD.visible){if(!(bD instanceof THREE.Mesh||bD instanceof THREE.ParticleSystem)||!(bD.frustumCulled)||aP.contains(bD)){aZ(bD,bL);m(bG);bG.render=true;if(this.sortObjects===true){if(bD.renderDepth!==null){bG.z=bD.renderDepth}else{s.copy(bD.matrixWorld.getPosition());ax.multiplyVector3(s);bG.z=s.z}}}}}if(this.sortObjects){bB.sort(I)}bB=bH.__webglObjectsImmediate;for(bF=0,bM=bB.length;bF<bM;bF++){bG=bB[bF];bD=bG.object;if(bD.visible){aZ(bD,bL);R(bG)}}if(bH.overrideMaterial){var bK=bH.overrideMaterial;this.setBlending(bK.blending,bK.blendEquation,bK.blendSrc,bK.blendDst);this.setDepthTest(bK.depthTest);this.setDepthWrite(bK.depthWrite);a3(bK.polygonOffset,bK.polygonOffsetFactor,bK.polygonOffsetUnits);ar(bH.__webglObjects,false,"",bL,bE,bC,true,bK);bp(bH.__webglObjectsImmediate,"",bL,bE,bC,false,bK)}else{this.setBlending(THREE.NormalBlending);ar(bH.__webglObjects,true,"opaque",bL,bE,bC,false);bp(bH.__webglObjectsImmediate,"opaque",bL,bE,bC,false);ar(bH.__webglObjects,false,"transparent",bL,bE,bC,true);bp(bH.__webglObjectsImmediate,"transparent",bL,bE,bC,true)}aD(this.renderPluginsPost,bH,bL);if(bI&&bI.generateMipmaps&&bI.minFilter!==THREE.NearestFilter&&bI.minFilter!==THREE.LinearFilter){g(bI)}this.setDepthTest(true);this.setDepthWrite(true)};function aD(bB,bF,bE){if(!bB.length){return}for(var bD=0,bC=bB.length;bD<bC;bD++){A=null;J=null;by=-1;aN=-1;ac=-1;y=-1;aa=-1;aB=-1;at=-1;bx=true;bB[bD].render(bF,bE,T,aE);A=null;J=null;by=-1;aN=-1;ac=-1;y=-1;aa=-1;aB=-1;at=-1;bx=true}}function ar(bB,bO,bK,bN,bH,bC,bL,bP){var bJ,bF,bG,bM,bD,bE,bQ;if(bO){bD=bB.length-1;bE=-1;bQ=-1}else{bD=0;bE=bB.length;bQ=1}for(var bI=bD;bI!==bE;bI+=bQ){bJ=bB[bI];if(bJ.render){bF=bJ.object;bG=bJ.buffer;if(bP){bM=bP}else{bM=bJ[bK];if(!bM){continue}if(bL){G.setBlending(bM.blending,bM.blendEquation,bM.blendSrc,bM.blendDst)}G.setDepthTest(bM.depthTest);G.setDepthWrite(bM.depthWrite);a3(bM.polygonOffset,bM.polygonOffsetFactor,bM.polygonOffsetUnits)}G.setMaterialFaces(bM);if(bG instanceof THREE.BufferGeometry){G.renderBufferDirect(bN,bH,bC,bM,bG,bF)}else{G.renderBuffer(bN,bH,bC,bM,bG,bF)}}}}function bp(bB,bI,bL,bE,bC,bJ,bM){var bH,bD,bK,bG;for(var bF=0,bN=bB.length;bF<bN;bF++){bH=bB[bF];bD=bH.object;if(bD.visible){if(bM){bK=bM}else{bK=bH[bI];if(!bK){continue}if(bJ){G.setBlending(bK.blending,bK.blendEquation,bK.blendSrc,bK.blendDst)}G.setDepthTest(bK.depthTest);G.setDepthWrite(bK.depthWrite);a3(bK.polygonOffset,bK.polygonOffsetFactor,bK.polygonOffsetUnits)}G.renderImmediateObject(bL,bE,bC,bK,bD)}}}this.renderImmediateObject=function(bF,bD,bG,bE,bC){var bB=aH(bF,bD,bG,bE,bC);aB=-1;G.setMaterialFaces(bE);if(bC.immediateRenderCallback){bC.immediateRenderCallback(bB,aU,aP)}else{bC.render(function(bH){G.renderBufferImmediate(bH,bB,bE)})}};function R(bD){var bB=bD.object,bC=bB.material;if(bC.transparent){bD.transparent=bC;bD.opaque=null}else{bD.opaque=bC;bD.transparent=null}}function m(bG){var bE=bG.object,bD=bG.buffer,bF,bC,bB;bB=bE.material;if(bB instanceof THREE.MeshFaceMaterial){bC=bD.materialIndex;if(bC>=0){bF=bE.geometry.materials[bC];if(bF.transparent){bG.transparent=bF;bG.opaque=null}else{bG.opaque=bF;bG.transparent=null}}}else{bF=bB;if(bF){if(bF.transparent){bG.transparent=bF;bG.opaque=null}else{bG.opaque=bF;bG.transparent=null}}}}function bk(bJ){var bF,bL,bI,bM,bH,bB,bD,bG={};var bK=bJ.morphTargets.length;var bC=bJ.morphNormals.length;bJ.geometryGroups={};for(bF=0,bL=bJ.faces.length;bF<bL;bF++){bI=bJ.faces[bF];bM=bI.materialIndex;bB=(bM!==undefined)?bM:-1;if(bG[bB]===undefined){bG[bB]={hash:bB,counter:0}}bD=bG[bB].hash+"_"+bG[bB].counter;if(bJ.geometryGroups[bD]===undefined){bJ.geometryGroups[bD]={faces3:[],faces4:[],materialIndex:bM,vertices:0,numMorphTargets:bK,numMorphNormals:bC}}bH=bI instanceof THREE.Face3?3:4;if(bJ.geometryGroups[bD].vertices+bH>65535){bG[bB].counter+=1;bD=bG[bB].hash+"_"+bG[bB].counter;if(bJ.geometryGroups[bD]===undefined){bJ.geometryGroups[bD]={faces3:[],faces4:[],materialIndex:bM,vertices:0,numMorphTargets:bK,numMorphNormals:bC}}}if(bI instanceof THREE.Face3){bJ.geometryGroups[bD].faces3.push(bF)}else{bJ.geometryGroups[bD].faces4.push(bF)}bJ.geometryGroups[bD].vertices+=bH}bJ.geometryGroupsList=[];for(var bE in bJ.geometryGroups){bJ.geometryGroups[bE].id=aC++;bJ.geometryGroupsList.push(bJ.geometryGroups[bE])}}this.initWebGLObjects=function(bC){if(!bC.__webglObjects){bC.__webglObjects=[];bC.__webglObjectsImmediate=[];bC.__webglSprites=[];bC.__webglFlares=[]}while(bC.__objectsAdded.length){r(bC.__objectsAdded[0],bC);bC.__objectsAdded.splice(0,1)}while(bC.__objectsRemoved.length){aM(bC.__objectsRemoved[0],bC);bC.__objectsRemoved.splice(0,1)}for(var bD=0,bB=bC.__webglObjects.length;bD<bB;bD++){al(bC.__webglObjects[bD].object)}};function r(bC,bE){var bD,bF,bB;if(!bC.__webglInit){bC.__webglInit=true;bC._modelViewMatrix=new THREE.Matrix4();bC._normalMatrix=new THREE.Matrix3();if(bC instanceof THREE.Mesh){bF=bC.geometry;if(bF instanceof THREE.Geometry){if(bF.geometryGroups===undefined){bk(bF)}for(bD in bF.geometryGroups){bB=bF.geometryGroups[bD];if(!bB.__webglVertexBuffer){bu(bB);z(bB,bC);bF.verticesNeedUpdate=true;bF.morphTargetsNeedUpdate=true;bF.elementsNeedUpdate=true;bF.uvsNeedUpdate=true;bF.normalsNeedUpdate=true;bF.tangentsNeedUpdate=true;bF.colorsNeedUpdate=true}}}else{if(bF instanceof THREE.BufferGeometry){E(bF)}}}else{if(bC instanceof THREE.Ribbon){bF=bC.geometry;if(!bF.__webglVertexBuffer){a7(bF);bl(bF);bF.verticesNeedUpdate=true;bF.colorsNeedUpdate=true}}else{if(bC instanceof THREE.Line){bF=bC.geometry;if(!bF.__webglVertexBuffer){bw(bF);B(bF,bC);bF.verticesNeedUpdate=true;bF.colorsNeedUpdate=true}}else{if(bC instanceof THREE.ParticleSystem){bF=bC.geometry;if(!bF.__webglVertexBuffer){if(bF instanceof THREE.Geometry){W(bF);bb(bF,bC);bF.verticesNeedUpdate=true;bF.colorsNeedUpdate=true}else{if(bF instanceof THREE.BufferGeometry){E(bF)}}}}}}}}if(!bC.__webglActive){if(bC instanceof THREE.Mesh){bF=bC.geometry;if(bF instanceof THREE.BufferGeometry){j(bE.__webglObjects,bF,bC)}else{for(bD in bF.geometryGroups){bB=bF.geometryGroups[bD];j(bE.__webglObjects,bB,bC)}}}else{if(bC instanceof THREE.Ribbon||bC instanceof THREE.Line||bC instanceof THREE.ParticleSystem){bF=bC.geometry;j(bE.__webglObjects,bF,bC)}else{if(bC instanceof THREE.ImmediateRenderObject||bC.immediateRenderCallback){H(bE.__webglObjectsImmediate,bC)}else{if(bC instanceof THREE.Sprite){bE.__webglSprites.push(bC)}else{if(bC instanceof THREE.LensFlare){bE.__webglFlares.push(bC)}}}}}bC.__webglActive=true}}function j(bD,bB,bC){bD.push({buffer:bB,object:bC,opaque:null,transparent:null})}function H(bC,bB){bC.push({object:bB,opaque:null,transparent:null})}function al(bD){var bH=bD.geometry,bB,bF,bG;if(bD instanceof THREE.Mesh){if(bH instanceof THREE.BufferGeometry){if(bH.verticesNeedUpdate||bH.elementsNeedUpdate||bH.uvsNeedUpdate||bH.normalsNeedUpdate||bH.colorsNeedUpdate||bH.tangentsNeedUpdate){aW(bH,aU.DYNAMIC_DRAW,!bH.dynamic)}bH.verticesNeedUpdate=false;bH.elementsNeedUpdate=false;bH.uvsNeedUpdate=false;bH.normalsNeedUpdate=false;bH.colorsNeedUpdate=false;bH.tangentsNeedUpdate=false}else{for(var bE=0,bC=bH.geometryGroupsList.length;bE<bC;bE++){bB=bH.geometryGroupsList[bE];bG=aF(bD,bB);bF=bG.attributes&&aJ(bG);if(bH.verticesNeedUpdate||bH.morphTargetsNeedUpdate||bH.elementsNeedUpdate||bH.uvsNeedUpdate||bH.normalsNeedUpdate||bH.colorsNeedUpdate||bH.tangentsNeedUpdate||bF){p(bB,bD,aU.DYNAMIC_DRAW,!bH.dynamic,bG)}}bH.verticesNeedUpdate=false;bH.morphTargetsNeedUpdate=false;bH.elementsNeedUpdate=false;bH.uvsNeedUpdate=false;bH.normalsNeedUpdate=false;bH.colorsNeedUpdate=false;bH.tangentsNeedUpdate=false;bG.attributes&&af(bG)}}else{if(bD instanceof THREE.Ribbon){if(bH.verticesNeedUpdate||bH.colorsNeedUpdate){ag(bH,aU.DYNAMIC_DRAW)}bH.verticesNeedUpdate=false;bH.colorsNeedUpdate=false}else{if(bD instanceof THREE.Line){bG=aF(bD,bB);bF=bG.attributes&&aJ(bG);if(bH.verticesNeedUpdate||bH.colorsNeedUpdate||bF){bt(bH,aU.DYNAMIC_DRAW)}bH.verticesNeedUpdate=false;bH.colorsNeedUpdate=false;bG.attributes&&af(bG)}else{if(bD instanceof THREE.ParticleSystem){if(bH instanceof THREE.BufferGeometry){if(bH.verticesNeedUpdate||bH.colorsNeedUpdate){aW(bH,aU.DYNAMIC_DRAW,!bH.dynamic)}bH.verticesNeedUpdate=false;bH.colorsNeedUpdate=false}else{bG=aF(bD,bB);bF=bG.attributes&&aJ(bG);if(bH.verticesNeedUpdate||bH.colorsNeedUpdate||bD.sortParticles||bF){N(bH,aU.DYNAMIC_DRAW,bD)}bH.verticesNeedUpdate=false;bH.colorsNeedUpdate=false;bG.attributes&&af(bG)}}}}}}function aJ(bC){for(var bB in bC.attributes){if(bC.attributes[bB].needsUpdate){return true}}return false}function af(bC){for(var bB in bC.attributes){bC.attributes[bB].needsUpdate=false}}function aM(bB,bC){if(bB instanceof THREE.Mesh||bB instanceof THREE.ParticleSystem||bB instanceof THREE.Ribbon||bB instanceof THREE.Line){aI(bC.__webglObjects,bB)}else{if(bB instanceof THREE.Sprite){aL(bC.__webglSprites,bB)}else{if(bB instanceof THREE.LensFlare){aL(bC.__webglFlares,bB)}else{if(bB instanceof THREE.ImmediateRenderObject||bB.immediateRenderCallback){aI(bC.__webglObjectsImmediate,bB)}}}}bB.__webglActive=false}function aI(bC,bB){for(var bD=bC.length-1;bD>=0;bD--){if(bC[bD].object===bB){bC.splice(bD,1)}}}function aL(bC,bB){for(var bD=bC.length-1;bD>=0;bD--){if(bC[bD]===bB){bC.splice(bD,1)}}}this.initMaterial=function(bL,bJ,bC,bH){var bQ,bN,bM,bK,bP,bF,bB,bG,bO;if(bL instanceof THREE.MeshDepthMaterial){bO="depth"}else{if(bL instanceof THREE.MeshNormalMaterial){bO="normal"}else{if(bL instanceof THREE.MeshBasicMaterial){bO="basic"}else{if(bL instanceof THREE.MeshLambertMaterial){bO="lambert"}else{if(bL instanceof THREE.MeshPhongMaterial){bO="phong"}else{if(bL instanceof THREE.LineBasicMaterial){bO="basic"}else{if(bL instanceof THREE.ParticleBasicMaterial){bO="particle_basic"}}}}}}}if(bO){aQ(bL,THREE.ShaderLib[bO])}bF=u(bJ);bG=bm(bJ);bB=f(bH);bP={map:!!bL.map,envMap:!!bL.envMap,lightMap:!!bL.lightMap,bumpMap:!!bL.bumpMap,normalMap:!!bL.normalMap,specularMap:!!bL.specularMap,vertexColors:bL.vertexColors,fog:bC,useFog:bL.fog,sizeAttenuation:bL.sizeAttenuation,skinning:bL.skinning,maxBones:bB,useVertexTexture:aY&&bH&&bH.useVertexTexture,boneTextureWidth:bH&&bH.boneTextureWidth,boneTextureHeight:bH&&bH.boneTextureHeight,morphTargets:bL.morphTargets,morphNormals:bL.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:bF.directional,maxPointLights:bF.point,maxSpotLights:bF.spot,maxHemiLights:bF.hemi,maxShadows:bG,shadowMapEnabled:this.shadowMapEnabled&&bH.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:bL.alphaTest,metal:bL.metal,perPixel:bL.perPixel,wrapAround:bL.wrapAround,doubleSided:bL.side===THREE.DoubleSide,flipSided:bL.side===THREE.BackSide};bL.program=a2(bO,bL.fragmentShader,bL.vertexShader,bL.uniforms,bL.attributes,bP);var bI=bL.program.attributes;if(bI.position>=0){aU.enableVertexAttribArray(bI.position)}if(bI.color>=0){aU.enableVertexAttribArray(bI.color)}if(bI.normal>=0){aU.enableVertexAttribArray(bI.normal)}if(bI.tangent>=0){aU.enableVertexAttribArray(bI.tangent)}if(bL.skinning&&bI.skinIndex>=0&&bI.skinWeight>=0){aU.enableVertexAttribArray(bI.skinIndex);aU.enableVertexAttribArray(bI.skinWeight)}if(bL.attributes){for(bN in bL.attributes){if(bI[bN]!==undefined&&bI[bN]>=0){aU.enableVertexAttribArray(bI[bN])}}}if(bL.morphTargets){bL.numSupportedMorphTargets=0;var bE,bD="morphTarget";for(bK=0;bK<this.maxMorphTargets;bK++){bE=bD+bK;if(bI[bE]>=0){aU.enableVertexAttribArray(bI[bE]);bL.numSupportedMorphTargets++}}}if(bL.morphNormals){bL.numSupportedMorphNormals=0;var bE,bD="morphNormal";for(bK=0;bK<this.maxMorphNormals;bK++){bE=bD+bK;if(bI[bE]>=0){aU.enableVertexAttribArray(bI[bE]);bL.numSupportedMorphNormals++}}}bL.uniformsList=[];for(bQ in bL.uniforms){bL.uniformsList.push([bL.uniforms[bQ],bQ])}};function aQ(bC,bB){bC.uniforms=THREE.UniformsUtils.clone(bB.uniforms);bC.vertexShader=bB.vertexShader;bC.fragmentShader=bB.fragmentShader}function aH(bH,bD,bB,bI,bC){bh=0;if(bI.needsUpdate){if(bI.program){G.deallocateMaterial(bI)}G.initMaterial(bI,bD,bB,bC);bI.needsUpdate=false}if(bI.morphTargets){if(!bC.__webglMorphTargetInfluences){bC.__webglMorphTargetInfluences=new Float32Array(G.maxMorphTargets)}}var bG=false;var bE=bI.program,bL=bE.uniforms,bJ=bI.uniforms;if(bE!==A){aU.useProgram(bE);A=bE;bG=true}if(bI.id!==at){at=bI.id;bG=true}if(bG||bH!==J){aU.uniformMatrix4fv(bL.projectionMatrix,false,bH._projectionMatrixArray);if(bH!==J){J=bH}}if(bI.skinning){if(aY&&bC.useVertexTexture){if(bL.boneTexture!==null){var bK=F();aU.uniform1i(bL.boneTexture,bK);G.setTexture(bC.boneTexture,bK)}}else{if(bL.boneGlobalMatrices!==null){aU.uniformMatrix4fv(bL.boneGlobalMatrices,false,bC.boneMatrices)}}}if(bG){if(bB&&bI.fog){aX(bJ,bB)}if(bI instanceof THREE.MeshPhongMaterial||bI instanceof THREE.MeshLambertMaterial||bI.lights){if(bx){bf(bE,bD);bx=false}x(bJ,t)}if(bI instanceof THREE.MeshBasicMaterial||bI instanceof THREE.MeshLambertMaterial||bI instanceof THREE.MeshPhongMaterial){aj(bJ,bI)}if(bI instanceof THREE.LineBasicMaterial){ap(bJ,bI)}else{if(bI instanceof THREE.ParticleBasicMaterial){ae(bJ,bI)}else{if(bI instanceof THREE.MeshPhongMaterial){ao(bJ,bI)}else{if(bI instanceof THREE.MeshLambertMaterial){bd(bJ,bI)}else{if(bI instanceof THREE.MeshDepthMaterial){bJ.mNear.value=bH.near;bJ.mFar.value=bH.far;bJ.opacity.value=bI.opacity}else{if(bI instanceof THREE.MeshNormalMaterial){bJ.opacity.value=bI.opacity}}}}}}if(bC.receiveShadow&&!bI._shadowPass){C(bJ,bD)}a6(bE,bI.uniformsList);if(bI instanceof THREE.ShaderMaterial||bI instanceof THREE.MeshPhongMaterial||bI.envMap){if(bL.cameraPosition!==null){var bF=bH.matrixWorld.getPosition();aU.uniform3f(bL.cameraPosition,bF.x,bF.y,bF.z)}}if(bI instanceof THREE.MeshPhongMaterial||bI instanceof THREE.MeshLambertMaterial||bI instanceof THREE.ShaderMaterial||bI.skinning){if(bL.viewMatrix!==null){aU.uniformMatrix4fv(bL.viewMatrix,false,bH._viewMatrixArray)}}}w(bL,bC);if(bL.modelMatrix!==null){aU.uniformMatrix4fv(bL.modelMatrix,false,bC.matrixWorld.elements)}return bE}function aj(bC,bD){bC.opacity.value=bD.opacity;if(G.gammaInput){bC.diffuse.value.copyGammaToLinear(bD.color)}else{bC.diffuse.value=bD.color}bC.map.value=bD.map;bC.lightMap.value=bD.lightMap;bC.specularMap.value=bD.specularMap;if(bD.bumpMap){bC.bumpMap.value=bD.bumpMap;bC.bumpScale.value=bD.bumpScale}if(bD.normalMap){bC.normalMap.value=bD.normalMap;bC.normalScale.value.copy(bD.normalScale)}var bB;if(bD.map){bB=bD.map}else{if(bD.specularMap){bB=bD.specularMap}else{if(bD.normalMap){bB=bD.normalMap}else{if(bD.bumpMap){bB=bD.bumpMap}}}}if(bB!==undefined){var bF=bB.offset;var bE=bB.repeat;bC.offsetRepeat.value.set(bF.x,bF.y,bE.x,bE.y)}bC.envMap.value=bD.envMap;bC.flipEnvMap.value=(bD.envMap instanceof THREE.WebGLRenderTargetCube)?1:-1;if(G.gammaInput){bC.reflectivity.value=bD.reflectivity}else{bC.reflectivity.value=bD.reflectivity}bC.refractionRatio.value=bD.refractionRatio;bC.combine.value=bD.combine;bC.useRefract.value=bD.envMap&&bD.envMap.mapping instanceof THREE.CubeRefractionMapping}function ap(bB,bC){bB.diffuse.value=bC.color;bB.opacity.value=bC.opacity}function ae(bB,bC){bB.psColor.value=bC.color;bB.opacity.value=bC.opacity;bB.size.value=bC.size;bB.scale.value=i.height/2;bB.map.value=bC.map}function aX(bB,bC){bB.fogColor.value=bC.color;if(bC instanceof THREE.Fog){bB.fogNear.value=bC.near;bB.fogFar.value=bC.far}else{if(bC instanceof THREE.FogExp2){bB.fogDensity.value=bC.density}}}function ao(bB,bC){bB.shininess.value=bC.shininess;if(G.gammaInput){bB.ambient.value.copyGammaToLinear(bC.ambient);bB.emissive.value.copyGammaToLinear(bC.emissive);bB.specular.value.copyGammaToLinear(bC.specular)}else{bB.ambient.value=bC.ambient;bB.emissive.value=bC.emissive;bB.specular.value=bC.specular}if(bC.wrapAround){bB.wrapRGB.value.copy(bC.wrapRGB)}}function bd(bB,bC){if(G.gammaInput){bB.ambient.value.copyGammaToLinear(bC.ambient);bB.emissive.value.copyGammaToLinear(bC.emissive)}else{bB.ambient.value=bC.ambient;bB.emissive.value=bC.emissive}if(bC.wrapAround){bB.wrapRGB.value.copy(bC.wrapRGB)}}function x(bB,bC){bB.ambientLightColor.value=bC.ambient;bB.directionalLightColor.value=bC.directional.colors;bB.directionalLightDirection.value=bC.directional.positions;bB.pointLightColor.value=bC.point.colors;bB.pointLightPosition.value=bC.point.positions;bB.pointLightDistance.value=bC.point.distances;bB.spotLightColor.value=bC.spot.colors;bB.spotLightPosition.value=bC.spot.positions;bB.spotLightDistance.value=bC.spot.distances;bB.spotLightDirection.value=bC.spot.directions;bB.spotLightAngle.value=bC.spot.angles;bB.spotLightExponent.value=bC.spot.exponents;bB.hemisphereLightSkyColor.value=bC.hemi.skyColors;bB.hemisphereLightGroundColor.value=bC.hemi.groundColors;bB.hemisphereLightPosition.value=bC.hemi.positions}function C(bB,bF){if(bB.shadowMatrix){var bE=0;for(var bG=0,bD=bF.length;bG<bD;bG++){var bC=bF[bG];if(!bC.castShadow){continue}if(bC instanceof THREE.SpotLight||(bC instanceof THREE.DirectionalLight&&!bC.shadowCascade)){bB.shadowMap.value[bE]=bC.shadowMap;bB.shadowMapSize.value[bE]=bC.shadowMapSize;bB.shadowMatrix.value[bE]=bC.shadowMatrix;bB.shadowDarkness.value[bE]=bC.shadowDarkness;bB.shadowBias.value[bE]=bC.shadowBias;bE++}}}}function w(bB,bC){aU.uniformMatrix4fv(bB.modelViewMatrix,false,bC._modelViewMatrix.elements);if(bB.normalMatrix){aU.uniformMatrix3fv(bB.normalMatrix,false,bC._normalMatrix.elements)}}function F(){var bB=bh;if(bB>=a1){console.warn("Trying to use "+bB+" texture units while this GPU supports only "+a1)}bh+=1;return bB}function a6(bG,bM){var bB,bK,bI,bL,bH,bN,bF,bJ,bD,bE,bC;for(bD=0,bE=bM.length;bD<bE;bD++){bL=bG.uniforms[bM[bD][1]];if(!bL){continue}bB=bM[bD][0];bI=bB.type;bK=bB.value;if(bI==="i"){aU.uniform1i(bL,bK)}else{if(bI==="f"){aU.uniform1f(bL,bK)}else{if(bI==="v2"){aU.uniform2f(bL,bK.x,bK.y)}else{if(bI==="v3"){aU.uniform3f(bL,bK.x,bK.y,bK.z)}else{if(bI==="v4"){aU.uniform4f(bL,bK.x,bK.y,bK.z,bK.w)}else{if(bI==="c"){aU.uniform3f(bL,bK.r,bK.g,bK.b)}else{if(bI==="iv1"){aU.uniform1iv(bL,bK)}else{if(bI==="iv"){aU.uniform3iv(bL,bK)}else{if(bI==="fv1"){aU.uniform1fv(bL,bK)}else{if(bI==="fv"){aU.uniform3fv(bL,bK)}else{if(bI==="v2v"){if(bB._array===undefined){bB._array=new Float32Array(2*bK.length)}for(bF=0,bJ=bK.length;bF<bJ;bF++){bC=bF*2;bB._array[bC]=bK[bF].x;bB._array[bC+1]=bK[bF].y}aU.uniform2fv(bL,bB._array)}else{if(bI==="v3v"){if(bB._array===undefined){bB._array=new Float32Array(3*bK.length)}for(bF=0,bJ=bK.length;bF<bJ;bF++){bC=bF*3;bB._array[bC]=bK[bF].x;bB._array[bC+1]=bK[bF].y;bB._array[bC+2]=bK[bF].z}aU.uniform3fv(bL,bB._array)}else{if(bI==="v4v"){if(bB._array===undefined){bB._array=new Float32Array(4*bK.length)}for(bF=0,bJ=bK.length;bF<bJ;bF++){bC=bF*4;bB._array[bC]=bK[bF].x;bB._array[bC+1]=bK[bF].y;bB._array[bC+2]=bK[bF].z;bB._array[bC+3]=bK[bF].w}aU.uniform4fv(bL,bB._array)}else{if(bI==="m4"){if(bB._array===undefined){bB._array=new Float32Array(16)}bK.flattenToArray(bB._array);aU.uniformMatrix4fv(bL,false,bB._array)}else{if(bI==="m4v"){if(bB._array===undefined){bB._array=new Float32Array(16*bK.length)}for(bF=0,bJ=bK.length;bF<bJ;bF++){bK[bF].flattenToArrayOffset(bB._array,bF*16)}aU.uniformMatrix4fv(bL,false,bB._array)}else{if(bI==="t"){bH=bK;bN=F();aU.uniform1i(bL,bN);if(!bH){continue}if(bH.image instanceof Array&&bH.image.length===6){o(bH,bN)}else{if(bH instanceof THREE.WebGLRenderTargetCube){bi(bH,bN)}else{G.setTexture(bH,bN)}}}else{if(bI==="tv"){if(bB._array===undefined){bB._array=[]}for(bF=0,bJ=bB.value.length;bF<bJ;bF++){bB._array[bF]=F()}aU.uniform1iv(bL,bB._array);for(bF=0,bJ=bB.value.length;bF<bJ;bF++){bH=bB.value[bF];bN=bB._array[bF];if(!bH){continue}G.setTexture(bH,bN)}}}}}}}}}}}}}}}}}}}}function aZ(bB,bC){bB._modelViewMatrix.multiply(bC.matrixWorldInverse,bB.matrixWorld);bB._normalMatrix.getInverse(bB._modelViewMatrix);bB._normalMatrix.transpose()}function bn(bE,bD,bB,bC){bE[bD]=bB.r*bB.r*bC;bE[bD+1]=bB.g*bB.g*bC;bE[bD+2]=bB.b*bB.b*bC}function a4(bE,bD,bC,bB){bE[bD]=bC.r*bB;bE[bD+1]=bC.g*bB;bE[bD+2]=bC.b*bB}function bf(bB,bG){var ca,bX,bR,b6,b1=0,cb=0,cc=0,bV,bD,bI,bW,bH,b0,bP,bT=t,bN=bT.directional.colors,bE=bT.directional.positions,b7=bT.point.colors,b3=bT.point.positions,bU=bT.point.distances,b8=bT.spot.colors,bF=bT.spot.positions,b4=bT.spot.distances,bM=bT.spot.directions,bY=bT.spot.angles,bO=bT.spot.exponents,bC=bT.hemi.skyColors,b9=bT.hemi.groundColors,bL=bT.hemi.positions,cd=0,bS=0,bQ=0,bJ=0,bK=0,b5=0,b2=0,bZ=0;for(ca=0,bX=bG.length;ca<bX;ca++){bR=bG[ca];if(bR.onlyShadow||!bR.visible){continue}bV=bR.color;bW=bR.intensity;bP=bR.distance;if(bR instanceof THREE.AmbientLight){if(G.gammaInput){b1+=bV.r*bV.r;cb+=bV.g*bV.g;cc+=bV.b*bV.b}else{b1+=bV.r;cb+=bV.g;cc+=bV.b}}else{if(bR instanceof THREE.DirectionalLight){bK=cd*3;if(G.gammaInput){bn(bN,bK,bV,bW*bW)}else{a4(bN,bK,bV,bW)}k.copy(bR.matrixWorld.getPosition());k.subSelf(bR.target.matrixWorld.getPosition());k.normalize();bE[bK]=k.x;bE[bK+1]=k.y;bE[bK+2]=k.z;cd+=1}else{if(bR instanceof THREE.PointLight){b5=bS*3;if(G.gammaInput){bn(b7,b5,bV,bW*bW)}else{a4(b7,b5,bV,bW)}b0=bR.matrixWorld.getPosition();b3[b5]=b0.x;b3[b5+1]=b0.y;b3[b5+2]=b0.z;bU[bS]=bP;bS+=1}else{if(bR instanceof THREE.SpotLight){b2=bQ*3;if(G.gammaInput){bn(b8,b2,bV,bW*bW)}else{a4(b8,b2,bV,bW)}b0=bR.matrixWorld.getPosition();bF[b2]=b0.x;bF[b2+1]=b0.y;bF[b2+2]=b0.z;b4[bQ]=bP;k.copy(b0);k.subSelf(bR.target.matrixWorld.getPosition());k.normalize();bM[b2]=k.x;bM[b2+1]=k.y;bM[b2+2]=k.z;bY[bQ]=Math.cos(bR.angle);bO[bQ]=bR.exponent;bQ+=1}else{if(bR instanceof THREE.HemisphereLight){bD=bR.color;bI=bR.groundColor;bZ=bJ*3;if(G.gammaInput){bH=bW*bW;bn(bC,bZ,bD,bH);bn(b9,bZ,bI,bH)}else{a4(bC,bZ,bD,bW);a4(b9,bZ,bI,bW)}b0=bR.matrixWorld.getPosition();bL[bZ]=b0.x;bL[bZ+1]=b0.y;bL[bZ+2]=b0.z;bJ+=1}}}}}}for(ca=cd*3,bX=bN.length;ca<bX;ca++){bN[ca]=0}for(ca=bS*3,bX=b7.length;ca<bX;ca++){b7[ca]=0}for(ca=bQ*3,bX=b8.length;ca<bX;ca++){b8[ca]=0}for(ca=bJ*3,bX=bC.length;ca<bX;ca++){bC[ca]=0}for(ca=bJ*3,bX=b9.length;ca<bX;ca++){b9[ca]=0}bT.directional.length=cd;bT.point.length=bS;bT.spot.length=bQ;bT.hemi.length=bJ;bT.ambient[0]=b1;bT.ambient[1]=cb;bT.ambient[2]=cc}this.setFaceCulling=function(bC,bB){if(bC){if(!bB||bB==="ccw"){aU.frontFace(aU.CCW)}else{aU.frontFace(aU.CW)}if(bC==="back"){aU.cullFace(aU.BACK)}else{if(bC==="front"){aU.cullFace(aU.FRONT)}else{aU.cullFace(aU.FRONT_AND_BACK)}}aU.enable(aU.CULL_FACE)}else{aU.disable(aU.CULL_FACE)}};this.setMaterialFaces=function(bD){var bB=bD.side===THREE.DoubleSide;var bC=bD.side===THREE.BackSide;if(y!==bB){if(bB){aU.disable(aU.CULL_FACE)}else{aU.enable(aU.CULL_FACE)}y=bB}if(aa!==bC){if(bC){aU.frontFace(aU.CW)}else{aU.frontFace(aU.CCW)}aa=bC}};this.setDepthTest=function(bB){if(aN!==bB){if(bB){aU.enable(aU.DEPTH_TEST)}else{aU.disable(aU.DEPTH_TEST)}aN=bB}};this.setDepthWrite=function(bB){if(ac!==bB){aU.depthMask(bB);ac=bB}};function X(bB){if(bB!==bo){aU.lineWidth(bB);bo=bB}}function a3(bD,bC,bB){if(br!==bD){if(bD){aU.enable(aU.POLYGON_OFFSET_FILL)}else{aU.disable(aU.POLYGON_OFFSET_FILL)}br=bD}if(bD&&(az!==bC||c!==bB)){aU.polygonOffset(bC,bB);az=bC;c=bB}}this.setBlending=function(bC,bB,bD,bE){if(bC!==by){if(bC===THREE.NoBlending){aU.disable(aU.BLEND)}else{if(bC===THREE.AdditiveBlending){aU.enable(aU.BLEND);aU.blendEquation(aU.FUNC_ADD);aU.blendFunc(aU.SRC_ALPHA,aU.ONE)}else{if(bC===THREE.SubtractiveBlending){aU.enable(aU.BLEND);aU.blendEquation(aU.FUNC_ADD);aU.blendFunc(aU.ZERO,aU.ONE_MINUS_SRC_COLOR)}else{if(bC===THREE.MultiplyBlending){aU.enable(aU.BLEND);aU.blendEquation(aU.FUNC_ADD);aU.blendFunc(aU.ZERO,aU.SRC_COLOR)}else{if(bC===THREE.CustomBlending){aU.enable(aU.BLEND)}else{aU.enable(aU.BLEND);aU.blendEquationSeparate(aU.FUNC_ADD,aU.FUNC_ADD);aU.blendFuncSeparate(aU.SRC_ALPHA,aU.ONE_MINUS_SRC_ALPHA,aU.ONE,aU.ONE_MINUS_SRC_ALPHA)}}}}}by=bC}if(bC===THREE.CustomBlending){if(bB!==Y){aU.blendEquation(au(bB));Y=bB}if(bD!==l||bE!==M){aU.blendFunc(au(bD),au(bE));l=bD;M=bE}}else{Y=null;l=null;M=null}};function a2(bI,bB,bE,bT,bM,bK){var bP,bS,bL,bC;var bO=[];if(bI){bO.push(bI)}else{bO.push(bB);bO.push(bE)}for(bP in bK){bO.push(bP);bO.push(bK[bP])}bC=bO.join();for(bP=0,bS=b.length;bP<bS;bP++){var bF=b[bP];if(bF.code===bC){bF.usedTimes++;return bF.program}}bL=aU.createProgram();var bD=["precision "+aR+" float;",ay?"#define VERTEX_TEXTURES":"",G.gammaInput?"#define GAMMA_INPUT":"",G.gammaOutput?"#define GAMMA_OUTPUT":"",G.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+bK.maxDirLights,"#define MAX_POINT_LIGHTS "+bK.maxPointLights,"#define MAX_SPOT_LIGHTS "+bK.maxSpotLights,"#define MAX_HEMI_LIGHTS "+bK.maxHemiLights,"#define MAX_SHADOWS "+bK.maxShadows,"#define MAX_BONES "+bK.maxBones,bK.map?"#define USE_MAP":"",bK.envMap?"#define USE_ENVMAP":"",bK.lightMap?"#define USE_LIGHTMAP":"",bK.bumpMap?"#define USE_BUMPMAP":"",bK.normalMap?"#define USE_NORMALMAP":"",bK.specularMap?"#define USE_SPECULARMAP":"",bK.vertexColors?"#define USE_COLOR":"",bK.skinning?"#define USE_SKINNING":"",bK.useVertexTexture?"#define BONE_TEXTURE":"",bK.boneTextureWidth?"#define N_BONE_PIXEL_X "+bK.boneTextureWidth.toFixed(1):"",bK.boneTextureHeight?"#define N_BONE_PIXEL_Y "+bK.boneTextureHeight.toFixed(1):"",bK.morphTargets?"#define USE_MORPHTARGETS":"",bK.morphNormals?"#define USE_MORPHNORMALS":"",bK.perPixel?"#define PHONG_PER_PIXEL":"",bK.wrapAround?"#define WRAP_AROUND":"",bK.doubleSided?"#define DOUBLE_SIDED":"",bK.flipSided?"#define FLIP_SIDED":"",bK.shadowMapEnabled?"#define USE_SHADOWMAP":"",bK.shadowMapSoft?"#define SHADOWMAP_SOFT":"",bK.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",bK.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",bK.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n");var bG=["precision "+aR+" float;",(bK.bumpMap||bK.normalMap)?"#extension GL_OES_standard_derivatives : enable":"","#define MAX_DIR_LIGHTS "+bK.maxDirLights,"#define MAX_POINT_LIGHTS "+bK.maxPointLights,"#define MAX_SPOT_LIGHTS "+bK.maxSpotLights,"#define MAX_HEMI_LIGHTS "+bK.maxHemiLights,"#define MAX_SHADOWS "+bK.maxShadows,bK.alphaTest?"#define ALPHATEST "+bK.alphaTest:"",G.gammaInput?"#define GAMMA_INPUT":"",G.gammaOutput?"#define GAMMA_OUTPUT":"",G.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",(bK.useFog&&bK.fog)?"#define USE_FOG":"",(bK.useFog&&bK.fog instanceof THREE.FogExp2)?"#define FOG_EXP2":"",bK.map?"#define USE_MAP":"",bK.envMap?"#define USE_ENVMAP":"",bK.lightMap?"#define USE_LIGHTMAP":"",bK.bumpMap?"#define USE_BUMPMAP":"",bK.normalMap?"#define USE_NORMALMAP":"",bK.specularMap?"#define USE_SPECULARMAP":"",bK.vertexColors?"#define USE_COLOR":"",bK.metal?"#define METAL":"",bK.perPixel?"#define PHONG_PER_PIXEL":"",bK.wrapAround?"#define WRAP_AROUND":"",bK.doubleSided?"#define DOUBLE_SIDED":"",bK.flipSided?"#define FLIP_SIDED":"",bK.shadowMapEnabled?"#define USE_SHADOWMAP":"",bK.shadowMapSoft?"#define SHADOWMAP_SOFT":"",bK.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",bK.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");var bQ=am("fragment",bG+bB);var bH=am("vertex",bD+bE);aU.attachShader(bL,bH);aU.attachShader(bL,bQ);aU.linkProgram(bL);if(!aU.getProgramParameter(bL,aU.LINK_STATUS)){console.error("Could not initialise shader\nVALIDATE_STATUS: "+aU.getProgramParameter(bL,aU.VALIDATE_STATUS)+", gl error ["+aU.getError()+"]")}aU.deleteShader(bQ);aU.deleteShader(bH);bL.uniforms={};bL.attributes={};var bJ,bN,bU,bR;bJ=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"];if(bK.useVertexTexture){bJ.push("boneTexture")}else{bJ.push("boneGlobalMatrices")}for(bN in bT){bJ.push(bN)}D(bL,bJ);bJ=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight"];for(bR=0;bR<bK.maxMorphTargets;bR++){bJ.push("morphTarget"+bR)}for(bR=0;bR<bK.maxMorphNormals;bR++){bJ.push("morphNormal"+bR)}for(bU in bM){bJ.push(bU)}bj(bL,bJ);bL.id=bs++;b.push({program:bL,code:bC,usedTimes:1});G.info.memory.programs=b.length;return bL}function D(bD,bB){var bE,bC,bF;for(bE=0,bC=bB.length;bE<bC;bE++){bF=bB[bE];bD.uniforms[bF]=aU.getUniformLocation(bD,bF)}}function bj(bD,bB){var bE,bC,bF;for(bE=0,bC=bB.length;bE<bC;bE++){bF=bB[bE];bD.attributes[bF]=aU.getAttribLocation(bD,bF)}}function ab(bC){var bE=bC.split("\n");for(var bD=0,bB=bE.length;bD<bB;bD++){bE[bD]=(bD+1)+": "+bE[bD]}return bE.join("\n")}function am(bC,bB){var bD;if(bC==="fragment"){bD=aU.createShader(aU.FRAGMENT_SHADER)}else{if(bC==="vertex"){bD=aU.createShader(aU.VERTEX_SHADER)}}aU.shaderSource(bD,bB);aU.compileShader(bD);if(!aU.getShaderParameter(bD,aU.COMPILE_STATUS)){console.error(aU.getShaderInfoLog(bD));console.error(ab(bB));return null}return bD}function V(bB){return(bB&(bB-1))===0}function S(bB,bC,bD){if(bD){aU.texParameteri(bB,aU.TEXTURE_WRAP_S,au(bC.wrapS));aU.texParameteri(bB,aU.TEXTURE_WRAP_T,au(bC.wrapT));aU.texParameteri(bB,aU.TEXTURE_MAG_FILTER,au(bC.magFilter));aU.texParameteri(bB,aU.TEXTURE_MIN_FILTER,au(bC.minFilter))}else{aU.texParameteri(bB,aU.TEXTURE_WRAP_S,aU.CLAMP_TO_EDGE);aU.texParameteri(bB,aU.TEXTURE_WRAP_T,aU.CLAMP_TO_EDGE);aU.texParameteri(bB,aU.TEXTURE_MAG_FILTER,aw(bC.magFilter));aU.texParameteri(bB,aU.TEXTURE_MIN_FILTER,aw(bC.minFilter))}if(a5&&bC.type!==THREE.FloatType){if(bC.anisotropy>1||bC.__oldAnisotropy){aU.texParameterf(bB,a5.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(bC.anisotropy,ah));bC.__oldAnisotropy=bC.anisotropy}}}this.setTexture=function(bI,bK){if(bI.needsUpdate){if(!bI.__webglInit){bI.__webglInit=true;bI.__webglTexture=aU.createTexture();G.info.memory.textures++}aU.activeTexture(aU.TEXTURE0+bK);aU.bindTexture(aU.TEXTURE_2D,bI.__webglTexture);aU.pixelStorei(aU.UNPACK_FLIP_Y_WEBGL,bI.flipY);aU.pixelStorei(aU.UNPACK_PREMULTIPLY_ALPHA_WEBGL,bI.premultiplyAlpha);var bE=bI.image,bH=V(bE.width)&&V(bE.height),bB=au(bI.format),bD=au(bI.type);S(aU.TEXTURE_2D,bI,bH);if(bI instanceof THREE.CompressedTexture){var bC,bF=bI.mipmaps;for(var bG=0,bJ=bF.length;bG<bJ;bG++){bC=bF[bG];aU.compressedTexImage2D(aU.TEXTURE_2D,bG,bB,bC.width,bC.height,0,bC.data)}}else{if(bI instanceof THREE.DataTexture){aU.texImage2D(aU.TEXTURE_2D,0,bB,bE.width,bE.height,0,bB,bD,bE.data)}else{aU.texImage2D(aU.TEXTURE_2D,0,bB,bB,bD,bI.image)}}if(bI.generateMipmaps&&bH){aU.generateMipmap(aU.TEXTURE_2D)}bI.needsUpdate=false;if(bI.onUpdate){bI.onUpdate()}}else{aU.activeTexture(aU.TEXTURE0+bK);aU.bindTexture(aU.TEXTURE_2D,bI.__webglTexture)}};function v(bG,bH){if(bG.width<=bH&&bG.height<=bH){return bG}var bF=Math.max(bG.width,bG.height);var bE=Math.floor(bG.width*bH/bF);var bC=Math.floor(bG.height*bH/bF);var bD=document.createElement("canvas");bD.width=bE;bD.height=bC;var bB=bD.getContext("2d");bB.drawImage(bG,0,0,bG.width,bG.height,0,0,bE,bC);return bD}function o(bM,bN){if(bM.image.length===6){if(bM.needsUpdate){if(!bM.image.__webglTextureCube){bM.image.__webglTextureCube=aU.createTexture()}aU.activeTexture(aU.TEXTURE0+bN);aU.bindTexture(aU.TEXTURE_CUBE_MAP,bM.image.__webglTextureCube);aU.pixelStorei(aU.UNPACK_FLIP_Y_WEBGL,bM.flipY);var bE=bM instanceof THREE.CompressedTexture;var bB=[];for(var bK=0;bK<6;bK++){if(G.autoScaleCubemaps&&!bE){bB[bK]=v(bM.image[bK],aq)}else{bB[bK]=bM.image[bK]}}var bH=bB[0],bL=V(bH.width)&&V(bH.height),bC=au(bM.format),bF=au(bM.type);S(aU.TEXTURE_CUBE_MAP,bM,bL);for(var bK=0;bK<6;bK++){if(bE){var bD,bG=bB[bK].mipmaps;for(var bI=0,bJ=bG.length;bI<bJ;bI++){bD=bG[bI];aU.compressedTexImage2D(aU.TEXTURE_CUBE_MAP_POSITIVE_X+bK,bI,bC,bD.width,bD.height,0,bD.data)}}else{aU.texImage2D(aU.TEXTURE_CUBE_MAP_POSITIVE_X+bK,0,bC,bC,bF,bB[bK])}}if(bM.generateMipmaps&&bL){aU.generateMipmap(aU.TEXTURE_CUBE_MAP)}bM.needsUpdate=false;if(bM.onUpdate){bM.onUpdate()}}else{aU.activeTexture(aU.TEXTURE0+bN);aU.bindTexture(aU.TEXTURE_CUBE_MAP,bM.image.__webglTextureCube)}}}function bi(bB,bC){aU.activeTexture(aU.TEXTURE0+bC);aU.bindTexture(aU.TEXTURE_CUBE_MAP,bB.__webglTexture)}function n(bD,bC,bB){aU.bindFramebuffer(aU.FRAMEBUFFER,bD);aU.framebufferTexture2D(aU.FRAMEBUFFER,aU.COLOR_ATTACHMENT0,bB,bC.__webglTexture,0)}function q(bB,bC){aU.bindRenderbuffer(aU.RENDERBUFFER,bB);if(bC.depthBuffer&&!bC.stencilBuffer){aU.renderbufferStorage(aU.RENDERBUFFER,aU.DEPTH_COMPONENT16,bC.width,bC.height);aU.framebufferRenderbuffer(aU.FRAMEBUFFER,aU.DEPTH_ATTACHMENT,aU.RENDERBUFFER,bB)}else{if(bC.depthBuffer&&bC.stencilBuffer){aU.renderbufferStorage(aU.RENDERBUFFER,aU.DEPTH_STENCIL,bC.width,bC.height);aU.framebufferRenderbuffer(aU.FRAMEBUFFER,aU.DEPTH_STENCIL_ATTACHMENT,aU.RENDERBUFFER,bB)}else{aU.renderbufferStorage(aU.RENDERBUFFER,aU.RGBA4,bC.width,bC.height)}}}this.setRenderTarget=function(bF){var bH=(bF instanceof THREE.WebGLRenderTargetCube);if(bF&&!bF.__webglFramebuffer){if(bF.depthBuffer===undefined){bF.depthBuffer=true}if(bF.stencilBuffer===undefined){bF.stencilBuffer=true}bF.__webglTexture=aU.createTexture();var bI=V(bF.width)&&V(bF.height),bB=au(bF.format),bD=au(bF.type);if(bH){bF.__webglFramebuffer=[];bF.__webglRenderbuffer=[];aU.bindTexture(aU.TEXTURE_CUBE_MAP,bF.__webglTexture);S(aU.TEXTURE_CUBE_MAP,bF,bI);for(var bE=0;bE<6;bE++){bF.__webglFramebuffer[bE]=aU.createFramebuffer();bF.__webglRenderbuffer[bE]=aU.createRenderbuffer();aU.texImage2D(aU.TEXTURE_CUBE_MAP_POSITIVE_X+bE,0,bB,bF.width,bF.height,0,bB,bD,null);n(bF.__webglFramebuffer[bE],bF,aU.TEXTURE_CUBE_MAP_POSITIVE_X+bE);q(bF.__webglRenderbuffer[bE],bF)}if(bI){aU.generateMipmap(aU.TEXTURE_CUBE_MAP)}}else{bF.__webglFramebuffer=aU.createFramebuffer();bF.__webglRenderbuffer=aU.createRenderbuffer();aU.bindTexture(aU.TEXTURE_2D,bF.__webglTexture);S(aU.TEXTURE_2D,bF,bI);aU.texImage2D(aU.TEXTURE_2D,0,bB,bF.width,bF.height,0,bB,bD,null);n(bF.__webglFramebuffer,bF,aU.TEXTURE_2D);q(bF.__webglRenderbuffer,bF);if(bI){aU.generateMipmap(aU.TEXTURE_2D)}}if(bH){aU.bindTexture(aU.TEXTURE_CUBE_MAP,null)}else{aU.bindTexture(aU.TEXTURE_2D,null)}aU.bindRenderbuffer(aU.RENDERBUFFER,null);aU.bindFramebuffer(aU.FRAMEBUFFER,null)}var bK,bC,bL,bJ,bG;if(bF){if(bH){bK=bF.__webglFramebuffer[bF.activeCubeFace]}else{bK=bF.__webglFramebuffer}bC=bF.width;bL=bF.height;bJ=0;bG=0}else{bK=null;bC=be;bL=K;bJ=e;bG=d}if(bK!==bg){aU.bindFramebuffer(aU.FRAMEBUFFER,bK);aU.viewport(bJ,bG,bC,bL);bg=bK}T=bC;aE=bL};function g(bB){if(bB instanceof THREE.WebGLRenderTargetCube){aU.bindTexture(aU.TEXTURE_CUBE_MAP,bB.__webglTexture);aU.generateMipmap(aU.TEXTURE_CUBE_MAP);aU.bindTexture(aU.TEXTURE_CUBE_MAP,null)}else{aU.bindTexture(aU.TEXTURE_2D,bB.__webglTexture);aU.generateMipmap(aU.TEXTURE_2D);aU.bindTexture(aU.TEXTURE_2D,null)}}function aw(bB){if(bB===THREE.NearestFilter||bB===THREE.NearestMipMapNearestFilter||bB===THREE.NearestMipMapLinearFilter){return aU.NEAREST}return aU.LINEAR}function au(bB){if(bB===THREE.RepeatWrapping){return aU.REPEAT}if(bB===THREE.ClampToEdgeWrapping){return aU.CLAMP_TO_EDGE}if(bB===THREE.MirroredRepeatWrapping){return aU.MIRRORED_REPEAT}if(bB===THREE.NearestFilter){return aU.NEAREST}if(bB===THREE.NearestMipMapNearestFilter){return aU.NEAREST_MIPMAP_NEAREST}if(bB===THREE.NearestMipMapLinearFilter){return aU.NEAREST_MIPMAP_LINEAR}if(bB===THREE.LinearFilter){return aU.LINEAR}if(bB===THREE.LinearMipMapNearestFilter){return aU.LINEAR_MIPMAP_NEAREST}if(bB===THREE.LinearMipMapLinearFilter){return aU.LINEAR_MIPMAP_LINEAR}if(bB===THREE.UnsignedByteType){return aU.UNSIGNED_BYTE}if(bB===THREE.UnsignedShort4444Type){return aU.UNSIGNED_SHORT_4_4_4_4}if(bB===THREE.UnsignedShort5551Type){return aU.UNSIGNED_SHORT_5_5_5_1}if(bB===THREE.UnsignedShort565Type){return aU.UNSIGNED_SHORT_5_6_5}if(bB===THREE.ByteType){return aU.BYTE}if(bB===THREE.ShortType){return aU.SHORT}if(bB===THREE.UnsignedShortType){return aU.UNSIGNED_SHORT}if(bB===THREE.IntType){return aU.INT}if(bB===THREE.UnsignedIntType){return aU.UNSIGNED_INT}if(bB===THREE.FloatType){return aU.FLOAT}if(bB===THREE.AlphaFormat){return aU.ALPHA}if(bB===THREE.RGBFormat){return aU.RGB}if(bB===THREE.RGBAFormat){return aU.RGBA}if(bB===THREE.LuminanceFormat){return aU.LUMINANCE}if(bB===THREE.LuminanceAlphaFormat){return aU.LUMINANCE_ALPHA}if(bB===THREE.AddEquation){return aU.FUNC_ADD}if(bB===THREE.SubtractEquation){return aU.FUNC_SUBTRACT}if(bB===THREE.ReverseSubtractEquation){return aU.FUNC_REVERSE_SUBTRACT}if(bB===THREE.ZeroFactor){return aU.ZERO}if(bB===THREE.OneFactor){return aU.ONE}if(bB===THREE.SrcColorFactor){return aU.SRC_COLOR}if(bB===THREE.OneMinusSrcColorFactor){return aU.ONE_MINUS_SRC_COLOR}if(bB===THREE.SrcAlphaFactor){return aU.SRC_ALPHA}if(bB===THREE.OneMinusSrcAlphaFactor){return aU.ONE_MINUS_SRC_ALPHA}if(bB===THREE.DstAlphaFactor){return aU.DST_ALPHA}if(bB===THREE.OneMinusDstAlphaFactor){return aU.ONE_MINUS_DST_ALPHA}if(bB===THREE.DstColorFactor){return aU.DST_COLOR}if(bB===THREE.OneMinusDstColorFactor){return aU.ONE_MINUS_DST_COLOR}if(bB===THREE.SrcAlphaSaturateFactor){return aU.SRC_ALPHA_SATURATE}if(aV!==undefined){if(bB===THREE.RGB_S3TC_DXT1_Format){return aV.COMPRESSED_RGB_S3TC_DXT1_EXT}if(bB===THREE.RGBA_S3TC_DXT1_Format){return aV.COMPRESSED_RGBA_S3TC_DXT1_EXT}if(bB===THREE.RGBA_S3TC_DXT3_Format){return aV.COMPRESSED_RGBA_S3TC_DXT3_EXT}if(bB===THREE.RGBA_S3TC_DXT5_Format){return aV.COMPRESSED_RGBA_S3TC_DXT5_EXT}}return 0}function f(bE){if(aY&&bE&&bE.useVertexTexture){return 1024}else{var bC=aU.getParameter(aU.MAX_VERTEX_UNIFORM_VECTORS);var bD=Math.floor((bC-20)/4);var bB=bD;if(bE!==undefined&&bE instanceof THREE.SkinnedMesh){bB=Math.min(bE.bones.length,bB);if(bB<bE.bones.length){console.warn("WebGLRenderer: too many bones - "+bE.bones.length+", this GPU supports just "+bB+" (try OpenGL instead of ANGLE)")}}return bB}}function u(bF){var bC,bK,bG,bM,bH,bB,bE,bD,bI,bJ,bL;bM=bH=bB=bE=bD=bI=bJ=bL=0;for(bC=0,bK=bF.length;bC<bK;bC++){bG=bF[bC];if(bG.onlyShadow){continue}if(bG instanceof THREE.DirectionalLight){bM++}if(bG instanceof THREE.PointLight){bH++}if(bG instanceof THREE.SpotLight){bB++}if(bG instanceof THREE.HemisphereLight){bE++}}if((bH+bB+bM+bE)<=P){bD=bM;bI=bH;bJ=bB;bL=bE}else{bD=Math.ceil(P*bM/(bH+bM));bI=P-bD;bJ=bI;bL=bD}return{directional:bD,point:bI,spot:bJ,hemi:bL}}function bm(bD){var bC,bF,bB,bE=0;for(bC=0,bF=bD.length;bC<bF;bC++){bB=bD[bC];if(!bB.castShadow){continue}if(bB instanceof THREE.SpotLight){bE++}if(bB instanceof THREE.DirectionalLight&&!bB.shadowCascade){bE++}}return bE}function ba(){try{if(!(aU=i.getContext("experimental-webgl",{alpha:ak,premultipliedAlpha:bq,antialias:aA,stencil:bA,preserveDrawingBuffer:aG}))){throw"Error creating WebGL context."}}catch(bB){console.error(bB)}bz=aU.getExtension("OES_texture_float");h=aU.getExtension("OES_standard_derivatives");a5=aU.getExtension("EXT_texture_filter_anisotropic")||aU.getExtension("MOZ_EXT_texture_filter_anisotropic")||aU.getExtension("WEBKIT_EXT_texture_filter_anisotropic");aV=aU.getExtension("WEBGL_compressed_texture_s3tc")||aU.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||aU.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");if(!bz){console.log("THREE.WebGLRenderer: Float textures not supported.")}if(!h){console.log("THREE.WebGLRenderer: Standard derivatives not supported.")}if(!a5){console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported.")}if(!aV){console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.")}}function a0(){aU.clearColor(0,0,0,1);aU.clearDepth(1);aU.clearStencil(0);aU.enable(aU.DEPTH_TEST);aU.depthFunc(aU.LEQUAL);aU.frontFace(aU.CCW);aU.cullFace(aU.BACK);aU.enable(aU.CULL_FACE);aU.enable(aU.BLEND);aU.blendEquation(aU.FUNC_ADD);aU.blendFunc(aU.SRC_ALPHA,aU.ONE_MINUS_SRC_ALPHA);aU.clearColor(Q.r,Q.g,Q.b,aS)}this.shadowMapPlugin=new THREE.ShadowMapPlugin();this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new THREE.SpritePlugin());this.addPostPlugin(new THREE.LensFlarePlugin())};THREE.WebGLRenderTarget=function(c,a,b){this.width=c;this.height=a;b=b||{};this.wrapS=b.wrapS!==undefined?b.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=b.wrapT!==undefined?b.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=b.magFilter!==undefined?b.magFilter:THREE.LinearFilter;this.minFilter=b.minFilter!==undefined?b.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=b.anisotropy!==undefined?b.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=b.format!==undefined?b.format:THREE.RGBAFormat;this.type=b.type!==undefined?b.type:THREE.UnsignedByteType;this.depthBuffer=b.depthBuffer!==undefined?b.depthBuffer:true;this.stencilBuffer=b.stencilBuffer!==undefined?b.stencilBuffer:true;this.generateMipmaps=true};THREE.WebGLRenderTarget.prototype.clone=function(){var a=new THREE.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.anisotropy=this.anisotropy;a.minFilter=this.minFilter;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;a.generateMipmaps=this.generateMipmaps;return a};THREE.WebGLRenderTargetCube=function(c,a,b){THREE.WebGLRenderTarget.call(this,c,a,b);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3();this.positionScreen=new THREE.Vector4();this.visible=true};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.v3=new THREE.RenderableVertex();this.centroidWorld=new THREE.Vector3();this.centroidScreen=new THREE.Vector3();this.normalWorld=new THREE.Vector3();this.vertexNormalsWorld=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];this.vertexNormalsLength=0;this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.v3=new THREE.RenderableVertex();this.v4=new THREE.RenderableVertex();this.centroidWorld=new THREE.Vector3();this.centroidScreen=new THREE.Vector3();this.normalWorld=new THREE.Vector3();this.vertexNormalsWorld=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];this.vertexNormalsLength=0;this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableObject=function(){this.object=null;this.z=null};THREE.RenderableParticle=function(){this.object=null;this.x=null;this.y=null;this.z=null;this.rotation=null;this.scale=new THREE.Vector2();this.material=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.material=null};THREE.ColorUtils={adjustHSV:function(b,e,d,a){var c=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(b,c);c.h=THREE.Math.clamp(c.h+e,0,1);c.s=THREE.Math.clamp(c.s+d,0,1);c.v=THREE.Math.clamp(c.v+a,0,1);b.setHSV(c.h,c.s,c.v)},rgbToHsv:function(c,f){var a=c.r;var h=c.g;var j=c.b;var k=Math.max(Math.max(a,h),j);var d=Math.min(Math.min(a,h),j);var i;var e;var l=k;if(d===k){i=0;e=0}else{var m=(k-d);e=m/k;if(a===k){i=(h-j)/m}else{if(h===k){i=2+((j-a)/m)}else{i=4+((a-h)/m)}}i/=6;if(i<0){i+=1}if(i>1){i-=1}}if(f===undefined){f={h:0,s:0,v:0}}f.h=i;f.s=e;f.v=l;return f}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};THREE.GeometryUtils={merge:function(p,l){var y,H,o=p.vertices.length,u=p.faceVertexUvs[0].length,n=l instanceof THREE.Mesh?l.geometry:l,d=p.vertices,c=n.vertices,b=p.faces,a=n.faces,E=p.faceVertexUvs[0],C=n.faceVertexUvs[0];var F={};for(var z=0;z<p.materials.length;z++){var v=p.materials[z].id;F[v]=z}if(l instanceof THREE.Mesh){l.matrixAutoUpdate&&l.updateMatrix();y=l.matrix;H=new THREE.Matrix4();H.extractRotation(y,l.scale)}for(var z=0,m=c.length;z<m;z++){var D=c[z];var t=D.clone();if(y){y.multiplyVector3(t)}d.push(t)}for(z=0,m=a.length;z<m;z++){var k=a[z],r,G,w,q=k.vertexNormals,B=k.vertexColors;if(k instanceof THREE.Face3){r=new THREE.Face3(k.a+o,k.b+o,k.c+o)}else{if(k instanceof THREE.Face4){r=new THREE.Face4(k.a+o,k.b+o,k.c+o,k.d+o)}}r.normal.copy(k.normal);if(H){H.multiplyVector3(r.normal)}for(var x=0,A=q.length;x<A;x++){G=q[x].clone();if(H){H.multiplyVector3(G)}r.vertexNormals.push(G)}r.color.copy(k.color);for(var x=0,A=B.length;x<A;x++){w=B[x];r.vertexColors.push(w.clone())}if(k.materialIndex!==undefined){var s=n.materials[k.materialIndex];var f=s.id;var h=F[f];if(h===undefined){h=p.materials.length;F[f]=h;p.materials.push(s)}r.materialIndex=h}r.centroid.copy(k.centroid);if(y){y.multiplyVector3(r.centroid)}b.push(r)}for(z=0,m=C.length;z<m;z++){var g=C[z],e=[];for(var x=0,A=g.length;x<A;x++){e.push(new THREE.UV(g[x].u,g[x].v))}E.push(e)}},clone:function(n){var h=new THREE.Geometry();var g,o;var l=n.vertices,c=n.faces,e=n.faceVertexUvs[0];if(n.materials){h.materials=n.materials.slice()}for(g=0,o=l.length;g<o;g++){var k=l[g];h.vertices.push(k.clone())}for(g=0,o=c.length;g<o;g++){var m=c[g];h.faces.push(m.clone())}for(g=0,o=e.length;g<o;g++){var b=e[g],a=[];for(var d=0,f=b.length;d<f;d++){a.push(new THREE.UV(b[d].u,b[d].v))}h.faceVertexUvs[0].push(a)}return h},randomPointInTriangle:function(h,f,k){var g,e,j,d=new THREE.Vector3(),i=THREE.GeometryUtils.__v1;g=THREE.GeometryUtils.random();e=THREE.GeometryUtils.random();if((g+e)>1){g=1-g;e=1-e}j=1-g-e;d.copy(h);d.multiplyScalar(g);i.copy(f);i.multiplyScalar(e);d.addSelf(i);i.copy(k);i.multiplyScalar(j);d.addSelf(i);return d},randomPointInFace:function(f,g,e){var d,c,b,j;if(f instanceof THREE.Face3){d=g.vertices[f.a];c=g.vertices[f.b];b=g.vertices[f.c];return THREE.GeometryUtils.randomPointInTriangle(d,c,b)}else{if(f instanceof THREE.Face4){d=g.vertices[f.a];c=g.vertices[f.b];b=g.vertices[f.c];j=g.vertices[f.d];var i,h;if(e){if(f._area1&&f._area2){i=f._area1;h=f._area2}else{i=THREE.GeometryUtils.triangleArea(d,c,j);h=THREE.GeometryUtils.triangleArea(c,b,j);f._area1=i;f._area2=h}}else{i=THREE.GeometryUtils.triangleArea(d,c,j),h=THREE.GeometryUtils.triangleArea(c,b,j)}var a=THREE.GeometryUtils.random()*(i+h);if(a<i){return THREE.GeometryUtils.randomPointInTriangle(d,c,j)}else{return THREE.GeometryUtils.randomPointInTriangle(c,b,j)}}}},randomPointsInGeometry:function(b,k){var e,o,a=b.faces,c=b.vertices,f=a.length,q=0,t=[],s,p,m,l;for(o=0;o<f;o++){e=a[o];if(e instanceof THREE.Face3){s=c[e.a];p=c[e.b];m=c[e.c];e._area=THREE.GeometryUtils.triangleArea(s,p,m)}else{if(e instanceof THREE.Face4){s=c[e.a];p=c[e.b];m=c[e.c];l=c[e.d];e._area1=THREE.GeometryUtils.triangleArea(s,p,l);e._area2=THREE.GeometryUtils.triangleArea(p,m,l);e._area=e._area1+e._area2}}q+=e._area;t[o]=q}function h(n){function r(x,v){if(v<x){return x}var w=x+Math.floor((v-x)/2);if(t[w]>n){return r(x,w-1)}else{if(t[w]<n){return r(w+1,v)}else{return w}}}var i=r(0,t.length-1);return i}var j,d,g=[];var u={};for(o=0;o<k;o++){j=THREE.GeometryUtils.random()*q;d=h(j);g[o]=THREE.GeometryUtils.randomPointInFace(a[d],b,true);if(!u[d]){u[d]=1}else{u[d]+=1}}return g},triangleArea:function(g,e,k){var i,f,d,j,h=THREE.GeometryUtils.__v1;h.sub(g,e);f=h.length();h.sub(g,k);d=h.length();h.sub(e,k);j=h.length();i=0.5*(f+d+j);return Math.sqrt(i*(i-f)*(i-d)*(i-j))},center:function(c){c.computeBoundingBox();var b=c.boundingBox;var a=new THREE.Vector3();a.add(b.min,b.max);a.multiplyScalar(-0.5);c.applyMatrix(new THREE.Matrix4().makeTranslation(a.x,a.y,a.z));c.computeBoundingBox();return a},normalizeUVs:function(g){var b=g.faceVertexUvs[0];for(var f=0,a=b.length;f<a;f++){var e=b[f];for(var c=0,d=e.length;c<d;c++){if(e[c].u!==1){e[c].u=e[c].u-Math.floor(e[c].u)}if(e[c].v!==1){e[c].v=e[c].v-Math.floor(e[c].v)}}}},triangulateQuads:function(g){var u,m,t,v;var e=[];var f=[];var w=[];for(u=0,m=g.faceUvs.length;u<m;u++){f[u]=[]}for(u=0,m=g.faceVertexUvs.length;u<m;u++){w[u]=[]}for(u=0,m=g.faces.length;u<m;u++){var k=g.faces[u];if(k instanceof THREE.Face4){var C=k.a;var B=k.b;var A=k.c;var z=k.d;var s=new THREE.Face3();var r=new THREE.Face3();s.color.copy(k.color);r.color.copy(k.color);s.materialIndex=k.materialIndex;r.materialIndex=k.materialIndex;s.a=C;s.b=B;s.c=z;r.a=B;r.b=A;r.c=z;if(k.vertexColors.length===4){s.vertexColors[0]=k.vertexColors[0].clone();s.vertexColors[1]=k.vertexColors[1].clone();s.vertexColors[2]=k.vertexColors[3].clone();r.vertexColors[0]=k.vertexColors[1].clone();r.vertexColors[1]=k.vertexColors[2].clone();r.vertexColors[2]=k.vertexColors[3].clone()}e.push(s,r);for(t=0,v=g.faceVertexUvs.length;t<v;t++){if(g.faceVertexUvs[t].length){var n=g.faceVertexUvs[t][u];var q=n[0];var p=n[1];var o=n[2];var l=n[3];var y=[q.clone(),p.clone(),l.clone()];var x=[p.clone(),o.clone(),l.clone()];w[t].push(y,x)}}for(t=0,v=g.faceUvs.length;t<v;t++){if(g.faceUvs[t].length){var h=g.faceUvs[t][u];f[t].push(h,h)}}}else{e.push(k);for(t=0,v=g.faceUvs.length;t<v;t++){f[t].push(g.faceUvs[t][u])}for(t=0,v=g.faceVertexUvs.length;t<v;t++){w[t].push(g.faceVertexUvs[t][u])}}}g.faces=e;g.faceUvs=f;g.faceVertexUvs=w;g.computeCentroids();g.computeFaceNormals();g.computeVertexNormals();if(g.hasTangents){g.computeTangents()}},explode:function(q){var h=[];for(var f=0,s=q.faces.length;f<s;f++){var e=h.length;var l=q.faces[f];if(l instanceof THREE.Face4){var t=l.a;var r=l.b;var o=l.c;var k=l.d;var p=q.vertices[t];var m=q.vertices[r];var j=q.vertices[o];var g=q.vertices[k];h.push(p.clone());h.push(m.clone());h.push(j.clone());h.push(g.clone());l.a=e;l.b=e+1;l.c=e+2;l.d=e+3}else{var t=l.a;var r=l.b;var o=l.c;var p=q.vertices[t];var m=q.vertices[r];var j=q.vertices[o];h.push(p.clone());h.push(m.clone());h.push(j.clone());l.a=e;l.b=e+1;l.c=e+2}}q.vertices=h;delete q.__tmpVertices},tessellate:function(z,n){var Y,K,x,af,ae,ad,ac,H,F,D,C,T,B,Q,g,O,U,ab,aa,A,t,r,y,M,L,W,Z,X,G,E,J,I,o;var w=[];var S=[];for(Y=0,K=z.faceVertexUvs.length;Y<K;Y++){S[Y]=[]}for(Y=0,K=z.faces.length;Y<K;Y++){x=z.faces[Y];if(x instanceof THREE.Face3){af=x.a;ae=x.b;ad=x.c;H=z.vertices[af];F=z.vertices[ae];D=z.vertices[ad];T=H.distanceTo(F);B=F.distanceTo(D);Q=H.distanceTo(D);if(T>n||B>n||Q>n){U=z.vertices.length;G=x.clone();E=x.clone();if(T>=B&&T>=Q){A=H.clone();A.lerpSelf(F,0.5);G.a=af;G.b=U;G.c=ad;E.a=U;E.b=ae;E.c=ad;if(x.vertexNormals.length===3){y=x.vertexNormals[0].clone();y.lerpSelf(x.vertexNormals[1],0.5);G.vertexNormals[1].copy(y);E.vertexNormals[0].copy(y)}if(x.vertexColors.length===3){W=x.vertexColors[0].clone();W.lerpSelf(x.vertexColors[1],0.5);G.vertexColors[1].copy(W);E.vertexColors[0].copy(W)}o=0}else{if(B>=T&&B>=Q){A=F.clone();A.lerpSelf(D,0.5);G.a=af;G.b=ae;G.c=U;E.a=U;E.b=ad;E.c=af;if(x.vertexNormals.length===3){y=x.vertexNormals[1].clone();y.lerpSelf(x.vertexNormals[2],0.5);G.vertexNormals[2].copy(y);E.vertexNormals[0].copy(y);E.vertexNormals[1].copy(x.vertexNormals[2]);E.vertexNormals[2].copy(x.vertexNormals[0])}if(x.vertexColors.length===3){W=x.vertexColors[1].clone();W.lerpSelf(x.vertexColors[2],0.5);G.vertexColors[2].copy(W);E.vertexColors[0].copy(W);E.vertexColors[1].copy(x.vertexColors[2]);E.vertexColors[2].copy(x.vertexColors[0])}o=1}else{A=H.clone();A.lerpSelf(D,0.5);G.a=af;G.b=ae;G.c=U;E.a=U;E.b=ae;E.c=ad;if(x.vertexNormals.length===3){y=x.vertexNormals[0].clone();y.lerpSelf(x.vertexNormals[2],0.5);G.vertexNormals[2].copy(y);E.vertexNormals[0].copy(y)}if(x.vertexColors.length===3){W=x.vertexColors[0].clone();W.lerpSelf(x.vertexColors[2],0.5);G.vertexColors[2].copy(W);E.vertexColors[0].copy(W)}o=2}}w.push(G,E);z.vertices.push(A);var V,v,R,u,s,q,l,f,e;for(V=0,v=z.faceVertexUvs.length;V<v;V++){if(z.faceVertexUvs[V].length){R=z.faceVertexUvs[V][Y];u=R[0];s=R[1];q=R[2];if(o===0){l=u.clone();l.lerpSelf(s,0.5);f=[u.clone(),l.clone(),q.clone()];e=[l.clone(),s.clone(),q.clone()]}else{if(o===1){l=s.clone();l.lerpSelf(q,0.5);f=[u.clone(),s.clone(),l.clone()];e=[l.clone(),q.clone(),u.clone()]}else{l=u.clone();l.lerpSelf(q,0.5);f=[u.clone(),s.clone(),l.clone()];e=[l.clone(),s.clone(),q.clone()]}}S[V].push(f,e)}}}else{w.push(x);for(V=0,v=z.faceVertexUvs.length;V<v;V++){S[V].push(z.faceVertexUvs[V][Y])}}}else{af=x.a;ae=x.b;ad=x.c;ac=x.d;H=z.vertices[af];F=z.vertices[ae];D=z.vertices[ad];C=z.vertices[ac];T=H.distanceTo(F);B=F.distanceTo(D);g=D.distanceTo(C);O=H.distanceTo(C);if(T>n||B>n||g>n||O>n){ab=z.vertices.length;aa=z.vertices.length+1;J=x.clone();I=x.clone();if((T>=B&&T>=g&&T>=O)||(g>=B&&g>=T&&g>=O)){t=H.clone();t.lerpSelf(F,0.5);r=D.clone();r.lerpSelf(C,0.5);J.a=af;J.b=ab;J.c=aa;J.d=ac;I.a=ab;I.b=ae;I.c=ad;I.d=aa;if(x.vertexNormals.length===4){M=x.vertexNormals[0].clone();M.lerpSelf(x.vertexNormals[1],0.5);L=x.vertexNormals[2].clone();L.lerpSelf(x.vertexNormals[3],0.5);J.vertexNormals[1].copy(M);J.vertexNormals[2].copy(L);I.vertexNormals[0].copy(M);I.vertexNormals[3].copy(L)}if(x.vertexColors.length===4){Z=x.vertexColors[0].clone();Z.lerpSelf(x.vertexColors[1],0.5);X=x.vertexColors[2].clone();X.lerpSelf(x.vertexColors[3],0.5);J.vertexColors[1].copy(Z);J.vertexColors[2].copy(X);I.vertexColors[0].copy(Z);I.vertexColors[3].copy(X)}o=0}else{t=F.clone();t.lerpSelf(D,0.5);r=C.clone();r.lerpSelf(H,0.5);J.a=af;J.b=ae;J.c=ab;J.d=aa;I.a=aa;I.b=ab;I.c=ad;I.d=ac;if(x.vertexNormals.length===4){M=x.vertexNormals[1].clone();M.lerpSelf(x.vertexNormals[2],0.5);L=x.vertexNormals[3].clone();L.lerpSelf(x.vertexNormals[0],0.5);J.vertexNormals[2].copy(M);J.vertexNormals[3].copy(L);I.vertexNormals[0].copy(L);I.vertexNormals[1].copy(M)}if(x.vertexColors.length===4){Z=x.vertexColors[1].clone();Z.lerpSelf(x.vertexColors[2],0.5);X=x.vertexColors[3].clone();X.lerpSelf(x.vertexColors[0],0.5);J.vertexColors[2].copy(Z);J.vertexColors[3].copy(X);I.vertexColors[0].copy(X);I.vertexColors[1].copy(Z)}o=1}w.push(J,I);z.vertices.push(t,r);var V,v,R,u,s,q,p,P,N,k,h;for(V=0,v=z.faceVertexUvs.length;V<v;V++){if(z.faceVertexUvs[V].length){R=z.faceVertexUvs[V][Y];u=R[0];s=R[1];q=R[2];p=R[3];if(o===0){P=u.clone();P.lerpSelf(s,0.5);N=q.clone();N.lerpSelf(p,0.5);k=[u.clone(),P.clone(),N.clone(),p.clone()];h=[P.clone(),s.clone(),q.clone(),N.clone()]}else{P=s.clone();P.lerpSelf(q,0.5);N=p.clone();N.lerpSelf(u,0.5);k=[u.clone(),s.clone(),P.clone(),N.clone()];h=[N.clone(),P.clone(),q.clone(),p.clone()]}S[V].push(k,h)}}}else{w.push(x);for(V=0,v=z.faceVertexUvs.length;V<v;V++){S[V].push(z.faceVertexUvs[V][Y])}}}}z.faces=w;z.faceVertexUvs=S}};THREE.GeometryUtils.random=THREE.Math.random16;THREE.GeometryUtils.__v1=new THREE.Vector3();THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(c,b,d,f){var g=new Image();var e=new THREE.Texture(g,b);var a=new THREE.ImageLoader();a.addEventListener("load",function(h){e.image=h.content;e.needsUpdate=true;if(d){d(e)}});a.addEventListener("error",function(h){if(f){f(h.message)}});a.crossOrigin=this.crossOrigin;a.load(c,g);return e},loadCompressedTexture:function(b,a,c,f){var e=new THREE.CompressedTexture();e.mapping=a;var d=new XMLHttpRequest();d.onload=function(){var g=d.response;var h=THREE.ImageUtils.parseDDS(g,true);e.format=h.format;e.mipmaps=h.mipmaps;e.image.width=h.width;e.image.height=h.height;e.generateMipmaps=false;e.needsUpdate=true;if(c){c(e)}};d.onerror=f;d.open("GET",b,true);d.responseType="arraybuffer";d.send(null);return e},loadTextureCube:function(e,b,g,d){var h=[];h.loadCount=0;var f=new THREE.Texture();f.image=h;if(b!==undefined){f.mapping=b}f.flipY=false;for(var c=0,j=e.length;c<j;++c){var a=new Image();h[c]=a;a.onload=function(){h.loadCount+=1;if(h.loadCount===6){f.needsUpdate=true;if(g){g()}}};a.onerror=d;a.crossOrigin=this.crossOrigin;a.src=e[c]}return f},loadCompressedTextureCube:function(h,b,k,g){var l=[];l.loadCount=0;var j=new THREE.CompressedTexture();j.image=l;if(b!==undefined){j.mapping=b}j.flipY=false;j.generateMipmaps=false;var d=function(n,i){return function(){var o=n.response;var p=THREE.ImageUtils.parseDDS(o,true);i.format=p.format;i.mipmaps=p.mipmaps;i.width=p.width;i.height=p.height;l.loadCount+=1;if(l.loadCount===6){j.format=p.format;j.needsUpdate=true;if(k){k()}}}};for(var f=0,m=h.length;f<m;++f){var a={};l[f]=a;var e=new XMLHttpRequest();e.onload=d(e,a);e.onerror=g;var c=h[f];e.open("GET",c,true);e.responseType="arraybuffer";e.send(null)}return j},parseDDS:function(y,W){var H={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};var x=542327876;var L=1,w=2,Y=4,z=8,N=4096,J=131072,s=524288,f=8388608;var Q=8,m=4194304,l=4096;var P=512,I=1024,U=2048,G=4096,T=8192,F=16384,R=32768,o=2097152;var v=1,A=2,ab=4,p=64,O=512,t=131072;function aa(i){return i.charCodeAt(0)+(i.charCodeAt(1)<<8)+(i.charCodeAt(2)<<16)+(i.charCodeAt(3)<<24)}function r(i){return String.fromCharCode(i&255,(i>>8)&255,(i>>16)&255,(i>>24)&255)}var k=aa("DXT1");var j=aa("DXT3");var g=aa("DXT5");var b=31;var u=0;var S=1;var Z=2;var V=3;var E=4;var n=7;var K=20;var d=21;var h=new Int32Array(y,0,b);if(h[u]!==x){console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header");return H}if(!h[K]&ab){console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code");return H}var C;var B=h[d];switch(B){case k:C=8;H.format=THREE.RGB_S3TC_DXT1_Format;break;case j:C=16;H.format=THREE.RGBA_S3TC_DXT3_Format;break;case g:C=16;H.format=THREE.RGBA_S3TC_DXT5_Format;break;default:console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",r(B));return H}H.mipmapCount=1;if(h[Z]&J&&W!==false){H.mipmapCount=Math.max(1,h[n])}H.width=h[E];H.height=h[V];var M=h[S]+4;var a=H.width;var e=H.height;for(var X=0;X<H.mipmapCount;X++){var q=Math.max(4,a)/4*Math.max(4,e)/4*C;var D=new Uint8Array(y,M,q);var c={data:D,width:a,height:e};H.mipmaps.push(c);M+=q;a=Math.max(a*0.5,1);e=Math.max(e*0.5,1)}return H},getNormalMap:function(q,C){var d=function(x,i){return[x[1]*i[2]-x[2]*i[1],x[2]*i[0]-x[0]*i[2],x[0]*i[1]-x[1]*i[0]]};var v=function(x,i){return[x[0]-i[0],x[1]-i[1],x[2]-i[2]]};var s=function(x){var i=Math.sqrt(x[0]*x[0]+x[1]*x[1]+x[2]*x[2]);return[x[0]/i,x[1]/i,x[2]/i]};C=C|1;var r=q.width;var p=q.height;var e=document.createElement("canvas");e.width=r;e.height=p;var c=e.getContext("2d");c.drawImage(q,0,0);var D=c.getImageData(0,0,r,p).data;var w=c.createImageData(r,p);var k=w.data;for(var m=0;m<r;m++){for(var l=0;l<p;l++){var f=l-1<0?0:l-1;var h=l+1>p-1?p-1:l+1;var g=m-1<0?0:m-1;var j=m+1>r-1?r-1:m+1;var u=[];var B=[0,0,D[(l*r+m)*4]/255*C];u.push([-1,0,D[(l*r+g)*4]/255*C]);u.push([-1,-1,D[(f*r+g)*4]/255*C]);u.push([0,-1,D[(f*r+m)*4]/255*C]);u.push([1,-1,D[(f*r+j)*4]/255*C]);u.push([1,0,D[(l*r+j)*4]/255*C]);u.push([1,1,D[(h*r+j)*4]/255*C]);u.push([0,1,D[(h*r+m)*4]/255*C]);u.push([-1,1,D[(h*r+g)*4]/255*C]);var o=[];var z=u.length;for(var t=0;t<z;t++){var b=u[t];var a=u[(t+1)%z];b=v(b,B);a=v(a,B);o.push(s(d(b,a)))}var A=[0,0,0];for(var t=0;t<o.length;t++){A[0]+=o[t][0];A[1]+=o[t][1];A[2]+=o[t][2]}A[0]/=o.length;A[1]/=o.length;A[2]/=o.length;var n=(l*r+m)*4;k[n]=((A[0]+1)/2*255)|0;k[n+1]=((A[1]+1)/2*255)|0;k[n+2]=(A[2]*255)|0;k[n+3]=255}}c.putImageData(w,0,0);return e},generateDataTexture:function(c,l,d){var m=c*l;var f=new Uint8Array(3*m);var a=Math.floor(d.r*255);var h=Math.floor(d.g*255);var k=Math.floor(d.b*255);for(var e=0;e<m;e++){f[e*3]=a;f[e*3+1]=h;f[e*3+2]=k}var j=new THREE.DataTexture(f,c,l,THREE.RGBFormat);j.needsUpdate=true;return j}};THREE.SceneUtils={showHierarchy:function(a,b){THREE.SceneUtils.traverseHierarchy(a,function(c){c.visible=b})},traverseHierarchy:function(b,e){var d,c,a=b.children.length;for(c=0;c<a;c++){d=b.children[c];e(d);THREE.SceneUtils.traverseHierarchy(d,e)}},createMultiMaterialObject:function(f,a){var d,b=a.length,e=new THREE.Object3D();for(d=0;d<b;d++){var c=new THREE.Mesh(f,a[d]);e.add(c)}return e},cloneObject:function(c){var a;if(c instanceof THREE.MorphAnimMesh){a=new THREE.MorphAnimMesh(c.geometry,c.material);a.duration=c.duration;a.mirroredLoop=c.mirroredLoop;a.time=c.time;a.lastKeyframe=c.lastKeyframe;a.currentKeyframe=c.currentKeyframe;a.direction=c.direction;a.directionBackwards=c.directionBackwards}else{if(c instanceof THREE.SkinnedMesh){a=new THREE.SkinnedMesh(c.geometry,c.material,c.useVertexTexture)}else{if(c instanceof THREE.Mesh){a=new THREE.Mesh(c.geometry,c.material)}else{if(c instanceof THREE.Line){a=new THREE.Line(c.geometry,c.material,c.type)}else{if(c instanceof THREE.Ribbon){a=new THREE.Ribbon(c.geometry,c.material)}else{if(c instanceof THREE.ParticleSystem){a=new THREE.ParticleSystem(c.geometry,c.material);a.sortParticles=c.sortParticles}else{if(c instanceof THREE.Particle){a=new THREE.Particle(c.material)}else{if(c instanceof THREE.Sprite){a=new THREE.Sprite({});a.color.copy(c.color);a.map=c.map;a.blending=c.blending;a.useScreenCoordinates=c.useScreenCoordinates;a.mergeWith3D=c.mergeWith3D;a.affectedByDistance=c.affectedByDistance;a.scaleByViewport=c.scaleByViewport;a.alignment=c.alignment;a.rotation3d.copy(c.rotation3d);a.rotation=c.rotation;a.opacity=c.opacity;a.uvOffset.copy(c.uvOffset);a.uvScale.copy(c.uvScale)}else{if(c instanceof THREE.LOD){a=new THREE.LOD()}else{if(c instanceof THREE.Object3D){a=new THREE.Object3D()}}}}}}}}}}a.name=c.name;a.parent=c.parent;a.up.copy(c.up);a.position.copy(c.position);if(a.rotation instanceof THREE.Vector3){a.rotation.copy(c.rotation)}a.eulerOrder=c.eulerOrder;a.scale.copy(c.scale);a.dynamic=c.dynamic;a.renderDepth=c.renderDepth;a.rotationAutoUpdate=c.rotationAutoUpdate;a.matrix.copy(c.matrix);a.matrixWorld.copy(c.matrixWorld);a.matrixRotationWorld.copy(c.matrixRotationWorld);a.matrixAutoUpdate=c.matrixAutoUpdate;a.matrixWorldNeedsUpdate=c.matrixWorldNeedsUpdate;a.quaternion.copy(c.quaternion);a.useQuaternion=c.useQuaternion;a.boundRadius=c.boundRadius;a.boundRadiusScale=c.boundRadiusScale;a.visible=c.visible;a.castShadow=c.castShadow;a.receiveShadow=c.receiveShadow;a.frustumCulled=c.frustumCulled;for(var b=0;b<c.children.length;b++){var e=THREE.SceneUtils.cloneObject(c.children[b]);a.children[b]=e;e.parent=a}if(c instanceof THREE.LOD){for(var b=0;b<c.LODs.length;b++){var d=c.LODs[b];a.LODs[b]={visibleAtDistance:d.visibleAtDistance,object3D:a.children[b]}}}return a},detach:function(c,a,b){c.applyMatrix(a.matrixWorld);a.remove(c);b.add(c)},attach:function(d,c,a){var b=new THREE.Matrix4();b.getInverse(a.matrixWorld);d.applyMatrix(b);c.remove(d);a.add(d)}};if(THREE.WebGLRenderer){THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:null}},fragmentShader:["uniform samplerCube tCube;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","vec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );","refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;","refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;","refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;","refractedColor.a = 1.0;","gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );","}"].join("\n"),vertexShader:["uniform float mRefractionRatio;","uniform float mFresnelBias;","uniform float mFresnelScale;","uniform float mFresnelPower;","varying vec3 vReflect;","varying vec3 vRefract[3];","varying float vReflectionFactor;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vec4 mPosition = modelMatrix * vec4( position, 1.0 );","vec3 nWorld = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );","vec3 I = mPosition.xyz - cameraPosition;","vReflect = reflect( I, nWorld );","vRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );","vRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );","vRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );","vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n")},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:0.98},uReflectivity:{type:"f",value:0.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightPosition[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngle[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngle[ i ] ) {","spotEffect = pow( spotEffect, spotLightExponent[ i ] );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( hemisphereLightPosition[ i ], 1.0 );","vec3 lVector = normalize( lPosition.xyz + vViewPosition.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = normalize( -lPosition.xyz + vViewPosition.xyz );","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalMatrix * skinnedNormal.xyz;","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalMatrix * skinnedTangent.xyz;","#else","vNormal = normalMatrix * normal;","vTangent = normalMatrix * tangent.xyz;","#endif","vBinormal = cross( vNormal, vTangent ) * tangent.w;","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 mPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = mPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * mPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vViewPosition;","void main() {","vec4 mPosition = modelMatrix * vec4( position, 1.0 );","vViewPosition = cameraPosition - mPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vViewPosition;","void main() {","vec3 wPos = cameraPosition - vViewPosition;","gl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );","}"].join("\n")}}}}THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(d){var a=d.familyName.toLowerCase();var b=this;b.faces[a]=b.faces[a]||{};b.faces[a][d.cssFontWeight]=b.faces[a][d.cssFontWeight]||{};b.faces[a][d.cssFontWeight][d.cssFontStyle]=d;var c=b.faces[a][d.cssFontWeight][d.cssFontStyle]=d;return d},drawText:function(n){var a=[],e=[];var j,c,l=this.getFace(),g=this.size/l.resolution,h=0,m=String(n).split(""),d=m.length;var f=[];for(j=0;j<d;j++){var o=new THREE.Path();var k=this.extractGlyphPoints(m[j],l,g,h,o);h+=k.offset;f.push(k.path)}var b=h/2;return{paths:f,offset:b}},extractGlyphPoints:function(C,j,G,f,r){var H=[];var v,s,d,e,u,b,E,B,l,k,h,g,q,A,o,z,n,w,a,m=j.glyphs[C]||j.glyphs["?"];if(!m){return}if(m.o){e=m._cachedOutline||(m._cachedOutline=m.o.split(" "));b=e.length;E=G;B=G;for(v=0;v<b;){u=e[v++];switch(u){case"m":l=e[v++]*E+f;k=e[v++]*B;r.moveTo(l,k);break;case"l":l=e[v++]*E+f;k=e[v++]*B;r.lineTo(l,k);break;case"q":h=e[v++]*E+f;g=e[v++]*B;o=e[v++]*E+f;z=e[v++]*B;r.quadraticCurveTo(o,z,h,g);a=H[H.length-1];if(a){q=a.x;A=a.y;for(s=1,d=this.divisions;s<=d;s++){var p=s/d;var F=THREE.Shape.Utils.b2(p,q,o,h);var D=THREE.Shape.Utils.b2(p,A,z,g)}}break;case"b":h=e[v++]*E+f;g=e[v++]*B;o=e[v++]*E+f;z=e[v++]*-B;n=e[v++]*E+f;w=e[v++]*-B;r.bezierCurveTo(h,g,o,z,n,w);a=H[H.length-1];if(a){q=a.x;A=a.y;for(s=1,d=this.divisions;s<=d;s++){var p=s/d;var F=THREE.Shape.Utils.b3(p,q,o,n,h);var D=THREE.Shape.Utils.b3(p,A,z,w,g)}}break}}}return{offset:m.ha*G,path:r}}};THREE.FontUtils.generateShapes=function(i,j){j=j||{};var l=j.size!==undefined?j.size:100;var h=j.curveSegments!==undefined?j.curveSegments:4;var d=j.font!==undefined?j.font:"helvetiker";var g=j.weight!==undefined?j.weight:"normal";var a=j.style!==undefined?j.style:"normal";THREE.FontUtils.size=l;THREE.FontUtils.divisions=h;THREE.FontUtils.face=d;THREE.FontUtils.weight=g;THREE.FontUtils.style=a;var f=THREE.FontUtils.drawText(i);var k=f.paths;var c=[];for(var b=0,e=k.length;b<e;b++){Array.prototype.push.apply(c,k[b].toShapes())}return c};(function(c){var b=1e-10;var f=function(h,x){var g=h.length;if(g<3){return null}var B=[],q=[],k=[];var y,r,p;if(e(h)>0){for(r=0;r<g;r++){q[r]=r}}else{for(r=0;r<g;r++){q[r]=(g-1)-r}}var j=g;var i=2*j;for(r=j-1;j>2;){if((i--)<=0){console.log("Warning, unable to triangulate polygon!");if(x){return k}return B}y=r;if(j<=y){y=0}r=y+1;if(j<=r){r=0}p=r+1;if(j<=p){p=0}if(a(h,y,r,p,j,q)){var o,m,l,A,z;o=q[y];m=q[r];l=q[p];B.push([h[o],h[m],h[l]]);k.push([q[y],q[r],q[p]]);for(A=r,z=r+1;z<j;A++,z++){q[A]=q[z]}j--;i=2*j}}if(x){return k}return B};var e=function(h){var k=h.length;var g=0;for(var j=k-1,i=0;i<k;j=i++){g+=h[j].x*h[i].y-h[i].x*h[j].y}return g*0.5};var d=function(r,q,A,y,j,h,w,v){var i,g,t,s;var C,B,m,l;var z,x,o,n;var k,p,u;i=j-A;g=h-y;t=r-j;s=q-h;C=A-r;B=y-q;m=w-r;l=v-q;z=w-A;x=v-y;o=w-j;n=v-h;u=i*x-g*z;k=C*l-B*m;p=t*n-s*o;return((u>=0)&&(p>=0)&&(k>=0))};var a=function(l,y,x,t,i,s){var h;var g,z,o,m;var k,j,r,q;g=l[s[y]].x;z=l[s[y]].y;o=l[s[x]].x;m=l[s[x]].y;k=l[s[t]].x;j=l[s[t]].y;if(b>(((o-g)*(j-z))-((m-z)*(k-g)))){return false}for(h=0;h<i;h++){if((h==y)||(h==x)||(h==t)){continue}r=l[s[h]].x;q=l[s[h]].y;if(d(g,z,o,m,k,j,r,q)){return false}}return true};c.Triangulate=f;c.Triangulate.area=e;return c})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(a){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(a){var b=this.getUtoTmapping(a);return this.getPoint(b)};THREE.Curve.prototype.getPoints=function(a){if(!a){a=5}var c,b=[];for(c=0;c<=a;c++){b.push(this.getPoint(c/a))}return b};THREE.Curve.prototype.getSpacedPoints=function(a){if(!a){a=5}var c,b=[];for(c=0;c<=a;c++){b.push(this.getPointAt(c/a))}return b};THREE.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]};THREE.Curve.prototype.getLengths=function(b){if(!b){b=(this.__arcLengthDivisions)?(this.__arcLengthDivisions):200}if(this.cacheArcLengths&&(this.cacheArcLengths.length==b+1)&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var a=[];var f,d=this.getPoint(0);var e,c=0;a.push(0);for(e=1;e<=b;e++){f=this.getPoint(e/b);c+=f.distanceTo(d);a.push(c);d=f}this.cacheArcLengths=a;return a};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(m,a){var b=this.getLengths();var e=0,j=b.length;var k;if(a){k=a}else{k=m*b[j-1]}var h=0,d=j-1,l;while(h<=d){e=Math.floor(h+(d-h)/2);l=b[e]-k;if(l<0){h=e+1;continue}else{if(l>0){d=e-1;continue}else{d=e;break}}}e=d;if(b[e]==k){var o=e/(j-1);return o}var f=b[e];var n=b[e+1];var c=n-f;var g=(k-f)/c;var o=(e+g)/(j-1);return o};THREE.Curve.prototype.getNormalVector=function(b){var a=this.getTangent(b);return new THREE.Vector2(-a.y,a.x)};THREE.Curve.prototype.getTangent=function(b){var g=0.0001;var d=b-g;var c=b+g;if(d<0){d=0}if(c>1){c=1}var f=this.getPoint(d);var e=this.getPoint(c);var a=e.clone().subSelf(f);return a.normalize()};THREE.Curve.prototype.getTangentAt=function(a){var b=this.getUtoTmapping(a);return this.getTangent(b)};THREE.LineCurve=function(b,a){this.v1=b;this.v2=a};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(b){var a=this.v2.clone().subSelf(this.v1);a.multiplyScalar(b).addSelf(this.v1);return a};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};THREE.LineCurve.prototype.getTangent=function(a){var b=this.v2.clone().subSelf(this.v1);return b.normalize()};THREE.QuadraticBezierCurve=function(a,c,b){this.v0=a;this.v1=c;this.v2=b};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(c){var b,a;b=THREE.Shape.Utils.b2(c,this.v0.x,this.v1.x,this.v2.x);a=THREE.Shape.Utils.b2(c,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(b,a)};THREE.QuadraticBezierCurve.prototype.getTangent=function(c){var b,a;b=THREE.Curve.Utils.tangentQuadraticBezier(c,this.v0.x,this.v1.x,this.v2.x);a=THREE.Curve.Utils.tangentQuadraticBezier(c,this.v0.y,this.v1.y,this.v2.y);var d=new THREE.Vector2(b,a);d.normalize();return d};THREE.CubicBezierCurve=function(a,d,c,b){this.v0=a;this.v1=d;this.v2=c;this.v3=b};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.getPoint=function(c){var b,a;b=THREE.Shape.Utils.b3(c,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=THREE.Shape.Utils.b3(c,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(b,a)};THREE.CubicBezierCurve.prototype.getTangent=function(c){var b,a;b=THREE.Curve.Utils.tangentCubicBezier(c,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=THREE.Curve.Utils.tangentCubicBezier(c,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var d=new THREE.Vector2(b,a);d.normalize();return d};THREE.SplineCurve=function(a){this.points=(a==undefined)?[]:a};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(d){var b=new THREE.Vector2();var h=[];var e=this.points,a,g,f;a=(e.length-1)*d;g=Math.floor(a);f=a-g;h[0]=g==0?g:g-1;h[1]=g;h[2]=g>e.length-2?e.length-1:g+1;h[3]=g>e.length-3?e.length-1:g+2;b.x=THREE.Curve.Utils.interpolate(e[h[0]].x,e[h[1]].x,e[h[2]].x,e[h[3]].x,f);b.y=THREE.Curve.Utils.interpolate(e[h[0]].y,e[h[1]].y,e[h[2]].y,e[h[3]].y,f);return b};THREE.EllipseCurve=function(f,e,g,a,d,c,b){this.aX=f;this.aY=e;this.xRadius=g;this.yRadius=a;this.aStartAngle=d;this.aEndAngle=c;this.aClockwise=b};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.getPoint=function(c){var e=this.aEndAngle-this.aStartAngle;if(!this.aClockwise){c=1-c}var d=this.aStartAngle+c*e;var b=this.aX+this.xRadius*Math.cos(d);var a=this.aY+this.yRadius*Math.sin(d);return new THREE.Vector2(b,a)};THREE.ArcCurve=function(e,d,f,c,b,a){THREE.EllipseCurve.call(this,e,d,f,f,c,b,a)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.Curve.Utils={tangentQuadraticBezier:function(a,d,c,b){return 2*(1-a)*(c-d)+2*a*(b-c)},tangentCubicBezier:function(a,e,d,c,b){return -3*e*(1-a)*(1-a)+3*d*(1-a)*(1-a)-6*a*d*(1-a)+6*a*c*(1-a)-3*a*a*c+3*a*a*b},tangentSpline:function(i,h,g,f,d){var e=6*i*i-6*i;var b=3*i*i-4*i+1;var c=-6*i*i+6*i;var a=3*i*i-2*i;return e+b+c+a},interpolate:function(h,g,e,d,i){var f=(e-h)*0.5;var c=(d-g)*0.5;var b=i*i;var a=i*b;return(2*g-2*e+f+c)*a+(-3*g+3*e-2*f-c)*b+f*i+g}};THREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.getPoint=b;return a};THREE.LineCurve3=THREE.Curve.create(function(b,a){this.v1=b;this.v2=a},function(a){var b=new THREE.Vector3();b.sub(this.v2,this.v1);b.multiplyScalar(a);b.addSelf(this.v1);return b});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,c,b){this.v0=a;this.v1=c;this.v2=b},function(c){var b,a,d;b=THREE.Shape.Utils.b2(c,this.v0.x,this.v1.x,this.v2.x);a=THREE.Shape.Utils.b2(c,this.v0.y,this.v1.y,this.v2.y);d=THREE.Shape.Utils.b2(c,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(b,a,d)});THREE.CubicBezierCurve3=THREE.Curve.create(function(a,d,c,b){this.v0=a;this.v1=d;this.v2=c;this.v3=b},function(c){var b,a,d;b=THREE.Shape.Utils.b3(c,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=THREE.Shape.Utils.b3(c,this.v0.y,this.v1.y,this.v2.y,this.v3.y);d=THREE.Shape.Utils.b3(c,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(b,a,d)});THREE.SplineCurve3=THREE.Curve.create(function(a){this.points=(a==undefined)?[]:a},function(l){var j=new THREE.Vector3();var d=[];var i=this.points,g,a,b;g=(i.length-1)*l;a=Math.floor(g);b=g-a;d[0]=a==0?a:a-1;d[1]=a;d[2]=a>i.length-2?i.length-1:a+1;d[3]=a>i.length-3?i.length-1:a+2;var k=i[d[0]],h=i[d[1]],f=i[d[2]],e=i[d[3]];j.x=THREE.Curve.Utils.interpolate(k.x,h.x,f.x,e.x,b);j.y=THREE.Curve.Utils.interpolate(k.y,h.y,f.y,e.y,b);j.z=THREE.Curve.Utils.interpolate(k.z,h.z,f.z,e.z,b);return j});THREE.ClosedSplineCurve3=THREE.Curve.create(function(a){this.points=(a==undefined)?[]:a},function(d){var b=new THREE.Vector3();var h=[];var e=this.points,a,g,f;a=(e.length-0)*d;g=Math.floor(a);f=a-g;g+=g>0?0:(Math.floor(Math.abs(g)/e.length)+1)*e.length;h[0]=(g-1)%e.length;h[1]=(g)%e.length;h[2]=(g+1)%e.length;h[3]=(g+2)%e.length;b.x=THREE.Curve.Utils.interpolate(e[h[0]].x,e[h[1]].x,e[h[2]].x,e[h[3]].x,f);b.y=THREE.Curve.Utils.interpolate(e[h[0]].y,e[h[1]].y,e[h[2]].y,e[h[3]].y,f);b.z=THREE.Curve.Utils.interpolate(e[h[0]].z,e[h[1]].z,e[h[2]].z,e[h[3]].z,f);return b});THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(a){this.curves.push(a)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var b=this.curves[0].getPoint(0);var a=this.curves[this.curves.length-1].getPoint(1);if(!b.equals(a)){this.curves.push(new THREE.LineCurve(a,b))}};THREE.CurvePath.prototype.getPoint=function(c){var h=c*this.getLength();var g=this.getCurveLengths();var b=0,e,f;while(b<g.length){if(g[b]>=h){e=g[b]-h;f=this.curves[b];var a=1-e/f.getLength();return f.getPointAt(a);break}b++}return null};THREE.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var d=[],c=0;var b,a=this.curves.length;for(b=0;b<a;b++){c+=this.curves[b].getLength();d.push(c)}this.cacheLengths=d;return d};THREE.CurvePath.prototype.getBoundingBox=function(){var m=this.getPoints();var b,a,n;var f,e,d;b=a=Number.NEGATIVE_INFINITY;f=e=Number.POSITIVE_INFINITY;var c,g,l,h;var k=m[0] instanceof THREE.Vector3;h=k?new THREE.Vector3():new THREE.Vector2();for(g=0,l=m.length;g<l;g++){c=m[g];if(c.x>b){b=c.x}else{if(c.x<f){f=c.x}}if(c.y>a){a=c.y}else{if(c.y<e){e=c.y}}if(k){if(c.z>n){n=c.z}else{if(c.z<d){d=c.z}}}h.addSelf(c)}var j={minX:f,minY:e,maxX:b,maxY:a,centroid:h.divideScalar(l)};if(k){j.maxZ=n;j.minZ=d}return j};THREE.CurvePath.prototype.createPointsGeometry=function(a){var b=this.getPoints(a,true);return this.createGeometry(b)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(a){var b=this.getSpacedPoints(a,true);return this.createGeometry(b)};THREE.CurvePath.prototype.createGeometry=function(b){var c=new THREE.Geometry();for(var a=0;a<b.length;a++){c.vertices.push(new THREE.Vector3(b[a].x,b[a].y,b[a].z||0))}return c};THREE.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)};THREE.CurvePath.prototype.getTransformedPoints=function(c,e){var b=this.getPoints(c);var d,a;if(!e){e=this.bends}for(d=0,a=e.length;d<a;d++){b=this.getWrapPoints(b,e[d])}return b};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(c,e){var b=this.getSpacedPoints(c);var d,a;if(!e){e=this.bends}for(d=0,a=e.length;d<a;d++){b=this.getWrapPoints(b,e[d])}return b};THREE.CurvePath.prototype.getWrapPoints=function(f,l){var a=this.getBoundingBox();var d,g,b,j,h,k;for(d=0,g=f.length;d<g;d++){b=f[d];j=b.x;h=b.y;k=j/a.maxX;k=l.getUtoTmapping(k,j);var c=l.getPoint(k);var e=l.getNormalVector(k).multiplyScalar(h);b.x=c.x+e.x;b.y=c.y+e.y}return f};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.updateMatrixWorld=function(c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||c){if(this.parent){this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld);this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject);this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;c=true}for(var b=0,a=this.children.length;b<a;b++){this.children[b].updateMatrixWorld(c)}};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3();THREE.Gyroscope.prototype.translationObject=new THREE.Vector3();THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion();THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion();THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3();THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3();THREE.Path=function(a){THREE.CurvePath.call(this);this.actions=[];if(a){this.fromPoints(a)}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(b){this.moveTo(b[0].x,b[0].y);for(var a=1,c=b.length;a<c;a++){this.lineTo(b[a].x,b[a].y)}};THREE.Path.prototype.moveTo=function(a,c){var b=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:b})};THREE.Path.prototype.lineTo=function(a,g){var b=Array.prototype.slice.call(arguments);var e=this.actions[this.actions.length-1].args;var c=e[e.length-2];var d=e[e.length-1];var f=new THREE.LineCurve(new THREE.Vector2(c,d),new THREE.Vector2(a,g));this.curves.push(f);this.actions.push({action:THREE.PathActions.LINE_TO,args:b})};THREE.Path.prototype.quadraticCurveTo=function(e,b,g,f){var h=Array.prototype.slice.call(arguments);var a=this.actions[this.actions.length-1].args;var c=a[a.length-2];var i=a[a.length-1];var d=new THREE.QuadraticBezierCurve(new THREE.Vector2(c,i),new THREE.Vector2(e,b),new THREE.Vector2(g,f));this.curves.push(d);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:h})};THREE.Path.prototype.bezierCurveTo=function(e,c,k,j,g,f){var h=Array.prototype.slice.call(arguments);var a=this.actions[this.actions.length-1].args;var b=a[a.length-2];var i=a[a.length-1];var d=new THREE.CubicBezierCurve(new THREE.Vector2(b,i),new THREE.Vector2(e,c),new THREE.Vector2(k,j),new THREE.Vector2(g,f));this.curves.push(d);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:h})};THREE.Path.prototype.splineThru=function(g){var a=Array.prototype.slice.call(arguments);var d=this.actions[this.actions.length-1].args;var b=d[d.length-2];var c=d[d.length-1];var f=[new THREE.Vector2(b,c)];Array.prototype.push.apply(f,g);var e=new THREE.SplineCurve(f);this.curves.push(e);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:a})};THREE.Path.prototype.arc=function(h,f,g,d,a,b){var c=this.actions[this.actions.length-1].args;var e=c[c.length-2];var i=c[c.length-1];this.absarc(h+e,f+i,g,d,a,b)};THREE.Path.prototype.absarc=function(e,d,f,c,b,a){this.absellipse(e,d,f,f,c,b,a)};THREE.Path.prototype.ellipse=function(g,f,i,h,d,a,b){var c=this.actions[this.actions.length-1].args;var e=c[c.length-2];var j=c[c.length-1];this.absellipse(g+e,f+j,i,h,d,a,b)};THREE.Path.prototype.absellipse=function(f,e,j,g,c,a,b){var h=Array.prototype.slice.call(arguments);var d=new THREE.EllipseCurve(f,e,j,g,c,a,b);this.curves.push(d);var i=d.getPoint(b?1:0);h.push(i.x);h.push(i.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:h})};THREE.Path.prototype.getSpacedPoints=function(b,d){if(!b){b=40}var c=[];for(var a=0;a<b;a++){c.push(this.getPoint(a/b))}return c};THREE.Path.prototype.getPoints=function(O,M){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(O,M)}O=O||12;var A=[];var J,u,r,c,E;var B,y,N,v,P,w,a,x,b,I,D,H,G;for(J=0,u=this.actions.length;J<u;J++){r=this.actions[J];c=r.action;E=r.args;switch(c){case THREE.PathActions.MOVE_TO:A.push(new THREE.Vector2(E[0],E[1]));break;case THREE.PathActions.LINE_TO:A.push(new THREE.Vector2(E[0],E[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:B=E[2];y=E[3];P=E[0];w=E[1];if(A.length>0){b=A[A.length-1];a=b.x;x=b.y}else{b=this.actions[J-1].args;a=b[b.length-2];x=b[b.length-1]}for(I=1;I<=O;I++){D=I/O;H=THREE.Shape.Utils.b2(D,a,P,B);G=THREE.Shape.Utils.b2(D,x,w,y);A.push(new THREE.Vector2(H,G))}break;case THREE.PathActions.BEZIER_CURVE_TO:B=E[4];y=E[5];P=E[0];w=E[1];N=E[2];v=E[3];if(A.length>0){b=A[A.length-1];a=b.x;x=b.y}else{b=this.actions[J-1].args;a=b[b.length-2];x=b[b.length-1]}for(I=1;I<=O;I++){D=I/O;H=THREE.Shape.Utils.b3(D,a,P,N,B);G=THREE.Shape.Utils.b3(D,x,w,v,y);A.push(new THREE.Vector2(H,G))}break;case THREE.PathActions.CSPLINE_THRU:b=this.actions[J-1].args;var k=new THREE.Vector2(b[b.length-2],b[b.length-1]);var f=[k];var F=O*E[0].length;f=f.concat(E[0]);var L=new THREE.SplineCurve(f);for(I=1;I<=F;I++){A.push(L.getPointAt(I/F))}break;case THREE.PathActions.ARC:var o=E[0],m=E[1],p=E[2],K=E[3],C=E[4],h=!!E[5];var z=C-K;var l;var d=O*2;for(I=1;I<=d;I++){D=I/d;if(!h){D=1-D}l=K+D*z;H=o+p*Math.cos(l);G=m+p*Math.sin(l);A.push(new THREE.Vector2(H,G))}break;case THREE.PathActions.ELLIPSE:var o=E[0],m=E[1],q=E[2],s=E[3],K=E[4],C=E[5],h=!!E[6];var z=C-K;var l;var d=O*2;for(I=1;I<=d;I++){D=I/d;if(!h){D=1-D}l=K+D*z;H=o+q*Math.cos(l);G=m+s*Math.sin(l);A.push(new THREE.Vector2(H,G))}break}}var e=A[A.length-1];var g=1e-10;if(Math.abs(e.x-A[0].x)<g&&Math.abs(e.y-A[0].y)<g){A.splice(A.length-1,1)}if(M){A.push(A[0])}return A};THREE.Path.prototype.toShapes=function(){var c,f,j,b,d;var e=[],h=new THREE.Path();for(c=0,f=this.actions.length;c<f;c++){j=this.actions[c];d=j.args;b=j.action;if(b==THREE.PathActions.MOVE_TO){if(h.actions.length!=0){e.push(h);h=new THREE.Path()}}h[b].apply(h,d)}if(h.actions.length!=0){e.push(h)}if(e.length==0){return[]}var l,k,a=[];var g=!THREE.Shape.Utils.isClockWise(e[0].getPoints());if(e.length==1){l=e[0];k=new THREE.Shape();k.actions=l.actions;k.curves=l.curves;a.push(k);return a}if(g){k=new THREE.Shape();for(c=0,f=e.length;c<f;c++){l=e[c];if(THREE.Shape.Utils.isClockWise(l.getPoints())){k.actions=l.actions;k.curves=l.curves;a.push(k);k=new THREE.Shape()}else{k.holes.push(l)}}}else{for(c=0,f=e.length;c<f;c++){l=e[c];if(THREE.Shape.Utils.isClockWise(l.getPoints())){if(k){a.push(k)}k=new THREE.Shape();k.actions=l.actions;k.curves=l.curves}else{k.holes.push(l)}}a.push(k)}return a};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(b){var a=new THREE.ExtrudeGeometry(this,b);return a};THREE.Shape.prototype.makeGeometry=function(a){var b=new THREE.ShapeGeometry(this,a);return b};THREE.Shape.prototype.getPointsHoles=function(c){var b,a=this.holes.length,d=[];for(b=0;b<a;b++){d[b]=this.holes[b].getTransformedPoints(c,this.bends)}return d};THREE.Shape.prototype.getSpacedPointsHoles=function(c){var b,a=this.holes.length,d=[];for(b=0;b<a;b++){d[b]=this.holes[b].getTransformedSpacedPoints(c,this.bends)}return d};THREE.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}};THREE.Shape.prototype.extractPoints=function(a){if(this.useSpacedPoints){return this.extractAllSpacedPoints(a)}return this.extractAllPoints(a)};THREE.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}};THREE.Shape.Utils={removeHoles:function(C,m){var k=C.concat();var A=k.concat();var x,c,t,L,z,u,B,i,J,s,r,q,M,D,o,n,O,N,b,a,I=[];for(J=0;J<m.length;J++){r=m[J];Array.prototype.push.apply(A,r);q=Number.POSITIVE_INFINITY;for(s=0;s<r.length;s++){o=r[s];var e=[];for(D=0;D<k.length;D++){n=k[D];M=o.distanceToSquared(n);e.push(M);if(M<q){q=M;z=s;u=D}}}x=(u-1)>=0?u-1:k.length-1;t=(z-1)>=0?z-1:r.length-1;var f=[r[z],k[u],k[x]];var H=THREE.FontUtils.Triangulate.area(f);var y=[r[z],r[t],k[u]];var G=THREE.FontUtils.Triangulate.area(y);var l=1;var E=-1;var v=u,F=z;u+=l;z+=E;if(u<0){u+=k.length}u%=k.length;if(z<0){z+=r.length}z%=r.length;x=(u-1)>=0?u-1:k.length-1;t=(z-1)>=0?z-1:r.length-1;f=[r[z],k[u],k[x]];var K=THREE.FontUtils.Triangulate.area(f);y=[r[z],r[t],k[u]];var w=THREE.FontUtils.Triangulate.area(y);if((H+G)>(K+w)){u=v;z=F;if(u<0){u+=k.length}u%=k.length;if(z<0){z+=r.length}z%=r.length;x=(u-1)>=0?u-1:k.length-1;t=(z-1)>=0?z-1:r.length-1}else{}O=k.slice(0,u);N=k.slice(u);b=r.slice(z);a=r.slice(0,z);var j=[r[z],k[u],k[x]];var g=[r[z],r[t],k[u]];I.push(j);I.push(g);k=O.concat(b).concat(a).concat(N)}return{shape:k,isolatedPts:I,allpoints:A}},triangulateShape:function(d,c){var h=THREE.Shape.Utils.removeHoles(d,c);var l=h.shape,a=h.allpoints,o=h.isolatedPts;var b=THREE.FontUtils.Triangulate(l,false);var e,n,k,m,p,j,g={},q={};for(e=0,n=a.length;e<n;e++){p=a[e].x+":"+a[e].y;if(g[p]!==undefined){console.log("Duplicate point",p)}g[p]=e}for(e=0,n=b.length;e<n;e++){m=b[e];for(k=0;k<3;k++){p=m[k].x+":"+m[k].y;j=g[p];if(j!==undefined){m[k]=j}}}for(e=0,n=o.length;e<n;e++){m=o[e];for(k=0;k<3;k++){p=m[k].x+":"+m[k].y;j=g[p];if(j!==undefined){m[k]=j}}}return b.concat(o)},isClockWise:function(a){return THREE.FontUtils.Triangulate.area(a)<0},b2p0:function(b,c){var a=1-b;return a*a*c},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,d,c,b){return this.b2p0(a,d)+this.b2p1(a,c)+this.b2p2(a,b)},b3p0:function(b,c){var a=1-b;return a*a*a*c},b3p1:function(b,c){var a=1-b;return 3*a*a*b*c},b3p2:function(b,c){var a=1-b;return 3*a*b*b*c},b3p3:function(a,b){return a*a*a*b},b3:function(a,e,d,c,b){return this.b3p0(a,e)+this.b3p1(a,d)+this.b3p2(a,c)+this.b3p3(a,b)}};THREE.AnimationHandler=(function(){var c=[];var b={};var d={};d.update=function(g){for(var f=0;f<c.length;f++){c[f].update(g)}};d.addToUpdate=function(f){if(c.indexOf(f)===-1){c.push(f)}};d.removeFromUpdate=function(g){var f=c.indexOf(g);if(f!==-1){c.splice(f,1)}};d.add=function(f){if(b[f.name]!==undefined){console.log("THREE.AnimationHandler.add: Warning! "+f.name+" already exists in library. Overwriting.")}b[f.name]=f;a(f)};d.get=function(f){if(typeof f==="string"){if(b[f]){return b[f]}else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+f);return null}}else{}};d.parse=function(g){var h=[];if(g instanceof THREE.SkinnedMesh){for(var f=0;f<g.bones.length;f++){h.push(g.bones[f])}}else{e(g,h)}return h};var e=function(f,g){g.push(f);for(var h=0;h<f.children.length;h++){e(f.children[h],g)}};var a=function(j){if(j.initialized===true){return}for(var l=0;l<j.hierarchy.length;l++){for(var i=0;i<j.hierarchy[l].keys.length;i++){if(j.hierarchy[l].keys[i].time<0){j.hierarchy[l].keys[i].time=0}if(j.hierarchy[l].keys[i].rot!==undefined&&!(j.hierarchy[l].keys[i].rot instanceof THREE.Quaternion)){var f=j.hierarchy[l].keys[i].rot;j.hierarchy[l].keys[i].rot=new THREE.Quaternion(f[0],f[1],f[2],f[3])}}if(j.hierarchy[l].keys.length&&j.hierarchy[l].keys[0].morphTargets!==undefined){var p={};for(var i=0;i<j.hierarchy[l].keys.length;i++){for(var g=0;g<j.hierarchy[l].keys[i].morphTargets.length;g++){var n=j.hierarchy[l].keys[i].morphTargets[g];p[n]=-1}}j.hierarchy[l].usedMorphTargets=p;for(var i=0;i<j.hierarchy[l].keys.length;i++){var o={};for(var n in p){for(var g=0;g<j.hierarchy[l].keys[i].morphTargets.length;g++){if(j.hierarchy[l].keys[i].morphTargets[g]===n){o[n]=j.hierarchy[l].keys[i].morphTargetsInfluences[g];break}}if(g===j.hierarchy[l].keys[i].morphTargets.length){o[n]=0}}j.hierarchy[l].keys[i].morphTargetsInfluences=o}}for(var i=1;i<j.hierarchy[l].keys.length;i++){if(j.hierarchy[l].keys[i].time===j.hierarchy[l].keys[i-1].time){j.hierarchy[l].keys.splice(i,1);i--}}for(var i=0;i<j.hierarchy[l].keys.length;i++){j.hierarchy[l].keys[i].index=i}}var q=parseInt(j.length*j.fps,10);j.JIT={};j.JIT.hierarchy=[];for(var l=0;l<j.hierarchy.length;l++){j.JIT.hierarchy.push(new Array(q))}j.initialized=true};d.LINEAR=0;d.CATMULLROM=1;d.CATMULLROM_FORWARD=2;return d}());THREE.Animation=function(a,b,c){this.root=a;this.data=THREE.AnimationHandler.get(b);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.isPaused=true;this.loop=true;this.interpolationType=c!==undefined?c:THREE.AnimationHandler.LINEAR;this.points=[];this.target=new THREE.Vector3()};THREE.Animation.prototype.play=function(d,c){if(this.isPlaying===false){this.isPlaying=true;this.loop=d!==undefined?d:true;this.currentTime=c!==undefined?c:0;var g,b=this.hierarchy.length,e;for(g=0;g<b;g++){e=this.hierarchy[g];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD){e.useQuaternion=true}e.matrixAutoUpdate=true;if(e.animationCache===undefined){e.animationCache={};e.animationCache.prevKey={pos:0,rot:0,scl:0};e.animationCache.nextKey={pos:0,rot:0,scl:0};e.animationCache.originalMatrix=e instanceof THREE.Bone?e.skinMatrix:e.matrix}var f=e.animationCache.prevKey;var a=e.animationCache.nextKey;f.pos=this.data.hierarchy[g].keys[0];f.rot=this.data.hierarchy[g].keys[0];f.scl=this.data.hierarchy[g].keys[0];a.pos=this.getNextKeyWith("pos",g,1);a.rot=this.getNextKeyWith("rot",g,1);a.scl=this.getNextKeyWith("scl",g,1)}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.Animation.prototype.pause=function(){if(this.isPaused===true){THREE.AnimationHandler.addToUpdate(this)}else{THREE.AnimationHandler.removeFromUpdate(this)}this.isPaused=!this.isPaused};THREE.Animation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this)};THREE.Animation.prototype.update=function(l){if(this.isPlaying===false){return}var g=["pos","rot","scl"];var d;var v;var b;var m,c;var s,e;var u;var k;var j;var r=this.data.JIT.hierarchy;var o,q;var f,w,p;this.currentTime+=l*this.timeScale;q=this.currentTime;o=this.currentTime=this.currentTime%this.data.length;j=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10);for(var n=0,a=this.hierarchy.length;n<a;n++){u=this.hierarchy[n];k=u.animationCache;for(var i=0;i<3;i++){d=g[i];s=k.prevKey[d];e=k.nextKey[d];if(e.time<=q){if(o<q){if(this.loop){s=this.data.hierarchy[n].keys[0];e=this.getNextKeyWith(d,n,1);while(e.time<o){s=e;e=this.getNextKeyWith(d,n,e.index+1)}}else{this.stop();return}}else{do{s=e;e=this.getNextKeyWith(d,n,e.index+1)}while(e.time<o)}k.prevKey[d]=s;k.nextKey[d]=e}u.matrixAutoUpdate=true;u.matrixWorldNeedsUpdate=true;v=(o-s.time)/(e.time-s.time);m=s[d];c=e[d];if(v<0||v>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+v+" on bone "+n);v=v<0?0:1}if(d==="pos"){b=u.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){b.x=m[0]+(c[0]-m[0])*v;b.y=m[1]+(c[1]-m[1])*v;b.z=m[2]+(c[2]-m[2])*v}else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=this.getPrevKeyWith("pos",n,s.index-1)["pos"];this.points[1]=m;this.points[2]=c;this.points[3]=this.getNextKeyWith("pos",n,e.index+1)["pos"];v=v*0.33+0.33;f=this.interpolateCatmullRom(this.points,v);b.x=f[0];b.y=f[1];b.z=f[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){w=this.interpolateCatmullRom(this.points,v*1.01);this.target.set(w[0],w[1],w[2]);this.target.subSelf(b);this.target.y=0;this.target.normalize();p=Math.atan2(this.target.x,this.target.z);u.rotation.set(0,p,0)}}}}else{if(d==="rot"){THREE.Quaternion.slerp(m,c,u.quaternion,v)}else{if(d==="scl"){b=u.scale;b.x=m[0]+(c[0]-m[0])*v;b.y=m[1]+(c[1]-m[1])*v;b.z=m[2]+(c[2]-m[2])*v}}}}}};THREE.Animation.prototype.interpolateCatmullRom=function(n,b){var h=[],j=[],m,a,f,e,d,l,k,i,g;m=(n.length-1)*b;a=Math.floor(m);f=m-a;h[0]=a===0?a:a-1;h[1]=a;h[2]=a>n.length-2?a:a+1;h[3]=a>n.length-3?a:a+2;l=n[h[0]];k=n[h[1]];i=n[h[2]];g=n[h[3]];e=f*f;d=f*e;j[0]=this.interpolate(l[0],k[0],i[0],g[0],f,e,d);j[1]=this.interpolate(l[1],k[1],i[1],g[1],f,e,d);j[2]=this.interpolate(l[2],k[2],i[2],g[2],f,e,d);return j};THREE.Animation.prototype.interpolate=function(h,g,e,d,i,b,a){var f=(e-h)*0.5,c=(d-g)*0.5;return(2*(g-e)+f+c)*a+(-3*(g-e)-2*f-c)*b+f*i+g};THREE.Animation.prototype.getNextKeyWith=function(c,b,a){var d=this.data.hierarchy[b].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){a=a<d.length-1?a:d.length-1}else{a=a%d.length}for(;a<d.length;a++){if(d[a][c]!==undefined){return d[a]}}return this.data.hierarchy[b].keys[0]};THREE.Animation.prototype.getPrevKeyWith=function(c,b,a){var d=this.data.hierarchy[b].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){a=a>0?a:0}else{a=a>=0?a:a+d.length}for(;a>=0;a--){if(d[a][c]!==undefined){return d[a]}}return this.data.hierarchy[b].keys[d.length-1]};THREE.KeyFrameAnimation=function(j,e,i){this.root=j;this.data=THREE.AnimationHandler.get(e);this.hierarchy=THREE.AnimationHandler.parse(j);this.currentTime=0;this.timeScale=0.001;this.isPlaying=false;this.isPaused=true;this.loop=true;this.JITCompile=i!==undefined?i:true;for(var g=0,c=this.hierarchy.length;g<c;g++){var k=this.data.hierarchy[g].keys,a=this.data.hierarchy[g].sids,d=this.hierarchy[g];if(k.length&&a){for(var l=0;l<a.length;l++){var b=a[l],f=this.getNextKeyWith(b,g,0);if(f){f.apply(b)}}d.matrixAutoUpdate=false;this.data.hierarchy[g].node.updateMatrix();d.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype.play=function(c,b){if(!this.isPlaying){this.isPlaying=true;this.loop=c!==undefined?c:true;this.currentTime=b!==undefined?b:0;this.startTimeMs=b;this.startTime=10000000;this.endTime=-this.startTime;var e,a=this.hierarchy.length,d,g;for(e=0;e<a;e++){d=this.hierarchy[e];g=this.data.hierarchy[e];d.useQuaternion=true;if(g.animationCache===undefined){g.animationCache={};g.animationCache.prevKey=null;g.animationCache.nextKey=null;g.animationCache.originalMatrix=d instanceof THREE.Bone?d.skinMatrix:d.matrix}var f=this.data.hierarchy[e].keys;if(f.length){g.animationCache.prevKey=f[0];g.animationCache.nextKey=f[1];this.startTime=Math.min(f[0].time,this.startTime);this.endTime=Math.max(f[f.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.KeyFrameAnimation.prototype.pause=function(){if(this.isPaused){THREE.AnimationHandler.addToUpdate(this)}else{THREE.AnimationHandler.removeFromUpdate(this)}this.isPaused=!this.isPaused};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.data.hierarchy.length;b++){var d=this.hierarchy[b];var c=this.data.hierarchy[b];if(c.animationCache!==undefined){var a=c.animationCache.originalMatrix;if(d instanceof THREE.Bone){a.copy(d.skinMatrix);d.skinMatrix=a}else{a.copy(d.matrix);d.matrix=a}delete c.animationCache}}};THREE.KeyFrameAnimation.prototype.update=function(n){if(!this.isPlaying){return}var v,d;var w;var l;var g;var u=this.data.JIT.hierarchy;var q,t;var e;this.currentTime+=n*this.timeScale;t=this.currentTime;q=this.currentTime=this.currentTime%this.data.length;if(q<this.startTimeMs){q=this.currentTime=this.startTimeMs+q}g=parseInt(Math.min(q*this.data.fps,this.data.length*this.data.fps),10);e=q<t;if(e&&!this.loop){for(var o=0,a=this.hierarchy.length;o<a;o++){var j=this.data.hierarchy[o].keys,r=this.data.hierarchy[o].sids,b=j.length-1,f=this.hierarchy[o];if(j.length){for(var i=0;i<r.length;i++){var c=r[i],k=this.getPrevKeyWith(c,o,b);if(k){k.apply(c)}}this.data.hierarchy[o].node.updateMatrix();f.matrixWorldNeedsUpdate=true}}this.stop();return}if(q<this.startTime){return}for(var o=0,a=this.hierarchy.length;o<a;o++){w=this.hierarchy[o];l=this.data.hierarchy[o];var j=l.keys,m=l.animationCache;if(this.JITCompile&&u[o][g]!==undefined){if(w instanceof THREE.Bone){w.skinMatrix=u[o][g];w.matrixWorldNeedsUpdate=false}else{w.matrix=u[o][g];w.matrixWorldNeedsUpdate=true}}else{if(j.length){if(this.JITCompile&&m){if(w instanceof THREE.Bone){w.skinMatrix=m.originalMatrix}else{w.matrix=m.originalMatrix}}v=m.prevKey;d=m.nextKey;if(v&&d){if(d.time<=t){if(e&&this.loop){v=j[0];d=j[1];while(d.time<q){v=d;d=j[v.index+1]}}else{if(!e){var p=j.length-1;while(d.time<q&&d.index!==p){v=d;d=j[v.index+1]}}}m.prevKey=v;m.nextKey=d}if(d.time>=q){v.interpolate(d,q)}else{v.interpolate(d,d.time)}}this.data.hierarchy[o].node.updateMatrix();w.matrixWorldNeedsUpdate=true}}}if(this.JITCompile){if(u[0][g]===undefined){this.hierarchy[0].updateMatrixWorld(true);for(var o=0;o<this.hierarchy.length;o++){if(this.hierarchy[o] instanceof THREE.Bone){u[o][g]=this.hierarchy[o].skinMatrix.clone()}else{u[o][g]=this.hierarchy[o].matrix.clone()}}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(a,c,b){var d=this.data.hierarchy[c].keys;b=b%d.length;for(;b<d.length;b++){if(d[b].hasTarget(a)){return d[b]}}return d[0]};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,c,b){var d=this.data.hierarchy[c].keys;b=b>=0?b:b+d.length;for(;b>=0;b--){if(d[b].hasTarget(a)){return d[b]}}return d[d.length-1]};THREE.CubeCamera=function(f,e,g){THREE.Object3D.call(this);var d=90,b=1;var c=new THREE.PerspectiveCamera(d,b,f,e);c.up.set(0,-1,0);c.lookAt(new THREE.Vector3(1,0,0));this.add(c);var j=new THREE.PerspectiveCamera(d,b,f,e);j.up.set(0,-1,0);j.lookAt(new THREE.Vector3(-1,0,0));this.add(j);var a=new THREE.PerspectiveCamera(d,b,f,e);a.up.set(0,0,1);a.lookAt(new THREE.Vector3(0,1,0));this.add(a);var i=new THREE.PerspectiveCamera(d,b,f,e);i.up.set(0,0,-1);i.lookAt(new THREE.Vector3(0,-1,0));this.add(i);var k=new THREE.PerspectiveCamera(d,b,f,e);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,1));this.add(k);var h=new THREE.PerspectiveCamera(d,b,f,e);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,-1));this.add(h);this.renderTarget=new THREE.WebGLRenderTargetCube(g,g,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(n,o){var m=this.renderTarget;var l=m.generateMipmaps;m.generateMipmaps=false;m.activeCubeFace=0;n.render(o,c,m);m.activeCubeFace=1;n.render(o,j,m);m.activeCubeFace=2;n.render(o,a,m);m.activeCubeFace=3;n.render(o,i,m);m.activeCubeFace=4;n.render(o,k,m);m.generateMipmaps=l;m.activeCubeFace=5;n.render(o,h,m)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CombinedCamera=function(h,a,e,g,b,f,d){THREE.Camera.call(this);this.fov=e;this.left=-h/2;this.right=h/2;this.top=a/2;this.bottom=-a/2;this.cameraO=new THREE.OrthographicCamera(h/-2,h/2,a/2,a/-2,f,d);this.cameraP=new THREE.PerspectiveCamera(e,h/a,g,b);this.zoom=1;this.toPerspective();var c=h/a};THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype);THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=true;this.inOrthographicMode=false};THREE.CombinedCamera.prototype.toOrthographic=function(){var d=this.fov;var b=this.cameraP.aspect;var f=this.cameraP.near;var e=this.cameraP.far;var g=(f+e)/2;var h=Math.tan(d/2)*g;var a=2*h;var i=a*b;var c=i/2;h/=this.zoom;c/=this.zoom;this.cameraO.left=-c;this.cameraO.right=c;this.cameraO.top=h;this.cameraO.bottom=-h;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=false;this.inOrthographicMode=true};THREE.CombinedCamera.prototype.setSize=function(b,a){this.cameraP.aspect=b/a;this.left=-b/2;this.right=b/2;this.top=a/2;this.bottom=-a/2};THREE.CombinedCamera.prototype.setFov=function(a){this.fov=a;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){if(this.inPerspectiveMode){this.toPerspective()}else{this.toPerspective();this.toOrthographic()}};THREE.CombinedCamera.prototype.setLens=function(c,b){if(b===undefined){b=24}var a=2*Math.atan(b/(c*2))*(180/Math.PI);this.setFov(a);return a};THREE.CombinedCamera.prototype.setZoom=function(a){this.zoom=a;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.FirstPersonControls=function(a,b){this.object=a;this.target=new THREE.Vector3(0,0,0);this.domElement=(b!==undefined)?b:document;this.movementSpeed=1;this.lookSpeed=0.005;this.lookVertical=true;this.autoForward=false;this.activeLook=true;this.heightSpeed=false;this.heightCoef=1;this.heightMin=0;this.heightMax=1;this.constrainVertical=false;this.verticalMin=0;this.verticalMax=Math.PI;this.autoSpeedFactor=0;this.mouseX=0;this.mouseY=0;this.lat=0;this.lon=0;this.phi=0;this.theta=0;this.moveForward=false;this.moveBackward=false;this.moveLeft=false;this.moveRight=false;this.freeze=false;this.mouseDragOn=false;this.viewHalfX=0;this.viewHalfY=0;if(this.domElement!==document){this.domElement.setAttribute("tabindex",-1)}this.handleResize=function(){if(this.domElement===document){this.viewHalfX=window.innerWidth/2;this.viewHalfY=window.innerHeight/2}else{this.viewHalfX=this.domElement.offsetWidth/2;this.viewHalfY=this.domElement.offsetHeight/2}};this.onMouseDown=function(d){if(this.domElement!==document){this.domElement.focus()}d.preventDefault();d.stopPropagation();if(this.activeLook){switch(d.button){case 0:this.moveForward=true;break;case 2:this.moveBackward=true;break}}this.mouseDragOn=true};this.onMouseUp=function(d){d.preventDefault();d.stopPropagation();if(this.activeLook){switch(d.button){case 0:this.moveForward=false;break;case 2:this.moveBackward=false;break}}this.mouseDragOn=false};this.onMouseMove=function(d){if(this.domElement===document){this.mouseX=d.pageX-this.viewHalfX;this.mouseY=d.pageY-this.viewHalfY}else{this.mouseX=d.pageX-this.domElement.offsetLeft-this.viewHalfX;this.mouseY=d.pageY-this.domElement.offsetTop-this.viewHalfY}};this.onKeyDown=function(d){switch(d.keyCode){case 38:case 87:this.moveForward=true;break;case 37:case 65:this.moveLeft=true;break;case 40:case 83:this.moveBackward=true;break;case 39:case 68:this.moveRight=true;break;case 82:this.moveUp=true;break;case 70:this.moveDown=true;break;case 81:this.freeze=!this.freeze;break}};this.onKeyUp=function(d){switch(d.keyCode){case 38:case 87:this.moveForward=false;break;case 37:case 65:this.moveLeft=false;break;case 40:case 83:this.moveBackward=false;break;case 39:case 68:this.moveRight=false;break;case 82:this.moveUp=false;break;case 70:this.moveDown=false;break}};this.update=function(k){var e=0;if(this.freeze){return}else{if(this.heightSpeed){var j=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax);var h=j-this.heightMin;this.autoSpeedFactor=k*(h*this.heightCoef)}else{this.autoSpeedFactor=0}e=k*this.movementSpeed;if(this.moveForward||(this.autoForward&&!this.moveBackward)){this.object.translateZ(-(e+this.autoSpeedFactor))}if(this.moveBackward){this.object.translateZ(e)}if(this.moveLeft){this.object.translateX(-e)}if(this.moveRight){this.object.translateX(e)}if(this.moveUp){this.object.translateY(e)}if(this.moveDown){this.object.translateY(-e)}var i=k*this.lookSpeed;if(!this.activeLook){i=0}this.lon+=this.mouseX*i;if(this.lookVertical){this.lat-=this.mouseY*i}this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;var f=this.target,d=this.object.position;f.x=d.x+100*Math.sin(this.phi)*Math.cos(this.theta);f.y=d.y+100*Math.cos(this.phi);f.z=d.z+100*Math.sin(this.phi)*Math.sin(this.theta)}var g=1;if(this.constrainVertical){g=Math.PI/(this.verticalMax-this.verticalMin)}this.lon+=this.mouseX*i;if(this.lookVertical){this.lat-=this.mouseY*i*g}this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical){this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax)}var f=this.target,d=this.object.position;f.x=d.x+100*Math.sin(this.phi)*Math.cos(this.theta);f.y=d.y+100*Math.cos(this.phi);f.z=d.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(f)};this.domElement.addEventListener("contextmenu",function(d){d.preventDefault()},false);this.domElement.addEventListener("mousemove",c(this,this.onMouseMove),false);this.domElement.addEventListener("mousedown",c(this,this.onMouseDown),false);this.domElement.addEventListener("mouseup",c(this,this.onMouseUp),false);this.domElement.addEventListener("keydown",c(this,this.onKeyDown),false);this.domElement.addEventListener("keyup",c(this,this.onKeyUp),false);function c(e,d){return function(){d.apply(e,arguments)}}this.handleResize()};THREE.PathControls=function(d,e){this.object=d;this.domElement=(e!==undefined)?e:document;this.id="PathControls"+THREE.PathControlsIdCounter++;this.duration=10*1000;this.waypoints=[];this.useConstantSpeed=true;this.resamplingCoef=50;this.debugPath=new THREE.Object3D();this.debugDummy=new THREE.Object3D();this.animationParent=new THREE.Object3D();this.lookSpeed=0.005;this.lookVertical=true;this.lookHorizontal=true;this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.target=new THREE.Object3D();this.mouseX=0;this.mouseY=0;this.lat=0;this.lon=0;this.phi=0;this.theta=0;var k=Math.PI*2,b=Math.PI/180;this.viewHalfX=0;this.viewHalfY=0;if(this.domElement!==document){this.domElement.setAttribute("tabindex",-1)}this.handleResize=function(){if(this.domElement===document){this.viewHalfX=window.innerWidth/2;this.viewHalfY=window.innerHeight/2}else{this.viewHalfX=this.domElement.offsetWidth/2;this.viewHalfY=this.domElement.offsetHeight/2}};this.update=function(v){var u,l;if(this.lookHorizontal){this.lon+=this.mouseX*this.lookSpeed*v}if(this.lookVertical){this.lat-=this.mouseY*this.lookSpeed*v}this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*b;this.theta=this.lon*b;this.phi=f(this.phi);u=this.verticalAngleMap.srcRange;l=this.verticalAngleMap.dstRange;var r=THREE.Math.mapLinear(this.phi,u[0],u[1],l[0],l[1]);var s=l[1]-l[0];var o=(r-l[0])/s;this.phi=c(o)*s+l[0];u=this.horizontalAngleMap.srcRange;l=this.horizontalAngleMap.dstRange;var t=THREE.Math.mapLinear(this.theta,u[0],u[1],l[0],l[1]);var m=l[1]-l[0];var q=(t-l[0])/m;this.theta=c(q)*m+l[0];var n=this.target.position,p=this.object.position;n.x=100*Math.sin(this.phi)*Math.cos(this.theta);n.y=100*Math.cos(this.phi);n.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(this.target.position)};this.onMouseMove=function(l){if(this.domElement===document){this.mouseX=l.pageX-this.viewHalfX;this.mouseY=l.pageY-this.viewHalfY}else{this.mouseX=l.pageX-this.domElement.offsetLeft-this.viewHalfX;this.mouseY=l.pageY-this.domElement.offsetTop-this.viewHalfY}};function f(m){var l=m%k;return l>=0?l:l+k}function a(o,m){var p=o[0]-m[0],n=o[1]-m[1],l=o[2]-m[2];return Math.sqrt(p*p+n*n+l*l)}function c(l){if((l*=2)<1){return 0.5*l*l}return -0.5*(--l*(l-2)-1)}function i(m,l){return function(){l.apply(m,arguments)}}function j(v,s,l,p){var x={name:l,fps:0.6,length:p,hierarchy:[]};var q,n,u,z=s.getControlPointsArray(),m=s.getLength(),o=z.length,y=0,r=0,w=o-1;n={parent:-1,keys:[]};n.keys[r]={time:0,pos:z[r],rot:[0,0,0,1],scl:[1,1,1]};n.keys[w]={time:p,pos:z[w],rot:[0,0,0,1],scl:[1,1,1]};for(q=1;q<o-1;q++){y=p*m.chunks[q]/m.total;n.keys[q]={time:y,pos:z[q]}}x.hierarchy[0]=n;THREE.AnimationHandler.add(x);return new THREE.Animation(v,l,THREE.AnimationHandler.CATMULLROM_FORWARD,false)}function g(q,o){var n,m,l,p=new THREE.Geometry();for(n=0;n<q.points.length*o;n++){m=n/(q.points.length*o);l=q.getPoint(m);p.vertices[n]=new THREE.Vector3(l.x,l.y,l.z)}return p}function h(t,s){var q=g(s,10),l=g(s,10),v=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),r=new THREE.Line(q,v),m=new THREE.ParticleSystem(l,new THREE.ParticleBasicMaterial({color:16755200,size:3}));r.scale.set(1,1,1);t.add(r);m.scale.set(1,1,1);t.add(m);var n,p=new THREE.SphereGeometry(1,16,8),u=new THREE.MeshBasicMaterial({color:65280});for(var o=0;o<s.points.length;o++){n=new THREE.Mesh(p,u);n.position.copy(s.points[o]);t.add(n)}}this.init=function(){this.spline=new THREE.Spline();this.spline.initFromArray(this.waypoints);if(this.useConstantSpeed){this.spline.reparametrizeByArcLength(this.resamplingCoef)}if(this.createDebugDummy){var m=new THREE.MeshLambertMaterial({color:30719}),p=new THREE.MeshLambertMaterial({color:65280}),o=new THREE.CubeGeometry(10,10,20),n=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(o,m);var l=new THREE.Mesh(n,p);l.position.set(0,10,0);this.animation=j(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.object);this.animationParent.add(this.target);this.animationParent.add(l)}else{this.animation=j(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.target);this.animationParent.add(this.object)}if(this.createDebugPath){h(this.debugPath,this.spline)}this.domElement.addEventListener("mousemove",i(this,this.onMouseMove),false)};this.handleResize()};THREE.PathControlsIdCounter=0;THREE.FlyControls=function(a,b){this.object=a;this.domElement=(b!==undefined)?b:document;if(b){this.domElement.setAttribute("tabindex",-1)}this.movementSpeed=1;this.rollSpeed=0.005;this.dragToLook=false;this.autoForward=false;this.object.useQuaternion=true;this.tmpQuaternion=new THREE.Quaternion();this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.handleEvent=function(d){if(typeof this[d.type]=="function"){this[d.type](d)}};this.keydown=function(d){if(d.altKey){return}switch(d.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1;break}this.updateMovementVector();this.updateRotationVector()};this.keyup=function(d){switch(d.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0;break}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(d){if(this.domElement!==document){this.domElement.focus()}d.preventDefault();d.stopPropagation();if(this.dragToLook){this.mouseStatus++}else{switch(d.button){case 0:this.object.moveForward=true;break;case 2:this.object.moveBackward=true;break}}};this.mousemove=function(f){if(!this.dragToLook||this.mouseStatus>0){var e=this.getContainerDimensions();var g=e.size[0]/2;var d=e.size[1]/2;this.moveState.yawLeft=-((f.pageX-e.offset[0])-g)/g;this.moveState.pitchDown=((f.pageY-e.offset[1])-d)/d;this.updateRotationVector()}};this.mouseup=function(d){d.preventDefault();d.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else{switch(d.button){case 0:this.moveForward=false;break;case 2:this.moveBackward=false;break}}this.updateRotationVector()};this.update=function(f){var e=f*this.movementSpeed;var d=f*this.rollSpeed;this.object.translateX(this.moveVector.x*e);this.object.translateY(this.moveVector.y*e);this.object.translateZ(this.moveVector.z*e);this.tmpQuaternion.set(this.rotationVector.x*d,this.rotationVector.y*d,this.rotationVector.z*d,1).normalize();this.object.quaternion.multiplySelf(this.tmpQuaternion);this.object.matrix.setPosition(this.object.position);this.object.matrix.setRotationFromQuaternion(this.object.quaternion);this.object.matrixWorldNeedsUpdate=true};this.updateMovementVector=function(){var d=(this.moveState.forward||(this.autoForward&&!this.moveState.back))?1:0;this.moveVector.x=(-this.moveState.left+this.moveState.right);this.moveVector.y=(-this.moveState.down+this.moveState.up);this.moveVector.z=(-d+this.moveState.back)};this.updateRotationVector=function(){this.rotationVector.x=(-this.moveState.pitchDown+this.moveState.pitchUp);this.rotationVector.y=(-this.moveState.yawRight+this.moveState.yawLeft);this.rotationVector.z=(-this.moveState.rollRight+this.moveState.rollLeft)};this.getContainerDimensions=function(){if(this.domElement!=document){return{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}}else{return{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}};function c(e,d){return function(){d.apply(e,arguments)}}this.domElement.addEventListener("mousemove",c(this,this.mousemove),false);this.domElement.addEventListener("mousedown",c(this,this.mousedown),false);this.domElement.addEventListener("mouseup",c(this,this.mouseup),false);this.domElement.addEventListener("keydown",c(this,this.keydown),false);this.domElement.addEventListener("keyup",c(this,this.keyup),false);this.updateMovementVector();this.updateRotationVector()};THREE.RollControls=function(t,s){this.object=t;this.domElement=(s!==undefined)?s:document;this.mouseLook=true;this.autoForward=false;this.lookSpeed=1;this.movementSpeed=1;this.rollSpeed=1;this.constrainVertical=[-0.9,0.9];this.object.matrixAutoUpdate=false;this.forward=new THREE.Vector3(0,0,1);this.roll=0;var c=new THREE.Vector3();var q=new THREE.Vector3();var j=new THREE.Vector3();var d=new THREE.Matrix4();var r=false,g=1,a=0,p=0,h=0;var l=0,k=0;var n=0;var m=0;this.handleResize=function(){n=window.innerWidth/2;m=window.innerHeight/2};this.update=function(x){if(this.mouseLook){var v=x*this.lookSpeed;this.rotateHorizontally(v*l);this.rotateVertically(v*k)}var w=x*this.movementSpeed;var u=(a>0||(this.autoForward&&!(a<0)))?1:a;this.object.translateZ(-w*u);this.object.translateX(w*p);this.object.translateY(w*h);if(r){this.roll+=this.rollSpeed*x*g}if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else{if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}}j.copy(this.forward);q.set(0,1,0);c.cross(q,j).normalize();q.cross(j,c).normalize();this.object.matrix.elements[0]=c.x;this.object.matrix.elements[4]=q.x;this.object.matrix.elements[8]=j.x;this.object.matrix.elements[1]=c.y;this.object.matrix.elements[5]=q.y;this.object.matrix.elements[9]=j.y;this.object.matrix.elements[2]=c.z;this.object.matrix.elements[6]=q.z;this.object.matrix.elements[10]=j.z;d.identity();d.elements[0]=Math.cos(this.roll);d.elements[4]=-Math.sin(this.roll);d.elements[1]=Math.sin(this.roll);d.elements[5]=Math.cos(this.roll);this.object.matrix.multiplySelf(d);this.object.matrixWorldNeedsUpdate=true;this.object.matrix.elements[12]=this.object.position.x;this.object.matrix.elements[13]=this.object.position.y;this.object.matrix.elements[14]=this.object.position.z};this.translateX=function(u){this.object.position.x+=this.object.matrix.elements[0]*u;this.object.position.y+=this.object.matrix.elements[1]*u;this.object.position.z+=this.object.matrix.elements[2]*u};this.translateY=function(u){this.object.position.x+=this.object.matrix.elements[4]*u;this.object.position.y+=this.object.matrix.elements[5]*u;this.object.position.z+=this.object.matrix.elements[6]*u};this.translateZ=function(u){this.object.position.x-=this.object.matrix.elements[8]*u;this.object.position.y-=this.object.matrix.elements[9]*u;this.object.position.z-=this.object.matrix.elements[10]*u};this.rotateHorizontally=function(u){c.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]);c.multiplyScalar(u);this.forward.subSelf(c);this.forward.normalize()};this.rotateVertically=function(u){q.set(this.object.matrix.elements[4],this.object.matrix.elements[5],this.object.matrix.elements[6]);q.multiplyScalar(u);this.forward.addSelf(q);this.forward.normalize()};function e(u){switch(u.keyCode){case 38:case 87:a=1;break;case 37:case 65:p=-1;break;case 40:case 83:a=-1;break;case 39:case 68:p=1;break;case 81:r=true;g=1;break;case 69:r=true;g=-1;break;case 82:h=1;break;case 70:h=-1;break}}function b(u){switch(u.keyCode){case 38:case 87:a=0;break;case 37:case 65:p=0;break;case 40:case 83:a=0;break;case 39:case 68:p=0;break;case 81:r=false;break;case 69:r=false;break;case 82:h=0;break;case 70:h=0;break}}function o(u){l=(u.clientX-n)/window.innerWidth;k=(u.clientY-m)/window.innerHeight}function i(u){u.preventDefault();u.stopPropagation();switch(u.button){case 0:a=1;break;case 2:a=-1;break}}function f(u){u.preventDefault();u.stopPropagation();switch(u.button){case 0:a=0;break;case 2:a=0;break}}this.domElement.addEventListener("contextmenu",function(u){u.preventDefault()},false);this.domElement.addEventListener("mousemove",o,false);this.domElement.addEventListener("mousedown",i,false);this.domElement.addEventListener("mouseup",f,false);this.domElement.addEventListener("keydown",e,false);this.domElement.addEventListener("keyup",b,false);this.handleResize()};THREE.TrackballControls=function(u,t){THREE.EventTarget.call(this);var m=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=u;this.domElement=(t!==undefined)?t:document;this.enabled=true;this.screen={width:0,height:0,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3();var g=new THREE.Vector3();var b=false,o=n.NONE,a=new THREE.Vector3(),k=new THREE.Vector3(),f=new THREE.Vector3(),h=new THREE.Vector2(),q=new THREE.Vector2(),c=new THREE.Vector2(),p=new THREE.Vector2();var s={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth;this.screen.height=window.innerHeight;this.screen.offsetLeft=0;this.screen.offsetTop=0;this.radius=(this.screen.width+this.screen.height)/4};this.handleEvent=function(v){if(typeof this[v.type]=="function"){this[v.type](v)}};this.getMouseOnScreen=function(w,v){return new THREE.Vector2((w-m.screen.offsetLeft)/m.radius*0.5,(v-m.screen.offsetTop)/m.radius*0.5)};this.getMouseProjectionOnBall=function(z,x){var w=new THREE.Vector3((z-m.screen.width*0.5-m.screen.offsetLeft)/m.radius,(m.screen.height*0.5+m.screen.offsetTop-x)/m.radius,0);var y=w.length();if(y>1){w.normalize()}else{w.z=Math.sqrt(1-y*y)}a.copy(m.object.position).subSelf(m.target);var v=m.object.up.clone().setLength(w.y);v.addSelf(m.object.up.clone().crossSelf(a).setLength(w.x));v.addSelf(a.setLength(w.z));return v};this.rotateCamera=function(){var x=Math.acos(k.dot(f)/k.length()/f.length());if(x){var v=(new THREE.Vector3()).cross(k,f).normalize(),w=new THREE.Quaternion();x*=m.rotateSpeed;w.setFromAxisAngle(v,-x);w.multiplyVector3(a);w.multiplyVector3(m.object.up);w.multiplyVector3(f);if(m.staticMoving){k.copy(f)}else{w.setFromAxisAngle(v,x*(m.dynamicDampingFactor-1));w.multiplyVector3(k)}}};this.zoomCamera=function(){var v=1+(q.y-h.y)*m.zoomSpeed;if(v!==1&&v>0){a.multiplyScalar(v);if(m.staticMoving){h.copy(q)}else{h.y+=(q.y-h.y)*this.dynamicDampingFactor}}};this.panCamera=function(){var v=p.clone().subSelf(c);if(v.lengthSq()){v.multiplyScalar(a.length()*m.panSpeed);var w=a.clone().crossSelf(m.object.up).setLength(v.x);w.addSelf(m.object.up.clone().setLength(v.y));m.object.position.addSelf(w);m.target.addSelf(w);if(m.staticMoving){c=p}else{c.addSelf(v.sub(p,c).multiplyScalar(m.dynamicDampingFactor))}}};this.checkDistances=function(){if(!m.noZoom||!m.noPan){if(m.object.position.lengthSq()>m.maxDistance*m.maxDistance){m.object.position.setLength(m.maxDistance)}if(a.lengthSq()<m.minDistance*m.minDistance){m.object.position.add(m.target,a.setLength(m.minDistance))}}};this.update=function(){a.copy(m.object.position).subSelf(m.target);if(!m.noRotate){m.rotateCamera()}if(!m.noZoom){m.zoomCamera()}if(!m.noPan){m.panCamera()}m.object.position.add(m.target,a);m.checkDistances();m.object.lookAt(m.target);if(g.distanceToSquared(m.object.position)>0){m.dispatchEvent(s);g.copy(m.object.position)}};function e(v){if(!m.enabled){return}if(o!==n.NONE){return}else{if(v.keyCode===m.keys[n.ROTATE]&&!m.noRotate){o=n.ROTATE}else{if(v.keyCode===m.keys[n.ZOOM]&&!m.noZoom){o=n.ZOOM}else{if(v.keyCode===m.keys[n.PAN]&&!m.noPan){o=n.PAN}}}}if(o!==n.NONE){b=true}}function d(v){if(!m.enabled){return}if(o!==n.NONE){o=n.NONE}}function j(v){if(!m.enabled){return}v.preventDefault();v.stopPropagation();if(o===n.NONE){o=v.button;if(o===n.ROTATE&&!m.noRotate){k=f=m.getMouseProjectionOnBall(v.clientX,v.clientY)}else{if(o===n.ZOOM&&!m.noZoom){h=q=m.getMouseOnScreen(v.clientX,v.clientY)}else{if(!this.noPan){c=p=m.getMouseOnScreen(v.clientX,v.clientY)}}}}}function r(v){if(!m.enabled){return}if(b){k=f=m.getMouseProjectionOnBall(v.clientX,v.clientY);h=q=m.getMouseOnScreen(v.clientX,v.clientY);c=p=m.getMouseOnScreen(v.clientX,v.clientY);b=false}if(o===n.NONE){return}else{if(o===n.ROTATE&&!m.noRotate){f=m.getMouseProjectionOnBall(v.clientX,v.clientY)}else{if(o===n.ZOOM&&!m.noZoom){q=m.getMouseOnScreen(v.clientX,v.clientY)}else{if(o===n.PAN&&!m.noPan){p=m.getMouseOnScreen(v.clientX,v.clientY)}}}}}function l(v){if(!m.enabled){return}v.preventDefault();v.stopPropagation();o=n.NONE}function i(v){if(!m.enabled){return}v.preventDefault();v.stopPropagation();var w=0;if(v.wheelDelta){w=v.wheelDelta/40}else{if(v.detail){w=-v.detail/3}}h.y+=(1/w)*0.05}this.domElement.addEventListener("contextmenu",function(v){v.preventDefault()},false);this.domElement.addEventListener("mousemove",r,false);this.domElement.addEventListener("mousedown",j,false);this.domElement.addEventListener("mouseup",l,false);this.domElement.addEventListener("DOMMouseScroll",i,false);this.domElement.addEventListener("mousewheel",i,false);window.addEventListener("keydown",e,false);window.addEventListener("keyup",d,false);this.handleResize()};THREE.OrbitControls=function(w,t){THREE.EventTarget.call(this);this.object=w;this.domElement=(t!==undefined)?t:document;this.center=new THREE.Vector3();this.userZoom=true;this.userZoomSpeed=1;this.userRotate=true;this.userRotateSpeed=1;this.autoRotate=false;this.autoRotateSpeed=2;var a=this;var m=0.000001;var u=1800;var q=new THREE.Vector2();var c=new THREE.Vector2();var k=new THREE.Vector2();var p=new THREE.Vector2();var v=new THREE.Vector2();var i=new THREE.Vector2();var d=0;var s=0;var x=1;var l=new THREE.Vector3();var o={NONE:-1,ROTATE:0,ZOOM:1};var e=o.NONE;var r={type:"change"};this.rotateLeft=function(y){if(y===undefined){y=f()}s-=y};this.rotateRight=function(y){if(y===undefined){y=f()}s+=y};this.rotateUp=function(y){if(y===undefined){y=f()}d-=y};this.rotateDown=function(y){if(y===undefined){y=f()}d+=y};this.zoomIn=function(y){if(y===undefined){y=n()}x/=y};this.zoomOut=function(y){if(y===undefined){y=n()}x*=y};this.update=function(){var z=this.object.position;var C=z.clone().subSelf(this.center);var A=Math.atan2(C.x,C.z);var B=Math.atan2(Math.sqrt(C.x*C.x+C.z*C.z),C.y);if(this.autoRotate){this.rotateLeft(f())}A+=s;B+=d;B=Math.max(m,Math.min(Math.PI-m,B));var y=C.length();C.x=y*Math.sin(B)*Math.sin(A);C.y=y*Math.cos(B);C.z=y*Math.sin(B)*Math.cos(A);C.multiplyScalar(x);z.copy(this.center).addSelf(C);this.object.lookAt(this.center);s=0;d=0;x=1;if(l.distanceTo(this.object.position)>0){this.dispatchEvent(r);l.copy(this.object.position)}};function f(){return 2*Math.PI/60/60*a.autoRotateSpeed}function n(){return Math.pow(0.95,a.userZoomSpeed)}function g(y){if(!a.userRotate){return}y.preventDefault();if(y.button===0||y.button===2){e=o.ROTATE;q.set(y.clientX,y.clientY)}else{if(y.button===1){e=o.ZOOM;p.set(y.clientX,y.clientY)}}document.addEventListener("mousemove",j,false);document.addEventListener("mouseup",b,false)}function j(y){y.preventDefault();if(e===o.ROTATE){c.set(y.clientX,y.clientY);k.sub(c,q);a.rotateLeft(2*Math.PI*k.x/u*a.userRotateSpeed);a.rotateUp(2*Math.PI*k.y/u*a.userRotateSpeed);q.copy(c)}else{if(e===o.ZOOM){v.set(y.clientX,y.clientY);i.sub(v,p);if(i.y>0){a.zoomIn()}else{a.zoomOut()}p.copy(v)}}}function b(y){if(!a.userRotate){return}document.removeEventListener("mousemove",j,false);document.removeEventListener("mouseup",b,false);e=o.NONE}function h(y){if(!a.userZoom){return}if(y.wheelDelta>0){a.zoomOut()}else{a.zoomIn()}}this.domElement.addEventListener("contextmenu",function(y){y.preventDefault()},false);this.domElement.addEventListener("mousedown",g,false);this.domElement.addEventListener("mousewheel",h,false)};THREE.CircleGeometry=function(j,g,d,b){THREE.Geometry.call(this);j=j||50;d=d!==undefined?d:0;b=b!==undefined?b:Math.PI*2;g=g!==undefined?Math.max(3,g):8;var f,e=[],a=new THREE.Vector3(),m=new THREE.UV(0.5,0.5);this.vertices.push(a);e.push(m);for(f=0;f<=g;f++){var h=new THREE.Vector3();h.x=j*Math.cos(d+f/g*b);h.y=j*Math.sin(d+f/g*b);this.vertices.push(h);e.push(new THREE.UV((h.x/j+1)/2,-(h.y/j+1)/2+1))}var c=new THREE.Vector3(0,0,-1);for(f=1;f<=g;f++){var o=f;var l=f+1;var k=0;this.faces.push(new THREE.Face3(o,l,k,[c,c,c]));this.faceVertexUvs[0].push([e[f],e[f+1],m])}this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:j}};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=function(n,m,v,p,a,c,e,t){THREE.Geometry.call(this);var b=this,j=n/2,f=m/2,w=v/2;var u,r,q,h,g,d;if(e!==undefined){if(e instanceof Array){this.materials=e}else{this.materials=[];for(var o=0;o<6;o++){this.materials.push(e)}}u=0;h=1;r=2;g=3;q=4;d=5}else{this.materials=[]}this.sides={px:true,nx:true,py:true,ny:true,pz:true,nz:true};if(t!=undefined){for(var l in t){if(this.sides[l]!==undefined){this.sides[l]=t[l]}}}this.sides.px&&k("z","y",-1,-1,v,m,j,u);this.sides.nx&&k("z","y",1,-1,v,m,-j,h);this.sides.py&&k("x","z",1,1,n,v,f,r);this.sides.ny&&k("x","z",1,-1,n,v,-f,g);this.sides.pz&&k("x","y",1,-1,n,m,w,q);this.sides.nz&&k("x","y",-1,-1,n,m,-w,d);function k(H,G,i,C,K,J,V,I){var F,A,z,M=p||1,L=a||1,B=K/2,y=J/2,D=b.vertices.length;if((H==="x"&&G==="y")||(H==="y"&&G==="x")){F="z"}else{if((H==="x"&&G==="z")||(H==="z"&&G==="x")){F="y";L=c||1}else{if((H==="z"&&G==="y")||(H==="y"&&G==="z")){F="x";M=c||1}}}var N=M+1,x=L+1,U=K/M,P=J/L,T=new THREE.Vector3();T[F]=V>0?1:-1;for(z=0;z<x;z++){for(A=0;A<N;A++){var s=new THREE.Vector3();s[H]=(A*U-B)*i;s[G]=(z*P-y)*C;s[F]=V;b.vertices.push(s)}}for(z=0;z<L;z++){for(A=0;A<M;A++){var S=A+N*z;var R=A+N*(z+1);var Q=(A+1)+N*(z+1);var O=(A+1)+N*z;var E=new THREE.Face4(S+D,R+D,Q+D,O+D);E.normal.copy(T);E.vertexNormals.push(T.clone(),T.clone(),T.clone(),T.clone());E.materialIndex=I;b.faces.push(E);b.faceVertexUvs[0].push([new THREE.UV(A/M,1-z/L),new THREE.UV(A/M,1-(z+1)/L),new THREE.UV((A+1)/M,1-(z+1)/L),new THREE.UV((A+1)/M,1-z/L)])}}}this.computeCentroids();this.mergeVertices()};THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry=function(l,L,A,f,b,I){THREE.Geometry.call(this);l=l!==undefined?l:20;L=L!==undefined?L:20;A=A!==undefined?A:100;var C=A/2;var B=f||8;var z=b||1;var q,p,h=[],r=[];for(p=0;p<=z;p++){var w=[];var K=[];var s=p/z;var g=s*(L-l)+l;for(q=0;q<=B;q++){var t=q/B;var G=new THREE.Vector3();G.x=g*Math.sin(t*Math.PI*2);G.y=-s*A+C;G.z=g*Math.cos(t*Math.PI*2);this.vertices.push(G);w.push(this.vertices.length-1);K.push(new THREE.UV(t,1-s))}h.push(w);r.push(K)}var E=(L-l)/A;var n,k;for(q=0;q<B;q++){if(l!==0){n=this.vertices[h[0][q]].clone();k=this.vertices[h[0][q+1]].clone()}else{n=this.vertices[h[1][q]].clone();k=this.vertices[h[1][q+1]].clone()}n.setY(Math.sqrt(n.x*n.x+n.z*n.z)*E).normalize();k.setY(Math.sqrt(k.x*k.x+k.z*k.z)*E).normalize();for(p=0;p<z;p++){var e=h[p][q];var d=h[p+1][q];var c=h[p+1][q+1];var a=h[p][q+1];var o=n.clone();var m=n.clone();var j=k.clone();var i=k.clone();var J=r[p][q].clone();var H=r[p+1][q].clone();var F=r[p+1][q+1].clone();var D=r[p][q+1].clone();this.faces.push(new THREE.Face4(e,d,c,a,[o,m,j,i]));this.faceVertexUvs[0].push([J,H,F,D])}}if(!I&&l>0){this.vertices.push(new THREE.Vector3(0,C,0));for(q=0;q<B;q++){var e=h[0][q];var d=h[0][q+1];var c=this.vertices.length-1;var o=new THREE.Vector3(0,1,0);var m=new THREE.Vector3(0,1,0);var j=new THREE.Vector3(0,1,0);var J=r[0][q].clone();var H=r[0][q+1].clone();var F=new THREE.UV(H.u,0);this.faces.push(new THREE.Face3(e,d,c,[o,m,j]));this.faceVertexUvs[0].push([J,H,F])}}if(!I&&L>0){this.vertices.push(new THREE.Vector3(0,-C,0));for(q=0;q<B;q++){var e=h[p][q+1];var d=h[p][q];var c=this.vertices.length-1;var o=new THREE.Vector3(0,-1,0);var m=new THREE.Vector3(0,-1,0);var j=new THREE.Vector3(0,-1,0);var J=r[p][q+1].clone();var H=r[p][q].clone();var F=new THREE.UV(H.u,1);this.faces.push(new THREE.Face3(e,d,c,[o,m,j]));this.faceVertexUvs[0].push([J,H,F])}}this.computeCentroids();this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry=function(a,b){if(typeof(a)==="undefined"){a=[];return}THREE.Geometry.call(this);a=a instanceof Array?a:[a];this.shapebb=a[a.length-1].getBoundingBox();this.addShapeList(a,b);this.computeCentroids();this.computeFaceNormals()};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(b,d){var a=b.length;for(var e=0;e<a;e++){var c=b[e];this.addShape(c,d)}};THREE.ExtrudeGeometry.prototype.addShape=function(E,N){var g=N.amount!==undefined?N.amount:100;var f=N.bevelThickness!==undefined?N.bevelThickness:6;var O=N.bevelSize!==undefined?N.bevelSize:f-2;var B=N.bevelSegments!==undefined?N.bevelSegments:3;var a=N.bevelEnabled!==undefined?N.bevelEnabled:true;var M=N.curveSegments!==undefined?N.curveSegments:12;var X=N.steps!==undefined?N.steps:1;var r=N.extrudePath;var S,u=false;var ak=N.material;var o=N.extrudeMaterial;var D=N.UVGenerator!==undefined?N.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var W=this.shapebb;var x,aa,ae,at;if(r){S=r.getSpacedPoints(X);u=true;a=false;x=N.frames!==undefined?N.frames:new THREE.TubeGeometry.FrenetFrames(r,X,false);aa=new THREE.Vector3();ae=new THREE.Vector3();at=new THREE.Vector3()}if(!a){B=0;f=0;O=0}var aw,aq,ar;var Y=this;var K=[];var U=this.vertices.length;var C=E.extractPoints();var d=C.shape;var I=C.holes;var ag=!THREE.Shape.Utils.isClockWise(d);if(ag){d=d.reverse();for(aq=0,ar=I.length;aq<ar;aq++){aw=I[aq];if(THREE.Shape.Utils.isClockWise(aw)){I[aq]=aw.reverse()}}ag=false}var q=THREE.Shape.Utils.triangulateShape(d,I);var aj=d;for(aq=0,ar=I.length;aq<ar;aq++){aw=I[aq];d=d.concat(aw)}function P(i,h,b){if(!h){console.log("die")}return h.clone().multiplyScalar(b).addSelf(i)}var av,ah,ad,Z,w,ai=d.length,p,n=q.length,V,c=aj.length;var T=180/Math.PI;function G(i,h,b){return y(i,h,b)}function A(j,i,h){var t=Math.atan2(i.y-j.y,i.x-j.x);var s=Math.atan2(h.y-j.y,h.x-j.x);if(t>s){s+=Math.PI*2}var k=(t+s)/2;var z=-Math.cos(k);var v=-Math.sin(k);var b=new THREE.Vector2(z,v);return b}function y(ax,z,t){var aC=THREE.ExtrudeGeometry.__v1,az=THREE.ExtrudeGeometry.__v2,aB=THREE.ExtrudeGeometry.__v3,ay=THREE.ExtrudeGeometry.__v4,j=THREE.ExtrudeGeometry.__v5,i=THREE.ExtrudeGeometry.__v6,aE,aD,k,aA,aF,h;aC.set(ax.x-z.x,ax.y-z.y);az.set(ax.x-t.x,ax.y-t.y);aE=aC.normalize();aD=az.normalize();aB.set(-aE.y,aE.x);ay.set(aD.y,-aD.x);j.copy(ax).addSelf(aB);i.copy(ax).addSelf(ay);if(j.equals(i)){return ay.clone()}j.copy(z).addSelf(aB);i.copy(t).addSelf(ay);k=aE.dot(ay);aA=i.subSelf(j).dot(ay);if(k===0){console.log("Either infinite or no solutions!");if(aA===0){console.log("Its finite solutions.")}else{console.log("Too bad, no solutions.")}}aF=aA/k;if(aF<0){return A(ax,z,t)}h=aE.multiplyScalar(aF).addSelf(j);return h.subSelf(ax).clone()}var an=[];for(var ap=0,R=aj.length,am=R-1,al=ap+1;ap<R;ap++,am++,al++){if(am===R){am=0}if(al===R){al=0}var J=aj[ap];var H=aj[am];var F=aj[al];an[ap]=G(aj[ap],aj[am],aj[al])}var Q=[],ac,e=an.concat();for(aq=0,ar=I.length;aq<ar;aq++){aw=I[aq];ac=[];for(ap=0,R=aw.length,am=R-1,al=ap+1;ap<R;ap++,am++,al++){if(am===R){am=0}if(al===R){al=0}ac[ap]=G(aw[ap],aw[am],aw[al])}Q.push(ac);e=e.concat(ac)}for(av=0;av<B;av++){ad=av/B;Z=f*(1-ad);ah=O*(Math.sin(ad*Math.PI/2));for(ap=0,R=aj.length;ap<R;ap++){w=P(aj[ap],an[ap],ah);ab(w.x,w.y,-Z)}for(aq=0,ar=I.length;aq<ar;aq++){aw=I[aq];ac=Q[aq];for(ap=0,R=aw.length;ap<R;ap++){w=P(aw[ap],ac[ap],ah);ab(w.x,w.y,-Z)}}}ah=O;for(ap=0;ap<ai;ap++){w=a?P(d[ap],e[ap],ah):d[ap];if(!u){ab(w.x,w.y,0)}else{ae.copy(x.normals[0]).multiplyScalar(w.x);aa.copy(x.binormals[0]).multiplyScalar(w.y);at.copy(S[0]).addSelf(ae).addSelf(aa);ab(at.x,at.y,at.z)}}var af;for(af=1;af<=X;af++){for(ap=0;ap<ai;ap++){w=a?P(d[ap],e[ap],ah):d[ap];if(!u){ab(w.x,w.y,g/X*af)}else{ae.copy(x.normals[af]).multiplyScalar(w.x);aa.copy(x.binormals[af]).multiplyScalar(w.y);at.copy(S[af]).addSelf(ae).addSelf(aa);ab(at.x,at.y,at.z)}}}for(av=B-1;av>=0;av--){ad=av/B;Z=f*(1-ad);ah=O*Math.sin(ad*Math.PI/2);for(ap=0,R=aj.length;ap<R;ap++){w=P(aj[ap],an[ap],ah);ab(w.x,w.y,g+Z)}for(aq=0,ar=I.length;aq<ar;aq++){aw=I[aq];ac=Q[aq];for(ap=0,R=aw.length;ap<R;ap++){w=P(aw[ap],ac[ap],ah);if(!u){ab(w.x,w.y,g+Z)}else{ab(w.x,w.y+S[X-1].y,S[X-1].x+Z)}}}}L();au();function L(){if(a){var b=0;var h=ai*b;for(ap=0;ap<n;ap++){p=q[ap];m(p[2]+h,p[1]+h,p[0]+h,true)}b=X+B*2;h=ai*b;for(ap=0;ap<n;ap++){p=q[ap];m(p[0]+h,p[1]+h,p[2]+h,false)}}else{for(ap=0;ap<n;ap++){p=q[ap];m(p[2],p[1],p[0],true)}for(ap=0;ap<n;ap++){p=q[ap];m(p[0]+ai*X,p[1]+ai*X,p[2]+ai*X,false)}}}function au(){var b=0;ao(aj,b);b+=aj.length;for(aq=0,ar=I.length;aq<ar;aq++){aw=I[aq];ao(aw,b);b+=aw.length}}function ao(ay,h){var z,v;ap=ay.length;while(--ap>=0){z=ap;v=ap-1;if(v<0){v=ay.length-1}var aD=0,i=X+B*2;for(aD=0;aD<i;aD++){var ax=ai*aD;var t=ai*(aD+1);var aC=h+z+ax,aB=h+v+ax,aA=h+v+t,az=h+z+t;l(aC,aB,aA,az,ay,aD,i,z,v)}}}function ab(b,i,h){Y.vertices.push(new THREE.Vector3(b,i,h))}function m(i,h,s,k){i+=U;h+=U;s+=U;Y.faces.push(new THREE.Face3(i,h,s,null,null,ak));var j=k?D.generateBottomUV(Y,E,N,i,h,s):D.generateTopUV(Y,E,N,i,h,s);Y.faceVertexUvs[0].push(j)}function l(ax,z,t,s,h,j,ay,v,k){ax+=U;z+=U;t+=U;s+=U;Y.faces.push(new THREE.Face4(ax,z,t,s,null,null,o));var i=D.generateSideWallUV(Y,E,h,N,ax,z,t,s,j,ay,v,k);Y.faceVertexUvs[0].push(i)}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(g,h,d,k,j,i){var a=g.vertices[k].x,l=g.vertices[k].y,f=g.vertices[j].x,e=g.vertices[j].y,c=g.vertices[i].x,b=g.vertices[i].y;return[new THREE.UV(a,l),new THREE.UV(f,e),new THREE.UV(c,b)]},generateBottomUV:function(f,c,a,e,d,b){return this.generateTopUV(f,c,a,e,d,b)},generateSideWallUV:function(f,m,b,t,x,w,v,u,a,n,s,r){var k=f.vertices[x].x,i=f.vertices[x].y,g=f.vertices[x].z,q=f.vertices[w].x,p=f.vertices[w].y,o=f.vertices[w].z,e=f.vertices[v].x,d=f.vertices[v].y,c=f.vertices[v].z,l=f.vertices[u].x,j=f.vertices[u].y,h=f.vertices[u].z;if(Math.abs(i-p)<0.01){return[new THREE.UV(k,1-g),new THREE.UV(q,1-o),new THREE.UV(e,1-c),new THREE.UV(l,1-h)]}else{return[new THREE.UV(i,1-g),new THREE.UV(p,1-o),new THREE.UV(d,1-c),new THREE.UV(j,1-h)]}}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2();THREE.ExtrudeGeometry.__v2=new THREE.Vector2();THREE.ExtrudeGeometry.__v3=new THREE.Vector2();THREE.ExtrudeGeometry.__v4=new THREE.Vector2();THREE.ExtrudeGeometry.__v5=new THREE.Vector2();THREE.ExtrudeGeometry.__v6=new THREE.Vector2();THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);if(a instanceof Array===false){a=[a]}this.shapebb=a[a.length-1].getBoundingBox();this.addShapeList(a,b);this.computeCentroids();this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(b,c){for(var d=0,a=b.length;d<a;d++){this.addShape(b[d],c)}return this};THREE.ShapeGeometry.prototype.addShape=function(d,g){if(g===undefined){g={}}var p=g.material;var y=g.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:g.UVGenerator;var q=this.shapebb;var x,w,r,u;var o=this.vertices.length;var A=d.extractPoints();var h=A.shape;var k=A.holes;var n=!THREE.Shape.Utils.isClockWise(h);if(n){h=h.reverse();for(x=0,w=k.length;x<w;x++){r=k[x];if(THREE.Shape.Utils.isClockWise(r)){k[x]=r.reverse()}}n=false}var e=THREE.Shape.Utils.triangulateShape(h,k);var v=h;for(x=0,w=k.length;x<w;x++){r=k[x];h=h.concat(r)}var z,j=h.length;var m,E=e.length;var f,t=v.length;for(x=0;x<j;x++){z=h[x];this.vertices.push(new THREE.Vector3(z.x,z.y,0))}for(x=0;x<E;x++){m=e[x];var D=m[2]+o;var C=m[1]+o;var B=m[0]+o;this.faces.push(new THREE.Face3(D,C,B,null,null,p));this.faceVertexUvs[0].push(y.generateBottomUV(this,d,g,D,C,B))}};THREE.LatheGeometry=function(v,r,g){THREE.Geometry.call(this);var w=r||12;var n=g||2*Math.PI;var u=[];var f=new THREE.Matrix4().makeRotationZ(n/w);for(var l=0;l<v.length;l++){u[l]=v[l].clone();this.vertices.push(u[l])}var m,t=w+1;for(m=0;m<t;m++){for(var l=0;l<u.length;l++){u[l]=f.multiplyVector3(u[l].clone());this.vertices.push(u[l])}}for(m=0;m<w;m++){for(var h=0,e=v.length;h<e-1;h++){var s=m*e+h;var q=((m+1)%t)*e+h;var p=((m+1)%t)*e+(h+1)%e;var o=m*e+(h+1)%e;this.faces.push(new THREE.Face4(s,q,p,o));this.faceVertexUvs[0].push([new THREE.UV(1-m/w,h/e),new THREE.UV(1-(m+1)/w,h/e),new THREE.UV(1-(m+1)/w,(h+1)/e),new THREE.UV(1-m/w,(h+1)/e)])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry=function(o,m,r,n){THREE.Geometry.call(this);var g,e,h=o/2,f=m/2,q=r||1,p=n||1,s=q+1,l=p+1,B=o/q,u=m/p,A=new THREE.Vector3(0,0,1);for(e=0;e<l;e++){for(g=0;g<s;g++){var k=g*B-h;var j=e*u-f;this.vertices.push(new THREE.Vector3(k,-j,0))}}for(e=0;e<p;e++){for(g=0;g<q;g++){var z=g+s*e;var w=g+s*(e+1);var v=(g+1)+s*(e+1);var t=(g+1)+s*e;var i=new THREE.Face4(z,w,v,t);i.normal.copy(A);i.vertexNormals.push(A.clone(),A.clone(),A.clone(),A.clone());this.faces.push(i);this.faceVertexUvs[0].push([new THREE.UV(g/q,1-e/p),new THREE.UV(g/q,1-(e+1)/p),new THREE.UV((g+1)/q,1-(e+1)/p),new THREE.UV((g+1)/q,1-e/p)])}}this.computeCentroids()};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry=function(f,C,b,s,A,g,z){THREE.Geometry.call(this);f=f||50;s=s!==undefined?s:0;A=A!==undefined?A:Math.PI*2;g=g!==undefined?g:0;z=z!==undefined?z:Math.PI;var w=Math.max(3,Math.floor(C)||8);var t=Math.max(2,Math.floor(b)||6);var n,m,h=[],o=[];for(m=0;m<=t;m++){var r=[];var H=[];for(n=0;n<=w;n++){var q=n/w;var p=m/t;var E=new THREE.Vector3();E.x=-f*Math.cos(s+q*A)*Math.sin(g+p*z);E.y=f*Math.cos(g+p*z);E.z=f*Math.sin(s+q*A)*Math.sin(g+p*z);this.vertices.push(E);r.push(this.vertices.length-1);H.push(new THREE.UV(q,1-p))}h.push(r);o.push(H)}for(m=0;m<t;m++){for(n=0;n<w;n++){var e=h[m][n+1];var d=h[m][n];var c=h[m+1][n];var a=h[m+1][n+1];var l=this.vertices[e].clone().normalize();var k=this.vertices[d].clone().normalize();var j=this.vertices[c].clone().normalize();var i=this.vertices[a].clone().normalize();var G=o[m][n+1].clone();var F=o[m][n].clone();var D=o[m+1][n].clone();var B=o[m+1][n+1].clone();if(Math.abs(this.vertices[e].y)==f){this.faces.push(new THREE.Face3(e,c,a,[l,j,i]));this.faceVertexUvs[0].push([G,D,B])}else{if(Math.abs(this.vertices[c].y)==f){this.faces.push(new THREE.Face3(e,d,c,[l,k,j]));this.faceVertexUvs[0].push([G,F,D])}else{this.faces.push(new THREE.Face4(e,d,c,a,[l,k,j,i]));this.faceVertexUvs[0].push([G,F,D,B])}}}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:f}};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(b,a){var c=THREE.FontUtils.generateShapes(b,a);a.amount=a.height!==undefined?a.height:50;if(a.bevelThickness===undefined){a.bevelThickness=10}if(a.bevelSize===undefined){a.bevelSize=8}if(a.bevelEnabled===undefined){a.bevelEnabled=false}THREE.ExtrudeGeometry.call(this,c,a)};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TorusGeometry=function(g,f,q,p,h){THREE.Geometry.call(this);var e=this;this.radius=g||100;this.tube=f||40;this.segmentsR=q||8;this.segmentsT=p||6;this.arc=h||Math.PI*2;var z=new THREE.Vector3(),l=[],o=[];for(var r=0;r<=this.segmentsR;r++){for(var s=0;s<=this.segmentsT;s++){var n=s/this.segmentsT*this.arc;var m=r/this.segmentsR*Math.PI*2;z.x=this.radius*Math.cos(n);z.y=this.radius*Math.sin(n);var t=new THREE.Vector3();t.x=(this.radius+this.tube*Math.cos(m))*Math.cos(n);t.y=(this.radius+this.tube*Math.cos(m))*Math.sin(n);t.z=this.tube*Math.sin(m);this.vertices.push(t);l.push(new THREE.UV(s/this.segmentsT,r/this.segmentsR));o.push(t.clone().subSelf(z).normalize())}}for(var r=1;r<=this.segmentsR;r++){for(var s=1;s<=this.segmentsT;s++){var A=(this.segmentsT+1)*r+s-1;var y=(this.segmentsT+1)*(r-1)+s-1;var x=(this.segmentsT+1)*(r-1)+s;var w=(this.segmentsT+1)*r+s;var k=new THREE.Face4(A,y,x,w,[o[A],o[y],o[x],o[w]]);k.normal.addSelf(o[A]);k.normal.addSelf(o[y]);k.normal.addSelf(o[x]);k.normal.addSelf(o[w]);k.normal.normalize();this.faces.push(k);this.faceVertexUvs[0].push([l[A].clone(),l[y].clone(),l[x].clone(),l[w].clone()])}}this.computeCentroids()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry=function(r,o,C,A,y,x,e){THREE.Geometry.call(this);var g=this;this.radius=r||200;this.tube=o||40;this.segmentsR=C||64;this.segmentsT=A||8;this.p=y||2;this.q=x||3;this.heightScale=e||1;this.grid=new Array(this.segmentsR);var m=new THREE.Vector3();var z=new THREE.Vector3();var P=new THREE.Vector3();for(var F=0;F<this.segmentsR;++F){this.grid[F]=new Array(this.segmentsT);for(var D=0;D<this.segmentsT;++D){var w=F/this.segmentsR*2*this.p*Math.PI;var t=D/this.segmentsT*2*Math.PI;var h=G(w,t,this.q,this.p,this.radius,this.heightScale);var f=G(w+0.01,t,this.q,this.p,this.radius,this.heightScale);var l,k;m.sub(f,h);z.add(f,h);P.cross(m,z);z.cross(P,m);P.normalize();z.normalize();l=-this.tube*Math.cos(t);k=this.tube*Math.sin(t);h.x+=l*z.x+k*P.x;h.y+=l*z.y+k*P.y;h.z+=l*z.z+k*P.z;this.grid[F][D]=H(h.x,h.y,h.z)}}for(var F=0;F<this.segmentsR;++F){for(var D=0;D<this.segmentsT;++D){var s=(F+1)%this.segmentsR;var B=(D+1)%this.segmentsT;var O=this.grid[F][D];var N=this.grid[s][D];var M=this.grid[s][B];var L=this.grid[F][B];var K=new THREE.UV(F/this.segmentsR,D/this.segmentsT);var J=new THREE.UV((F+1)/this.segmentsR,D/this.segmentsT);var I=new THREE.UV((F+1)/this.segmentsR,(D+1)/this.segmentsT);var E=new THREE.UV(F/this.segmentsR,(D+1)/this.segmentsT);this.faces.push(new THREE.Face4(O,N,M,L));this.faceVertexUvs[0].push([K,J,I,E])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();function H(a,c,b){return g.vertices.push(new THREE.Vector3(a,c,b))-1}function G(U,S,q,R,Q,a){var n=Math.cos(U);var j=Math.cos(S);var T=Math.sin(U);var i=q/R*U;var p=Math.cos(i);var d=Q*(2+p)*0.5*n;var c=Q*(2+p)*T*0.5;var b=a*Q*Math.sin(i)*0.5;return new THREE.Vector3(d,c,b)}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry=function(L,h,K,k,J,r){THREE.Geometry.call(this);this.path=L;this.segments=h||64;this.radius=K||1;this.segmentsRadius=k||8;this.closed=J||false;if(r){this.debug=new THREE.Object3D()}this.grid=[];var A=this,E,I,B,e=this.segments+1,F,D,C,O,N,M,H,G,p,o,w,f=new THREE.Vector3(),Q,P,t,g,Y,X,W,V,U,T,S,R;var q=new THREE.TubeGeometry.FrenetFrames(L,h,J),s=q.tangents,n=q.normals,m=q.binormals;this.tangents=s;this.normals=n;this.binormals=m;function l(a,c,b){return A.vertices.push(new THREE.Vector3(a,c,b))-1}for(Q=0;Q<e;Q++){this.grid[Q]=[];H=Q/(e-1);w=L.getPointAt(H);E=s[Q];I=n[Q];B=m[Q];if(this.debug){this.debug.add(new THREE.ArrowHelper(E,w,K,255));this.debug.add(new THREE.ArrowHelper(I,w,K,16711680));this.debug.add(new THREE.ArrowHelper(B,w,K,65280))}for(P=0;P<this.segmentsRadius;P++){G=P/this.segmentsRadius*2*Math.PI;p=-this.radius*Math.cos(G);o=this.radius*Math.sin(G);f.copy(w);f.x+=p*I.x+o*B.x;f.y+=p*I.y+o*B.y;f.z+=p*I.z+o*B.z;this.grid[Q][P]=l(f.x,f.y,f.z)}}for(Q=0;Q<this.segments;Q++){for(P=0;P<this.segmentsRadius;P++){t=(J)?(Q+1)%this.segments:Q+1;g=(P+1)%this.segmentsRadius;Y=this.grid[Q][P];X=this.grid[t][P];W=this.grid[t][g];V=this.grid[Q][g];U=new THREE.UV(Q/this.segments,P/this.segmentsRadius);T=new THREE.UV((Q+1)/this.segments,P/this.segmentsRadius);S=new THREE.UV((Q+1)/this.segments,(P+1)/this.segmentsRadius);R=new THREE.UV(Q/this.segments,(P+1)/this.segmentsRadius);this.faces.push(new THREE.Face4(Y,X,W,V));this.faceVertexUvs[0].push([U,T,S,R])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.FrenetFrames=function(o,r,c){var f=new THREE.Vector3(),z=new THREE.Vector3(),p=new THREE.Vector3(),q=[],n=[],d=[],m=new THREE.Vector3(),t=new THREE.Matrix4(),b=r+1,e,A=0.0001,a,y,x,w,s,j,g;this.tangents=q;this.normals=n;this.binormals=d;for(s=0;s<b;s++){j=s/(b-1);q[s]=o.getTangentAt(j);q[s].normalize()}h();function l(i){n[0]=new THREE.Vector3();d[0]=new THREE.Vector3();if(i===undefined){i=new THREE.Vector3(0,0,1)}n[0].cross(i,q[0]).normalize();d[0].cross(q[0],n[0]).normalize()}function k(){var i=o.getTangentAt(A);n[0]=new THREE.Vector3().sub(i,q[0]).normalize();d[0]=new THREE.Vector3().cross(q[0],n[0]);n[0].cross(d[0],q[0]).normalize();d[0].cross(q[0],n[0]).normalize()}function h(){n[0]=new THREE.Vector3();d[0]=new THREE.Vector3();a=Number.MAX_VALUE;y=Math.abs(q[0].x);x=Math.abs(q[0].y);w=Math.abs(q[0].z);if(y<=a){a=y;z.set(1,0,0)}if(x<=a){a=x;z.set(0,1,0)}if(w<=a){z.set(0,0,1)}m.cross(q[0],z).normalize();n[0].cross(q[0],m);d[0].cross(q[0],n[0])}for(s=1;s<b;s++){n[s]=n[s-1].clone();d[s]=d[s-1].clone();m.cross(q[s-1],q[s]);if(m.length()>A){m.normalize();e=Math.acos(q[s-1].dot(q[s]));t.makeRotationAxis(m,e).multiplyVector3(n[s])}d[s].cross(q[s],n[s])}if(c){e=Math.acos(n[0].dot(n[b-1]));e/=(b-1);if(q[0].dot(m.cross(n[0],n[b-1]))>0){e=-e}for(s=1;s<b;s++){t.makeRotationAxis(q[s],e*s).multiplyVector3(n[s]);d[s].cross(q[s],n[s])}}};THREE.PolyhedronGeometry=function(m,d,k,h){THREE.Geometry.call(this);k=k||1;h=h||0;var j=this;for(var f=0,e=m.length;f<e;f++){o(new THREE.Vector3(m[f][0],m[f][1],m[f][2]))}var g=[],c=this.vertices;for(var f=0,e=d.length;f<e;f++){b(c[d[f][0]],c[d[f][1]],c[d[f][2]],h)}this.mergeVertices();for(var f=0,e=this.vertices.length;f<e;f++){this.vertices[f].multiplyScalar(k)}function o(i){var s=i.normalize().clone();s.index=j.vertices.push(s)-1;var p=r(i)/2/Math.PI+0.5;var l=n(i)/Math.PI+0.5;s.uv=new THREE.UV(p,1-l);return s}function b(u,t,s,l){if(l<1){var p=new THREE.Face3(u.index,t.index,s.index,[u.clone(),t.clone(),s.clone()]);p.centroid.addSelf(u).addSelf(t).addSelf(s).divideScalar(3);p.normal=p.centroid.clone().normalize();j.faces.push(p);var i=r(p.centroid);j.faceVertexUvs[0].push([a(u.uv,u,i),a(t.uv,t,i),a(s.uv,s,i)])}else{l-=1;b(u,q(u,t),q(u,s),l);b(q(u,t),t,q(t,s),l);b(q(u,s),q(t,s),s,l);b(q(u,t),q(t,s),q(u,s),l)}}function q(p,l){if(!g[p.index]){g[p.index]=[]}if(!g[l.index]){g[l.index]=[]}var i=g[p.index][l.index];if(i===undefined){g[p.index][l.index]=g[l.index][p.index]=i=o(new THREE.Vector3().add(p,l).divideScalar(2))}return i}function r(i){return Math.atan2(i.z,-i.x)}function n(i){return Math.atan2(-i.y,Math.sqrt((i.x*i.x)+(i.z*i.z)))}function a(l,i,p){if((p<0)&&(l.u===1)){l=new THREE.UV(l.u-1,l.v)}if((i.x===0)&&(i.z===0)){l=new THREE.UV(p/2/Math.PI+0.5,l.v)}return l}this.computeCentroids();this.boundingSphere={radius:k}};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry=function(b,e){var d=(1+Math.sqrt(5))/2;var c=[[-1,d,0],[1,d,0],[-1,-d,0],[1,-d,0],[0,-1,d],[0,1,d],[0,-1,-d],[0,1,-d],[d,0,-1],[d,0,1],[-d,0,-1],[-d,0,1]];var a=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];THREE.PolyhedronGeometry.call(this,c,a,b,e)};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry=function(b,d){var c=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]];var a=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];THREE.PolyhedronGeometry.call(this,c,a,b,d)};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(b,d){var c=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]];var a=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];THREE.PolyhedronGeometry.call(this,c,a,b,d)};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry=function(g,f,B,w){THREE.Geometry.call(this);var F=this.vertices;var e=this.faces;var k=this.faceVertexUvs[0];w=(w===undefined)?false:w;var s,h,q,o;var m,l;var n=B+1;var E=f+1;for(s=0;s<=B;s++){l=s/B;for(q=0;q<=f;q++){m=q/f;o=g(m,l);F.push(o)}}var D,C,A,z;var y,x,t,r;for(s=0;s<B;s++){for(q=0;q<f;q++){D=s*E+q;C=s*E+q+1;A=(s+1)*E+q;z=(s+1)*E+q+1;y=new THREE.UV(q/f,s/B);x=new THREE.UV((q+1)/f,s/B);t=new THREE.UV(q/f,(s+1)/B);r=new THREE.UV((q+1)/f,(s+1)/B);if(w){e.push(new THREE.Face3(D,C,A));e.push(new THREE.Face3(C,z,A));k.push([y,x,t]);k.push([x,r,t])}else{e.push(new THREE.Face4(D,C,z,A));k.push([y,x,r,t])}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ConvexGeometry=function(k){THREE.Geometry.call(this);var d=[[0,1,2],[0,2,1]];for(var g=3;g<k.length;g++){b(g)}function b(v){var s=k[v].clone();var r=s.length();s.x+=r*n();s.y+=r*n();s.z+=r*n();var i=[];for(var t=0;t<d.length;){var w=d[t];if(e(w,s)){for(var u=0;u<3;u++){var p=[w[u],w[(u+1)%3]];var j=true;for(var q=0;q<i.length;q++){if(o(i[q],p)){i[q]=i[i.length-1];i.pop();j=false;break}}if(j){i.push(p)}}d[t]=d[d.length-1];d.pop()}else{t++}}for(var q=0;q<i.length;q++){d.push([i[q][0],i[q][1],v])}}function e(r,q){var p=k[r[0]];var j=k[r[1]];var i=k[r[2]];var t=h(p,j,i);var s=t.dot(p);return t.dot(q)>=s}function h(q,p,j){var i=new THREE.Vector3();var r=new THREE.Vector3();i.sub(j,p);r.sub(q,p);i.crossSelf(r);if(!i.isZero()){i.normalize()}return i}function o(j,i){return j[0]===i[1]&&j[1]===i[0]}function n(){return(Math.random()-0.5)*2*0.000001}function m(j){var i=j.length();return new THREE.UV(j.x/i,j.y/i)}var a=0;var c=new Array(k.length);for(var g=0;g<d.length;g++){var l=d[g];for(var f=0;f<3;f++){if(c[l[f]]===undefined){c[l[f]]=a++;this.vertices.push(k[l[f]])}l[f]=c[l[f]]}}for(var g=0;g<d.length;g++){this.faces.push(new THREE.Face3(d[g][0],d[g][1],d[g][2]))}for(var g=0;g<this.faces.length;g++){var l=this.faces[g];this.faceVertexUvs[0].push([m(this.vertices[l.a]),m(this.vertices[l.b]),m(this.vertices[l.c])])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.AxisHelper=function(){THREE.Object3D.call(this);var b=new THREE.Geometry();b.vertices.push(new THREE.Vector3());b.vertices.push(new THREE.Vector3(0,100,0));var d=new THREE.CylinderGeometry(0,5,25,5,1);var a,c;a=new THREE.Line(b,new THREE.LineBasicMaterial({color:16711680}));a.rotation.z=-Math.PI/2;this.add(a);c=new THREE.Mesh(d,new THREE.MeshBasicMaterial({color:16711680}));c.position.x=100;c.rotation.z=-Math.PI/2;this.add(c);a=new THREE.Line(b,new THREE.LineBasicMaterial({color:65280}));this.add(a);c=new THREE.Mesh(d,new THREE.MeshBasicMaterial({color:65280}));c.position.y=100;this.add(c);a=new THREE.Line(b,new THREE.LineBasicMaterial({color:255}));a.rotation.x=Math.PI/2;this.add(a);c=new THREE.Mesh(d,new THREE.MeshBasicMaterial({color:255}));c.position.z=100;c.rotation.x=Math.PI/2;this.add(c)};THREE.AxisHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper=function(c,b,f,e){THREE.Object3D.call(this);if(e===undefined){e=16776960}if(f===undefined){f=20}var a=new THREE.Geometry();a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(0,1,0));this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:e}));this.add(this.line);var d=new THREE.CylinderGeometry(0,0.05,0.25,5,1);this.cone=new THREE.Mesh(d,new THREE.MeshBasicMaterial({color:e}));this.cone.position.set(0,1,0);this.add(this.cone);if(b instanceof THREE.Vector3){this.position=b}this.setDirection(c);this.setLength(f)};THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(a){var b=new THREE.Vector3(0,1,0).crossSelf(a);var c=Math.acos(new THREE.Vector3(0,1,0).dot(a.clone().normalize()));this.matrix=new THREE.Matrix4().makeRotationAxis(b.normalize(),c);this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)};THREE.ArrowHelper.prototype.setLength=function(a){this.scale.set(a,a,a)};THREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.setHex(a);this.cone.material.color.setHex(a)};THREE.CameraHelper=function(e){THREE.Line.call(this);var g=this;this.geometry=new THREE.Geometry();this.material=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});this.type=THREE.LinePieces;this.matrixWorld=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap={};var d=16755200;var i=16711680;var b=43775;var f=16777215;var c=3355443;h("n1","n2",d);h("n2","n4",d);h("n4","n3",d);h("n3","n1",d);h("f1","f2",d);h("f2","f4",d);h("f4","f3",d);h("f3","f1",d);h("n1","f1",d);h("n2","f2",d);h("n3","f3",d);h("n4","f4",d);h("p","n1",i);h("p","n2",i);h("p","n3",i);h("p","n4",i);h("u1","u2",b);h("u2","u3",b);h("u3","u1",b);h("c","t",f);h("p","c",c);h("cn1","cn2",c);h("cn3","cn4",c);h("cf1","cf2",c);h("cf3","cf4",c);this.camera=e;function h(k,j,l){a(k,l);a(j,l)}function a(k,j){g.geometry.vertices.push(new THREE.Vector3());g.geometry.colors.push(new THREE.Color(j));if(g.pointMap[k]===undefined){g.pointMap[k]=[]}g.pointMap[k].push(g.geometry.vertices.length-1)}this.update(e)};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.update=function(){var d=this;var a=1,c=1;THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix);b("c",0,0,-1);b("t",0,0,1);b("n1",-a,-c,-1);b("n2",a,-c,-1);b("n3",-a,c,-1);b("n4",a,c,-1);b("f1",-a,-c,1);b("f2",a,-c,1);b("f3",-a,c,1);b("f4",a,c,1);b("u1",a*0.7,c*1.1,-1);b("u2",-a*0.7,c*1.1,-1);b("u3",0,c*2,-1);b("cf1",-a,0,1);b("cf2",a,0,1);b("cf3",0,-c,1);b("cf4",0,c,1);b("cn1",-a,0,-1);b("cn2",a,0,-1);b("cn3",0,-c,-1);b("cn4",0,c,-1);function b(f,e,l,k){THREE.CameraHelper.__v.set(e,l,k);THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v,THREE.CameraHelper.__c);var j=d.pointMap[f];if(j!==undefined){for(var h=0,g=j.length;h<g;h++){d.geometry.vertices[j[h]].copy(THREE.CameraHelper.__v)}}}this.geometry.verticesNeedUpdate=true};THREE.CameraHelper.__projector=new THREE.Projector();THREE.CameraHelper.__v=new THREE.Vector3();THREE.CameraHelper.__c=new THREE.Camera();THREE.SubdivisionModifier=function(a){this.subdivisions=(a===undefined)?1:a;this.useOldVertexColors=false;this.supportUVs=true;this.debug=false};THREE.SubdivisionModifier.prototype.modify=function(b){var a=this.subdivisions;while(a-->0){this.smooth(b)}};THREE.SubdivisionModifier.prototype.smooth=function(E){var s=[],D=[],ap=[];function ah(f,j,i){s.push(new THREE.Vector3(f,j,i))}var Z=this;function P(){if(Z.debug){console.log.apply(console,arguments)}}function w(){if(console){console.log.apply(console,arguments)}}function l(aI,aH,aE,aD,aF,v,aC){var f=new THREE.Face4(aI,aH,aE,aD,null,aF.color,aF.materialIndex);if(Z.useOldVertexColors){f.vertexColors=[];var u,aG,n;for(var aB=0;aB<4;aB++){n=v[aB];u=new THREE.Color(),u.setRGB(0,0,0);for(var R=0,aA=0;R<n.length;R++){aG=aF.vertexColors[n[R]-1];u.r+=aG.r;u.g+=aG.g;u.b+=aG.b}u.r/=n.length;u.g/=n.length;u.b/=n.length;f.vertexColors[aB]=u}}D.push(f);if(Z.supportUVs){var F=[o(aI,""),o(aH,aC),o(aE,aC),o(aD,aC)];if(!F[0]){P("a :( ",aI+":"+aC)}else{if(!F[1]){P("b :( ",aH+":"+aC)}else{if(!F[2]){P("c :( ",aE+":"+aC)}else{if(!F[3]){P("d :( ",aD+":"+aC)}else{ap.push(F)}}}}}}function c(i,f){return Math.min(i,f)+"_"+Math.max(i,f)}function J(aC){var R,aE,aG,aD,v,u,aB,aA,aF,f,F,aH={};function n(aI,j){if(aH[aI]===undefined){aH[aI]=[]}aH[aI].push(j)}for(R=0,aE=aC.faces.length;R<aE;R++){aB=aC.faces[R];if(aB instanceof THREE.Face3){F=c(aB.a,aB.b);n(F,R);F=c(aB.b,aB.c);n(F,R);F=c(aB.c,aB.a);n(F,R)}else{if(aB instanceof THREE.Face4){F=c(aB.a,aB.b);n(F,R);F=c(aB.b,aB.c);n(F,R);F=c(aB.c,aB.d);n(F,R);F=c(aB.d,aB.a);n(F,R)}}}return aH}var k=E.vertices;var al=E.faces;var y=k.concat();var ac=[],d={};var ay={},ax=[],av=[];var G={};var H=k.length;function o(F,f){var i,u;var n=F+":"+f;var v=G[n];if(!v){if(F>=H&&F<(H+al.length)){P("face pt")}else{P("edge pt")}w("warning, UV not found for",n);return null}return v}function C(n,f,j){var i=n+":"+f;if(!(i in G)){G[i]=j}else{w("dup vertexNo",n,"oldFaceNo",f,"value",j,"key",i,G[i])}}var au,W,at,z,A;var ae=E.faceVertexUvs[0];var e="abcd",I;P("originalFaces, uvs, originalVerticesLength",al.length,ae.length,H);if(Z.supportUVs){for(au=0,W=ae.length;au<W;au++){for(at=0,z=ae[au].length;at<z;at++){I=al[au][e.charAt(at)];C(I,au,ae[au][at])}}}if(ae.length==0){Z.supportUVs=false}var ag=0;for(var ai in G){ag++}if(!ag){Z.supportUVs=false;P("no uvs")}P("-- Original Faces + Vertices UVs completed",G,"vs",ae.length);var az;for(au=0,W=al.length;au<W;au++){A=al[au];ac.push(A.centroid);y.push(A.centroid);if(!Z.supportUVs){continue}az=new THREE.UV();if(A instanceof THREE.Face3){az.u=o(A.a,au).u+o(A.b,au).u+o(A.c,au).u;az.v=o(A.a,au).v+o(A.b,au).v+o(A.c,au).v;az.u/=3;az.v/=3}else{if(A instanceof THREE.Face4){az.u=o(A.a,au).u+o(A.b,au).u+o(A.c,au).u+o(A.d,au).u;az.v=o(A.a,au).v+o(A.b,au).v+o(A.c,au).v+o(A.d,au).v;az.u/=4;az.v/=4}}C(H+au,"",az)}P("-- added UVs for new Faces",G);var Q=J(E);var p,V,T,m;var am=0;var ak,ar,aq;var ad={};var x={};function Y(i,f){if(ad[i]===undefined){ad[i]=[]}ad[i].push(f)}function h(j,i,f){if(x[j]===undefined){x[j]={}}x[j][i]=f}for(au in Q){p=Q[au];ak=au.split("_");ar=ak[0];aq=ak[1];Y(ar,[ar,aq]);Y(aq,[ar,aq]);for(at=0,z=p.length;at<z;at++){A=p[at];h(ar,A,au);h(aq,A,au)}if(p.length<2){ay[au]=true;ax[ar]=true;ax[aq]=true}}P("vertexEdgeMap",ad,"vertexFaceMap",x);for(au in Q){p=Q[au];V=p[0];T=p[1];ak=au.split("_");ar=ak[0];aq=ak[1];m=new THREE.Vector3();if(ay[au]){m.addSelf(k[ar]);m.addSelf(k[aq]);m.multiplyScalar(0.5);ax[y.length]=true}else{m.addSelf(ac[V]);m.addSelf(ac[T]);m.addSelf(k[ar]);m.addSelf(k[aq]);m.multiplyScalar(0.25)}d[au]=H+al.length+am;y.push(m);am++;if(!Z.supportUVs){continue}az=new THREE.UV();az.u=o(ar,V).u+o(aq,V).u;az.v=o(ar,V).v+o(aq,V).v;az.u/=2;az.v/=2;C(d[au],V,az);if(!ay[au]){az=new THREE.UV();az.u=o(ar,T).u+o(aq,T).u;az.v=o(ar,T).v+o(aq,T).v;az.u/=2;az.v/=2;C(d[au],T,az)}}P("-- Step 2 done");var ab,U;var M,a,aa,N,af;var K=["123","12","2","23"];var aj=["123","23","3","31"];var r=["123","31","1","12"];var ao=["1234","12","2","23"];var b=["1234","23","3","34"];var O=["1234","34","4","41"];var X=["1234","41","1","12"];for(au=0,W=ac.length;au<W;au++){ab=ac[au];A=al[au];U=H+au;if(A instanceof THREE.Face3){M=c(A.a,A.b);a=c(A.b,A.c);af=c(A.c,A.a);l(U,d[M],A.b,d[a],A,K,au);l(U,d[a],A.c,d[af],A,aj,au);l(U,d[af],A.a,d[M],A,r,au)}else{if(A instanceof THREE.Face4){M=c(A.a,A.b);a=c(A.b,A.c);aa=c(A.c,A.d);N=c(A.d,A.a);l(U,d[M],A.b,d[a],A,ao,au);l(U,d[a],A.c,d[aa],A,b,au);l(U,d[aa],A.d,d[N],A,O,au);l(U,d[N],A.a,d[M],A,X,au)}else{P("face should be a face!",A)}}}s=y;var t=new THREE.Vector3();var g=new THREE.Vector3();var an;for(au=0,W=k.length;au<W;au++){if(ad[au]===undefined){continue}t.set(0,0,0);g.set(0,0,0);var B=new THREE.Vector3(0,0,0);var aw=0;for(at in x[au]){t.addSelf(ac[at]);aw++}var q=0;an=ad[au].length;for(at=0;at<an;at++){if(ay[c(ad[au][at][0],ad[au][at][1])]){q++}}if(q==2){continue}t.divideScalar(aw);for(at=0;at<an;at++){p=ad[au][at];var L=k[p[0]].clone().addSelf(k[p[1]]).divideScalar(2);g.addSelf(L)}g.divideScalar(an);B.addSelf(k[au]);B.multiplyScalar(an-3);B.addSelf(t);B.addSelf(g.multiplyScalar(2));B.divideScalar(an);s[au]=B}var S=E;S.vertices=s;S.faces=D;S.faceVertexUvs[0]=ap;delete S.__tmpVertices;S.computeCentroids();S.computeFaceNormals();S.computeVertexNormals()};THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(a){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare=function(d,b,e,c,a){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3();this.customUpdateCallback=undefined;if(d!==undefined){this.add(d,b,e,c,a)}};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.add=function(e,c,f,d,a,b){if(c===undefined){c=-1}if(f===undefined){f=0}if(b===undefined){b=1}if(a===undefined){a=new THREE.Color(16777215)}if(d===undefined){d=THREE.NormalBlending}f=Math.min(f,Math.max(0,f));this.lensFlares.push({texture:e,size:c,distance:f,x:0,y:0,z:0,scale:1,rotation:1,opacity:b,color:a,blending:d})};THREE.LensFlare.prototype.updateLensFlares=function(){var d,c=this.lensFlares.length;var b;var a=-this.positionScreen.x*2;var e=-this.positionScreen.y*2;for(d=0;d<c;d++){b=this.lensFlares[d];b.x=this.positionScreen.x+a*b.distance;b.y=this.positionScreen.y+e*b.distance;b.wantedRotation=b.x*Math.PI*0.25;b.rotation+=(b.wantedRotation-b.rotation)*0.25}};THREE.MorphBlendMesh=function(g,d){THREE.Mesh.call(this,g,d);this.animationsMap={};this.animationsList=[];var f=this.geometry.morphTargets.length;var b="__default";var c=0;var a=f-1;var e=f/1;this.createAnimation(b,c,a,e);this.setAnimationWeight(b,1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.createAnimation=function(b,e,a,d){var c={startFrame:e,endFrame:a,length:a-e+1,fps:d,duration:(a-e)/d,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[b]=c;this.animationsList.push(c)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(c){var j=/([a-z]+)(\d+)/;var b,g={};var k=this.geometry;for(var d=0,l=k.morphTargets.length;d<l;d++){var m=k.morphTargets[d];var h=m.name.match(j);if(h&&h.length>1){var a=h[1];var f=h[2];if(!g[a]){g[a]={start:Infinity,end:-Infinity}}var e=g[a];if(d<e.start){e.start=d}if(d>e.end){e.end=d}if(!b){b=a}}}for(var a in g){var e=g[a];this.createAnimation(a,e.start,e.end,c)}this.firstAnimation=b};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){var b=this.animationsMap[a];if(b){b.direction=1;b.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){var b=this.animationsMap[a];if(b){b.direction=-1;b.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,c){var b=this.animationsMap[a];if(b){b.fps=c;b.duration=(b.end-b.start)/b.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,c){var b=this.animationsMap[a];if(b){b.duration=c;b.fps=(b.end-b.start)/b.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,c){var b=this.animationsMap[a];if(b){b.weight=c}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,c){var b=this.animationsMap[a];if(b){b.time=c}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var c=0;var b=this.animationsMap[a];if(b){c=b.time}return c};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var c=-1;var b=this.animationsMap[a];if(b){c=b.duration}return c};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];if(b){b.time=0;b.active=true}else{console.warn("animation["+a+"] undefined")}};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){var b=this.animationsMap[a];if(b){b.active=false}};THREE.MorphBlendMesh.prototype.update=function(h){for(var c=0,a=this.animationsList.length;c<a;c++){var g=this.animationsList[c];if(!g.active){continue}var e=g.duration/g.length;g.time+=g.direction*h;if(g.mirroredLoop){if(g.time>g.duration||g.time<0){g.direction*=-1;if(g.time>g.duration){g.time=g.duration;g.directionBackwards=true}if(g.time<0){g.time=0;g.directionBackwards=false}}}else{g.time=g.time%g.duration;if(g.time<0){g.time+=g.duration}}var b=g.startFrame+THREE.Math.clamp(Math.floor(g.time/e),0,g.length-1);var f=g.weight;if(b!==g.currentFrame){this.morphTargetInfluences[g.lastFrame]=0;this.morphTargetInfluences[g.currentFrame]=1*f;this.morphTargetInfluences[b]=0;g.lastFrame=g.currentFrame;g.currentFrame=b}var d=(g.time%e)/e;if(g.directionBackwards){d=1-d}this.morphTargetInfluences[g.currentFrame]=d*f;this.morphTargetInfluences[g.lastFrame]=(1-d)*f}};THREE.LensFlarePlugin=function(){var b,c,d={};this.init=function(f){b=f.context;c=f;d.vertices=new Float32Array(8+8);d.faces=new Uint16Array(6);var e=0;d.vertices[e++]=-1;d.vertices[e++]=-1;d.vertices[e++]=0;d.vertices[e++]=0;d.vertices[e++]=1;d.vertices[e++]=-1;d.vertices[e++]=1;d.vertices[e++]=0;d.vertices[e++]=1;d.vertices[e++]=1;d.vertices[e++]=1;d.vertices[e++]=1;d.vertices[e++]=-1;d.vertices[e++]=1;d.vertices[e++]=0;d.vertices[e++]=1;e=0;d.faces[e++]=0;d.faces[e++]=1;d.faces[e++]=2;d.faces[e++]=0;d.faces[e++]=2;d.faces[e++]=3;d.vertexBuffer=b.createBuffer();d.elementBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,d.vertexBuffer);b.bufferData(b.ARRAY_BUFFER,d.vertices,b.STATIC_DRAW);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d.elementBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,d.faces,b.STATIC_DRAW);d.tempTexture=b.createTexture();d.occlusionTexture=b.createTexture();b.bindTexture(b.TEXTURE_2D,d.tempTexture);b.texImage2D(b.TEXTURE_2D,0,b.RGB,16,16,0,b.RGB,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);b.bindTexture(b.TEXTURE_2D,d.occlusionTexture);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,16,16,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST);if(b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){d.hasVertexTexture=false;d.program=a(THREE.ShaderFlares.lensFlare)}else{d.hasVertexTexture=true;d.program=a(THREE.ShaderFlares.lensFlareVertexTexture)}d.attributes={};d.uniforms={};d.attributes.vertex=b.getAttribLocation(d.program,"position");d.attributes.uv=b.getAttribLocation(d.program,"uv");d.uniforms.renderType=b.getUniformLocation(d.program,"renderType");d.uniforms.map=b.getUniformLocation(d.program,"map");d.uniforms.occlusionMap=b.getUniformLocation(d.program,"occlusionMap");d.uniforms.opacity=b.getUniformLocation(d.program,"opacity");d.uniforms.color=b.getUniformLocation(d.program,"color");d.uniforms.scale=b.getUniformLocation(d.program,"scale");d.uniforms.rotation=b.getUniformLocation(d.program,"rotation");d.uniforms.screenPosition=b.getUniformLocation(d.program,"screenPosition");d.attributesEnabled=false};this.render=function(x,u,q,e){var m=x.__webglFlares,z=m.length;if(!z){return}var v=new THREE.Vector3();var g=e/q,w=q*0.5,p=e*0.5;var n=16/e,A=new THREE.Vector2(n*g,n);var l=new THREE.Vector3(1,1,0),k=new THREE.Vector2(1,1);var y=d.uniforms,h=d.attributes;b.useProgram(d.program);if(!d.attributesEnabled){b.enableVertexAttribArray(d.attributes.vertex);b.enableVertexAttribArray(d.attributes.uv);d.attributesEnabled=true}b.uniform1i(y.occlusionMap,0);b.uniform1i(y.map,1);b.bindBuffer(b.ARRAY_BUFFER,d.vertexBuffer);b.vertexAttribPointer(h.vertex,2,b.FLOAT,false,2*8,0);b.vertexAttribPointer(h.uv,2,b.FLOAT,false,2*8,8);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,d.elementBuffer);b.disable(b.CULL_FACE);b.depthMask(false);var s,r,t,f,o;for(s=0;s<z;s++){n=16/e;A.set(n*g,n);f=m[s];v.set(f.matrixWorld.elements[12],f.matrixWorld.elements[13],f.matrixWorld.elements[14]);u.matrixWorldInverse.multiplyVector3(v);u.projectionMatrix.multiplyVector3(v);l.copy(v);k.x=l.x*w+w;k.y=l.y*p+p;if(d.hasVertexTexture||(k.x>0&&k.x<q&&k.y>0&&k.y<e)){b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,d.tempTexture);b.copyTexImage2D(b.TEXTURE_2D,0,b.RGB,k.x-8,k.y-8,16,16,0);b.uniform1i(y.renderType,0);b.uniform2f(y.scale,A.x,A.y);b.uniform3f(y.screenPosition,l.x,l.y,l.z);b.disable(b.BLEND);b.enable(b.DEPTH_TEST);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,d.occlusionTexture);b.copyTexImage2D(b.TEXTURE_2D,0,b.RGBA,k.x-8,k.y-8,16,16,0);b.uniform1i(y.renderType,1);b.disable(b.DEPTH_TEST);b.activeTexture(b.TEXTURE1);b.bindTexture(b.TEXTURE_2D,d.tempTexture);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0);f.positionScreen.copy(l);if(f.customUpdateCallback){f.customUpdateCallback(f)}else{f.updateLensFlares()}b.uniform1i(y.renderType,2);b.enable(b.BLEND);for(r=0,t=f.lensFlares.length;r<t;r++){o=f.lensFlares[r];if(o.opacity>0.001&&o.scale>0.001){l.x=o.x;l.y=o.y;l.z=o.z;n=o.size*o.scale/e;A.x=n*g;A.y=n;b.uniform3f(y.screenPosition,l.x,l.y,l.z);b.uniform2f(y.scale,A.x,A.y);b.uniform1f(y.rotation,o.rotation);b.uniform1f(y.opacity,o.opacity);b.uniform3f(y.color,o.color.r,o.color.g,o.color.b);c.setBlending(o.blending,o.blendEquation,o.blendSrc,o.blendDst);c.setTexture(o.texture,1);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0)}}}}b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST);b.depthMask(true)};function a(g){var f=b.createProgram();var e=b.createShader(b.FRAGMENT_SHADER);var h=b.createShader(b.VERTEX_SHADER);b.shaderSource(e,g.fragmentShader);b.shaderSource(h,g.vertexShader);b.compileShader(e);b.compileShader(h);b.attachShader(f,e);b.attachShader(f,h);b.linkProgram(f);return f}};THREE.ShadowMapPlugin=function(){var a,i,l,e,b,j,k=new THREE.Frustum(),c=new THREE.Matrix4(),g=new THREE.Vector3(),m=new THREE.Vector3();this.init=function(p){a=p.context;i=p;var n=THREE.ShaderLib.depthRGBA;var o=THREE.UniformsUtils.clone(n.uniforms);l=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o});e=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o,morphTargets:true});b=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o,skinning:true});j=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:o,morphTargets:true,skinning:true});l._shadowPass=true;e._shadowPass=true;b._shadowPass=true;j._shadowPass=true};this.render=function(o,n){if(!(i.shadowMapEnabled&&i.shadowMapAutoUpdate)){return}this.update(o,n)};this.update=function(I,G){var F,v,E,H,z,r,J,L,u,D,x,p,M,t,w,K=[],C=0,o=null;a.clearColor(1,1,1,1);a.disable(a.BLEND);a.enable(a.CULL_FACE);a.frontFace(a.CCW);if(i.shadowMapCullFrontFaces){a.cullFace(a.FRONT)}else{a.cullFace(a.BACK)}i.setDepthTest(true);for(F=0,v=I.__lights.length;F<v;F++){t=I.__lights[F];if(!t.castShadow){continue}if((t instanceof THREE.DirectionalLight)&&t.shadowCascade){for(z=0;z<t.shadowCascadeCount;z++){var s;if(!t.shadowCascadeArray[z]){s=d(t,z);s.originalCamera=G;var B=new THREE.Gyroscope();B.position=t.shadowCascadeOffset;B.add(s);B.add(s.target);G.add(B);t.shadowCascadeArray[z]=s;console.log("Created virtualLight",s)}else{s=t.shadowCascadeArray[z]}f(t,z);K[C]=s;C++}}else{K[C]=t;C++}}for(F=0,v=K.length;F<v;F++){t=K[F];if(!t.shadowMap){var A={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat};t.shadowMap=new THREE.WebGLRenderTarget(t.shadowMapWidth,t.shadowMapHeight,A);t.shadowMapSize=new THREE.Vector2(t.shadowMapWidth,t.shadowMapHeight);t.shadowMatrix=new THREE.Matrix4()}if(!t.shadowCamera){if(t instanceof THREE.SpotLight){t.shadowCamera=new THREE.PerspectiveCamera(t.shadowCameraFov,t.shadowMapWidth/t.shadowMapHeight,t.shadowCameraNear,t.shadowCameraFar)}else{if(t instanceof THREE.DirectionalLight){t.shadowCamera=new THREE.OrthographicCamera(t.shadowCameraLeft,t.shadowCameraRight,t.shadowCameraTop,t.shadowCameraBottom,t.shadowCameraNear,t.shadowCameraFar)}else{console.error("Unsupported light type for shadow");continue}}I.add(t.shadowCamera);if(i.autoUpdateScene){I.updateMatrixWorld()}}if(t.shadowCameraVisible&&!t.cameraHelper){t.cameraHelper=new THREE.CameraHelper(t.shadowCamera);t.shadowCamera.add(t.cameraHelper)}if(t.isVirtual&&s.originalCamera==G){h(G,t)}r=t.shadowMap;J=t.shadowMatrix;L=t.shadowCamera;L.position.copy(t.matrixWorld.getPosition());L.lookAt(t.target.matrixWorld.getPosition());L.updateMatrixWorld();L.matrixWorldInverse.getInverse(L.matrixWorld);if(t.cameraHelper){t.cameraHelper.visible=t.shadowCameraVisible}if(t.shadowCameraVisible){t.cameraHelper.update()}J.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);J.multiplySelf(L.projectionMatrix);J.multiplySelf(L.matrixWorldInverse);if(!L._viewMatrixArray){L._viewMatrixArray=new Float32Array(16)}if(!L._projectionMatrixArray){L._projectionMatrixArray=new Float32Array(16)}L.matrixWorldInverse.flattenToArray(L._viewMatrixArray);L.projectionMatrix.flattenToArray(L._projectionMatrixArray);c.multiply(L.projectionMatrix,L.matrixWorldInverse);k.setFromMatrix(c);i.setRenderTarget(r);i.clear();w=I.__webglObjects;for(E=0,H=w.length;E<H;E++){p=w[E];M=p.object;p.render=false;if(M.visible&&M.castShadow){if(!(M instanceof THREE.Mesh)||!(M.frustumCulled)||k.contains(M)){M._modelViewMatrix.multiply(L.matrixWorldInverse,M.matrixWorld);p.render=true}}}for(E=0,H=w.length;E<H;E++){p=w[E];if(p.render){M=p.object;D=p.buffer;if(M.customDepthMaterial){x=M.customDepthMaterial}else{if(M instanceof THREE.SkinnedMesh){x=M.geometry.morphTargets.length?j:b}else{if(M.geometry.morphTargets.length){x=e}else{x=l}}}if(D instanceof THREE.BufferGeometry){i.renderBufferDirect(L,I.__lights,o,x,D,M)}else{i.renderBuffer(L,I.__lights,o,x,D,M)}}}w=I.__webglObjectsImmediate;for(E=0,H=w.length;E<H;E++){p=w[E];M=p.object;if(M.visible&&M.castShadow){M._modelViewMatrix.multiply(L.matrixWorldInverse,M.matrixWorld);i.renderImmediateObject(L,I.__lights,o,l,M)}}}var q=i.getClearColor(),y=i.getClearAlpha();a.clearColor(q.r,q.g,q.b,y);a.enable(a.BLEND);if(i.shadowMapCullFrontFaces){a.cullFace(a.BACK)}};function d(o,q){var n=new THREE.DirectionalLight();n.isVirtual=true;n.onlyShadow=true;n.castShadow=true;n.shadowCameraNear=o.shadowCameraNear;n.shadowCameraFar=o.shadowCameraFar;n.shadowCameraLeft=o.shadowCameraLeft;n.shadowCameraRight=o.shadowCameraRight;n.shadowCameraBottom=o.shadowCameraBottom;n.shadowCameraTop=o.shadowCameraTop;n.shadowCameraVisible=o.shadowCameraVisible;n.shadowDarkness=o.shadowDarkness;n.shadowBias=o.shadowCascadeBias[q];n.shadowMapWidth=o.shadowCascadeWidth[q];n.shadowMapHeight=o.shadowCascadeHeight[q];n.pointsWorld=[];n.pointsFrustum=[];var t=n.pointsWorld,p=n.pointsFrustum;for(var s=0;s<8;s++){t[s]=new THREE.Vector3();p[s]=new THREE.Vector3()}var u=o.shadowCascadeNearZ[q];var r=o.shadowCascadeFarZ[q];p[0].set(-1,-1,u);p[1].set(1,-1,u);p[2].set(-1,1,u);p[3].set(1,1,u);p[4].set(-1,-1,r);p[5].set(1,-1,r);p[6].set(-1,1,r);p[7].set(1,1,r);return n}function f(o,q){var n=o.shadowCascadeArray[q];n.position.copy(o.position);n.target.position.copy(o.target.position);n.lookAt(n.target);n.shadowCameraVisible=o.shadowCameraVisible;n.shadowDarkness=o.shadowDarkness;n.shadowBias=o.shadowCascadeBias[q];var s=o.shadowCascadeNearZ[q];var r=o.shadowCascadeFarZ[q];var p=n.pointsFrustum;p[0].z=s;p[1].z=s;p[2].z=s;p[3].z=s;p[4].z=r;p[5].z=r;p[6].z=r;p[7].z=r}function h(r,n){var t=n.shadowCamera,o=n.pointsFrustum,s=n.pointsWorld;g.set(Infinity,Infinity,Infinity);m.set(-Infinity,-Infinity,-Infinity);for(var q=0;q<8;q++){var u=s[q];u.copy(o[q]);THREE.ShadowMapPlugin.__projector.unprojectVector(u,r);t.matrixWorldInverse.multiplyVector3(u);if(u.x<g.x){g.x=u.x}if(u.x>m.x){m.x=u.x}if(u.y<g.y){g.y=u.y}if(u.y>m.y){m.y=u.y}if(u.z<g.z){g.z=u.z}if(u.z>m.z){m.z=u.z}}t.left=g.x;t.right=m.x;t.top=m.y;t.bottom=g.y;t.updateProjectionMatrix()}};THREE.ShadowMapPlugin.__projector=new THREE.Projector();THREE.SpritePlugin=function(){var b,d,c={};this.init=function(g){b=g.context;d=g;c.vertices=new Float32Array(8+8);c.faces=new Uint16Array(6);var f=0;c.vertices[f++]=-1;c.vertices[f++]=-1;c.vertices[f++]=0;c.vertices[f++]=0;c.vertices[f++]=1;c.vertices[f++]=-1;c.vertices[f++]=1;c.vertices[f++]=0;c.vertices[f++]=1;c.vertices[f++]=1;c.vertices[f++]=1;c.vertices[f++]=1;c.vertices[f++]=-1;c.vertices[f++]=1;c.vertices[f++]=0;c.vertices[f++]=1;f=0;c.faces[f++]=0;c.faces[f++]=1;c.faces[f++]=2;c.faces[f++]=0;c.faces[f++]=2;c.faces[f++]=3;c.vertexBuffer=b.createBuffer();c.elementBuffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c.vertexBuffer);b.bufferData(b.ARRAY_BUFFER,c.vertices,b.STATIC_DRAW);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c.elementBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,c.faces,b.STATIC_DRAW);c.program=a(THREE.ShaderSprite.sprite);c.attributes={};c.uniforms={};c.attributes.position=b.getAttribLocation(c.program,"position");c.attributes.uv=b.getAttribLocation(c.program,"uv");c.uniforms.uvOffset=b.getUniformLocation(c.program,"uvOffset");c.uniforms.uvScale=b.getUniformLocation(c.program,"uvScale");c.uniforms.rotation=b.getUniformLocation(c.program,"rotation");c.uniforms.scale=b.getUniformLocation(c.program,"scale");c.uniforms.alignment=b.getUniformLocation(c.program,"alignment");c.uniforms.color=b.getUniformLocation(c.program,"color");c.uniforms.map=b.getUniformLocation(c.program,"map");c.uniforms.opacity=b.getUniformLocation(c.program,"opacity");c.uniforms.useScreenCoordinates=b.getUniformLocation(c.program,"useScreenCoordinates");c.uniforms.affectedByDistance=b.getUniformLocation(c.program,"affectedByDistance");c.uniforms.screenPosition=b.getUniformLocation(c.program,"screenPosition");c.uniforms.modelViewMatrix=b.getUniformLocation(c.program,"modelViewMatrix");c.uniforms.projectionMatrix=b.getUniformLocation(c.program,"projectionMatrix");c.attributesEnabled=false};this.render=function(j,p,o,k){var q=j.__webglSprites,l=q.length;if(!l){return}var g=c.attributes,t=c.uniforms;var s=k/o;var n=o*0.5,r=k*0.5;var v=true;b.useProgram(c.program);if(!c.attributesEnabled){b.enableVertexAttribArray(g.position);b.enableVertexAttribArray(g.uv);c.attributesEnabled=true}b.disable(b.CULL_FACE);b.enable(b.BLEND);b.depthMask(true);b.bindBuffer(b.ARRAY_BUFFER,c.vertexBuffer);b.vertexAttribPointer(g.position,2,b.FLOAT,false,2*8,0);b.vertexAttribPointer(g.uv,2,b.FLOAT,false,2*8,8);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c.elementBuffer);b.uniformMatrix4fv(t.projectionMatrix,false,p._projectionMatrixArray);b.activeTexture(b.TEXTURE0);b.uniform1i(t.map,0);var h,u,m,w,f=[];for(h=0;h<l;h++){u=q[h];if(!u.visible||u.opacity===0){continue}if(!u.useScreenCoordinates){u._modelViewMatrix.multiply(p.matrixWorldInverse,u.matrixWorld);u.z=-u._modelViewMatrix.elements[14]}else{u.z=-u.position.z}}q.sort(e);for(h=0;h<l;h++){u=q[h];if(!u.visible||u.opacity===0){continue}if(u.map&&u.map.image&&u.map.image.width){if(u.useScreenCoordinates){b.uniform1i(t.useScreenCoordinates,1);b.uniform3f(t.screenPosition,(u.position.x-n)/n,(r-u.position.y)/r,Math.max(0,Math.min(1,u.position.z)))}else{b.uniform1i(t.useScreenCoordinates,0);b.uniform1i(t.affectedByDistance,u.affectedByDistance?1:0);b.uniformMatrix4fv(t.modelViewMatrix,false,u._modelViewMatrix.elements)}w=u.map.image.width/(u.scaleByViewport?k:1);f[0]=w*s*u.scale.x;f[1]=w*u.scale.y;b.uniform2f(t.uvScale,u.uvScale.x,u.uvScale.y);b.uniform2f(t.uvOffset,u.uvOffset.x,u.uvOffset.y);b.uniform2f(t.alignment,u.alignment.x,u.alignment.y);b.uniform1f(t.opacity,u.opacity);b.uniform3f(t.color,u.color.r,u.color.g,u.color.b);b.uniform1f(t.rotation,u.rotation);b.uniform2fv(t.scale,f);if(u.mergeWith3D&&!v){b.enable(b.DEPTH_TEST);v=true}else{if(!u.mergeWith3D&&v){b.disable(b.DEPTH_TEST);v=false}}d.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst);d.setTexture(u.map,0);b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0)}}b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST);b.depthMask(true)};function a(h){var g=b.createProgram();var f=b.createShader(b.FRAGMENT_SHADER);var i=b.createShader(b.VERTEX_SHADER);b.shaderSource(f,h.fragmentShader);b.shaderSource(i,h.vertexShader);b.compileShader(f);b.compileShader(i);b.attachShader(g,f);b.attachShader(g,i);b.linkProgram(g);return g}function e(g,f){return f.z-g.z}};THREE.DepthPassPlugin=function(){this.enabled=false;this.renderTarget=null;var c,f,d,a,b=new THREE.Frustum(),e=new THREE.Matrix4();this.init=function(i){c=i.context;f=i;var g=THREE.ShaderLib.depthRGBA;var h=THREE.UniformsUtils.clone(g.uniforms);d=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h});a=new THREE.ShaderMaterial({fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:h,morphTargets:true});d._shadowPass=true;a._shadowPass=true};this.render=function(h,g){if(!this.enabled){return}this.update(h,g)};this.update=function(u,w){var q,x,p,r,k,s,o,v,t,l,m,g,h=null;c.clearColor(1,1,1,1);c.disable(c.BLEND);f.setDepthTest(true);if(f.autoUpdateScene){u.updateMatrixWorld()}if(!w._viewMatrixArray){w._viewMatrixArray=new Float32Array(16)}if(!w._projectionMatrixArray){w._projectionMatrixArray=new Float32Array(16)}w.matrixWorldInverse.getInverse(w.matrixWorld);w.matrixWorldInverse.flattenToArray(w._viewMatrixArray);w.projectionMatrix.flattenToArray(w._projectionMatrixArray);e.multiply(w.projectionMatrix,w.matrixWorldInverse);b.setFromMatrix(e);f.setRenderTarget(this.renderTarget);f.clear();g=u.__webglObjects;for(p=0,r=g.length;p<r;p++){t=g[p];l=t.object;t.render=false;if(l.visible){if(!(l instanceof THREE.Mesh)||!(l.frustumCulled)||b.contains(l)){l._modelViewMatrix.multiply(w.matrixWorldInverse,l.matrixWorld);t.render=true}}}for(p=0,r=g.length;p<r;p++){t=g[p];if(t.render){l=t.object;o=t.buffer;if(l.material){f.setMaterialFaces(l.material)}if(l.customDepthMaterial){v=l.customDepthMaterial}else{if(l.geometry.morphTargets.length){v=a}else{v=d}}if(o instanceof THREE.BufferGeometry){f.renderBufferDirect(w,u.__lights,h,v,o,l)}else{f.renderBuffer(w,u.__lights,h,v,o,l)}}}g=u.__webglObjectsImmediate;for(p=0,r=g.length;p<r;p++){t=g[p];l=t.object;if(l.visible&&l.castShadow){l._modelViewMatrix.multiply(w.matrixWorldInverse,l.matrixWorld);f.renderImmediateObject(w,u.__lights,h,d,l)}}var z=f.getClearColor(),y=f.getClearAlpha();c.clearColor(z.r,z.g,z.b,y);c.enable(c.BLEND)}};THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform int renderType;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility = (       visibility.r / 9.0 ) *","( 1.0 - visibility.g / 9.0 ) *","(       visibility.b / 9.0 ) *","( 1.0 - visibility.a / 9.0 );","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform sampler2D map;","uniform float opacity;","uniform int renderType;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform int renderType;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform int renderType;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}};THREE.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int affectedByDistance;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["precision mediump float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","}"].join("\n")}};var dat=dat||{};dat.gui=dat.gui||{};dat.utils=dat.utils||{};dat.controllers=dat.controllers||{};dat.dom=dat.dom||{};dat.color=dat.color||{};dat.utils.css=(function(){return{load:function(a,c){c=c||document;var b=c.createElement("link");b.type="text/css";b.rel="stylesheet";b.href=a;c.getElementsByTagName("head")[0].appendChild(b)},inject:function(b,c){c=c||document;var a=document.createElement("style");a.type="text/css";a.innerHTML=b;c.getElementsByTagName("head")[0].appendChild(a)}}})();dat.utils.common=(function(){var a=Array.prototype.forEach;var b=Array.prototype.slice;return{BREAK:{},extend:function(c){this.each(b.call(arguments,1),function(e){for(var d in e){if(!this.isUndefined(e[d])){c[d]=e[d]}}},this);return c},defaults:function(c){this.each(b.call(arguments,1),function(e){for(var d in e){if(this.isUndefined(c[d])){c[d]=e[d]}}},this);return c},compose:function(){var c=b.call(arguments);return function(){var d=b.call(arguments);for(var e=c.length-1;e>=0;e--){d=[c[e].apply(this,d)]}return d[0]}},each:function(g,f,e){if(a&&g.forEach===a){g.forEach(f,e)}else{if(g.length===g.length+0){for(var d=0,c=g.length;d<c;d++){if(d in g&&f.call(e,g[d],d)===this.BREAK){return}}}else{for(var d in g){if(f.call(e,g[d],d)===this.BREAK){return}}}}},defer:function(c){setTimeout(c,0)},toArray:function(c){if(c.toArray){return c.toArray()}return b.call(c)},isUndefined:function(c){return c===undefined},isNull:function(c){return c===null},isNaN:function(c){return c!==c},isArray:Array.isArray||function(c){return c.constructor===Array},isObject:function(c){return c===Object(c)},isNumber:function(c){return c===c+0},isString:function(c){return c===c+""},isBoolean:function(c){return c===false||c===true},isFunction:function(c){return Object.prototype.toString.call(c)==="[object Function]"}}})();dat.controllers.Controller=(function(a){var b=function(c,d){this.initialValue=c[d];this.domElement=document.createElement("div");this.object=c;this.property=d;this.__onChange=undefined;this.__onFinishChange=undefined};a.extend(b.prototype,{onChange:function(c){this.__onChange=c;return this},onFinishChange:function(c){this.__onFinishChange=c;return this},setValue:function(c){this.object[this.property]=c;if(this.__onChange){this.__onChange.call(this,c)}this.updateDisplay();return this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}});return b})(dat.utils.common);dat.dom.dom=(function(b){var f={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]};var e={};b.each(f,function(h,g){b.each(h,function(i){e[i]=g})});var a=/(\d+(\.\d+)?)px/;function c(h){if(h==="0"||b.isUndefined(h)){return 0}var g=h.match(a);if(!b.isNull(g)){return parseFloat(g[1])}return 0}var d={makeSelectable:function(h,g){if(h===undefined||h.style===undefined){return}h.onselectstart=g?function(){return false}:function(){};h.style.MozUserSelect=g?"auto":"none";h.style.KhtmlUserSelect=g?"auto":"none";h.unselectable=g?"on":"off"},makeFullscreen:function(i,g,h){if(b.isUndefined(g)){g=true}if(b.isUndefined(h)){h=true}i.style.position="absolute";if(g){i.style.left=0;i.style.right=0}if(h){i.style.top=0;i.style.bottom=0}},fakeEvent:function(k,i,l,j){l=l||{};var m=e[i];if(!m){throw new Error("Event type "+i+" not supported.")}var n=document.createEvent(m);switch(m){case"MouseEvents":var h=l.x||l.clientX||0;var g=l.y||l.clientY||0;n.initMouseEvent(i,l.bubbles||false,l.cancelable||true,window,l.clickCount||1,0,0,h,g,false,false,false,false,0,null);break;case"KeyboardEvents":var o=n.initKeyboardEvent||n.initKeyEvent;b.defaults(l,{cancelable:true,ctrlKey:false,altKey:false,shiftKey:false,metaKey:false,keyCode:undefined,charCode:undefined});o(i,l.bubbles||false,l.cancelable,window,l.ctrlKey,l.altKey,l.shiftKey,l.metaKey,l.keyCode,l.charCode);break;default:n.initEvent(i,l.bubbles||false,l.cancelable||true);break}b.defaults(n,j);k.dispatchEvent(n)},bind:function(j,i,h,g){g=g||false;if(j.addEventListener){j.addEventListener(i,h,g)}else{if(j.attachEvent){j.attachEvent("on"+i,h)}}return d},unbind:function(j,i,h,g){g=g||false;if(j.removeEventListener){j.removeEventListener(i,h,g)}else{if(j.detachEvent){j.detachEvent("on"+i,h)}}return d},addClass:function(i,h){if(i.className===undefined){i.className=h}else{if(i.className!==h){var g=i.className.split(/ +/);if(g.indexOf(h)==-1){g.push(h);i.className=g.join(" ").replace(/^\s+/,"").replace(/\s+$/,"")}}}return d},removeClass:function(j,i){if(i){if(j.className===undefined){}else{if(j.className===i){j.removeAttribute("class")}else{var h=j.className.split(/ +/);var g=h.indexOf(i);if(g!=-1){h.splice(g,1);j.className=h.join(" ")}}}}else{j.className=undefined}return d},hasClass:function(h,g){return new RegExp("(?:^|\\s+)"+g+"(?:\\s+|$)").test(h.className)||false},getWidth:function(h){var g=getComputedStyle(h);return c(g["border-left-width"])+c(g["border-right-width"])+c(g["padding-left"])+c(g["padding-right"])+c(g.width)},getHeight:function(h){var g=getComputedStyle(h);return c(g["border-top-width"])+c(g["border-bottom-width"])+c(g["padding-top"])+c(g["padding-bottom"])+c(g.height)},getOffset:function(g){var h={left:0,top:0};if(g.offsetParent){do{h.left+=g.offsetLeft;h.top+=g.offsetTop}while(g=g.offsetParent)}return h},isActive:function(g){return g===document.activeElement&&(g.type||g.href)}};return d})(dat.utils.common);dat.controllers.OptionController=(function(c,d,a){var b=function(f,g,e){b.superclass.call(this,f,g);var i=this;this.__select=document.createElement("select");if(a.isArray(e)){var h={};a.each(e,function(j){h[j]=j});e=h}a.each(e,function(l,k){var j=document.createElement("option");j.innerHTML=k;j.setAttribute("value",l);i.__select.appendChild(j)});this.updateDisplay();d.bind(this.__select,"change",function(){var j=this.options[this.selectedIndex].value;i.setValue(j)});this.domElement.appendChild(this.__select)};b.superclass=c;a.extend(b.prototype,c.prototype,{setValue:function(e){var f=b.superclass.prototype.setValue.call(this,e);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}return f},updateDisplay:function(){this.__select.value=this.getValue();return b.superclass.prototype.updateDisplay.call(this)}});return b})(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.controllers.NumberController=(function(d,b){var c=function(e,f,g){c.superclass.call(this,e,f);g=g||{};this.__min=g.min;this.__max=g.max;this.__step=g.step;if(b.isUndefined(this.__step)){if(this.initialValue==0){this.__impliedStep=1}else{this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10}}else{this.__impliedStep=this.__step}this.__precision=a(this.__impliedStep)};c.superclass=d;b.extend(c.prototype,d.prototype,{setValue:function(e){if(this.__min!==undefined&&e<this.__min){e=this.__min}else{if(this.__max!==undefined&&e>this.__max){e=this.__max}}if(this.__step!==undefined&&e%this.__step!=0){e=Math.round(e/this.__step)*this.__step}return c.superclass.prototype.setValue.call(this,e)},min:function(e){this.__min=e;return this},max:function(e){this.__max=e;return this},step:function(e){this.__step=e;return this}});function a(e){e=e.toString();if(e.indexOf(".")>-1){return e.length-e.indexOf(".")-1}else{return 0}}return c})(dat.controllers.Controller,dat.utils.common);dat.controllers.NumberControllerBox=(function(d,e,c){var b=function(h,o,g){this.__truncationSuspended=false;b.superclass.call(this,h,o,g);var l=this;var j;this.__input=document.createElement("input");this.__input.setAttribute("type","text");e.bind(this.__input,"change",m);e.bind(this.__input,"blur",f);e.bind(this.__input,"mousedown",n);e.bind(this.__input,"keydown",function(p){if(p.keyCode===13){l.__truncationSuspended=true;this.blur();l.__truncationSuspended=false}});function m(){var p=parseFloat(l.__input.value);if(!c.isNaN(p)){l.setValue(p)}}function f(){m();if(l.__onFinishChange){l.__onFinishChange.call(l,l.getValue())}}function n(p){e.bind(window,"mousemove",i);e.bind(window,"mouseup",k);j=p.clientY}function i(q){var p=j-q.clientY;l.setValue(l.getValue()+p*l.__impliedStep);j=q.clientY}function k(){e.unbind(window,"mousemove",i);e.unbind(window,"mouseup",k)}this.updateDisplay();this.domElement.appendChild(this.__input)};b.superclass=d;c.extend(b.prototype,d.prototype,{updateDisplay:function(){this.__input.value=this.__truncationSuspended?this.getValue():a(this.getValue(),this.__precision);return b.superclass.prototype.updateDisplay.call(this)}});function a(g,f){var h=Math.pow(10,f);return Math.round(g*h)/h}return b})(dat.controllers.NumberController,dat.dom.dom,dat.utils.common);dat.controllers.NumberControllerSlider=(function(d,f,a,b,g){var c=function(i,p,j,n,h){c.superclass.call(this,i,p,{min:j,max:n,step:h});var m=this;this.__background=document.createElement("div");this.__foreground=document.createElement("div");f.bind(this.__background,"mousedown",o);f.addClass(this.__background,"slider");f.addClass(this.__foreground,"slider-fg");function o(q){f.bind(window,"mousemove",k);f.bind(window,"mouseup",l);k(q)}function k(r){r.preventDefault();var s=f.getOffset(m.__background);var q=f.getWidth(m.__background);m.setValue(e(r.clientX,s.left,s.left+q,m.__min,m.__max));return false}function l(){f.unbind(window,"mousemove",k);f.unbind(window,"mouseup",l);if(m.__onFinishChange){m.__onFinishChange.call(m,m.getValue())}}this.updateDisplay();this.__background.appendChild(this.__foreground);this.domElement.appendChild(this.__background)};c.superclass=d;c.useDefaultStyles=function(){a.inject(g)};b.extend(c.prototype,d.prototype,{updateDisplay:function(){var h=(this.getValue()-this.__min)/(this.__max-this.__min);this.__foreground.style.width=h*100+"%";return c.superclass.prototype.updateDisplay.call(this)}});function e(h,k,i,l,j){return l+(j-l)*((h-k)/(i-k))}return c})(dat.controllers.NumberController,dat.dom.dom,dat.utils.css,dat.utils.common,".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}");dat.controllers.FunctionController=(function(b,c,a){var d=function(e,f,g){d.superclass.call(this,e,f);var h=this;this.__button=document.createElement("div");this.__button.innerHTML=g===undefined?"Fire":g;c.bind(this.__button,"click",function(i){i.preventDefault();h.fire();return false});c.addClass(this.__button,"button");this.domElement.appendChild(this.__button)};d.superclass=b;a.extend(d.prototype,b.prototype,{fire:function(){if(this.__onChange){this.__onChange.call(this)}if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}this.getValue().call(this.object)}});return d})(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.controllers.BooleanController=(function(c,d,a){var b=function(f,g){b.superclass.call(this,f,g);var h=this;this.__prev=this.getValue();this.__checkbox=document.createElement("input");this.__checkbox.setAttribute("type","checkbox");d.bind(this.__checkbox,"change",e,false);this.domElement.appendChild(this.__checkbox);this.updateDisplay();function e(){h.setValue(!h.__prev)}};b.superclass=c;a.extend(b.prototype,c.prototype,{setValue:function(e){var f=b.superclass.prototype.setValue.call(this,e);if(this.__onFinishChange){this.__onFinishChange.call(this,this.getValue())}this.__prev=this.getValue();return f},updateDisplay:function(){if(this.getValue()===true){this.__checkbox.setAttribute("checked","checked");this.__checkbox.checked=true}else{this.__checkbox.checked=false}return b.superclass.prototype.updateDisplay.call(this)}});return b})(dat.controllers.Controller,dat.dom.dom,dat.utils.common);dat.color.toString=(function(a){return function(b){if(b.a==1||a.isUndefined(b.a)){var c=b.hex.toString(16);while(c.length<6){c="0"+c}return"#"+c}else{return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}})(dat.utils.common);dat.color.interpret=(function(d,c){var a,f;var b=function(){f=false;var g=arguments.length>1?c.toArray(arguments):arguments[0];c.each(e,function(h){if(h.litmus(g)){c.each(h.conversions,function(j,i){a=j.read(g);if(f===false&&a!==false){f=a;a.conversionName=i;a.conversion=j;return c.BREAK}});return c.BREAK}});return f};var e=[{litmus:c.isString,conversions:{THREE_CHAR_HEX:{read:function(g){var h=g.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);if(h===null){return false}return{space:"HEX",hex:parseInt("0x"+h[1].toString()+h[1].toString()+h[2].toString()+h[2].toString()+h[3].toString()+h[3].toString())}},write:d},SIX_CHAR_HEX:{read:function(g){var h=g.match(/^#([A-F0-9]{6})$/i);if(h===null){return false}return{space:"HEX",hex:parseInt("0x"+h[1].toString())}},write:d},CSS_RGB:{read:function(g){var h=g.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);if(h===null){return false}return{space:"RGB",r:parseFloat(h[1]),g:parseFloat(h[2]),b:parseFloat(h[3])}},write:d},CSS_RGBA:{read:function(g){var h=g.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);if(h===null){return false}return{space:"RGB",r:parseFloat(h[1]),g:parseFloat(h[2]),b:parseFloat(h[3]),a:parseFloat(h[4])}},write:d}}},{litmus:c.isNumber,conversions:{HEX:{read:function(g){return{space:"HEX",hex:g,conversionName:"HEX"}},write:function(g){return g.hex}}}},{litmus:c.isArray,conversions:{RGB_ARRAY:{read:function(g){if(g.length!=3){return false}return{space:"RGB",r:g[0],g:g[1],b:g[2]}},write:function(g){return[g.r,g.g,g.b]}},RGBA_ARRAY:{read:function(g){if(g.length!=4){return false}return{space:"RGB",r:g[0],g:g[1],b:g[2],a:g[3]}},write:function(g){return[g.r,g.g,g.b,g.a]}}}},{litmus:c.isObject,conversions:{RGBA_OBJ:{read:function(g){if(c.isNumber(g.r)&&c.isNumber(g.g)&&c.isNumber(g.b)&&c.isNumber(g.a)){return{space:"RGB",r:g.r,g:g.g,b:g.b,a:g.a}}return false},write:function(g){return{r:g.r,g:g.g,b:g.b,a:g.a}}},RGB_OBJ:{read:function(g){if(c.isNumber(g.r)&&c.isNumber(g.g)&&c.isNumber(g.b)){return{space:"RGB",r:g.r,g:g.g,b:g.b}}return false},write:function(g){return{r:g.r,g:g.g,b:g.b}}},HSVA_OBJ:{read:function(g){if(c.isNumber(g.h)&&c.isNumber(g.s)&&c.isNumber(g.v)&&c.isNumber(g.a)){return{space:"HSV",h:g.h,s:g.s,v:g.v,a:g.a}}return false},write:function(g){return{h:g.h,s:g.s,v:g.v,a:g.a}}},HSV_OBJ:{read:function(g){if(c.isNumber(g.h)&&c.isNumber(g.s)&&c.isNumber(g.v)){return{space:"HSV",h:g.h,s:g.s,v:g.v}}return false},write:function(g){return{h:g.h,s:g.s,v:g.v}}}}}];return b})(dat.color.toString,dat.utils.common);dat.GUI=dat.gui.GUI=(function(E,G,i,h,f,y,o,r,L,A,t,l,j,c,s){E.inject(i);var B="dg";var z=72;var k=20;var b="Default";var a=(function(){try{return"localStorage" in window&&window.localStorage!==null}catch(N){return false}})();var w;var M=true;var p;var H=false;var D=[];var g=function(R){var S=this;this.domElement=document.createElement("div");this.__ul=document.createElement("ul");this.domElement.appendChild(this.__ul);c.addClass(this.domElement,B);this.__folders={};this.__controllers=[];this.__rememberedObjects=[];this.__rememberedObjectIndecesToControllers=[];this.__listening=[];R=R||{};R=s.defaults(R,{autoPlace:true,width:g.DEFAULT_WIDTH});R=s.defaults(R,{resizable:R.autoPlace,hideable:R.autoPlace});if(!s.isUndefined(R.load)){if(R.preset){R.load.preset=R.preset}}else{R.load={preset:b}}if(s.isUndefined(R.parent)&&R.hideable){D.push(this)}R.resizable=s.isUndefined(R.parent)&&R.resizable;if(R.autoPlace&&s.isUndefined(R.scrollable)){R.scrollable=true}var U=a&&localStorage.getItem(q(this,"isLocal"))==="true";Object.defineProperties(this,{parent:{get:function(){return R.parent}},scrollable:{get:function(){return R.scrollable}},autoPlace:{get:function(){return R.autoPlace}},preset:{get:function(){if(S.parent){return S.getRoot().preset}else{return R.load.preset}},set:function(X){if(S.parent){S.getRoot().preset=X}else{R.load.preset=X}u(this);S.revert()}},width:{get:function(){return R.width},set:function(X){R.width=X;I(S,X)}},name:{get:function(){return R.name},set:function(X){R.name=X;if(O){O.innerHTML=R.name}}},closed:{get:function(){return R.closed},set:function(X){R.closed=X;if(R.closed){c.addClass(S.__ul,g.CLASS_CLOSED)}else{c.removeClass(S.__ul,g.CLASS_CLOSED)}this.onResize();if(S.__closeButton){S.__closeButton.innerHTML=X?g.TEXT_OPEN:g.TEXT_CLOSED}}},load:{get:function(){return R.load}},useLocalStorage:{get:function(){return U},set:function(X){if(a){U=X;if(X){c.bind(window,"unload",Q)}else{c.unbind(window,"unload",Q)}localStorage.setItem(q(S,"isLocal"),X)}}}});if(s.isUndefined(R.parent)){R.closed=false;c.addClass(this.domElement,g.CLASS_MAIN);c.makeSelectable(this.domElement,false);if(a){if(U){S.useLocalStorage=true;var N=localStorage.getItem(q(this,"gui"));if(N){R.load=JSON.parse(N)}}}this.__closeButton=document.createElement("div");this.__closeButton.innerHTML=g.TEXT_CLOSED;c.addClass(this.__closeButton,g.CLASS_CLOSE_BUTTON);this.domElement.appendChild(this.__closeButton);c.bind(this.__closeButton,"click",function(){S.closed=!S.closed})}else{if(R.closed===undefined){R.closed=true}var O=document.createTextNode(R.name);c.addClass(O,"controller-name");var V=C(S,O);var W=function(X){X.preventDefault();S.closed=!S.closed;return false};c.addClass(this.__ul,g.CLASS_CLOSED);c.addClass(V,"title");c.bind(V,"click",W);if(!R.closed){this.closed=false}}if(R.autoPlace){if(s.isUndefined(R.parent)){if(M){p=document.createElement("div");c.addClass(p,B);c.addClass(p,g.CLASS_AUTO_PLACE_CONTAINER);document.body.appendChild(p);M=false}p.appendChild(this.domElement);c.addClass(this.domElement,g.CLASS_AUTO_PLACE)}if(!this.parent){I(S,R.width)}}c.bind(window,"resize",function(){S.onResize()});c.bind(this.__ul,"webkitTransitionEnd",function(){S.onResize()});c.bind(this.__ul,"transitionend",function(){S.onResize()});c.bind(this.__ul,"oTransitionEnd",function(){S.onResize()});this.onResize();if(R.resizable){K(this)}function Q(){localStorage.setItem(q(S,"gui"),JSON.stringify(S.getSaveObject()))}var T=S.getRoot();function P(){var X=S.getRoot();X.width+=1;s.defer(function(){X.width-=1})}if(!R.parent){P()}};g.toggleHide=function(){H=!H;s.each(D,function(N){N.domElement.style.zIndex=H?-999:999;N.domElement.style.opacity=H?0:1})};g.CLASS_AUTO_PLACE="a";g.CLASS_AUTO_PLACE_CONTAINER="ac";g.CLASS_MAIN="main";g.CLASS_CONTROLLER_ROW="cr";g.CLASS_TOO_TALL="taller-than-window";g.CLASS_CLOSED="closed";g.CLASS_CLOSE_BUTTON="close-button";g.CLASS_DRAG="drag";g.DEFAULT_WIDTH=245;g.TEXT_CLOSED="Close Controls";g.TEXT_OPEN="Open Controls";c.bind(window,"keydown",function(N){if(document.activeElement.type!=="text"&&(N.which===z||N.keyCode==z)){g.toggleHide()}},false);s.extend(g.prototype,{add:function(N,O){return d(this,N,O,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(N,O){return d(this,N,O,{color:true})},remove:function(N){this.__ul.removeChild(N.__li);this.__controllers.slice(this.__controllers.indexOf(N),1);var O=this;s.defer(function(){O.onResize()})},destroy:function(){if(this.autoPlace){p.removeChild(this.domElement)}},addFolder:function(P){if(this.__folders[P]!==undefined){throw new Error('You already have a folder in this GUI by the name "'+P+'"')}var Q={name:P,parent:this};Q.autoPlace=this.autoPlace;if(this.load&&this.load.folders&&this.load.folders[P]){Q.closed=this.load.folders[P].closed;Q.load=this.load.folders[P]}var O=new g(Q);this.__folders[P]=O;var N=C(this,O.domElement);c.addClass(N,"folder");return O},open:function(){this.closed=false},close:function(){this.closed=true},onResize:function(){var N=this.getRoot();if(N.scrollable){var P=c.getOffset(N.__ul).top;var O=0;s.each(N.__ul.childNodes,function(Q){if(!(N.autoPlace&&Q===N.__save_row)){O+=c.getHeight(Q)}});if(window.innerHeight-P-k<O){c.addClass(N.domElement,g.CLASS_TOO_TALL);N.__ul.style.height=window.innerHeight-P-k+"px"}else{c.removeClass(N.domElement,g.CLASS_TOO_TALL);N.__ul.style.height="auto"}}if(N.__resize_handle){s.defer(function(){N.__resize_handle.style.height=N.__ul.offsetHeight+"px"})}if(N.__closeButton){N.__closeButton.style.width=N.width+"px"}},remember:function(){if(s.isUndefined(w)){w=new j();w.domElement.innerHTML=G}if(this.parent){throw new Error("You can only call remember on a top level GUI.")}var N=this;s.each(Array.prototype.slice.call(arguments),function(O){if(N.__rememberedObjects.length==0){v(N)}if(N.__rememberedObjects.indexOf(O)==-1){N.__rememberedObjects.push(O)}});if(this.autoPlace){I(this,this.width)}},getRoot:function(){var N=this;while(N.parent){N=N.parent}return N},getSaveObject:function(){var N=this.load;N.closed=this.closed;if(this.__rememberedObjects.length>0){N.preset=this.preset;if(!N.remembered){N.remembered={}}N.remembered[this.preset]=F(this)}N.folders={};s.each(this.__folders,function(P,O){N.folders[O]=P.getSaveObject()});return N},save:function(){if(!this.load.remembered){this.load.remembered={}}this.load.remembered[this.preset]=F(this);n(this,false)},saveAs:function(N){if(!this.load.remembered){this.load.remembered={};this.load.remembered[b]=F(this,true)}this.load.remembered[N]=F(this);this.preset=N;x(this,N,true)},revert:function(N){s.each(this.__controllers,function(O){if(!this.getRoot().load.remembered){O.setValue(O.initialValue)}else{e(N||this.getRoot(),O)}},this);s.each(this.__folders,function(O){O.revert(O)});if(!N){n(this.getRoot(),false)}},listen:function(N){var O=this.__listening.length==0;this.__listening.push(N);if(O){J(this.__listening)}}});function d(P,R,U,Q){if(R[U]===undefined){throw new Error("Object "+R+' has no property "'+U+'"')}var S;if(Q.color){S=new t(R,U)}else{var V=[R,U].concat(Q.factoryArgs);S=h.apply(P,V)}if(Q.before instanceof f){Q.before=Q.before.__li}e(P,S);c.addClass(S.domElement,"c");var N=document.createElement("span");c.addClass(N,"property-name");N.innerHTML=S.property;var O=document.createElement("div");O.appendChild(N);O.appendChild(S.domElement);var T=C(P,O,Q.before);c.addClass(T,g.CLASS_CONTROLLER_ROW);c.addClass(T,typeof S.getValue());m(P,T,S);P.__controllers.push(S);return S}function C(O,Q,P){var N=document.createElement("li");if(Q){N.appendChild(Q)}if(P){O.__ul.insertBefore(N,params.before)}else{O.__ul.appendChild(N)}O.onResize();return N}function m(P,N,O){O.__li=N;O.__gui=P;s.extend(O,{options:function(S){if(arguments.length>1){O.remove();return d(P,O.object,O.property,{before:O.__li.nextElementSibling,factoryArgs:[s.toArray(arguments)]})}if(s.isArray(S)||s.isObject(S)){O.remove();return d(P,O.object,O.property,{before:O.__li.nextElementSibling,factoryArgs:[S]})}},name:function(S){O.__li.firstElementChild.firstElementChild.innerHTML=S;return O},listen:function(){O.__gui.listen(O);return O},remove:function(){O.__gui.remove(O);return O}});if(O instanceof L){var R=new r(O.object,O.property,{min:O.__min,max:O.__max,step:O.__step});s.each(["updateDisplay","onChange","onFinishChange"],function(U){var S=O[U];var T=R[U];O[U]=R[U]=function(){var V=Array.prototype.slice.call(arguments);S.apply(O,V);return T.apply(R,V)}});c.addClass(N,"has-slider");O.domElement.insertBefore(R.domElement,O.domElement.firstElementChild)}else{if(O instanceof r){var Q=function(S){if(s.isNumber(O.__min)&&s.isNumber(O.__max)){O.remove();return d(P,O.object,O.property,{before:O.__li.nextElementSibling,factoryArgs:[O.__min,O.__max,O.__step]})}return S};O.min=s.compose(Q,O.min);O.max=s.compose(Q,O.max)}else{if(O instanceof y){c.bind(N,"click",function(){c.fakeEvent(O.__checkbox,"click")});c.bind(O.__checkbox,"click",function(S){S.stopPropagation()})}else{if(O instanceof o){c.bind(N,"click",function(){c.fakeEvent(O.__button,"click")});c.bind(N,"mouseover",function(){c.addClass(O.__button,"hover")});c.bind(N,"mouseout",function(){c.removeClass(O.__button,"hover")})}else{if(O instanceof t){c.addClass(N,"color");O.updateDisplay=s.compose(function(S){N.style.borderLeftColor=O.__color.toString();return S},O.updateDisplay);O.updateDisplay()}}}}}O.setValue=s.compose(function(S){if(P.getRoot().__preset_select&&O.isModified()){n(P.getRoot(),true)}return S},O.setValue)}function e(P,O){var N=P.getRoot();var U=N.__rememberedObjects.indexOf(O.object);if(U!=-1){var R=N.__rememberedObjectIndecesToControllers[U];if(R===undefined){R={};N.__rememberedObjectIndecesToControllers[U]=R}R[O.property]=O;if(N.load&&N.load.remembered){var Q=N.load.remembered;var S;if(Q[P.preset]){S=Q[P.preset]}else{if(Q[b]){S=Q[b]}else{return}}if(S[U]&&S[U][O.property]!==undefined){var T=S[U][O.property];O.initialValue=T;O.setValue(T)}}}}function q(N,O){return document.location.href+"."+O}function v(Q){var N=Q.__save_row=document.createElement("li");c.addClass(Q.domElement,"has-save");Q.__ul.insertBefore(N,Q.__ul.firstChild);c.addClass(N,"save-row");var P=document.createElement("span");P.innerHTML="&nbsp;";c.addClass(P,"button gears");var R=document.createElement("span");R.innerHTML="Save";c.addClass(R,"button");c.addClass(R,"save");var U=document.createElement("span");U.innerHTML="New";c.addClass(U,"button");c.addClass(U,"save-as");var S=document.createElement("span");S.innerHTML="Revert";c.addClass(S,"button");c.addClass(S,"revert");var Y=Q.__preset_select=document.createElement("select");if(Q.load&&Q.load.remembered){s.each(Q.load.remembered,function(aa,Z){x(Q,Z,Z==Q.preset)})}else{x(Q,b,false)}c.bind(Y,"change",function(){for(var Z=0;Z<Q.__preset_select.length;Z++){Q.__preset_select[Z].innerHTML=Q.__preset_select[Z].value}Q.preset=this.value});N.appendChild(Y);N.appendChild(P);N.appendChild(R);N.appendChild(U);N.appendChild(S);if(a){var X=document.getElementById("dg-save-locally");var T=document.getElementById("dg-local-explain");X.style.display="block";var V=document.getElementById("dg-local-storage");if(localStorage.getItem(q(Q,"isLocal"))==="true"){V.setAttribute("checked","checked")}function O(){T.style.display=Q.useLocalStorage?"block":"none"}O();c.bind(V,"change",function(){Q.useLocalStorage=!Q.useLocalStorage;O()})}var W=document.getElementById("dg-new-constructor");c.bind(W,"keydown",function(Z){if(Z.metaKey&&(Z.which===67||Z.keyCode==67)){w.hide()}});c.bind(P,"click",function(){W.innerHTML=JSON.stringify(Q.getSaveObject(),undefined,2);w.show();W.focus();W.select()});c.bind(R,"click",function(){Q.save()});c.bind(U,"click",function(){var Z=prompt("Enter a new preset name.");if(Z){Q.saveAs(Z)}});c.bind(S,"click",function(){Q.revert()})}function K(P){P.__resize_handle=document.createElement("div");s.extend(P.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var O;c.bind(P.__resize_handle,"mousedown",N);c.bind(P.__closeButton,"mousedown",N);P.domElement.insertBefore(P.__resize_handle,P.domElement.firstElementChild);function N(S){S.preventDefault();O=S.clientX;c.addClass(P.__closeButton,g.CLASS_DRAG);c.bind(window,"mousemove",R);c.bind(window,"mouseup",Q);return false}function R(S){S.preventDefault();P.width+=O-S.clientX;P.onResize();O=S.clientX;return false}function Q(){c.removeClass(P.__closeButton,g.CLASS_DRAG);c.unbind(window,"mousemove",R);c.unbind(window,"mouseup",Q)}}function I(O,N){O.domElement.style.width=N+"px";if(O.__save_row&&O.autoPlace){O.__save_row.style.width=N+"px"}if(O.__closeButton){O.__closeButton.style.width=N+"px"}}function F(N,O){var P={};s.each(N.__rememberedObjects,function(T,R){var Q={};var S=N.__rememberedObjectIndecesToControllers[R];s.each(S,function(U,V){Q[V]=O?U.initialValue:U.getValue()});P[R]=Q});return P}function x(N,O,Q){var P=document.createElement("option");P.innerHTML=O;P.value=O;N.__preset_select.appendChild(P);if(Q){N.__preset_select.selectedIndex=N.__preset_select.length-1}}function u(N){for(var O=0;O<N.__preset_select.length;O++){if(N.__preset_select[O].value==N.preset){N.__preset_select.selectedIndex=O}}}function n(N,O){var P=N.__preset_select[N.__preset_select.selectedIndex];if(O){P.innerHTML=P.value+"*"}else{P.innerHTML=P.value}}function J(N){if(N.length!=0){l(function(){J(N)})}s.each(N,function(O){O.updateDisplay()})}return g})(dat.utils.css,'<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>',".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13em;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10em;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11em;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10em}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9em;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n",dat.controllers.factory=(function(e,c,d,a,g,f,b){return function(i,j){var h=i[j];if(b.isArray(arguments[2])||b.isObject(arguments[2])){return new e(i,j,arguments[2])}if(b.isNumber(h)){if(b.isNumber(arguments[2])&&b.isNumber(arguments[3])){return new d(i,j,arguments[2],arguments[3])}else{return new c(i,j,{min:arguments[2],max:arguments[3]})}}if(b.isString(h)){return new a(i,j)}if(b.isFunction(h)){return new g(i,j,"")}if(b.isBoolean(h)){return new f(i,j)}}})(dat.controllers.OptionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.StringController=(function(c,d,b){var a=function(f,h){a.superclass.call(this,f,h);var i=this;this.__input=document.createElement("input");this.__input.setAttribute("type","text");d.bind(this.__input,"keyup",e);d.bind(this.__input,"change",e);d.bind(this.__input,"blur",g);d.bind(this.__input,"keydown",function(j){if(j.keyCode===13){this.blur()}});function e(){i.setValue(i.__input.value)}function g(){if(i.__onFinishChange){i.__onFinishChange.call(i,i.getValue())}}this.updateDisplay();this.domElement.appendChild(this.__input)};a.superclass=c;b.extend(a.prototype,c.prototype,{updateDisplay:function(){if(!d.isActive(this.__input)){this.__input.value=this.getValue()}return a.superclass.prototype.updateDisplay.call(this)}});return a})(dat.controllers.Controller,dat.dom.dom,dat.utils.common),dat.controllers.FunctionController,dat.controllers.BooleanController,dat.utils.common),dat.controllers.Controller,dat.controllers.BooleanController,dat.controllers.FunctionController,dat.controllers.NumberControllerBox,dat.controllers.NumberControllerSlider,dat.controllers.OptionController,dat.controllers.ColorController=(function(c,d,a,b,f){var e=function(m,r){e.superclass.call(this,m,r);this.__color=new a(this.getValue());this.__temp=new a(0);var p=this;this.domElement=document.createElement("div");d.makeSelectable(this.domElement,false);this.__selector=document.createElement("div");this.__selector.className="selector";this.__saturation_field=document.createElement("div");this.__saturation_field.className="saturation-field";this.__field_knob=document.createElement("div");this.__field_knob.className="field-knob";this.__field_knob_border="2px solid ";this.__hue_knob=document.createElement("div");this.__hue_knob.className="hue-knob";this.__hue_field=document.createElement("div");this.__hue_field.className="hue-field";this.__input=document.createElement("input");this.__input.type="text";this.__input_textShadow="0 1px 1px ";d.bind(this.__input,"keydown",function(t){if(t.keyCode===13){j.call(this)}});d.bind(this.__input,"blur",j);d.bind(this.__selector,"mousedown",function(t){d.addClass(this,"drag").bind(window,"mouseup",function(u){d.removeClass(p.__selector,"drag")})});var n=document.createElement("div");f.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"});f.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<0.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1});f.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1});f.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"});f.extend(n.style,{width:"100%",height:"100%",background:"none"});g(n,"top","rgba(0,0,0,0)","#000");f.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"});i(this.__hue_field);f.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"});d.bind(this.__saturation_field,"mousedown",q);d.bind(this.__field_knob,"mousedown",q);d.bind(this.__hue_field,"mousedown",function(t){o(t);d.bind(window,"mousemove",o);d.bind(window,"mouseup",k)});function q(t){l(t);d.bind(window,"mousemove",l);d.bind(window,"mouseup",s)}function s(){d.unbind(window,"mousemove",l);d.unbind(window,"mouseup",s)}function j(){var t=b(this.value);if(t!==false){p.__color.__state=t;p.setValue(p.__color.toOriginal())}else{this.value=p.__color.toString()}}function k(){d.unbind(window,"mousemove",o);d.unbind(window,"mouseup",k)}this.__saturation_field.appendChild(n);this.__selector.appendChild(this.__field_knob);this.__selector.appendChild(this.__saturation_field);this.__selector.appendChild(this.__hue_field);this.__hue_field.appendChild(this.__hue_knob);this.domElement.appendChild(this.__input);this.domElement.appendChild(this.__selector);this.updateDisplay();function l(y){y.preventDefault();var t=d.getWidth(p.__saturation_field);var z=d.getOffset(p.__saturation_field);var x=(y.clientX-z.left+document.body.scrollLeft)/t;var u=1-(y.clientY-z.top+document.body.scrollTop)/t;if(u>1){u=1}else{if(u<0){u=0}}if(x>1){x=1}else{if(x<0){x=0}}p.__color.v=u;p.__color.s=x;p.setValue(p.__color.toOriginal());return false}function o(v){v.preventDefault();var u=d.getHeight(p.__hue_field);var w=d.getOffset(p.__hue_field);var t=1-(v.clientY-w.top+document.body.scrollTop)/u;if(t>1){t=1}else{if(t<0){t=0}}p.__color.h=t*360;p.setValue(p.__color.toOriginal());return false}};e.superclass=c;f.extend(e.prototype,c.prototype,{updateDisplay:function(){var k=b(this.getValue());if(k!==false){var j=false;f.each(a.COMPONENTS,function(n){if(!f.isUndefined(k[n])&&!f.isUndefined(this.__color.__state[n])&&k[n]!==this.__color.__state[n]){j=true;return{}}},this);if(j){f.extend(this.__color.__state,k)}}f.extend(this.__temp.__state,this.__color.__state);this.__temp.a=1;var m=(this.__color.v<0.5||this.__color.s>0.5)?255:0;var l=255-m;f.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+m+","+m+","+m+")"});this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px";this.__temp.s=1;this.__temp.v=1;g(this.__saturation_field,"left","#fff",this.__temp.toString());f.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+m+","+m+","+m+")",textShadow:this.__input_textShadow+"rgba("+l+","+l+","+l+",.7)"})}});var h=["-moz-","-o-","-webkit-","-ms-",""];function g(m,k,l,j){m.style.background="";f.each(h,function(n){m.style.cssText+="background: "+n+"linear-gradient("+k+", "+l+" 0%, "+j+" 100%); "})}function i(j){j.style.background="";j.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);";j.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";j.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";j.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";j.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}return e})(dat.controllers.Controller,dat.dom.dom,dat.color.Color=(function(b,h,c,g){var a=function(){this.__state=b.apply(this,arguments);if(this.__state===false){throw"Failed to interpret color arguments"}this.__state.a=this.__state.a||1};a.COMPONENTS=["r","g","b","h","s","v","hex","a"];g.extend(a.prototype,{toString:function(){return c(this)},toOriginal:function(){return this.__state.conversion.write(this)}});f(a.prototype,"r",2);f(a.prototype,"g",1);f(a.prototype,"b",0);i(a.prototype,"h");i(a.prototype,"s");i(a.prototype,"v");Object.defineProperty(a.prototype,"a",{get:function(){return this.__state.a},set:function(j){this.__state.a=j}});Object.defineProperty(a.prototype,"hex",{get:function(){if(!this.__state.space!=="HEX"){this.__state.hex=h.rgb_to_hex(this.r,this.g,this.b)}return this.__state.hex},set:function(j){this.__state.space="HEX";this.__state.hex=j}});function f(l,k,j){Object.defineProperty(l,k,{get:function(){if(this.__state.space==="RGB"){return this.__state[k]}e(this,k,j);return this.__state[k]},set:function(m){if(this.__state.space!=="RGB"){e(this,k,j);this.__state.space="RGB"}this.__state[k]=m}})}function i(k,j){Object.defineProperty(k,j,{get:function(){if(this.__state.space==="HSV"){return this.__state[j]}d(this);return this.__state[j]},set:function(l){if(this.__state.space!=="HSV"){d(this);this.__state.space="HSV"}this.__state[j]=l}})}function e(j,l,k){if(j.__state.space==="HEX"){j.__state[l]=h.component_from_hex(j.__state.hex,k)}else{if(j.__state.space==="HSV"){g.extend(j.__state,h.hsv_to_rgb(j.__state.h,j.__state.s,j.__state.v))}else{throw"Corrupted color state"}}}function d(k){var j=h.rgb_to_hsv(k.r,k.g,k.b);g.extend(k.__state,{s:j.s,v:j.v});if(!g.isNaN(j.h)){k.__state.h=j.h}else{if(g.isUndefined(k.__state.h)){k.__state.h=0}}}return a})(dat.color.interpret,dat.color.math=(function(){var a;return{hsv_to_rgb:function(g,m,k){var e=Math.floor(g/60)%6;var i=g/60-Math.floor(g/60);var d=k*(1-m);var b=k*(1-(i*m));var l=k*(1-((1-i)*m));var j=[[k,l,d],[b,k,d],[d,k,l],[d,b,k],[l,d,k],[k,d,b]][e];return{r:j[0]*255,g:j[1]*255,b:j[2]*255}},rgb_to_hsv:function(k,j,d){var e=Math.min(k,j,d),c=Math.max(k,j,d),l=c-e,i,f;if(c!=0){f=l/c}else{return{h:NaN,s:0,v:0}}if(k==c){i=(j-d)/l}else{if(j==c){i=2+(d-k)/l}else{i=4+(k-j)/l}}i/=6;if(i<0){i+=1}return{h:i*360,s:f,v:c/255}},rgb_to_hex:function(f,e,c){var d=this.hex_with_component(0,2,f);d=this.hex_with_component(d,1,e);d=this.hex_with_component(d,0,c);return d},component_from_hex:function(c,b){return(c>>(b*8))&255},hex_with_component:function(c,b,d){return d<<(a=b*8)|(c&~(255<<a))}}})(),dat.color.toString,dat.utils.common),dat.color.interpret,dat.utils.common),dat.utils.requestAnimationFrame=(function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b,a){window.setTimeout(b,1000/60)}})(),dat.dom.CenteredDiv=(function(d,c){var b=function(){this.backgroundElement=document.createElement("div");c.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"});d.makeFullscreen(this.backgroundElement);this.backgroundElement.style.position="fixed";this.domElement=document.createElement("div");c.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"});document.body.appendChild(this.backgroundElement);document.body.appendChild(this.domElement);var e=this;d.bind(this.backgroundElement,"click",function(){e.hide()})};b.prototype.show=function(){var e=this;this.backgroundElement.style.display="block";this.domElement.style.display="block";this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)";this.layout();c.defer(function(){e.backgroundElement.style.opacity=1;e.domElement.style.opacity=1;e.domElement.style.webkitTransform="scale(1)"})};b.prototype.hide=function(){var f=this;var e=function(){f.domElement.style.display="none";f.backgroundElement.style.display="none";d.unbind(f.domElement,"webkitTransitionEnd",e);d.unbind(f.domElement,"transitionend",e);d.unbind(f.domElement,"oTransitionEnd",e)};d.bind(this.domElement,"webkitTransitionEnd",e);d.bind(this.domElement,"transitionend",e);d.bind(this.domElement,"oTransitionEnd",e);this.backgroundElement.style.opacity=0;this.domElement.style.opacity=0;this.domElement.style.webkitTransform="scale(1.1)"};b.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-d.getWidth(this.domElement)/2+"px";this.domElement.style.top=window.innerHeight/2-d.getHeight(this.domElement)/2+"px"};function a(f){console.log(f)}return b})(dat.dom.dom,dat.utils.common),dat.dom.dom,dat.utils.common);Detector={canvas:!!window.CanvasRenderingContext2D,webgl:(function(){try{return !!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(a){return false}})(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");a.id="webgl-error-message";a.style.fontFamily="monospace";a.style.fontSize="13px";a.style.fontWeight="normal";a.style.textAlign="center";a.style.background="#fff";a.style.color="#000";a.style.padding="1.5em";a.style.width="400px";a.style.margin="5em auto 0";if(!this.webgl){a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")}return a},addGetWebGLMessage:function(c){var b,d,a;c=c||{};b=c.parent!==undefined?c.parent:document.body;d=c.id!==undefined?c.id:"oldie";a=Detector.getWebGLErrorMessage();a.id=d;b.appendChild(a)}};THREE.ColladaLoader=function(){var al=null;var G=null;var W;var aI=null;var Z={};var k={};var O={};var ae={};var ap={};var Q={};var ar={};var ad={};var aM;var aG;var aP;var f;var J;var s=true;var P=THREE.SmoothShading;var ab={centerGeometry:false,convertUpAxis:false,subdivideFaces:true,upAxis:"Y",defaultEnvMap:null};var aO=1;var at="Y";var y=null;var z=Math.PI/180;function g(aY,a2,a1){var a0=0;if(document.implementation&&document.implementation.createDocument){var aZ=new XMLHttpRequest();aZ.onreadystatechange=function(){if(aZ.readyState==4){if(aZ.status==0||aZ.status==200){if(aZ.responseXML){aI=a2;ak(aZ.responseXML,undefined,aY)}else{console.error("ColladaLoader: Empty or non-existing file ("+aY+")")}}}else{if(aZ.readyState==3){if(a1){if(a0==0){a0=aZ.getResponseHeader("Content-Length")}a1({total:a0,loaded:aZ.responseText.length})}}}};aZ.open("GET",aY,true);aZ.send(null)}else{alert("Don't know how to parse XML!")}}function ak(a3,a1,aZ){al=a3;a1=a1||aI;if(aZ!==undefined){var a2=aZ.split("/");a2.pop();aP=(a2.length<1?".":a2.join("/"))+"/"}x();U();k=ax("//dae:library_images/dae:image",ac,"image");Q=ax("//dae:library_materials/dae:material",c,"material");ar=ax("//dae:library_effects/dae:effect",N,"effect");ap=ax("//dae:library_geometries/dae:geometry",az,"geometry");ad=ax(".//dae:library_cameras/dae:camera",aN,"camera");ae=ax("//dae:library_controllers/dae:controller",I,"controller");O=ax("//dae:library_animations/dae:animation",aQ,"animation");aG=ax(".//dae:library_visual_scenes/dae:visual_scene",aJ,"visual_scene");f=[];J=[];W=X();G=new THREE.Object3D();for(var a0=0;a0<W.nodes.length;a0++){G.add(d(W.nodes[a0]))}u();var aY={scene:G,morphs:f,skins:J,animations:aM,dae:{images:k,materials:Q,cameras:ad,effects:ar,geometries:ap,controllers:ae,animations:O,visualScenes:aG,scene:W}};if(a1){a1(aY)}return aY}function C(aY){P=aY}function x(){var a1=al.evaluate("//dae:asset",al,aU,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var aZ=a1.iterateNext();if(aZ&&aZ.childNodes){for(var aY=0;aY<aZ.childNodes.length;aY++){var a2=aZ.childNodes[aY];switch(a2.nodeName){case"unit":var a0=a2.getAttribute("meter");if(a0){aO=parseFloat(a0)}break;case"up_axis":at=a2.textContent.charAt(0);break}}}}function ax(a4,a1,a3){var a2=al.evaluate(a4,al,aU,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a5={};var a0=a2.iterateNext();var aZ=0;while(a0){var aY=(new a1()).parse(a0);if(!aY.id||aY.id.length==0){aY.id=a3+(aZ++)}a5[aY.id]=aY;a0=a2.iterateNext()}return a5}function X(){var aZ=al.evaluate(".//dae:scene/dae:instance_visual_scene",al,aU,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext();if(aZ){var aY=aZ.getAttribute("url").replace(/^#/,"");return aG[aY.length>0?aY:"visual_scene0"]}else{return null}}function u(){aM=[];o(G)}function o(a3){var a5=W.getChildById(a3.name,true),a2=null;if(a5&&a5.keys){a2={fps:60,hierarchy:[{node:a5,keys:a5.keys,sids:a5.sids}],node:a3,name:"animation_"+a3.name,length:0};aM.push(a2);for(var a1=0,aY=a5.keys.length;a1<aY;a1++){a2.length=Math.max(a2.length,a5.keys[a1].time)}}else{a2={hierarchy:[{keys:[],sids:[]}]}}for(var a1=0,aY=a3.children.length;a1<aY;a1++){var a4=o(a3.children[a1]);for(var aZ=0,a0=a4.hierarchy.length;aZ<a0;aZ++){a2.hierarchy.push({keys:[],sids:[]})}}return a2}function H(){var a4=1000000;var aY=-a4;var a2=0;for(var a3 in O){var a1=O[a3];for(var a0=0;a0<a1.sampler.length;a0++){var aZ=a1.sampler[a0];aZ.create();a4=Math.min(a4,aZ.startTime);aY=Math.max(aY,aZ.endTime);a2=Math.max(a2,aZ.input.length)}}return{start:a4,end:aY,frames:a2}}function m(a5,a2){var a4=a2 instanceof D?ae[a2.url]:a2;if(!a4||!a4.morph){console.log("could not find morph controller!");return}var a1=a4.morph;for(var a0=0;a0<a1.targets.length;a0++){var aZ=a1.targets[a0];var aY=ap[aZ];if(!aY.mesh||!aY.mesh.primitives||!aY.mesh.primitives.length){continue}var a3=aY.mesh.primitives[0].geometry;if(a3.vertices.length===a5.vertices.length){a5.morphTargets.push({name:"target_1",vertices:a3.vertices})}}a5.morphTargets.push({name:"target_Z",vertices:a5.vertices})}function aK(a5,aY,a3){var aZ=ae[aY.url];if(!aZ||!aZ.skin){console.log("could not find skin controller!");return}if(!aY.skeleton||!aY.skeleton.length){console.log("could not find the skeleton for the skin!");return}var a6=aZ.skin;var a1=W.getChildById(aY.skeleton[0]);var a4=[];a3=a3!==undefined?a3:true;var a0=[];a5.skinWeights=[];a5.skinIndices=[];if(a3){for(var a2=0;a2<a5.vertices.length;a2++){a6.bindShapeMatrix.multiplyVector3(a5.vertices[a2])}}}function B(a3,aZ,a4,a1){a3.world=a3.world||new THREE.Matrix4();a3.world.copy(a3.matrix);if(a3.channels&&a3.channels.length){var a2=a3.channels[0];var aY=a2.sampler.output[a4];if(aY instanceof THREE.Matrix4){a3.world.copy(aY)}}if(a1){a3.world.multiply(a1,a3.world)}aZ.push(a3);for(var a0=0;a0<a3.nodes.length;a0++){B(a3.nodes[a0],aZ,a4,a3.world)}}function S(aY,a5){for(var a1=0;a1<aY.length;a1++){var a4=aY[a1];var a6=-1;if(a4.type!="JOINT"){continue}for(var a0=0;a0<a5.joints.length;a0++){if(a4.sid==a5.joints[a0]){a6=a0;break}}if(a6>=0){var a2=a5.invBindMatrices[a6];a4.invBindMatrix=a2;a4.skinningMatrix=new THREE.Matrix4();a4.skinningMatrix.multiply(a4.world,a2);a4.weights=[];for(var a0=0;a0<a5.weights.length;a0++){for(var aZ=0;aZ<a5.weights[a0].length;aZ++){var a3=a5.weights[a0][aZ];if(a3.joint==a6){a4.weights.push(a3)}}}}else{throw"ColladaLoader: Could not find joint '"+a4.sid+"'."}}}function aR(a9,ba,a0){var a7=ae[ba.url];a0=a0!==undefined?a0:40;if(!a7||!a7.skin){console.log("ColladaLoader: Could not find skin controller.");return}if(!ba.skeleton||!ba.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ");return}var a6=H();var a2=W.getChildById(ba.skeleton[0],true)||W.getChildBySid(ba.skeleton[0],true);var a4,a3,bb,aY,a5;var bc=new THREE.Vector3(),aZ,bd;for(a4=0;a4<a9.vertices.length;a4++){a7.skin.bindShapeMatrix.multiplyVector3(a9.vertices[a4])}for(a0=0;a0<a6.frames;a0++){var a1=[];var a8=[];for(a4=0;a4<a9.vertices.length;a4++){a8.push(new THREE.Vector3())}B(a2,a1,a0);S(a1,a7.skin);for(a4=0;a4<a1.length;a4++){if(a1[a4].type!="JOINT"){continue}for(a3=0;a3<a1[a4].weights.length;a3++){bb=a1[a4].weights[a3];aY=bb.index;a5=bb.weight;aZ=a9.vertices[aY];bd=a8[aY];bc.x=aZ.x;bc.y=aZ.y;bc.z=aZ.z;a1[a4].skinningMatrix.multiplyVector3(bc);bd.x+=(bc.x*a5);bd.y+=(bc.y*a5);bd.z+=(bc.z*a5)}}a9.morphTargets.push({name:"target_"+a0,vertices:a8})}}function d(bm,a8){var bd=new THREE.Object3D();var bb=false;var a6;var bh;var bp,bn;for(bp=0;bp<bm.controllers.length;bp++){var bj=ae[bm.controllers[bp].url];switch(bj.type){case"skin":if(ap[bj.skin.source]){var bf=new av();bf.url=bj.skin.source;bf.instance_material=bm.controllers[bp].instance_material;bm.geometries.push(bf);bb=true;a6=bm.controllers[bp]}else{if(ae[bj.skin.source]){var bt=ae[bj.skin.source];bh=bt;if(bt.morph&&ap[bt.morph.source]){var bf=new av();bf.url=bt.morph.source;bf.instance_material=bm.controllers[bp].instance_material;bm.geometries.push(bf)}}}break;case"morph":if(ap[bj.morph.source]){var bf=new av();bf.url=bj.morph.source;bf.instance_material=bm.controllers[bp].instance_material;bm.geometries.push(bf);bh=bm.controllers[bp]}console.log("ColladaLoader: Morph-controller partially supported.");default:break}}var a1={};for(bp=0;bp<bm.geometries.length;bp++){var bo=bm.geometries[bp];var a9=bo.instance_material;var a3=ap[bo.url];var a5={};var br=[];var be=0;var a0;if(a3){if(!a3.mesh||!a3.mesh.primitives){continue}if(bd.name.length==0){bd.name=a3.id}if(a9){for(bn=0;bn<a9.length;bn++){var bi=a9[bn];var bq=Q[bi.target];var a4=bq.instance_effect.url;var aY=ar[a4].shader;var bk=aY.material;if(a3.doubleSided){if(!(bk in a1)){var ba=bk.clone();ba.side=THREE.DoubleSide;a1[bk]=ba}bk=a1[bk]}bk.opacity=!bk.opacity?1:bk.opacity;a5[bi.symbol]=be;br.push(bk);a0=bk;a0.name=bq.name==null||bq.name===""?bq.id:bq.name;be++}}var aZ;var bc=a0||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading,side:a3.doubleSided?THREE.DoubleSide:THREE.FrontSide});var bl=a3.mesh.geometry3js;if(be>1){bc=new THREE.MeshFaceMaterial();bl.materials=br;for(bn=0;bn<bl.faces.length;bn++){var a7=bl.faces[bn];a7.materialIndex=a5[a7.daeMaterial]}}if(a6!==undefined){aR(bl,a6);bc.morphTargets=true;aZ=new THREE.SkinnedMesh(bl,bc,false);aZ.skeleton=a6.skeleton;aZ.skinController=ae[a6.url];aZ.skinInstanceController=a6;aZ.name="skin_"+J.length;J.push(aZ)}else{if(bh!==undefined){m(bl,bh);bc.morphTargets=true;aZ=new THREE.Mesh(bl,bc);aZ.name="morph_"+f.length;f.push(aZ)}else{aZ=new THREE.Mesh(bl,bc)}}bm.geometries.length>1?bd.add(aZ):bd=aZ}}for(bp=0;bp<bm.cameras.length;bp++){var bg=bm.cameras[bp];var bu=ad[bg.url];bd=new THREE.PerspectiveCamera(bu.fov,bu.aspect_ratio,bu.znear,bu.zfar)}bd.name=bm.id||"";bd.matrix=bm.matrix;var a2=bm.matrix.decompose();bd.position=a2[0];bd.quaternion=a2[1];bd.useQuaternion=true;bd.scale=a2[2];if(ab.centerGeometry&&bd.geometry){var bs=THREE.GeometryUtils.center(bd.geometry);bd.quaternion.multiplyVector3(bs.multiplySelf(bd.scale));bd.position.subSelf(bs)}for(bp=0;bp<bm.nodes.length;bp++){bd.add(d(bm.nodes[bp],bm))}return bd}function n(aZ,a0){for(var aY=0;aY<aZ.joints.length;aY++){if(aZ.joints[aY]==a0){return aY}}}function K(aY){return al.evaluate(".//dae:library_nodes//dae:node[@id='"+aY+"']",al,aU,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext()}function q(a0){var a3=[];var aZ=1000000;var a4=-1000000;for(var aY in O){var a1=O[aY];for(var a2=0;a2<a1.channel.length;a2++){var a5=a1.channel[a2];var a6=a1.sampler[a2];var aY=a5.target.split("/")[0];if(aY==a0.id){a6.create();a5.sampler=a6;aZ=Math.min(aZ,a6.startTime);a4=Math.max(a4,a6.endTime);a3.push(a5)}}}if(a3.length){a0.startTime=aZ;a0.endTime=a4}return a3}function aT(a3){var a1=10000000;for(var a0=0;a0<a3.channels.length;a0++){var aZ=a3.channels[a0].sampler;for(var aY=0;aY<aZ.input.length-1;aY++){var a4=aZ.input[aY];var a2=aZ.input[aY+1];a1=Math.min(a1,a2-a4)}}return a1}function aa(aZ,a7){var a0={};var a2,a1;for(a2=0;a2<aZ.channels.length;a2++){var a3=aZ.channels[a2];a0[a3.sid]=a3}var a5=new THREE.Matrix4();for(a2=0;a2<aZ.transforms.length;a2++){var aY=aZ.transforms[a2];var a3=a0[aY.sid];if(a3!==undefined){var a4=a3.sampler;var a6;for(a1=0;a1<a4.input.length-1;a1++){if(a4.input[a1+1]>a7){a6=a4.output[a1];break}}if(a6!==undefined){if(a6 instanceof THREE.Matrix4){a5=a5.multiply(a5,a6)}else{a5=a5.multiply(a5,aY.matrix)}}else{a5=a5.multiply(a5,aY.matrix)}}else{a5=a5.multiply(a5,aY.matrix)}}return a5}function aD(a8){if(a8.channels&&a8.channels.length){var a6=[],bc=[];for(var ba=0,a3=a8.channels.length;ba<a3;ba++){var bf=a8.channels[ba],aY=bf.fullSid,a7=bf.sampler,a4=a7.input,a5=a8.getTransformBySid(bf.sid),aZ;if(bf.arrIndices){aZ=[];for(var a9=0,bb=bf.arrIndices.length;a9<bb;a9++){aZ[a9]=ay(bf.arrIndices[a9])}}else{aZ=T(bf.member)}if(a5){if(bc.indexOf(aY)===-1){bc.push(aY)}for(var a9=0,bb=a4.length;a9<bb;a9++){var a2=a4[a9],bd=a7.getData(a5.type,a9),be=an(a6,a2);if(!be){be=new af(a2);var a1=v(a6,a2);a6.splice(a1==-1?a6.length:a1,0,be)}be.addTarget(aY,a5,aZ,bd)}}else{console.log('Could not find transform "'+bf.sid+'" in node '+a8.id)}}for(var ba=0;ba<bc.length;ba++){var a0=bc[ba];for(var a9=0;a9<a6.length;a9++){var be=a6[a9];if(!be.hasTarget(a0)){t(a6,be,a9,a0)}}}a8.keys=a6;a8.sids=bc}}function an(a1,a3){var a2=null;for(var a0=0,aY=a1.length;a0<aY&&a2==null;a0++){var aZ=a1[a0];if(aZ.time===a3){a2=aZ}else{if(aZ.time>a3){break}}}return a2}function v(a2,a3){var aZ=-1;for(var a1=0,aY=a2.length;a1<aY&&aZ==-1;a1++){var a0=a2[a1];if(a0.time>=a3){aZ=a1}}return aZ}function t(a8,a5,a6,a3){var a9=aw(a8,a3,a6?a6-1:0),a4=j(a8,a3,a6+1);if(a9&&a4){var aZ=(a5.time-a9.time)/(a4.time-a9.time),a7=a9.getTarget(a3),a2=a4.getTarget(a3).data,aY=a7.data,a1;if(a7.type==="matrix"){a1=aY}else{if(aY.length){a1=[];for(var a0=0;a0<aY.length;++a0){a1[a0]=aY[a0]+(a2[a0]-aY[a0])*aZ}}else{a1=aY+(a2-aY)*aZ}}a5.addTarget(a3,a7.transform,a7.member,a1)}}function j(a0,a1,aY){for(;aY<a0.length;aY++){var aZ=a0[aY];if(aZ.hasTarget(a1)){return aZ}}return null}function aw(a0,a1,aY){aY=aY>=0?aY:aY+a0.length;for(;aY>=0;aY--){var aZ=a0[aY];if(aZ.hasTarget(a1)){return aZ}}return null}function ac(){this.id="";this.init_from=""}ac.prototype.parse=function(aZ){this.id=aZ.getAttribute("id");for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];if(a0.nodeName=="init_from"){this.init_from=a0.textContent}}return this};function I(){this.id="";this.name="";this.type="";this.skin=null;this.morph=null}I.prototype.parse=function(aZ){this.id=aZ.getAttribute("id");this.name=aZ.getAttribute("name");this.type="none";for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];switch(a0.nodeName){case"skin":this.skin=(new p()).parse(a0);this.type=a0.nodeName;break;case"morph":this.morph=(new i()).parse(a0);this.type=a0.nodeName;break;default:break}}return this};function i(){this.method=null;this.source=null;this.targets=null;this.weights=null}i.prototype.parse=function(a2){var a0={};var aY=[];var a1;this.method=a2.getAttribute("method");this.source=a2.getAttribute("source").replace(/^#/,"");for(a1=0;a1<a2.childNodes.length;a1++){var a4=a2.childNodes[a1];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"source":var a3=(new aL()).parse(a4);a0[a3.id]=a3;break;case"targets":aY=this.parseInputs(a4);break;default:console.log(a4.nodeName);break}}for(a1=0;a1<aY.length;a1++){var aZ=aY[a1];var a3=a0[aZ.source];switch(aZ.semantic){case"MORPH_TARGET":this.targets=a3.read();break;case"MORPH_WEIGHT":this.weights=a3.read();break;default:break}}return this};i.prototype.parseInputs=function(a0){var aY=[];for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"input":aY.push((new a()).parse(a1));break;default:break}}return aY};function p(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}p.prototype.parse=function(a1){var aZ={};var aY,a2;this.source=a1.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var a0=0;a0<a1.childNodes.length;a0++){var a5=a1.childNodes[a0];if(a5.nodeType!=1){continue}switch(a5.nodeName){case"bind_shape_matrix":var a3=e(a5.textContent);this.bindShapeMatrix=aj(a3);break;case"source":var a4=new aL().parse(a5);aZ[a4.id]=a4;break;case"joints":aY=a5;break;case"vertex_weights":a2=a5;break;default:console.log(a5.nodeName);break}}this.parseJoints(aY,aZ);this.parseWeights(a2,aZ);return this};p.prototype.parseJoints=function(a1,aZ){for(var a0=0;a0<a1.childNodes.length;a0++){var a3=a1.childNodes[a0];if(a3.nodeType!=1){continue}switch(a3.nodeName){case"input":var aY=(new a()).parse(a3);var a2=aZ[aY.source];if(aY.semantic=="JOINT"){this.joints=a2.read()}else{if(aY.semantic=="INV_BIND_MATRIX"){this.invBindMatrices=a2.read()}}break;default:break}}};p.prototype.parseWeights=function(a3,aY){var bc,a9,a6=[];for(var a4=0;a4<a3.childNodes.length;a4++){var aZ=a3.childNodes[a4];if(aZ.nodeType!=1){continue}switch(aZ.nodeName){case"input":a6.push((new a()).parse(aZ));break;case"v":bc=aS(aZ.textContent);break;case"vcount":a9=aS(aZ.textContent);break;default:break}}var a7=0;for(var a4=0;a4<a9.length;a4++){var a1=a9[a4];var a5=[];for(var a2=0;a2<a1;a2++){var a8={};for(var a0=0;a0<a6.length;a0++){var ba=a6[a0];var bb=bc[a7+ba.offset];switch(ba.semantic){case"JOINT":a8.joint=bb;break;case"WEIGHT":a8.weight=aY[ba.source].data[bb];break;default:break}}a5.push(a8);a7+=a6.length}for(var a2=0;a2<a5.length;a2++){a5[a2].index=a4}this.weights.push(a5)}};function aJ(){this.id="";this.name="";this.nodes=[];this.scene=new THREE.Object3D()}aJ.prototype.getChildById=function(a1,aY){for(var aZ=0;aZ<this.nodes.length;aZ++){var a0=this.nodes[aZ].getChildById(a1,aY);if(a0){return a0}}return null};aJ.prototype.getChildBySid=function(aY,aZ){for(var a0=0;a0<this.nodes.length;a0++){var a1=this.nodes[a0].getChildBySid(aY,aZ);if(a1){return a1}}return null};aJ.prototype.parse=function(aZ){this.id=aZ.getAttribute("id");this.name=aZ.getAttribute("name");this.nodes=[];for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];if(a0.nodeType!=1){continue}switch(a0.nodeName){case"node":this.nodes.push((new aA()).parse(a0));break;default:break}}return this};function aA(){this.id="";this.name="";this.sid="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new THREE.Matrix4()}aA.prototype.getChannelForTransform=function(a8){for(var a4=0;a4<this.channels.length;a4++){var a5=this.channels[a4];var a2=a5.target.split("/");var aY=a2.shift();var aZ=a2.shift();var a6=(aZ.indexOf(".")>=0);var a7=(aZ.indexOf("(")>=0);var a1;var a3;if(a6){a2=aZ.split(".");aZ=a2.shift();a3=a2.shift()}else{if(a7){a1=aZ.split("(");aZ=a1.shift();for(var a0=0;a0<a1.length;a0++){a1[a0]=parseInt(a1[a0].replace(/\)/,""))}}}if(aZ==a8){a5.info={sid:aZ,dotSyntax:a6,arrSyntax:a7,arrIndices:a1};return a5}}return null};aA.prototype.getChildById=function(a1,aY){if(this.id==a1){return this}if(aY){for(var aZ=0;aZ<this.nodes.length;aZ++){var a0=this.nodes[aZ].getChildById(a1,aY);if(a0){return a0}}}return null};aA.prototype.getChildBySid=function(aY,aZ){if(this.sid==aY){return this}if(aZ){for(var a0=0;a0<this.nodes.length;a0++){var a1=this.nodes[a0].getChildBySid(aY,aZ);if(a1){return a1}}}return null};aA.prototype.getTransformBySid=function(aY){for(var aZ=0;aZ<this.transforms.length;aZ++){if(this.transforms[aZ].sid==aY){return this.transforms[aZ]}}return null};aA.prototype.parse=function(a0){var aY;this.id=a0.getAttribute("id");this.sid=a0.getAttribute("sid");this.name=a0.getAttribute("name");this.type=a0.getAttribute("type");this.type=this.type=="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.cameras=[];this.controllers=[];this.matrix=new THREE.Matrix4();for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a2=a0.childNodes[aZ];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"node":this.nodes.push((new aA()).parse(a2));break;case"instance_camera":this.cameras.push((new au()).parse(a2));break;case"instance_controller":this.controllers.push((new D()).parse(a2));break;case"instance_geometry":this.geometries.push((new av()).parse(a2));break;case"instance_light":break;case"instance_node":aY=a2.getAttribute("url").replace(/^#/,"");var a1=K(aY);if(a1){this.nodes.push((new aA()).parse(a1))}break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new aF()).parse(a2));break;case"extra":break;default:console.log(a2.nodeName);break}}this.channels=q(this);aD(this);this.updateMatrix();return this};aA.prototype.updateMatrix=function(){this.matrix.identity();for(var aY=0;aY<this.transforms.length;aY++){this.transforms[aY].apply(this.matrix)}};function aF(){this.sid="";this.type="";this.data=[];this.obj=null}aF.prototype.parse=function(aY){this.sid=aY.getAttribute("sid");this.type=aY.nodeName;this.data=e(aY.textContent);this.convert();return this};aF.prototype.convert=function(){switch(this.type){case"matrix":this.obj=aj(this.data);break;case"rotate":this.angle=this.data[3]*z;case"translate":R(this.data,-1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":R(this.data,1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type);break}};aF.prototype.apply=function(aY){switch(this.type){case"matrix":aY.multiplySelf(this.obj);break;case"translate":aY.translate(this.obj);break;case"rotate":aY.rotateByAxis(this.obj,this.angle);break;case"scale":aY.scale(this.obj);break}};aF.prototype.update=function(a0,a1){var aY=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(!a1){this.obj.copy(a0)}else{if(a1.length===1){switch(a1[0]){case 0:this.obj.n11=a0[0];this.obj.n21=a0[1];this.obj.n31=a0[2];this.obj.n41=a0[3];break;case 1:this.obj.n12=a0[0];this.obj.n22=a0[1];this.obj.n32=a0[2];this.obj.n42=a0[3];break;case 2:this.obj.n13=a0[0];this.obj.n23=a0[1];this.obj.n33=a0[2];this.obj.n43=a0[3];break;case 3:this.obj.n14=a0[0];this.obj.n24=a0[1];this.obj.n34=a0[2];this.obj.n44=a0[3];break}}else{if(a1.length===2){var aZ="n"+(a1[0]+1)+(a1[1]+1);this.obj[aZ]=a0}else{console.log("Incorrect addressing of matrix in transform.")}}}break;case"translate":case"scale":if(Object.prototype.toString.call(a1)==="[object Array]"){a1=aY[a1[0]]}switch(a1){case"X":this.obj.x=a0;break;case"Y":this.obj.y=a0;break;case"Z":this.obj.z=a0;break;default:this.obj.x=a0[0];this.obj.y=a0[1];this.obj.z=a0[2];break}break;case"rotate":if(Object.prototype.toString.call(a1)==="[object Array]"){a1=aY[a1[0]]}switch(a1){case"X":this.obj.x=a0;break;case"Y":this.obj.y=a0;break;case"Z":this.obj.z=a0;break;case"ANGLE":this.angle=a0*z;break;default:this.obj.x=a0[0];this.obj.y=a0[1];this.obj.z=a0[2];this.angle=a0[3]*z;break}break}};function D(){this.url="";this.skeleton=[];this.instance_material=[]}D.prototype.parse=function(a0){this.url=a0.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a2=a0.childNodes[aZ];if(a2.nodeType!==1){continue}switch(a2.nodeName){case"skeleton":this.skeleton.push(a2.textContent.replace(/^#/,""));break;case"bind_material":var a1=al.evaluate(".//dae:instance_material",a2,aU,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a1){var aY=a1.iterateNext();while(aY){this.instance_material.push((new h()).parse(aY));aY=a1.iterateNext()}}break;case"extra":break;default:break}}return this};function h(){this.symbol="";this.target=""}h.prototype.parse=function(aY){this.symbol=aY.getAttribute("symbol");this.target=aY.getAttribute("target").replace(/^#/,"");return this};function av(){this.url="";this.instance_material=[]}av.prototype.parse=function(a0){this.url=a0.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a2=a0.childNodes[aZ];if(a2.nodeType!=1){continue}if(a2.nodeName=="bind_material"){var a1=al.evaluate(".//dae:instance_material",a2,aU,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a1){var aY=a1.iterateNext();while(aY){this.instance_material.push((new h()).parse(aY));aY=a1.iterateNext()}}break}}return this};function az(){this.id="";this.mesh=null}az.prototype.parse=function(aZ){this.id=aZ.getAttribute("id");aE(this,aZ);for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];switch(a0.nodeName){case"mesh":this.mesh=(new ai(this)).parse(a0);break;case"extra":break;default:break}}return this};function ai(aY){this.geometry=aY.id;this.primitives=[];this.vertices=null;this.geometry3js=null}ai.prototype.parse=function(a2){this.primitives=[];var a1,a0;for(a1=0;a1<a2.childNodes.length;a1++){var a3=a2.childNodes[a1];switch(a3.nodeName){case"source":aV(a3);break;case"vertices":this.vertices=(new ah()).parse(a3);break;case"triangles":this.primitives.push((new Y().parse(a3)));break;case"polygons":this.primitives.push((new A().parse(a3)));break;case"polylist":this.primitives.push((new aB().parse(a3)));break;default:break}}this.geometry3js=new THREE.Geometry();var aZ=Z[this.vertices.input.POSITION.source].data;for(a1=0;a1<aZ.length;a1+=3){this.geometry3js.vertices.push(V(aZ,a1).clone())}for(a1=0;a1<this.primitives.length;a1++){var aY=this.primitives[a1];aY.setVertices(this.vertices);this.handlePrimitive(aY,this.geometry3js)}this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();if(this.geometry3js.calcNormals){this.geometry3js.computeVertexNormals();delete this.geometry3js.calcNormals}this.geometry3js.computeBoundingBox();return this};ai.prototype.handlePrimitive=function(a5,a0){var bn,bm,bg=a5.p,ba=a5.inputs;var aY,bf,a1;var a9,bl;var bj=0,bh=3,bd=0;var bv=[];for(bn=0;bn<ba.length;bn++){aY=ba[bn];var bi=aY.offset+1;bd=(bd<bi)?bi:bd;switch(aY.semantic){case"TEXCOORD":bv.push(aY.set);break}}for(var a7=0;a7<bg.length;++a7){var bk=bg[a7],bp=0;while(bp<bk.length){var a4=[];var bo=[];var bt=null;var bb=[];if(a5.vcount){bh=a5.vcount.length?a5.vcount[bj++]:a5.vcount}else{bh=bk.length/bd}for(bn=0;bn<bh;bn++){for(bm=0;bm<ba.length;bm++){aY=ba[bm];a9=Z[aY.source];bf=bk[bp+(bn*bd)+aY.offset];bl=a9.accessor.params.length;a1=bf*bl;switch(aY.semantic){case"VERTEX":a4.push(bf);break;case"NORMAL":bo.push(V(a9.data,a1));break;case"TEXCOORD":bt=bt||{};if(bt[aY.set]===undefined){bt[aY.set]=[]}bt[aY.set].push(new THREE.UV(a9.data[a1],a9.data[a1+1]));break;case"COLOR":bb.push(new THREE.Color().setRGB(a9.data[a1],a9.data[a1+1],a9.data[a1+2]));break;default:break}}}if(bo.length==0){aY=this.vertices.input.NORMAL;if(aY){a9=Z[aY.source];bl=a9.accessor.params.length;for(var a6=0,a8=a4.length;a6<a8;a6++){bo.push(V(a9.data,a4[a6]*bl))}}else{a0.calcNormals=true}}if(!bt){bt={};aY=this.vertices.input.TEXCOORD;if(aY){bv.push(aY.set);a9=Z[aY.source];bl=a9.accessor.params.length;for(var a6=0,a8=a4.length;a6<a8;a6++){a1=a4[a6]*bl;if(bt[aY.set]===undefined){bt[aY.set]=[]}bt[aY.set].push(new THREE.UV(a9.data[a1],1-a9.data[a1+1]))}}}if(bb.length==0){aY=this.vertices.input.COLOR;if(aY){a9=Z[aY.source];bl=a9.accessor.params.length;for(var a6=0,a8=a4.length;a6<a8;a6++){a1=a4[a6]*bl;bb.push(new THREE.Color().setRGB(a9.data[a1],a9.data[a1+1],a9.data[a1+2]))}}}var a2=null,a3=[],be,bc;if(bh===3){a3.push(new THREE.Face3(a4[0],a4[1],a4[2],bo,bb.length?bb:new THREE.Color()))}else{if(bh===4){a3.push(new THREE.Face4(a4[0],a4[1],a4[2],a4[3],bo,bb.length?bb:new THREE.Color()))}else{if(bh>4&&ab.subdivideFaces){var aZ=bb.length?bb:new THREE.Color(),bs,br,bq,bx,bw,bu;for(bm=1;bm<bh-1;){a3.push(new THREE.Face3(a4[0],a4[bm],a4[bm+1],[bo[0],bo[bm++],bo[bm]],aZ))}}}}if(a3.length){for(var a6=0,a8=a3.length;a6<a8;a6++){a2=a3[a6];a2.daeMaterial=a5.material;a0.faces.push(a2);for(bm=0;bm<bv.length;bm++){be=bt[bv[bm]];if(bh>4){bc=[be[0],be[a6+1],be[a6+2]]}else{if(bh===4){bc=[be[0],be[1],be[2],be[3]]}else{bc=[be[0],be[1],be[2]]}}if(!a0.faceVertexUvs[bm]){a0.faceVertexUvs[bm]=[]}a0.faceVertexUvs[bm].push(bc)}}}else{console.log("dropped face with vcount "+bh+" for geometry with id: "+a0.id)}bp+=bd*bh}}};function A(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new THREE.Geometry()}A.prototype.setVertices=function(aY){for(var aZ=0;aZ<this.inputs.length;aZ++){if(this.inputs[aZ].source==aY.id){this.inputs[aZ].source=aY.input.POSITION.source}}};A.prototype.parse=function(aZ){this.material=aZ.getAttribute("material");this.count=l(aZ,"count",0);for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];switch(a0.nodeName){case"input":this.inputs.push((new a()).parse(aZ.childNodes[aY]));break;case"vcount":this.vcount=aS(a0.textContent);break;case"p":this.p.push(aS(a0.textContent));break;case"ph":console.warn("polygon holes not yet supported!");break;default:break}}return this};function aB(){A.call(this);this.vcount=[]}aB.prototype=Object.create(A.prototype);function Y(){A.call(this);this.vcount=3}Y.prototype=Object.create(A.prototype);function aC(){this.source="";this.count=0;this.stride=0;this.params=[]}aC.prototype.parse=function(aZ){this.params=[];this.source=aZ.getAttribute("source");this.count=l(aZ,"count",0);this.stride=l(aZ,"stride",0);for(var aY=0;aY<aZ.childNodes.length;aY++){var a1=aZ.childNodes[aY];if(a1.nodeName=="param"){var a0={};a0.name=a1.getAttribute("name");a0.type=a1.getAttribute("type");this.params.push(a0)}}return this};function ah(){this.input={}}ah.prototype.parse=function(a0){this.id=a0.getAttribute("id");for(var aZ=0;aZ<a0.childNodes.length;aZ++){if(a0.childNodes[aZ].nodeName=="input"){var aY=(new a()).parse(a0.childNodes[aZ]);this.input[aY.semantic]=aY}}return this};function a(){this.semantic="";this.offset=0;this.source="";this.set=0}a.prototype.parse=function(aY){this.semantic=aY.getAttribute("semantic");this.source=aY.getAttribute("source").replace(/^#/,"");this.set=l(aY,"set",-1);this.offset=l(aY,"offset",0);if(this.semantic=="TEXCOORD"&&this.set<0){this.set=0}return this};function aL(aY){this.id=aY;this.type=null}aL.prototype.parse=function(a0){this.id=a0.getAttribute("id");for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];switch(a1.nodeName){case"bool_array":this.data=ag(a1.textContent);this.type=a1.nodeName;break;case"float_array":this.data=e(a1.textContent);this.type=a1.nodeName;break;case"int_array":this.data=aS(a1.textContent);this.type=a1.nodeName;break;case"IDREF_array":case"Name_array":this.data=F(a1.textContent);this.type=a1.nodeName;break;case"technique_common":for(var aY=0;aY<a1.childNodes.length;aY++){if(a1.childNodes[aY].nodeName=="accessor"){this.accessor=(new aC()).parse(a1.childNodes[aY]);break}}break;default:break}}return this};aL.prototype.read=function(){var aZ=[];var a2=this.accessor.params[0];switch(a2.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var a0=0;a0<this.data.length;a0+=16){var a1=this.data.slice(a0,a0+16);var aY=aj(a1);aZ.push(aY)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+a2.type+".");break}return aZ};function c(){this.id="";this.name="";this.instance_effect=null}c.prototype.parse=function(aZ){this.id=aZ.getAttribute("id");this.name=aZ.getAttribute("name");for(var aY=0;aY<aZ.childNodes.length;aY++){if(aZ.childNodes[aY].nodeName=="instance_effect"){this.instance_effect=(new w()).parse(aZ.childNodes[aY]);break}}return this};function am(){this.color=new THREE.Color(0);this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texture=null;this.texcoord=null;this.texOpts=null}am.prototype.isColor=function(){return(this.texture==null)};am.prototype.isTexture=function(){return(this.texture!=null)};am.prototype.parse=function(a0){for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"color":var aY=e(a1.textContent);this.color=new THREE.Color(0);this.color.setRGB(aY[0],aY[1],aY[2]);this.color.a=aY[3];break;case"texture":this.texture=a1.getAttribute("texture");this.texcoord=a1.getAttribute("texcoord");this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1,};this.parseTexture(a1);break;default:break}}return this};am.prototype.parseTexture=function(aZ){if(!aZ.childNodes){return this}if(aZ.childNodes[1]&&aZ.childNodes[1].nodeName==="extra"){aZ=aZ.childNodes[1];if(aZ.childNodes[1]&&aZ.childNodes[1].nodeName==="technique"){aZ=aZ.childNodes[1]}}for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];switch(a0.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[a0.nodeName]=parseFloat(a0.textContent);break;case"wrapU":case"wrapV":this.texOpts[a0.nodeName]=parseInt(a0.textContent);break;default:this.texOpts[a0.nodeName]=a0.textContent;break}}return this};function aq(aZ,aY){this.type=aZ;this.effect=aY;this.material=null}aq.prototype.parse=function(aZ){for(var aY=0;aY<aZ.childNodes.length;aY++){var a1=aZ.childNodes[aY];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[a1.nodeName]=(new am()).parse(a1);break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var a0=ao(a1,".//dae:float");if(a0.length>0){this[a1.nodeName]=parseFloat(a0[0].textContent)}break;default:break}}this.create();return this};aq.prototype.create=function(){var aY={};var a2=(this["transparency"]!==undefined&&this["transparency"]<1);for(var a3 in this){switch(a3){case"ambient":case"emission":case"diffuse":case"specular":var a0=this[a3];if(a0 instanceof am){if(a0.isTexture()){if(this.effect.sampler&&this.effect.surface){if(this.effect.sampler.source==this.effect.surface.sid){var a1=k[this.effect.surface.init_from];if(a1){var aZ=THREE.ImageUtils.loadTexture(aP+a1.init_from);aZ.wrapS=a0.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;aZ.wrapT=a0.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;aZ.offset.x=a0.texOpts.offsetU;aZ.offset.y=a0.texOpts.offsetV;aZ.repeat.x=a0.texOpts.repeatU;aZ.repeat.y=a0.texOpts.repeatV;aY.map=aZ;if(a3==="emission"){aY.emissive=16777215}}}}}else{if(a3==="diffuse"||!a2){if(a3==="emission"){aY.emissive=a0.color.getHex()}else{aY[a3]=a0.color.getHex()}}}}break;case"shininess":aY[a3]=this[a3];break;case"reflectivity":aY[a3]=this[a3];if(aY[a3]>0){aY.envMap=ab.defaultEnvMap}aY.combine=THREE.MixOperation;break;case"index_of_refraction":aY.refractionRatio=this[a3];if(this[a3]!==1){aY.envMap=ab.defaultEnvMap}break;case"transparency":if(a2){aY.transparent=true;aY.opacity=this[a3];a2=true}break;default:break}}aY.shading=P;aY.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide;switch(this.type){case"constant":aY.color=aY.emission;this.material=new THREE.MeshBasicMaterial(aY);break;case"phong":case"blinn":aY.color=aY.diffuse;this.material=new THREE.MeshPhongMaterial(aY);break;case"lambert":default:aY.color=aY.diffuse;this.material=new THREE.MeshLambertMaterial(aY);break}return this.material};function b(aY){this.effect=aY;this.init_from=null;this.format=null}b.prototype.parse=function(aZ){for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];if(a0.nodeType!=1){continue}switch(a0.nodeName){case"init_from":this.init_from=a0.textContent;break;case"format":this.format=a0.textContent;break;default:console.log("unhandled Surface prop: "+a0.nodeName);break}}return this};function M(aY){this.effect=aY;this.source=null;this.wrap_s=null;this.wrap_t=null;this.minfilter=null;this.magfilter=null;this.mipfilter=null}M.prototype.parse=function(aZ){for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];if(a0.nodeType!=1){continue}switch(a0.nodeName){case"source":this.source=a0.textContent;break;case"minfilter":this.minfilter=a0.textContent;break;case"magfilter":this.magfilter=a0.textContent;break;case"mipfilter":this.mipfilter=a0.textContent;break;case"wrap_s":this.wrap_s=a0.textContent;break;case"wrap_t":this.wrap_t=a0.textContent;break;default:console.log("unhandled Sampler2D prop: "+a0.nodeName);break}}return this};function N(){this.id="";this.name="";this.shader=null;this.surface=null;this.sampler=null}N.prototype.create=function(){if(this.shader==null){return null}};N.prototype.parse=function(aZ){this.id=aZ.getAttribute("id");this.name=aZ.getAttribute("name");aE(this,aZ);this.shader=null;for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];if(a0.nodeType!=1){continue}switch(a0.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(a0));break;default:break}}return this};N.prototype.parseNewparam=function(a0){var aY=a0.getAttribute("sid");for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"surface":this.surface=(new b(this)).parse(a1);this.surface.sid=aY;break;case"sampler2D":this.sampler=(new M(this)).parse(a1);this.sampler.sid=aY;break;case"extra":break;default:console.log(a1.nodeName);break}}};N.prototype.parseProfileCOMMON=function(a0){var a1;for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a2=a0.childNodes[aZ];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"profile_COMMON":this.parseProfileCOMMON(a2);break;case"technique":a1=a2;break;case"newparam":this.parseNewparam(a2);break;case"image":var aY=(new ac()).parse(a2);k[aY.id]=aY;break;case"extra":break;default:console.log(a2.nodeName);break}}return a1};N.prototype.parseTechnique=function(aZ){for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];if(a0.nodeType!=1){continue}switch(a0.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=(new aq(a0.nodeName,this)).parse(a0);break;default:break}}};function w(){this.url=""}w.prototype.parse=function(aY){this.url=aY.getAttribute("url").replace(/^#/,"");return this};function aQ(){this.id="";this.name="";this.source={};this.sampler=[];this.channel=[]}aQ.prototype.parse=function(a0){this.id=a0.getAttribute("id");this.name=a0.getAttribute("name");this.source={};for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a3=a0.childNodes[aZ];if(a3.nodeType!=1){continue}switch(a3.nodeName){case"animation":var a1=(new aQ()).parse(a3);for(var a2 in a1.source){this.source[a2]=a1.source[a2]}for(var aY=0;aY<a1.channel.length;aY++){this.channel.push(a1.channel[aY]);this.sampler.push(a1.sampler[aY])}break;case"source":var a2=(new aL()).parse(a3);this.source[a2.id]=a2;break;case"sampler":this.sampler.push((new E(this)).parse(a3));break;case"channel":this.channel.push((new L(this)).parse(a3));break;default:break}}return this};function L(aY){this.animation=aY;this.source="";this.target="";this.fullSid=null;this.sid=null;this.dotSyntax=null;this.arrSyntax=null;this.arrIndices=null;this.member=null}L.prototype.parse=function(a0){this.source=a0.getAttribute("source").replace(/^#/,"");this.target=a0.getAttribute("target");var a2=this.target.split("/");var a5=a2.shift();var aY=a2.shift();var a4=(aY.indexOf(".")>=0);var a1=(aY.indexOf("(")>=0);if(a4){a2=aY.split(".");this.sid=a2.shift();this.member=a2.shift()}else{if(a1){var a3=aY.split("(");this.sid=a3.shift();for(var aZ=0;aZ<a3.length;aZ++){a3[aZ]=parseInt(a3[aZ].replace(/\)/,""))}this.arrIndices=a3}else{this.sid=aY}}this.fullSid=aY;this.dotSyntax=a4;this.arrSyntax=a1;return this};function E(aY){this.id="";this.animation=aY;this.inputs=[];this.input=null;this.output=null;this.strideOut=null;this.interpolation=null;this.startTime=null;this.endTime=null;this.duration=0}E.prototype.parse=function(aZ){this.id=aZ.getAttribute("id");this.inputs=[];for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];if(a0.nodeType!=1){continue}switch(a0.nodeName){case"input":this.inputs.push((new a()).parse(a0));break;default:break}}return this};E.prototype.create=function(){for(var aZ=0;aZ<this.inputs.length;aZ++){var aY=this.inputs[aZ];var a0=this.animation.source[aY.source];switch(aY.semantic){case"INPUT":this.input=a0.read();break;case"OUTPUT":this.output=a0.read();this.strideOut=a0.accessor.stride;break;case"INTERPOLATION":this.interpolation=a0.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(aY.semantic);break}}this.startTime=0;this.endTime=0;this.duration=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(var aZ=0;aZ<this.input.length;aZ++){this.startTime=Math.min(this.startTime,this.input[aZ]);this.endTime=Math.max(this.endTime,this.input[aZ])}this.duration=this.endTime-this.startTime}};E.prototype.getData=function(a0,aY){var a1;if(a0==="matrix"&&this.strideOut===16){a1=this.output[aY]}else{if(this.strideOut>1){a1=[];aY*=this.strideOut;for(var aZ=0;aZ<this.strideOut;++aZ){a1[aZ]=this.output[aY+aZ]}if(this.strideOut===3){switch(a0){case"rotate":case"translate":R(a1,-1);break;case"scale":R(a1,1);break}}else{if(this.strideOut===4&&a0==="matrix"){R(a1,-1)}}}else{a1=this.output[aY]}}return a1};function af(aY){this.targets=[];this.time=aY}af.prototype.addTarget=function(a1,aY,a0,aZ){this.targets.push({sid:a1,member:a0,transform:aY,data:aZ})};af.prototype.apply=function(aY){for(var aZ=0;aZ<this.targets.length;++aZ){var a0=this.targets[aZ];if(!aY||a0.sid===aY){a0.transform.update(a0.data,a0.member)}}};af.prototype.getTarget=function(aZ){for(var aY=0;aY<this.targets.length;++aY){if(this.targets[aY].sid===aZ){return this.targets[aY]}}return null};af.prototype.hasTarget=function(aZ){for(var aY=0;aY<this.targets.length;++aY){if(this.targets[aY].sid===aZ){return true}}return false};af.prototype.interpolate=function(a7,a0){for(var a4=0;a4<this.targets.length;++a4){var a6=this.targets[a4],aY=a7.getTarget(a6.sid),a3;if(a6.transform.type!=="matrix"&&aY){var a1=(a0-this.time)/(a7.time-this.time),a5=aY.data,aZ=a6.data;if(a1<0||a1>1){console.log("Key.interpolate: Warning! Scale out of bounds:"+a1);a1=a1<0?0:1}if(aZ.length){a3=[];for(var a2=0;a2<aZ.length;++a2){a3[a2]=aZ[a2]+(a5[a2]-aZ[a2])*a1}}else{a3=aZ+(a5-aZ)*a1}}else{a3=a6.data}a6.transform.update(a3,a6.member)}};function aN(){this.id="";this.name="";this.technique=""}aN.prototype.parse=function(aZ){this.id=aZ.getAttribute("id");this.name=aZ.getAttribute("name");for(var aY=0;aY<aZ.childNodes.length;aY++){var a0=aZ.childNodes[aY];if(a0.nodeType!=1){continue}switch(a0.nodeName){case"optics":this.parseOptics(a0);break;default:break}}return this};aN.prototype.parseOptics=function(a2){for(var a1=0;a1<a2.childNodes.length;a1++){if(a2.childNodes[a1].nodeName=="technique_common"){var a4=a2.childNodes[a1];for(var a0=0;a0<a4.childNodes.length;a0++){this.technique=a4.childNodes[a0].nodeName;if(this.technique=="perspective"){var a3=a4.childNodes[a0];for(var aY=0;aY<a3.childNodes.length;aY++){var a5=a3.childNodes[aY];switch(a5.nodeName){case"yfov":this.yfov=a5.textContent;break;case"xfov":this.xfov=a5.textContent;break;case"znear":this.znear=a5.textContent;break;case"zfar":this.zfar=a5.textContent;break;case"aspect_ratio":this.aspect_ratio=a5.textContent;break}}}else{if(this.technique=="orthographic"){var aZ=a4.childNodes[a0];for(var aY=0;aY<aZ.childNodes.length;aY++){var a5=aZ.childNodes[aY];switch(a5.nodeName){case"xmag":this.xmag=a5.textContent;break;case"ymag":this.ymag=a5.textContent;break;case"znear":this.znear=a5.textContent;break;case"zfar":this.zfar=a5.textContent;break;case"aspect_ratio":this.aspect_ratio=a5.textContent;break}}}}}}}return this};function au(){this.url=""}au.prototype.parse=function(aY){this.url=aY.getAttribute("url").replace(/^#/,"");return this};function aV(aY){var aZ=aY.getAttribute("id");if(Z[aZ]!=undefined){return Z[aZ]}Z[aZ]=(new aL(aZ)).parse(aY);return Z[aZ]}function aU(aY){if(aY=="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function ag(a2){var aZ=F(a2);var a1=[];for(var a0=0,aY=aZ.length;a0<aY;a0++){a1.push((aZ[a0]=="true"||aZ[a0]=="1")?true:false)}return a1}function e(a2){var aZ=F(a2);var a1=[];for(var a0=0,aY=aZ.length;a0<aY;a0++){a1.push(parseFloat(aZ[a0]))}return a1}function aS(a2){var aZ=F(a2);var a1=[];for(var a0=0,aY=aZ.length;a0<aY;a0++){a1.push(parseInt(aZ[a0],10))}return a1}function F(aY){return(aY.length>0)?r(aY).split(/\s+/):[]}function r(aY){return aY.replace(/^\s+/,"").replace(/\s+$/,"")}function aW(a0,aZ,aY){if(a0.hasAttribute(aZ)){return parseFloat(a0.getAttribute(aZ))}else{return aY}}function l(a0,aZ,aY){if(a0.hasAttribute(aZ)){return parseInt(a0.getAttribute(aZ),10)}else{return aY}}function aH(a0,aZ,aY){if(a0.hasAttribute(aZ)){return a0.getAttribute(aZ)}else{return aY}}function aX(a0,aY){if(a0===undefined){var aZ="0.";while(aZ.length<aY+2){aZ+="0"}return aZ}aY=aY||2;var a1=a0.toString().split(".");a1[1]=a1.length>1?a1[1].substr(0,aY):"0";while(a1[1].length<aY){a1[1]+="0"}return a1.join(".")}function ao(aZ,a1){var a2=al.evaluate(a1,aZ,aU,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a0=a2.iterateNext();var aY=[];while(a0){aY.push(a0);a0=a2.iterateNext()}return aY}function aE(a0,aY){a0.doubleSided=false;var aZ=al.evaluate(".//dae:extra//dae:double_sided",aY,aU,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(aZ){aZ=aZ.iterateNext();if(aZ&&parseInt(aZ.textContent,10)===1){a0.doubleSided=true}}}function U(){if(!ab.convertUpAxis||at===ab.upAxis){y=null}else{switch(at){case"X":y=ab.upAxis==="Y"?"XtoY":"XtoZ";break;case"Y":y=ab.upAxis==="X"?"YtoX":"YtoZ";break;case"Z":y=ab.upAxis==="X"?"ZtoX":"ZtoY";break}}}function R(a0,aY){if(!ab.convertUpAxis||at===ab.upAxis){return}switch(y){case"XtoY":var aZ=a0[0];a0[0]=aY*a0[1];a0[1]=aZ;break;case"XtoZ":var aZ=a0[2];a0[2]=a0[1];a0[1]=a0[0];a0[0]=aZ;break;case"YtoX":var aZ=a0[0];a0[0]=a0[1];a0[1]=aY*aZ;break;case"YtoZ":var aZ=a0[1];a0[1]=aY*a0[2];a0[2]=aZ;break;case"ZtoX":var aZ=a0[0];a0[0]=a0[1];a0[1]=a0[2];a0[2]=aZ;break;case"ZtoY":var aZ=a0[1];a0[1]=a0[2];a0[2]=aY*aZ;break}}function V(aZ,a0){var aY=[aZ[a0],aZ[a0+1],aZ[a0+2]];R(aY,-1);return new THREE.Vector3(aY[0],aY[1],aY[2])}function aj(aZ){if(ab.convertUpAxis){var aY=[aZ[0],aZ[4],aZ[8]];R(aY,-1);aZ[0]=aY[0];aZ[4]=aY[1];aZ[8]=aY[2];aY=[aZ[1],aZ[5],aZ[9]];R(aY,-1);aZ[1]=aY[0];aZ[5]=aY[1];aZ[9]=aY[2];aY=[aZ[2],aZ[6],aZ[10]];R(aY,-1);aZ[2]=aY[0];aZ[6]=aY[1];aZ[10]=aY[2];aY=[aZ[0],aZ[1],aZ[2]];R(aY,-1);aZ[0]=aY[0];aZ[1]=aY[1];aZ[2]=aY[2];aY=[aZ[4],aZ[5],aZ[6]];R(aY,-1);aZ[4]=aY[0];aZ[5]=aY[1];aZ[6]=aY[2];aY=[aZ[8],aZ[9],aZ[10]];R(aY,-1);aZ[8]=aY[0];aZ[9]=aY[1];aZ[10]=aY[2];aY=[aZ[3],aZ[7],aZ[11]];R(aY,-1);aZ[3]=aY[0];aZ[7]=aY[1];aZ[11]=aY[2]}return new THREE.Matrix4(aZ[0],aZ[1],aZ[2],aZ[3],aZ[4],aZ[5],aZ[6],aZ[7],aZ[8],aZ[9],aZ[10],aZ[11],aZ[12],aZ[13],aZ[14],aZ[15])}function ay(aZ){if(aZ>-1&&aZ<3){var aY=["X","Y","Z"],a0={X:0,Y:1,Z:2};aZ=T(aY[aZ]);aZ=a0[aZ]}return aZ}function T(aY){if(ab.convertUpAxis){switch(aY){case"X":switch(y){case"XtoY":case"XtoZ":case"YtoX":aY="Y";break;case"ZtoX":aY="Z";break}break;case"Y":switch(y){case"XtoY":case"YtoX":case"ZtoX":aY="X";break;case"XtoZ":case"YtoZ":case"ZtoY":aY="Z";break}break;case"Z":switch(y){case"XtoZ":aY="X";break;case"YtoZ":case"ZtoX":case"ZtoY":aY="Y";break}break}}return aY}return{load:g,parse:ak,setPreferredShading:C,applySkin:aR,geometries:ap,options:ab}};THREE.TrackballControls=function(A,z){THREE.EventTarget.call(this);var q=this,s={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};this.object=A;this.domElement=(z!==undefined)?z:document;this.enabled=true;this.screen={width:0,height:0,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.pinchZoomTriggerDist=0.05;this.keys=[65,83,68];this.target=new THREE.Vector3();var j=new THREE.Vector3();var d=false,t=s.NONE,o=0,b=0,a=new THREE.Vector3(),n=new THREE.Vector3(),i=new THREE.Vector3(),k=new THREE.Vector2(),w=new THREE.Vector2(),e=new THREE.Vector2(),v=new THREE.Vector2();var y={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth;this.screen.height=window.innerHeight;this.screen.offsetLeft=0;this.screen.offsetTop=0;this.radius=(this.screen.width+this.screen.height)/4};this.handleEvent=function(B){if(typeof this[B.type]=="function"){this[B.type](B)}};this.getMouseOnScreen=function(C,B){return new THREE.Vector2((C-q.screen.offsetLeft)/q.radius*0.5,(B-q.screen.offsetTop)/q.radius*0.5)};this.getMouseProjectionOnBall=function(F,D){var C=new THREE.Vector3((F-q.screen.width*0.5-q.screen.offsetLeft)/q.radius,(q.screen.height*0.5+q.screen.offsetTop-D)/q.radius,0);var E=C.length();if(E>1){C.normalize()}else{C.z=Math.sqrt(1-E*E)}a.copy(q.object.position).subSelf(q.target);var B=q.object.up.clone().setLength(C.y);B.addSelf(q.object.up.clone().crossSelf(a).setLength(C.x));B.addSelf(a.setLength(C.z));return B};this.rotateCamera=function(){var D=Math.acos(n.dot(i)/n.length()/i.length());if(D){var B=(new THREE.Vector3()).cross(n,i).normalize(),C=new THREE.Quaternion();D*=q.rotateSpeed;C.setFromAxisAngle(B,-D);C.multiplyVector3(a);C.multiplyVector3(q.object.up);C.multiplyVector3(i);if(q.staticMoving){n.copy(i)}else{C.setFromAxisAngle(B,D*(q.dynamicDampingFactor-1));C.multiplyVector3(n)}}};this.zoomCamera=function(){var B=1+(w.y-k.y)*q.zoomSpeed;if(B!==1&&B>0){a.multiplyScalar(B);if(q.staticMoving){k.copy(w)}else{k.y+=(w.y-k.y)*this.dynamicDampingFactor}}};this.panCamera=function(){var B=v.clone().subSelf(e);if(B.lengthSq()){B.multiplyScalar(a.length()*q.panSpeed);var C=a.clone().crossSelf(q.object.up).setLength(B.x);C.addSelf(q.object.up.clone().setLength(B.y));q.object.position.addSelf(C);q.target.addSelf(C);if(q.staticMoving){e=v}else{e.addSelf(B.sub(v,e).multiplyScalar(q.dynamicDampingFactor))}}};this.checkDistances=function(){if(!q.noZoom||!q.noPan){if(q.object.position.lengthSq()>q.maxDistance*q.maxDistance){q.object.position.setLength(q.maxDistance)}if(a.lengthSq()<q.minDistance*q.minDistance){q.object.position.add(q.target,a.setLength(q.minDistance))}}};this.update=function(){a.copy(q.object.position).subSelf(q.target);if(!q.noRotate){q.rotateCamera()}if(!q.noZoom){q.zoomCamera()}if(!q.noPan){q.panCamera()}q.object.position.add(q.target,a);q.checkDistances();q.object.lookAt(q.target);if(j.distanceToSquared(q.object.position)>0){q.dispatchEvent(y);j.copy(q.object.position)}};function h(B){if(!q.enabled){return}if(t!==s.NONE){return}else{if(B.keyCode===q.keys[s.ROTATE]&&!q.noRotate){t=s.ROTATE}else{if(B.keyCode===q.keys[s.ZOOM]&&!q.noZoom){t=s.ZOOM}else{if(B.keyCode===q.keys[s.PAN]&&!q.noPan){t=s.PAN}}}}if(t!==s.NONE){d=true}}function f(B){if(!q.enabled){return}if(t!==s.NONE){t=s.NONE}}function m(B){if(!q.enabled){return}B.preventDefault();B.stopPropagation();if(t===s.NONE){t=B.button;if(t===s.ROTATE&&!q.noRotate){n=i=q.getMouseProjectionOnBall(B.clientX,B.clientY)}else{if(t===s.ZOOM&&!q.noZoom){k=w=q.getMouseOnScreen(B.clientX,B.clientY)}else{if(!q.noPan){e=v=q.getMouseOnScreen(B.clientX,B.clientY)}}}}}function x(B){if(!q.enabled){return}if(d){n=i=q.getMouseProjectionOnBall(B.clientX,B.clientY);k=w=q.getMouseOnScreen(B.clientX,B.clientY);e=v=q.getMouseOnScreen(B.clientX,B.clientY);d=false}if(t===s.NONE){return}else{if(t===s.ROTATE&&!q.noRotate){i=q.getMouseProjectionOnBall(B.clientX,B.clientY)}else{if(t===s.ZOOM&&!q.noZoom){w=q.getMouseOnScreen(B.clientX,B.clientY)}else{if(t===s.PAN&&!q.noPan){v=q.getMouseOnScreen(B.clientX,B.clientY)}}}}}function p(B){if(!q.enabled){return}B.preventDefault();B.stopPropagation();t=s.NONE;o=b=0}function l(B){if(!q.enabled){return}B.preventDefault();B.stopPropagation();var C=0;if(B.wheelDelta){C=B.wheelDelta/40}else{if(B.detail){C=-B.detail/3}}k.y+=(1/C)*0.05}function c(D,C){var B=D.x-C.x;var E=D.y-C.y;return Math.sqrt(B*B+E*E)}function r(E){var C=0,B=0;for(var D=0;D<E.length;D++){C+=E[D].clientX;B+=E[D].clientY}return[C/E.length,B/E.length]}function u(C){if(C.touches.length===1){var F=C.touches[0];C.clientX=F.clientX;C.clientY=F.clientY;C.button=0;m(C)}else{if(C.touches.length===2){var E=C.touches[0];var B=C.touches[1];t=s.PAN;var D=r(C.touches);e=v=q.getMouseOnScreen(D[0],D[1]);o=c(q.getMouseOnScreen(E.clientX,E.clientY),q.getMouseOnScreen(B.clientX,B.clientY))}}}function g(C){if(C.touches.length===1){var F=C.touches[0];C.clientX=F.clientX;C.clientY=F.clientY;x(C)}else{if(C.touches.length===2){var E=C.touches[0];var B=C.touches[1];if(t!==s.ZOOM){b=c(q.getMouseOnScreen(E.clientX,E.clientY),q.getMouseOnScreen(B.clientX,B.clientY));if((Math.abs(o-b))>q.pinchZoomTriggerDist){t=s.ZOOM;k=w=q.getMouseOnScreen(Math.abs(E.clientX-B.clientX)/2,Math.abs(E.clientY-B.clientY)/2)}else{if(t===s.PAN&&!q.noPan){var D=r(C.touches);v=q.getMouseOnScreen(D[0],D[1])}}}if(t===s.ZOOM&&!q.noZoom){w=q.getMouseOnScreen(Math.abs(E.clientX-B.clientX)/2,Math.abs(E.clientY-B.clientY)/2)}}}}this.domElement.addEventListener("contextmenu",function(B){B.preventDefault()},false);this.domElement.addEventListener("mousemove",x,false);this.domElement.addEventListener("mousedown",m,false);this.domElement.addEventListener("mouseup",p,false);this.domElement.addEventListener("touchmove",g,false);this.domElement.addEventListener("touchstart",u,false);this.domElement.addEventListener("touchend",p,false);this.domElement.addEventListener("DOMMouseScroll",l,false);this.domElement.addEventListener("mousewheel",l,false);window.addEventListener("keydown",h,false);window.addEventListener("keyup",f,false);this.handleResize()};var THREEx=THREEx||{};THREEx.FullScreen=THREEx.FullScreen||{};THREEx.FullScreen.available=function(){return this._hasWebkitFullScreen||this._hasMozFullScreen};THREEx.FullScreen.activated=function(){if(this._hasWebkitFullScreen){return document.webkitIsFullScreen}else{if(this._hasMozFullScreen){return document.mozFullScreen}else{console.assert(false)}}};THREEx.FullScreen.request=function(a){a=a||document.body;if(this._hasWebkitFullScreen){a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}else{if(this._hasMozFullScreen){a.mozRequestFullScreen()}else{console.assert(false)}}};THREEx.FullScreen.cancel=function(){if(this._hasWebkitFullScreen){document.webkitCancelFullScreen()}else{if(this._hasMozFullScreen){document.mozCancelFullScreen()}else{console.assert(false)}}};THREEx.FullScreen._hasWebkitFullScreen="webkitCancelFullScreen" in document?true:false;THREEx.FullScreen._hasMozFullScreen="mozCancelFullScreen" in document?true:false;THREEx.FullScreen.bindKey=function(f){f=f||{};var b=f.charCode||"f".charCodeAt(0);var g=f.dblclick!==undefined?f.dblclick:false;var e=f.element;var d=f.gui;var a=function(){if(THREEx.FullScreen.activated()){THREEx.FullScreen.cancel()}else{THREEx.FullScreen.request(e)}};var c=function(h){if(h.which!==b){return}a()}.bind(this);document.addEventListener("keypress",c,false);g&&document.addEventListener("dblclick",a,false);return{unbind:function(){document.removeEventListener("keypress",c,false);g&&document.removeEventListener("dblclick",a,false)}}};function parseUri(e){var d=parseUri.options,a=d.parser[d.strictMode?"strict":"loose"].exec(e),c={},b=14;while(b--){c[d.key[b]]=a[b]||""}c[d.q.name]={};c[d.key[12]].replace(d.q.parser,function(g,f,h){if(f){c[d.q.name][f]=h}});return c}parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};function alertBox(b){var c=document.getElementById("conAlert");if(b){if(c){c.innerHTML=b}else{var a=document.createElement("div");a.setAttribute("id","conAlert");a.innerHTML=b;a.style.position="absolute";a.style.width="400px";a.style.top="10px";a.style.left="50%";a.style.marginLeft="-200px";a.style.fontFamily="Impact, Charcoal, sans-serif";a.style.fontSize="1.5em";a.style.fontWeight="bold";a.style.textAlign="center";a.style.textShadow="0 4px 3px rgba(0, 0, 0, 0.4), 0 8px 10px rgba(0, 0, 0, 0.1), 0 8px 9px rgba(0, 0, 0, 0.1)";a.style.cursor="pointer";a.onclick=function(){a.parentNode.removeChild(a)};document.body.appendChild(a)}}else{if(c){c.parentNode.removeChild(c)}}}var WSManager=function(e,b,c){this.url="ws://"+e+":"+b;this.ws=null;this.reconnecting=false;this.connectTimer=null;var d={reconnectInterval:4000,timeout:5000};if(typeof(c==="undefined")){c=d}if(typeof(c.reconnectInterval)==="undefined"){c.reconnectInterval=d.reconnectInterval}this.reconnectInterval=c.reconnectInterval;if(typeof(c.timeout)==="undefined"){c.timeout=d.timeout}this.timeout=c.timeout;this.callbacks={};var a=function(f){if("WebSocket" in window){this.ws=new WebSocket(f)}else{if("MozWebSocket" in window){this.ws=new MozWebSocket(f)}else{alert("This Browser does not support WebSockets.  Use newest version of Google Chrome, FireFox or Opera. ");return}}this.ws.onopen=function(){if(this.connectTimer!=null){clearTimeout(this.connectTimer);this.connectTimer=null}console.log("WebSocket connection opened.");alertBox("Connected to server!");setTimeout(function(){alertBox()},2000);this.reconnecting=false}.bind(this);this.ws.onmessage=function(g){this.parseMessage(g.data)}.bind(this);this.ws.onclose=function(g){if(this.connectTimer!=null){clearTimeout(this.connectTimer);this.connectTimer=null}if(!this.reconnecting){alertBox("WebSocket connection failed. Attempting to reconnect...");this.triggerEvent("disconnected")}console.log("Reconnecting in "+this.reconnectInterval/1000+" seconds...");this.reconnecting=true;this.ws=null;setTimeout(function(){a(f)},this.reconnectInterval)}.bind(this);this.ws.onerror=function(g){console.log(g);alertBox("WebSocket error: "+g.message)};this.connectTimer=setTimeout(function(){this.ws.readyState=this.ws.CLOSED;this.ws.onclose();this.connectTimer=null}.bind(this),this.timeout)}.bind(this);a(this.url)};WSManager.prototype.parseMessage=function(b){var a=JSON.parse(b);this.processEvent(a)};WSManager.prototype.processEvent=function(a){if(a.event){console.log("Got event: "+a.event);if(a.data){this.triggerEvent(a.event,a.data)}}};WSManager.prototype.bind=function(a,b){this.callbacks[a]=this.callbacks[a]||[];this.callbacks[a].push(b);return this};WSManager.prototype.triggerEvent=function(a,d){var c=this.callbacks[a];if(typeof c=="undefined"){console.log("Error: Received an unknown event: "+a);return}for(var b=0;b<c.length;b++){c[b](d)}};if(!Detector.webgl){Detector.addGetWebGLMessage()}var _container,_objController,_sceneController={loadedObjects:[],renderer:null,camera:null,pointLight:null,scene:null,sceneParams:{colorMode:THREE.VertexColors,resolution:1,antiAlias:true,precision:"highp"},controls:null,loader:null},_gui={};var _connection={serverFiles:[],storageUrl:"",wsManager:null,ip:"",port:""};function isMobileBrowser(){if(typeof(window.mobile)!=="undefined"){return window.mobile}return false}function parseUrl(b){var a=parseUri(b);if(a.queryKey){var c=a.queryKey;if(c.ip){_connection.ip=c.ip}else{_connection.ip="127.0.0.1"}if(c.port){_connection.port=c.port}else{_connection.port="9002"}if(c.mobile){window.mobile=c.mobile==="1"}if(c.useProxy){_connection.useProxy=c.useProxy==="1"}}}function parseStorageUrl(b){var a=parseUri(b);if(a.directory.indexOf("/",a.directory.length-1)==-1){a.directory+="/"}var d=false;if(typeof(_connection.useProxy)==="undefined"){d=isMobileBrowser()}else{d=_connection.useProxy}var c="chiru.cie.fi:8000/";if(d){a.host=c+"?"+a.host}_connection.storageUrl="http://"+a.host+a.directory}function showInfoMsg(b){var a=document.getElementById("loading");if(a){if(b){a.innerHTML=b;if(a.style.display="none"){a.style.display="block"}}else{a.innerHTML="";a.style.display="none"}}}function windowResize(b,a){var c=function(){var d=_sceneController.sceneParams.resolution;b.setSize(window.innerWidth*d,window.innerHeight*d);a.aspect=(window.innerWidth*d)/(window.innerHeight*d);a.updateProjectionMatrix();_sceneController.controls.handleResize()};window.addEventListener("resize",c,false);return{stop:function(){window.removeEventListener("resize",c)}}}function setColorMode(e,d){var c=e.children,g=e.geometry;for(var b=0,a=c.length;b<a;b++){setColorMode(c[b],d)}if(g){var f=THREE.VertexColors;if(d==THREE.NoColors||d==THREE.FaceColors||d==THREE.VertexColors){f=d}e.material.vertexColors=parseInt(f);e.material.needsUpdate=true}}function initWSConnection(){parseUrl(location);console.log("Websocket ip: "+_connection.ip+" and port: "+_connection.port);_connection.wsManager=new WSManager(_connection.ip,_connection.port);_connection.wsManager.bind("newCollada",function(b){if(!(b in _connection.serverFiles)){console.log("A new collada was added in remote storage: "+b);_connection.serverFiles.push(b);_connection.serverFiles.sort();if(window.confirm("A new captured model was added to remote storage. Load the model?")){requestCollada(b)}var a=_gui.leftGui.fileList.domElement.children[0];a.options[a.options.length]=new Option(b,b);console.log(_connection.serverFiles)}});_connection.wsManager.bind("colladaList",function(b){_connection.serverFiles=b.list.split(", ");_connection.serverFiles.sort();var a=_gui.leftGui.fileList.domElement.children[0];_connection.serverFiles.forEach(function(c){a.options.add(new Option(c,c))});parseStorageUrl(b.storageUrl)});_connection.wsManager.bind("disconnected",function(){console.log("WebSocket closed.");_connection.serverFiles.length=0;var a=_gui.leftGui.fileList.domElement.children[0];while(a.options.length>1){a.options[1]=null}})}function requestCollada(f){var b=_sceneController.loadedObjects;for(var d=0;d<b.length;d++){if(b[d].name==f){console.log(f+" is loaded alredy.");removeFromScene(_objController.current);addToScene(b[d]);_objController.setCurrent(b[d]);return}}showInfoMsg("Requesting model...");var a=new THREE.ColladaLoader();a.options.convertUpAxis=true;_objController.loading=true;a.load(_connection.storageUrl+f,function e(h){var j=h.scene;setColorMode(j,_sceneController.sceneParams.colorMode);j.name=f;THREE.SceneUtils.traverseHierarchy(j,function(i){i.material.side=THREE.DoubleSide});_objController.loadNext="";_objController.loading=false;if(b.length>0){clearScene();console.log("removed earlier object from scene")}b.push(j);addToScene(j);_objController.setCurrent(j);var g=_gui.leftGui.fileList.domElement.children[0].options;for(var k=0;k<g.length;k++){if(g[k].label==j.name){g[k].style.backgroundColor="lightGreen";break}}j=null;cleanScene();_gui.leftGui.objectControls.open();showInfoMsg();a=null},function c(g){showInfoMsg("Downloading model...  Loaded: "+Math.ceil((g.loaded/1000000)*100)/100+" MB")});console.log("Requested file: "+_connection.storageUrl+f)}function addToScene(a){_sceneController.scene.add(a)}function removeFromScene(a){_sceneController.scene.remove(a)}function clearScene(){var c,a;var b=_sceneController.scene;for(a=b.children.length-1;a>=0;a--){c=b.children[a];if(!(c instanceof THREE.Camera||c instanceof THREE.Mesh||c instanceof THREE.Light)){b.remove(c)}}}function cleanScene(){var c=_sceneController.loadedObjects;if(c.length>4){while(c.length>4){console.log("removing object: "+c[0].name);var a=_gui.leftGui.fileList.domElement.children[0].options;for(var b=0;b<a.length;b++){if(a[b].label==c[0].name){a[b].style.backgroundColor=null;break}}removeFromScene(c[0]);_sceneController.renderer.deallocateObject(c[0]);_sceneController.renderer.clear();c.splice(0,1)}}}function init(){var i=isMobileBrowser();_container=document.getElementById("container");var c=_sceneController.scene=new THREE.Scene();var b=i?0.5:1;var f=_sceneController.camera=new THREE.PerspectiveCamera(45,(window.innerWidth*b)/(window.innerHeight*b),1,70);f.position.set(17,10,15);f.lookAt(c.position);c.add(f);var g=_sceneController.pointLight=new THREE.PointLight(16777215);g.intensity=2;c.add(g);c.add(new THREE.AmbientLight(16777215));var d=i?false:true;var e=i?"lowp":"highp";_sceneController.sceneParams.resolution=b;var a=document.getElementById("glCanvas");if(i){a.id="mobileCanvas"}a.width=window.innerWidth*b;a.height=window.innerHeight*b;var h=_sceneController.renderer=new THREE.WebGLRenderer({antiAlias:d,preserveDrawingBuffer:false,precision:e,canvas:a});h.setClearColorHex(12303291,1);_container.appendChild(h.domElement);_objController=new THREE.Object3D();_objController.setCurrent=function(k){this.current=k;if(this.current){this.position.x=k.position.x;this.position.y=k.position.y;this.position.z=k.position.z;this.scale.x=k.scale.x;this.scale.y=k.scale.y;this.scale.z=k.scale.z;this.rotation.x=k.rotation.x;this.rotation.y=k.rotation.y;this.rotation.z=k.rotation.z;this.rotation.degrees.x=k.rotation.x/(Math.PI/180);this.rotation.degrees.y=k.rotation.y/(Math.PI/180);this.rotation.degrees.z=k.rotation.z/(Math.PI/180)}};_objController.loadNext="";_objController.loading=false;var j=_sceneController.controls=new THREE.TrackballControls(f,h.domElement);j.staticMoving=false;j.maxDistance=50;j.minDistance=5;j.rotateSpeed=0.7;j.zoomSpeed=0.9;j.panSpeed=0.4;j.keys=[65,83,68];windowResize(_sceneController.renderer,_sceneController.camera)}function initGUI(){_gui.leftGui=new dat.GUI({autoPlace:false});var d=document.getElementById("leftGui");d.appendChild(_gui.leftGui.domElement);var j=_objController.scale;var a=_objController.position;var b=_objController.rotation;var i=_sceneController.sceneParams;var f=_sceneController.pointLight;var e=_sceneController.camera;b.degrees=new THREE.Vector3(0,0,0);_objController.scaleFactor=1;var m=_gui.leftGui.addFolder("File controls");_gui.leftGui.fileList=m.add(_objController,"loadNext").options(_connection.serverFiles).onFinishChange(function(){if(_objController.loadNext!=""&&!_objController.loading){requestCollada(_objController.loadNext)}});var k=_gui.leftGui.fileList.domElement.children[0];k.options.add(new Option("Choose collada",""));m.open();var l=_gui.leftGui.objectControls=_gui.leftGui.addFolder("Object controls");l.add(j,"x",0.1,4,0.1).name("Scale x").onChange(function(n){_objController.current.scale.x=n});l.add(j,"y",0.1,4,0.1).name("Scale y").onChange(function(n){_objController.current.scale.y=n});l.add(j,"z",0.1,4,0.1).name("Scale z").onChange(function(n){_objController.current.scale.z=n});_gui.rightGui=new dat.GUI({autoPlace:false});var h=document.getElementById("rightGui");h.appendChild(_gui.rightGui.domElement);var g=_gui.rightGui.addFolder("Light settings");g.add(f,"intensity",0.1,2).step(0.1);g.open();var c=_gui.rightGui.addFolder("Render options");c.add(i,"colorMode",{"No colors":THREE.NoColors,VertexColors:THREE.VertexColors}).name("Color Mode").onFinishChange(function(){console.log(i.colorMode);setColorMode(_objController.current,i.colorMode)});c.open();if(THREEx.FullScreen.available()){THREEx.FullScreen.bindKey({charCode:"f".charCodeAt(0)})}}function loop(){requestAnimationFrame(loop);_sceneController.controls.update();var a=_sceneController.pointLight;var b=_sceneController.camera;a.position.x=b.position.x;a.position.y=b.position.y;a.position.z=b.position.z;if(_objController.current){a.lookAt(_objController.current.position)}_sceneController.renderer.render(_sceneController.scene,b)}initWSConnection();init();initGUI();loop();